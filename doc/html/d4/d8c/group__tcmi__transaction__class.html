<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_transaction class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d4/d8c/group__tcmi__transaction__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_transaction class<div class="ingroups"><a class="el" href="../../d4/d6b/group__tcmi__comm__group.html">communication</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A transaction in communication is setup when a request message expects a certain response from the receiving party.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_transaction class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d4/d8c/group__tcmi__transaction__class.png" border="0" alt="" usemap="#d4_2d8c_2group____tcmi____transaction____class"/>
<map name="d4_2d8c_2group____tcmi____transaction____class" id="d4_2d8c_2group____tcmi____transaction____class">
<area shape="rect" id="node1" href="../../d4/d6b/group__tcmi__comm__group.html" title="Classes in this group provide TCMI communication features." alt="" coords="6,5,117,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:d7/d6e/structtcmi__transaction"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a></td></tr>
<tr class="memdesc:d7/d6e/structtcmi__transaction"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compound structure holding transaction attributes.  <a href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">More...</a><br/></td></tr>
<tr class="separator:d7/d6e/structtcmi__transaction"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gac546d01fab4d43f08caecc3f4fd7a90f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gac546d01fab4d43f08caecc3f4fd7a90f">TCMI_TRANSACTION_INVAL_ID</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:gac546d01fab4d43f08caecc3f4fd7a90f"><td class="mdescLeft">&#160;</td><td class="mdescRight">denotes an invalid transaction ID  <a href="#gac546d01fab4d43f08caecc3f4fd7a90f">More...</a><br/></td></tr>
<tr class="separator:gac546d01fab4d43f08caecc3f4fd7a90f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga80351dda01e92bc0cb0f5c6695303931"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga80351dda01e92bc0cb0f5c6695303931">TCMI_TRANS_FLAGS_ANONYMOUS</a>&#160;&#160;&#160;0x00000001</td></tr>
<tr class="memdesc:ga80351dda01e92bc0cb0f5c6695303931"><td class="mdescLeft">&#160;</td><td class="mdescRight">Denotes a transaction, where nobody is waiting for the response.  <a href="#ga80351dda01e92bc0cb0f5c6695303931">More...</a><br/></td></tr>
<tr class="separator:ga80351dda01e92bc0cb0f5c6695303931"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf985d412d4b2c938c9d4c0572b68ae88"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaf985d412d4b2c938c9d4c0572b68ae88">TCMI_TRANS_FLAGS_EXPIRED</a>&#160;&#160;&#160;0x00000002</td></tr>
<tr class="memdesc:gaf985d412d4b2c938c9d4c0572b68ae88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Denotes an expired transaction that hasn't been completed.  <a href="#gaf985d412d4b2c938c9d4c0572b68ae88">More...</a><br/></td></tr>
<tr class="separator:gaf985d412d4b2c938c9d4c0572b68ae88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gad5b94b8d233636d6d4f48b82ae08e59d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">tcmi_trans_state_t</a> { <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da4e292aa5fe9fd9ad5a4f4065bfd2b9de">TCMI_TRANSACTION_INIT</a>, 
<a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59daf060d1cb75573424e7635dd1f809d660">TCMI_TRANSACTION_RUNNING</a>, 
<a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da22d0b0bfd58d5d11fe441caa7f2c6395">TCMI_TRANSACTION_COMPLETE</a>, 
<a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>
 }</td></tr>
<tr class="memdesc:gad5b94b8d233636d6d4f48b82ae08e59d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes the current state of the transaction:  <a href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">More...</a><br/></td></tr>
<tr class="separator:gad5b94b8d233636d6d4f48b82ae08e59d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad66082869d71dbe73b9a0b60cb2f437c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad66082869d71dbe73b9a0b60cb2f437c">tcmi_transaction_gen_id</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gad66082869d71dbe73b9a0b60cb2f437c"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Generates a transaction ID.  <a href="#gad66082869d71dbe73b9a0b60cb2f437c">More...</a><br/></td></tr>
<tr class="separator:gad66082869d71dbe73b9a0b60cb2f437c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga244e6188e1c4f9e1faba20d0892f5441"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga244e6188e1c4f9e1faba20d0892f5441">tcmi_transaction_timer</a> (unsigned long trans)</td></tr>
<tr class="memdesc:ga244e6188e1c4f9e1faba20d0892f5441"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts.  <a href="#ga244e6188e1c4f9e1faba20d0892f5441">More...</a><br/></td></tr>
<tr class="separator:ga244e6188e1c4f9e1faba20d0892f5441"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gada9d9436def8919a10997233cd6b5ea1"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1">tcmi_transaction_new</a> (struct <a class="el" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec">tcmi_slotvec</a> *transactions, u_int32_t resp_id, unsigned long timeout)</td></tr>
<tr class="memdesc:gada9d9436def8919a10997233cd6b5ea1"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Creates a new transaction.  <a href="#gada9d9436def8919a10997233cd6b5ea1">More...</a><br/></td></tr>
<tr class="separator:gada9d9436def8919a10997233cd6b5ea1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga653b1761a1b6e9fef415196c54e00768"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768">tcmi_transaction_start</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97">flags</a>)</td></tr>
<tr class="memdesc:ga653b1761a1b6e9fef415196c54e00768"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Starts a transaction.  <a href="#ga653b1761a1b6e9fef415196c54e00768">More...</a><br/></td></tr>
<tr class="separator:ga653b1761a1b6e9fef415196c54e00768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec110b630e8c0935ddddfb0529a03368"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaec110b630e8c0935ddddfb0529a03368">tcmi_transaction_abort</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaec110b630e8c0935ddddfb0529a03368"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Aborting the transaction.  <a href="#gaec110b630e8c0935ddddfb0529a03368">More...</a><br/></td></tr>
<tr class="separator:gaec110b630e8c0935ddddfb0529a03368"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga283a3e7e1414ff2eb5a49300c4af3208"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga283a3e7e1414ff2eb5a49300c4af3208">tcmi_transaction_complete</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, void *context, u_int32_t type_id)</td></tr>
<tr class="memdesc:ga283a3e7e1414ff2eb5a49300c4af3208"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Completes a transaction and wakes up the processing thread.  <a href="#ga283a3e7e1414ff2eb5a49300c4af3208">More...</a><br/></td></tr>
<tr class="separator:ga283a3e7e1414ff2eb5a49300c4af3208"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacb04fbb3689a2fffdef88873aa6cda62"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gacb04fbb3689a2fffdef88873aa6cda62">tcmi_transaction_lookup</a> (struct <a class="el" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec">tcmi_slotvec</a> *transactions, u_int32_t trans_id)</td></tr>
<tr class="memdesc:gacb04fbb3689a2fffdef88873aa6cda62"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Tries to find a transaction based on its ID.  <a href="#gacb04fbb3689a2fffdef88873aa6cda62">More...</a><br/></td></tr>
<tr class="separator:gacb04fbb3689a2fffdef88873aa6cda62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2748d267a8fddd1ced86e73ba8efd079"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079">tcmi_transaction_put</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga2748d267a8fddd1ced86e73ba8efd079"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Releases the instance - serialized version.  <a href="#ga2748d267a8fddd1ced86e73ba8efd079">More...</a><br/></td></tr>
<tr class="separator:ga2748d267a8fddd1ced86e73ba8efd079"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaba57811a17b10df187e7918d02e3679e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e">tcmi_transaction_lock</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaba57811a17b10df187e7918d02e3679e"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Locks the instance data.  <a href="#gaba57811a17b10df187e7918d02e3679e">More...</a><br/></td></tr>
<tr class="separator:gaba57811a17b10df187e7918d02e3679e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2c5c24c4b88dae68aa68c7b043d105b8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8">tcmi_transaction_unlock</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga2c5c24c4b88dae68aa68c7b043d105b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Unlocks the instance data  <a href="#ga2c5c24c4b88dae68aa68c7b043d105b8">More...</a><br/></td></tr>
<tr class="separator:ga2c5c24c4b88dae68aa68c7b043d105b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga176151d0f528ed8cda13e21da8551519"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519">tcmi_transaction_get</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga176151d0f528ed8cda13e21da8551519"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Instance accessor.  <a href="#ga176151d0f528ed8cda13e21da8551519">More...</a><br/></td></tr>
<tr class="separator:ga176151d0f528ed8cda13e21da8551519"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac666feaaab1fe5c341237a3e0283501"><td class="memItemLeft" align="right" valign="top">static u_int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501">tcmi_transaction_id</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaac666feaaab1fe5c341237a3e0283501"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Transaction ID accessor.  <a href="#gaac666feaaab1fe5c341237a3e0283501">More...</a><br/></td></tr>
<tr class="separator:gaac666feaaab1fe5c341237a3e0283501"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga01baf770d7a3fdaa6931024d50f9d039"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">tcmi_trans_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039">tcmi_transaction_state</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga01baf770d7a3fdaa6931024d50f9d039"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Transaction state accessor.  <a href="#ga01baf770d7a3fdaa6931024d50f9d039">More...</a><br/></td></tr>
<tr class="separator:ga01baf770d7a3fdaa6931024d50f9d039"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8a1027d8451c92d105ff818b0bf09c1d"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga8a1027d8451c92d105ff818b0bf09c1d">tcmi_transaction_context</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga8a1027d8451c92d105ff818b0bf09c1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Transaction context accessor.  <a href="#ga8a1027d8451c92d105ff818b0bf09c1d">More...</a><br/></td></tr>
<tr class="separator:ga8a1027d8451c92d105ff818b0bf09c1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1dfece4fcea1c1b9ce676f560957077f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga1dfece4fcea1c1b9ce676f560957077f">tcmi_transaction_set_flags</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97">flags</a>)</td></tr>
<tr class="memdesc:ga1dfece4fcea1c1b9ce676f560957077f"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes.  <a href="#ga1dfece4fcea1c1b9ce676f560957077f">More...</a><br/></td></tr>
<tr class="separator:ga1dfece4fcea1c1b9ce676f560957077f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga755c57502b82f1c20a9adcdea11990a9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9">tcmi_transaction_is_complete</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga755c57502b82f1c20a9adcdea11990a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Checks on a complete transaction.  <a href="#ga755c57502b82f1c20a9adcdea11990a9">More...</a><br/></td></tr>
<tr class="separator:ga755c57502b82f1c20a9adcdea11990a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafebfbc6a51c59cbdb2bd9470b82afc18"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gafebfbc6a51c59cbdb2bd9470b82afc18">tcmi_transaction_is_aborted</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gafebfbc6a51c59cbdb2bd9470b82afc18"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Checks on aborted transaction.  <a href="#gafebfbc6a51c59cbdb2bd9470b82afc18">More...</a><br/></td></tr>
<tr class="separator:gafebfbc6a51c59cbdb2bd9470b82afc18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf09ca8b38517289edf0bdb43ec06360d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaf09ca8b38517289edf0bdb43ec06360d">tcmi_transaction_is_running</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaf09ca8b38517289edf0bdb43ec06360d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Checks on a running transaction.  <a href="#gaf09ca8b38517289edf0bdb43ec06360d">More...</a><br/></td></tr>
<tr class="separator:gaf09ca8b38517289edf0bdb43ec06360d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga96d22d09c9571b01fee1eacf0b0c0b6b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#ga96d22d09c9571b01fee1eacf0b0c0b6b">tcmi_transaction_is_anon</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga96d22d09c9571b01fee1eacf0b0c0b6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Checks on an anonymous transaction.  <a href="#ga96d22d09c9571b01fee1eacf0b0c0b6b">More...</a><br/></td></tr>
<tr class="separator:ga96d22d09c9571b01fee1eacf0b0c0b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf52ce36271ace80aa4d1928e6a067a00"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaf52ce36271ace80aa4d1928e6a067a00">tcmi_transaction_wait</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaf52ce36271ace80aa4d1928e6a067a00"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Waits on a transaction till it expires or is completed.  <a href="#gaf52ce36271ace80aa4d1928e6a067a00">More...</a><br/></td></tr>
<tr class="separator:gaf52ce36271ace80aa4d1928e6a067a00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaadc5d69241ec4815bf37e041ec0844dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gaadc5d69241ec4815bf37e041ec0844dc">tcmi_transaction_wait_interruptible</a> (struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaadc5d69241ec4815bf37e041ec0844dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Waits on a transaction till it expires or is completed, the task can be prematurely woken up by a signal.  <a href="#gaadc5d69241ec4815bf37e041ec0844dc">More...</a><br/></td></tr>
<tr class="separator:gaadc5d69241ec4815bf37e041ec0844dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A transaction in communication is setup when a request message expects a certain response from the receiving party. </p>
<p>This class provides the functionality to create, start and complete such transaction.</p>
<p>An example: A PEN node wants to register with a CCN. It will send a registration request towards the CCN. A new transaction is started on the PEN side by the thread creating the initial message. The transaction is assigned following attributes:</p>
<ul>
<li>transaction ID</li>
<li>response message ID</li>
<li>response timeout</li>
<li>flags -<ul>
<li>anonymous - setting an anonymous flag means that the user doesn't wait for the response synchronously. This flag is checked by tcmi_msg.c::tcmi_msg_deliver() - see for details.</li>
<li>expired - the timer upon timout marks the transaction expired and sets it to aborted state. This flag is used when checking whether the timer went off or not (needed for transaction destruction).</li>
</ul>
</li>
</ul>
<p>The CCN receives the registration request performs some authentication tasks and sends a reply back. The response message will carry the transaction ID. On PEN, the message is identified based on the transaction ID and successfully received. The message then completes the transaction, which in turn wakes up the thread waiting for the message. Message delivery is closely coupled to transactions. See tcmi_msg.c::tcmi_msg_deliver().</p>
<p>There are few stages in transaction lifetime:</p>
<ul>
<li>INIT - this is the phase when the transaction is instantiated and inserted into a transaction slot vector, but not active yet</li>
<li>RUNNING - transaction is activated and the timout timer is running.</li>
<li>COMPLETE - transaction has been successfully finished, the context data is ready to be picked up by the transaction owner</li>
<li>ABORTED - if the transaction times out, the timer handler marks it aborted. The transaction owner is supposed to discard such transaction </li>
</ul>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="d7/d6e/structtcmi__transaction" id="d7/d6e/structtcmi__transaction"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_transaction</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Compound structure holding transaction attributes. </p>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00108">108</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_transaction:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/ded/structtcmi__transaction__coll__graph.png" border="0" usemap="#tcmi__transaction_coll__map" alt="Collaboration graph"/></div>
<map name="tcmi__transaction_coll__map" id="tcmi__transaction_coll__map">
<area shape="rect" id="node2" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec" title="A slot vector compound structure." alt="" coords="5,235,115,400"/><area shape="rect" id="node3" href="../../da/d0c/group__tcmi__slot__class.html#d9/dbb/structtcmi__slot" title="A slot compound structure." alt="" coords="67,5,177,171"/></map>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a02e325d0b49741870f3b56d61baa44bb"></a>void *</td>
<td class="fieldname">
context</td>
<td class="fielddoc">
pointer to the transaction context data - assigned upon successful completion. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a98ee4f56e31ede6a3d85874e326d29b2"></a>atomic_t</td>
<td class="fieldname">
flags</td>
<td class="fielddoc">
Flags describe additional attributes of the transaction. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a73091996ae55e0bc4e51055dbf8c5eaa"></a>u_int32_t</td>
<td class="fieldname">
id</td>
<td class="fielddoc">
transaction ID. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af1c3709de339ff8d6b5e90cc48fa3226"></a><a class="el" href="../../da/d0c/group__tcmi__slot__class.html#ga97f49e924fec185311972baf87d31897">tcmi_slot_node_t</a></td>
<td class="fieldname">
node</td>
<td class="fielddoc">
link for storing the transaction in a slot. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a96b6dca337918d11ba380b54bc317cab"></a>atomic_t</td>
<td class="fieldname">
ref_count</td>
<td class="fielddoc">
reference counter. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac4e33aa73f016a156bd9c54510144abf"></a>u_int32_t</td>
<td class="fieldname">
resp_id</td>
<td class="fielddoc">
response ID - verified upon transaction completion. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af35918e10831fd890472ef32452de5e0"></a>struct <a class="el" href="../../da/d0c/group__tcmi__slot__class.html#d9/dbb/structtcmi__slot">tcmi_slot</a> *</td>
<td class="fieldname">
slot</td>
<td class="fielddoc">
Slot where the transaction resides. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad49e750d7fd796aaa8acf00a2d80d5da"></a><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">tcmi_trans_state_t</a></td>
<td class="fieldname">
state</td>
<td class="fielddoc">
transaction state. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a1cb150c1999f546753d7571e4b724477"></a>spinlock_t</td>
<td class="fieldname">
t_lock</td>
<td class="fielddoc">
spin lock - serializes access to the transaction. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af731b85673bce3ebdf0ef8da18a8a601"></a>struct timer_list</td>
<td class="fieldname">
timer</td>
<td class="fielddoc">
timer used for transaction timeouts. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad3c13b5a770265fc9f6fbf81522a6aec"></a>struct <a class="el" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec">tcmi_slotvec</a> *</td>
<td class="fieldname">
transactions</td>
<td class="fielddoc">
Back-references to slotvec where the transaction is present. <p>. used to get access to slotvec lock to guard agains lookup/put races. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a28494f80dab2968d98d88cd8a1b500c5"></a>wait_queue_head_t</td>
<td class="fieldname">
wq</td>
<td class="fielddoc">
Sleeping processes, that are to be notified upon transaction time out or completion. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga80351dda01e92bc0cb0f5c6695303931"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_TRANS_FLAGS_ANONYMOUS&#160;&#160;&#160;0x00000001</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Denotes a transaction, where nobody is waiting for the response. </p>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00102">102</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00138">tcmi_msg_send_anonymous()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00297">tcmi_transaction_is_anon()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf985d412d4b2c938c9d4c0572b68ae88"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_TRANS_FLAGS_EXPIRED&#160;&#160;&#160;0x00000002</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Denotes an expired transaction that hasn't been completed. </p>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00104">104</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

</div>
</div>
<a class="anchor" id="gac546d01fab4d43f08caecc3f4fd7a90f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_TRANSACTION_INVAL_ID&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>denotes an invalid transaction ID </p>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00099">99</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d99/tcmi__authenticate__msg_8c_source.html#l00065">tcmi_authenticate_msg_new_tx()</a>, <a class="el" href="../../d4/dbc/tcmi__disconnect__msg_8c_source.html#l00061">tcmi_disconnect_msg_new_tx()</a>, <a class="el" href="../../d3/dbc/tcmi__exit__procmsg_8c_source.html#l00092">tcmi_exit_procmsg_new_tx()</a>, <a class="el" href="../../d3/d3d/tcmi__generic__user__msg_8c_source.html#l00062">tcmi_generic_user_msg_new_tx()</a>, <a class="el" href="../../da/dc4/tcmi__generic__user__procmsg_8c_source.html#l00062">tcmi_generic_user_procmsg_new_tx()</a>, <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00358">tcmi_guesttask_post_fork()</a>, <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00297">tcmi_msg_deliver()</a>, <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00041">tcmi_msg_init_shared()</a>, <a class="el" href="../../d3/d1b/tcmi__p__emigrate__msg_8c_source.html#l00102">tcmi_p_emigrate_msg_new_tx()</a>, <a class="el" href="../../d9/d25/tcmi__ppm__p__emigrate__msg_8c_source.html#l00102">tcmi_ppm_p_emigrate_msg_new_tx()</a>, <a class="el" href="../../d2/dd7/tcmi__ppm__p__migr__back__guestreq__procmsg_8c_source.html#l00096">tcmi_ppm_p_migr_back_guestreq_procmsg_new_tx()</a>, <a class="el" href="../../d0/dc6/tcmi__ppm__p__migr__back__shadowreq__procmsg_8c_source.html#l00065">tcmi_ppm_p_migr_back_shadowreq_procmsg_new_tx()</a>, <a class="el" href="../../d2/d95/tcmi__rpc__procmsg_8c_source.html#l00093">tcmi_rpc_procmsg_new_tx()</a>, <a class="el" href="../../d3/d5b/tcmi__signal__msg_8c_source.html#l00095">tcmi_signal_msg_new_tx()</a>, <a class="el" href="../../d8/d37/tcmi__skel__msg_8c_source.html#l00096">tcmi_skel_msg_new_tx()</a>, <a class="el" href="../../d5/d4c/tcmi__skel__procmsg_8c_source.html#l00097">tcmi_skel_procmsg_new_tx()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00360">tcmi_transaction_gen_id()</a>, and <a class="el" href="../../d2/d89/tcmi__vfork__done__procmsg_8c_source.html#l00064">tcmi_vfork_done_procmsg_new_tx()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="gad5b94b8d233636d6d4f48b82ae08e59d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">tcmi_trans_state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Describes the current state of the transaction: </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="ggad5b94b8d233636d6d4f48b82ae08e59da4e292aa5fe9fd9ad5a4f4065bfd2b9de"></a>TCMI_TRANSACTION_INIT</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="ggad5b94b8d233636d6d4f48b82ae08e59daf060d1cb75573424e7635dd1f809d660"></a>TCMI_TRANSACTION_RUNNING</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="ggad5b94b8d233636d6d4f48b82ae08e59da22d0b0bfd58d5d11fe441caa7f2c6395"></a>TCMI_TRANSACTION_COMPLETE</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98"></a>TCMI_TRANSACTION_ABORTED</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00091">91</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;             {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da4e292aa5fe9fd9ad5a4f4065bfd2b9de">TCMI_TRANSACTION_INIT</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59daf060d1cb75573424e7635dd1f809d660">TCMI_TRANSACTION_RUNNING</a>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da22d0b0bfd58d5d11fe441caa7f2c6395">TCMI_TRANSACTION_COMPLETE</a>,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;} <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d" title="Describes the current state of the transaction:">tcmi_trans_state_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaec110b630e8c0935ddddfb0529a03368"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* tcmi_transaction_abort </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Aborting the transaction. </p>
<p>&lt;&lt;public&gt;&gt; Aborting the transaction.</p>
<ul>
<li>deleting the timer and checking if it hasn't expired</li>
<li>if the timer has been deleted without expiring, it is necessary to drop the reference that the timer was retaining</li>
<li>proceed further if the transaction is in INIT or RUNNING state and change the state to ABORTED.</li>
<li>notifying the transaction owner</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>if the transaction has already been completed, it will return a valid context and doesn't change the transaction state. An aborted transaction has still its context set to NULL. </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00168">168</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00095">TCMI_TRANSACTION_ABORTED</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00264">tcmi_transaction_is_complete()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00174">tcmi_transaction_lock()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00328">tcmi_transaction_put()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00184">tcmi_transaction_unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00178">tcmi_msg_send_and_receive()</a>.</p>
<div class="fragment"><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;{</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">int</span> put_needed = 0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    del_timer_sync(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data.">tcmi_transaction_lock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (!tcmi_transaction_is_expired(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Transaction hasn&#39;t expired yet, dropping timer reference.&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        tcmi_transaction_set_expired(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        put_needed = 1;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* Transaction can be aborted from RUNNING as well as from</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">     * INIT state. */</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction.">tcmi_transaction_is_complete</a>(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Aborting..&quot;</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keyword">self</span>-&gt;state = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        tcmi_transaction_notify_owner(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data">tcmi_transaction_unlock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> ( put_needed ) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance.">tcmi_transaction_put</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;context;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_gaec110b630e8c0935ddddfb0529a03368_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_gaec110b630e8c0935ddddfb0529a03368_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_gaec110b630e8c0935ddddfb0529a03368_cgraph" id="d4/d8c/group__tcmi__transaction__class_gaec110b630e8c0935ddddfb0529a03368_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction." alt="" coords="222,5,357,46"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="215,71,364,97"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="218,121,361,148"/><area shape="rect" id="node15" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="208,172,371,199"/><area shape="rect" id="node5" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="425,45,551,72"/><area shape="rect" id="node6" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="421,96,555,123"/><area shape="rect" id="node7" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="427,147,549,173"/><area shape="rect" id="node14" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="419,197,557,224"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="606,96,743,123"/><area shape="rect" id="node12" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="621,147,728,173"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="615,197,735,224"/><area shape="rect" id="node9" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="814,71,933,97"/><area shape="rect" id="node10" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="793,121,954,148"/><area shape="rect" id="node11" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="1003,121,1115,148"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga283a3e7e1414ff2eb5a49300c4af3208"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_transaction_complete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>resp_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Completes a transaction and wakes up the processing thread. </p>
<p>The completion requires:</p>
<ul>
<li>deleting the running timer and checking if it hasn't expired</li>
<li>if the timer has been deleted without expiring, it is necessary to drop the reference that the timer was retaining</li>
<li>proceed further if the transaction is in running state ONLY</li>
<li>verifying, that the response ID in the transaction matches caller's expected response ID. The transaction is aborted if those two ID's don't match as apparently a wrong response has arrived.</li>
<li>upon successful completion, the context specified by the user, is associated with the transaction. That way, the transaction owner can read any data related to a particular transaction, when it picks up the completed transaction.</li>
<li>notifying the transaction owner</li>
</ul>
<p>Completing a transaction is performed under transaction lock being held.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this transaction instance </td></tr>
    <tr><td class="paramname">*context</td><td>- context that is to be assigned to the transaction upon successful completion. </td></tr>
    <tr><td class="paramname">resp_id</td><td>- response message ID that must match the ID set initially in the transaction. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 when sucessfully completed </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">223</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00137">tcmi_transaction::context</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00095">TCMI_TRANSACTION_ABORTED</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00094">TCMI_TRANSACTION_COMPLETE</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00286">tcmi_transaction_is_running()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00174">tcmi_transaction_lock()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00328">tcmi_transaction_put()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00226">tcmi_transaction_state()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00184">tcmi_transaction_unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00297">tcmi_msg_deliver()</a>.</p>
<div class="fragment"><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">/* default is error */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordtype">int</span> err = -EINVAL;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">int</span> put_needed = 0;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    del_timer_sync(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data.">tcmi_transaction_lock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (!tcmi_transaction_is_expired(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Transaction hasn&#39;t expired yet, dropping timer reference.&quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        tcmi_transaction_set_expired(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        put_needed = 1;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Transaction state: %d&quot;</span>, <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor.">tcmi_transaction_state</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaf09ca8b38517289edf0bdb43ec06360d" title="&lt;&lt;public&gt;&gt; Checks on a running transaction.">tcmi_transaction_is_running</a>(<span class="keyword">self</span>)) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Can&#39;t complete-transaction ID %x is not running!&quot;</span>, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ac4e33aa73f016a156bd9c54510144abf" title="response ID - verified upon transaction completion.">resp_id</a> == resp_id) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Successfully completing transaction ID %x&quot;</span>, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keyword">self</span>-&gt;state = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da22d0b0bfd58d5d11fe441caa7f2c6395">TCMI_TRANSACTION_COMPLETE</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keyword">self</span>-&gt;context = context;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        err = 0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keyword">self</span>-&gt;state = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR4, <span class="stringliteral">&quot;Aborting transaction ID %x, resp_id(%x)&quot;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;             <span class="stringliteral">&quot;doesn&#39;t match the expected resp_id(%x)!&quot;</span>, </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;             self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>, resp_id, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ac4e33aa73f016a156bd9c54510144abf" title="response ID - verified upon transaction completion.">resp_id</a>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">/* In every case notify the transaction owner*/</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    tcmi_transaction_notify_owner(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; exit0:</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data">tcmi_transaction_unlock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> ( put_needed )</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance.">tcmi_transaction_put</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_ga283a3e7e1414ff2eb5a49300c4af3208_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_ga283a3e7e1414ff2eb5a49300c4af3208_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_ga283a3e7e1414ff2eb5a49300c4af3208_cgraph" id="d4/d8c/group__tcmi__transaction__class_ga283a3e7e1414ff2eb5a49300c4af3208_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#gaf09ca8b38517289edf0bdb43ec06360d" title="&lt;&lt;public&gt;&gt; Checks on a running transaction." alt="" coords="246,5,381,46"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="239,71,388,97"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="242,121,385,148"/><area shape="rect" id="node15" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor." alt="" coords="236,172,391,199"/><area shape="rect" id="node16" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="232,223,395,249"/><area shape="rect" id="node5" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="449,45,575,72"/><area shape="rect" id="node6" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="445,96,579,123"/><area shape="rect" id="node7" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="451,147,573,173"/><area shape="rect" id="node14" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="443,197,581,224"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="630,96,767,123"/><area shape="rect" id="node12" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="645,147,752,173"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="639,197,759,224"/><area shape="rect" id="node9" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="838,71,957,97"/><area shape="rect" id="node10" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="817,121,978,148"/><area shape="rect" id="node11" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="1027,121,1139,148"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga8a1027d8451c92d105ff818b0bf09c1d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* tcmi_transaction_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Transaction context accessor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the context associated with the transaction </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00238">238</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00178">tcmi_msg_send_and_receive()</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;context;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gad66082869d71dbe73b9a0b60cb2f437c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_transaction_gen_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Generates a transaction ID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this transaction instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00360">360</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00099">TCMI_TRANSACTION_INVAL_ID</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00067">tcmi_transaction_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    u_int32_t <span class="keywordtype">id</span> = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gac546d01fab4d43f08caecc3f4fd7a90f" title="denotes an invalid transaction ID">TCMI_TRANSACTION_INVAL_ID</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">while</span> (<span class="keywordtype">id</span> == <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gac546d01fab4d43f08caecc3f4fd7a90f" title="denotes an invalid transaction ID">TCMI_TRANSACTION_INVAL_ID</a>) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        get_random_bytes(&amp;<span class="keywordtype">id</span>, <span class="keyword">sizeof</span>(u_int32_t));</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">self</span>-&gt;id = id;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Generated new transaction ID: %x&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga176151d0f528ed8cda13e21da8551519"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a>* tcmi_transaction_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Instance accessor. </p>
<p>increments the reference counter. The user is now guaranteed, that the instance stays in memory while he is using it. Assumes, the access is serialized by means of locking the slot where the instance resides.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a> instance </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00199">199</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00279">tcmi_transaction_lookup()</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00130">tcmi_transaction_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        atomic_inc(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a96b6dca337918d11ba380b54bc317cab" title="reference counter.">ref_count</a>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaac666feaaab1fe5c341237a3e0283501"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u_int32_t tcmi_transaction_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Transaction ID accessor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>transaction ID </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00213">213</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00297">tcmi_msg_deliver()</a>, <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00089">tcmi_msg_init_tx()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00279">tcmi_transaction_lookup()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00067">tcmi_transaction_new()</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00328">tcmi_transaction_put()</a>.</p>
<div class="fragment"><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;id;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gafebfbc6a51c59cbdb2bd9470b82afc18"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_is_aborted </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Checks on aborted transaction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if transaction has been aborted </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00275">275</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00095">TCMI_TRANSACTION_ABORTED</a>.</p>

<p>Referenced by <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00310">tcmi_transaction_wait()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00328">tcmi_transaction_wait_interruptible()</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;{</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">return</span> (self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> == <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga96d22d09c9571b01fee1eacf0b0c0b6b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_is_anon </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Checks on an anonymous transaction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if transaction is marked as anonymous. </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00297">297</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00102">TCMI_TRANS_FLAGS_ANONYMOUS</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00297">tcmi_msg_deliver()</a>.</p>
<div class="fragment"><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> atomic_read(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a98ee4f56e31ede6a3d85874e326d29b2" title="Flags describe additional attributes of the transaction.">flags</a>) &amp; <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga80351dda01e92bc0cb0f5c6695303931" title="Denotes a transaction, where nobody is waiting for the response.">TCMI_TRANS_FLAGS_ANONYMOUS</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga755c57502b82f1c20a9adcdea11990a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_is_complete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Checks on a complete transaction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if transaction has been successfully finished </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00264">264</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00094">TCMI_TRANSACTION_COMPLETE</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00168">tcmi_transaction_abort()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00310">tcmi_transaction_wait()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00328">tcmi_transaction_wait_interruptible()</a>.</p>
<div class="fragment"><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">return</span> (self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> == <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da22d0b0bfd58d5d11fe441caa7f2c6395">TCMI_TRANSACTION_COMPLETE</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf09ca8b38517289edf0bdb43ec06360d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_is_running </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Checks on a running transaction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if transaction is still running.. </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00286">286</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00093">TCMI_TRANSACTION_RUNNING</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">tcmi_transaction_complete()</a>.</p>
<div class="fragment"><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> (self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> == <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59daf060d1cb75573424e7635dd1f809d660">TCMI_TRANSACTION_RUNNING</a>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaba57811a17b10df187e7918d02e3679e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_transaction_lock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Locks the instance data. </p>
<p>Spin lock used - no sleeping allowed!</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00174">174</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00168">tcmi_transaction_abort()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">tcmi_transaction_complete()</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00130">tcmi_transaction_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    spin_lock(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a1cb150c1999f546753d7571e4b724477" title="spin lock - serializes access to the transaction.">t_lock</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gacb04fbb3689a2fffdef88873aa6cda62"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a>* tcmi_transaction_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec">tcmi_slotvec</a> *&#160;</td>
          <td class="paramname"><em>transactions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>trans_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Tries to find a transaction based on its ID. </p>
<p>This is a class method that tries to find a transaction instance. It computes a hash of the transaction ID and searches the slot at index equal to the hash value.</p>
<p>The access to the transaction is serialized via the slotvector that is being searched.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*transactions</td><td>- slot vector where to perform the search </td></tr>
    <tr><td class="paramname">trans_id</td><td>- ID used when searching for the transaction. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>transaction if found or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00279">279</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00221">minfo</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00111">tcmi_transaction::node</a>, <a class="el" href="../../d3/d94/tcmi__slot_8h_source.html#l00092">tcmi_slot_for_each_entry</a>, <a class="el" href="../../d3/dc2/tcmi__slotvec_8c_source.html#l00148">tcmi_slotvec_at()</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00250">tcmi_slotvec_hashmask()</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00226">tcmi_slotvec_lock()</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00237">tcmi_slotvec_unlock()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00199">tcmi_transaction_get()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00213">tcmi_transaction_id()</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00297">tcmi_msg_deliver()</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    u_int hash;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">/* slot where the hash of the transaction ID points to */</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../da/d0c/group__tcmi__slot__class.html#d9/dbb/structtcmi__slot" title="A slot compound structure.">tcmi_slot</a> *slot;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a> *tran = NULL;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">/* temporary storage for the slot elements, needed by the iterator */</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="../../da/d0c/group__tcmi__slot__class.html#ga97f49e924fec185311972baf87d31897" title="A slot node is in fact a hlist node.">tcmi_slot_node_t</a> *nd; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    hash = tcmi_transaction_hash(trans_id, <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor.">tcmi_slotvec_hashmask</a>(transactions));</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data.">tcmi_slotvec_lock</a>(transactions);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">/* get the slot, the hash is pointing too */</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (!(slot = <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index.">tcmi_slotvec_at</a>(transactions, hash))) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t locate slot&quot;</span>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">/* Search the slot for matching transaction */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="../../da/d0c/group__tcmi__slot__class.html#ga9ae513b589152761d653fa5ea07621fe" title="&lt;&lt;public&gt;&gt; Iterates through all nodes in the slot.">tcmi_slot_for_each_entry</a>(tran, nd, slot, <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af1c3709de339ff8d6b5e90cc48fa3226" title="link for storing the transaction in a slot.">node</a>) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor.">tcmi_transaction_id</a>(tran) == trans_id) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(INFO4,<span class="stringliteral">&quot;Found matching transaction ID %x&quot;</span>, trans_id);          </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">/* succesfully found a transaction, adjust its reference counter */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (tran)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor.">tcmi_transaction_get</a>(tran);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data.">tcmi_slotvec_unlock</a>(transactions);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> tran;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; exit0:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data.">tcmi_slotvec_unlock</a>(transactions);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_gacb04fbb3689a2fffdef88873aa6cda62_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_gacb04fbb3689a2fffdef88873aa6cda62_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_gacb04fbb3689a2fffdef88873aa6cda62_cgraph" id="d4/d8c/group__tcmi__transaction__class_gacb04fbb3689a2fffdef88873aa6cda62_cgraph">
<area shape="rect" id="node2" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index." alt="" coords="241,5,353,32"/><area shape="rect" id="node3" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor." alt="" coords="217,56,378,83"/><area shape="rect" id="node4" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="235,107,360,133"/><area shape="rect" id="node5" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="228,157,367,184"/><area shape="rect" id="node6" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor." alt="" coords="226,208,369,235"/><area shape="rect" id="node7" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="230,259,365,285"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gada9d9436def8919a10997233cd6b5ea1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a>* tcmi_transaction_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec">tcmi_slotvec</a> *&#160;</td>
          <td class="paramname"><em>transactions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>resp_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Creates a new transaction. </p>
<p>Instance is created as follows:</p>
<ul>
<li>allocate the instance</li>
<li>generate a transaction ID (random number)</li>
<li>initilialize wait queue for process(es) that is/are to be woken up when:<ul>
<li>the transaction times out or</li>
<li>when it is sucessfully completed</li>
</ul>
</li>
<li>store timeout that will be activated when the transaction is started.</li>
<li>store the transaction in the transaction slot vector specified by the user</li>
<li>setup reference counter</li>
<li>clear transaction flags - the transaction owner will adjust the flags afterwards</li>
<li>one instance reference is for the timer and one instance reference is returned to the instantiator</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*transactions</td><td>- storage for the transactions </td></tr>
    <tr><td class="paramname">resp_id</td><td>- response message ID - required for the transaction so that match the response upon completion. </td></tr>
    <tr><td class="paramname">timeout</td><td>- transaction time out </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new transaction or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00067">67</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00137">tcmi_transaction::context</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00126">tcmi_transaction::flags</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00116">tcmi_transaction::id</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00221">minfo</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00111">tcmi_transaction::node</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00140">tcmi_transaction::ref_count</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00119">tcmi_transaction::resp_id</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00113">tcmi_transaction::slot</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00123">tcmi_transaction::state</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00142">tcmi_transaction::t_lock</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00250">tcmi_slotvec_hashmask()</a>, <a class="el" href="../../d3/dc2/tcmi__slotvec_8c_source.html#l00199">tcmi_slotvec_insert_at()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00360">tcmi_transaction_gen_id()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00213">tcmi_transaction_id()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00092">TCMI_TRANSACTION_INIT</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00387">tcmi_transaction_timer()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00133">tcmi_transaction::timer</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00145">tcmi_transaction::transactions</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00130">tcmi_transaction::wq</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00089">tcmi_msg_init_tx()</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a> *trans;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">/* hash of the transaction ID */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    u_int hash;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (!(trans = kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a>), GFP_KERNEL))) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate memory for a transaction&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gad66082869d71dbe73b9a0b60cb2f437c" title="&lt;&lt;private&gt;&gt; Generates a transaction ID.">tcmi_transaction_gen_id</a>(trans);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    hash = tcmi_transaction_hash(trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>, <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor.">tcmi_slotvec_hashmask</a>(transactions));</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ac4e33aa73f016a156bd9c54510144abf" title="response ID - verified upon transaction completion.">resp_id</a> = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ac4e33aa73f016a156bd9c54510144abf" title="response ID - verified upon transaction completion.">resp_id</a>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da4e292aa5fe9fd9ad5a4f4065bfd2b9de">TCMI_TRANSACTION_INIT</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad3c13b5a770265fc9f6fbf81522a6aec" title="Back-references to slotvec where the transaction is present.">transactions</a> = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad3c13b5a770265fc9f6fbf81522a6aec" title="Back-references to slotvec where the transaction is present.">transactions</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    init_waitqueue_head(&amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a28494f80dab2968d98d88cd8a1b500c5" title="Sleeping processes, that are to be notified upon transaction time out or completion.">wq</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">/* setup the timer that handles transaction timeout */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    init_timer(&amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">/* the expiration has to be added the current value of jiffies</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">     * when the timer is started, but this is upon transaction start */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>.expires = timeout; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>.data = (<span class="keywordtype">unsigned</span> long) trans;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>.function = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga244e6188e1c4f9e1faba20d0892f5441" title="&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts.">tcmi_transaction_timer</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* context will be filled in upon response arrival */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a02e325d0b49741870f3b56d61baa44bb" title="pointer to the transaction context data - assigned upon successful completion.">context</a> = NULL;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">/* one reference goes the the transaction instantiator */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    atomic_set(&amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a96b6dca337918d11ba380b54bc317cab" title="reference counter.">ref_count</a>, 1);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    atomic_set(&amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a98ee4f56e31ede6a3d85874e326d29b2" title="Flags describe additional attributes of the transaction.">flags</a>, 0);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    spin_lock_init(&amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a1cb150c1999f546753d7571e4b724477" title="spin lock - serializes access to the transaction.">t_lock</a>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">/* now, the transaction is ready to be inserted into the slot vector */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> (!(trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af35918e10831fd890472ef32452de5e0" title="Slot where the transaction resides.">slot</a> = <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4f973395848150fbebecf3cc292c80ba" title="&lt;&lt;public&gt;&gt; The index where the insertion takes place has to be a valid slot.">tcmi_slotvec_insert_at</a>(transactions, hash, &amp;trans-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af1c3709de339ff8d6b5e90cc48fa3226" title="link for storing the transaction in a slot.">node</a>))) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t insert transaction into slot vector!&quot;</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Allocated transaction ID=%x, memory=%p&quot;</span>, </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;         <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor.">tcmi_transaction_id</a>(trans), trans);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">return</span> trans;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; exit1:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    kfree(trans);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; exit0:</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_gada9d9436def8919a10997233cd6b5ea1_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_gada9d9436def8919a10997233cd6b5ea1_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_gada9d9436def8919a10997233cd6b5ea1_cgraph" id="d4/d8c/group__tcmi__transaction__class_gada9d9436def8919a10997233cd6b5ea1_cgraph">
<area shape="rect" id="node2" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor." alt="" coords="203,81,365,108"/><area shape="rect" id="node3" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4f973395848150fbebecf3cc292c80ba" title="&lt;&lt;public&gt;&gt; The index where the insertion takes place has to be a valid slot." alt="" coords="414,56,565,83"/><area shape="rect" id="node9" href="../../d4/d8c/group__tcmi__transaction__class.html#gad66082869d71dbe73b9a0b60cb2f437c" title="&lt;&lt;private&gt;&gt; Generates a transaction ID." alt="" coords="203,284,365,311"/><area shape="rect" id="node10" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="615,259,750,285"/><area shape="rect" id="node11" href="../../d4/d8c/group__tcmi__transaction__class.html#ga244e6188e1c4f9e1faba20d0892f5441" title="&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts." alt="" coords="207,183,361,209"/><area shape="rect" id="node4" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index." alt="" coords="627,5,739,32"/><area shape="rect" id="node5" href="../../da/d0c/group__tcmi__slot__class.html#gaefe294678d9d6922b3af1e452a318fa1" title="&lt;&lt;public&gt;&gt; Inserts a new node into the slot." alt="" coords="625,56,740,83"/><area shape="rect" id="node6" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="816,56,923,83"/><area shape="rect" id="node7" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="1197,44,1309,71"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="809,107,929,133"/><area shape="rect" id="node12" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="418,183,561,209"/><area shape="rect" id="node13" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="620,157,745,184"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="621,107,744,133"/><area shape="rect" id="node18" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="613,208,752,235"/><area shape="rect" id="node15" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="801,157,938,184"/><area shape="rect" id="node16" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="1009,157,1127,184"/><area shape="rect" id="node17" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="987,81,1149,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2748d267a8fddd1ced86e73ba8efd079"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcmi_transaction_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Releases the instance - serialized version. </p>
<p>&lt;&lt;public&gt;&gt; Releases the instance - serialized version.</p>
<p>Decrements reference counter and if it reaches 0, the transaction is removed from its slot and freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00328">328</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../d3/d94/tcmi__slot_8h_source.html#l00339">tcmi_slot_remove()</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00226">tcmi_slotvec_lock()</a>, <a class="el" href="../../d8/dc3/tcmi__slotvec_8h_source.html#l00237">tcmi_slotvec_unlock()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00213">tcmi_transaction_id()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00168">tcmi_transaction_abort()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">tcmi_transaction_complete()</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00387">tcmi_transaction_timer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec" title="A slot vector compound structure.">tcmi_slotvec</a> *transactions;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span> ( !<span class="keyword">self</span> ) </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    transactions = <span class="keyword">self</span>-&gt;transactions;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// Transactions slotvec lock used to guard against lookup/put races</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data.">tcmi_slotvec_lock</a>(transactions);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span> &amp;&amp; atomic_dec_and_test(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a96b6dca337918d11ba380b54bc317cab" title="reference counter.">ref_count</a>)) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Destroying transaction ID=%x, memory=%p&quot;</span>, </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;             <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor.">tcmi_transaction_id</a>(<span class="keyword">self</span>), <span class="keyword">self</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot.">tcmi_slot_remove</a>(self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af35918e10831fd890472ef32452de5e0" title="Slot where the transaction resides.">slot</a>, &amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af1c3709de339ff8d6b5e90cc48fa3226" title="link for storing the transaction in a slot.">node</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        kfree(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data.">tcmi_slotvec_unlock</a>(transactions);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_ga2748d267a8fddd1ced86e73ba8efd079_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_ga2748d267a8fddd1ced86e73ba8efd079_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_ga2748d267a8fddd1ced86e73ba8efd079_cgraph" id="d4/d8c/group__tcmi__transaction__class_ga2748d267a8fddd1ced86e73ba8efd079_cgraph">
<area shape="rect" id="node2" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="205,81,328,108"/><area shape="rect" id="node9" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="204,132,329,159"/><area shape="rect" id="node10" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="197,183,336,209"/><area shape="rect" id="node11" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="199,233,334,260"/><area shape="rect" id="node3" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="385,31,522,57"/><area shape="rect" id="node7" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="400,81,507,108"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="393,132,513,159"/><area shape="rect" id="node4" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="593,5,711,32"/><area shape="rect" id="node5" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="571,56,733,83"/><area shape="rect" id="node6" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="781,56,893,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga1dfece4fcea1c1b9ce676f560957077f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_transaction_set_flags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes. </p>
<p>Valid flags are:</p>
<ul>
<li>TCMI_TRANS_FLAGS_DELETED - transaction marked for deletion</li>
<li>TCMI_TRANS_FLAGS_ANONYMOUS - transaction is anonymous,</li>
<li>TCMI_TRANS_FLAGS_EXPIRED - timer has expired.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
    <tr><td class="paramname">flags</td><td>- additional flag setting </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00253">253</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00130">tcmi_transaction_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    atomic_set_mask(<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97" title="flags specified by the user when opening the file">flags</a>, &amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a98ee4f56e31ede6a3d85874e326d29b2" title="Flags describe additional attributes of the transaction.">flags</a>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga653b1761a1b6e9fef415196c54e00768"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_transaction_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Starts a transaction. </p>
<p>The transaction is started only if it is in INIT state. The timer is started, so that a timeout can be handled automatically. The timer is assigned an extra reference for the transaction to prevent destruction of the transaction before the timer goes off in case of timeout.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this transaction instance </td></tr>
    <tr><td class="paramname">flags</td><td>- flags to be set on the running transaction </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon successful start of the transaction </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00130">130</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00199">tcmi_transaction_get()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00092">TCMI_TRANSACTION_INIT</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00174">tcmi_transaction_lock()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00093">TCMI_TRANSACTION_RUNNING</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00253">tcmi_transaction_set_flags()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00184">tcmi_transaction_unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00413">tcmi_msg_send()</a>.</p>
<div class="fragment"><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;{</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data.">tcmi_transaction_lock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> != <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da4e292aa5fe9fd9ad5a4f4065bfd2b9de">TCMI_TRANSACTION_INIT</a>) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t start - transaction (ID=%x),&quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;             <span class="stringliteral">&quot; not in INIT state! state=%d&quot;</span>, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        err = -EINVAL;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">/* reference counter for the timer */</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor.">tcmi_transaction_get</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga1dfece4fcea1c1b9ce676f560957077f" title="&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes.">tcmi_transaction_set_flags</a>(<span class="keyword">self</span>, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97" title="flags specified by the user when opening the file">flags</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">self</span>-&gt;timer.expires += jiffies;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keyword">self</span>-&gt;state = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59daf060d1cb75573424e7635dd1f809d660">TCMI_TRANSACTION_RUNNING</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Starting transaction ID %x, response ID %x&quot;</span>, </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;         self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a73091996ae55e0bc4e51055dbf8c5eaa" title="transaction ID.">id</a>, self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ac4e33aa73f016a156bd9c54510144abf" title="response ID - verified upon transaction completion.">resp_id</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    add_timer(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#af731b85673bce3ebdf0ef8da18a8a601" title="timer used for transaction timeouts.">timer</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; exit0:</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data">tcmi_transaction_unlock</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_ga653b1761a1b6e9fef415196c54e00768_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_ga653b1761a1b6e9fef415196c54e00768_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_ga653b1761a1b6e9fef415196c54e00768_cgraph" id="d4/d8c/group__tcmi__transaction__class_ga653b1761a1b6e9fef415196c54e00768_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor." alt="" coords="215,5,358,32"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="212,56,361,83"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga1dfece4fcea1c1b9ce676f560957077f" title="&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes." alt="" coords="215,107,358,149"/><area shape="rect" id="node5" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="205,173,368,200"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga01baf770d7a3fdaa6931024d50f9d039"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#gad5b94b8d233636d6d4f48b82ae08e59d">tcmi_trans_state_t</a> tcmi_transaction_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Transaction state accessor. </p>
<p>The transaction should be locked by the caller, so that the transaction state doesn't change when making decisions based on it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>curren transaction state </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00226">226</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">tcmi_transaction_complete()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00310">tcmi_transaction_wait()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00328">tcmi_transaction_wait_interruptible()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;{</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;state;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga244e6188e1c4f9e1faba20d0892f5441"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_transaction_timer </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>trans</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts. </p>
<p>This method is called upon timer expiration and means that no response has arrived so far, the transaction needs to be aborted. Expired flag is set to indicate that the timer has executed. This means that the 'complete' or 'abort' operations won't try to release the timer reference.</p>
<p>Also, the thread that handles the transaction is woken up.</p>
<p>Other transaction operations (complete, abort) are serialized with this method by means of del_timer_sync() - they cannot proceed any further until this method finishes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trans</td><td>- pointer to the transaction instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00387">387</a> of file <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html">tcmi_transaction.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00123">tcmi_transaction::state</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00095">TCMI_TRANSACTION_ABORTED</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00328">tcmi_transaction_put()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00067">tcmi_transaction_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;{</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a> *<span class="keyword">self</span> = (<span class="keyword">struct </span><a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction" title="Compound structure holding transaction attributes.">tcmi_transaction</a>*) trans;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keyword">self</span>-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ad49e750d7fd796aaa8acf00a2d80d5da" title="transaction state.">state</a> = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ggad5b94b8d233636d6d4f48b82ae08e59da390b6a98474b9960141360353fd0ac98">TCMI_TRANSACTION_ABORTED</a>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Transaction ID %x expired, aborting..&quot;</span>, <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;id);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    tcmi_transaction_set_expired(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    tcmi_transaction_notify_owner(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance.">tcmi_transaction_put</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_ga244e6188e1c4f9e1faba20d0892f5441_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_ga244e6188e1c4f9e1faba20d0892f5441_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_ga244e6188e1c4f9e1faba20d0892f5441_cgraph" id="d4/d8c/group__tcmi__transaction__class_ga244e6188e1c4f9e1faba20d0892f5441_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="209,81,351,108"/><area shape="rect" id="node3" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="407,5,532,32"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="402,56,537,83"/><area shape="rect" id="node5" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="408,107,531,133"/><area shape="rect" id="node12" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="400,157,539,184"/><area shape="rect" id="node6" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="587,56,725,83"/><area shape="rect" id="node10" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="603,107,709,133"/><area shape="rect" id="node11" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="596,157,716,184"/><area shape="rect" id="node7" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="795,31,914,57"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="774,81,935,108"/><area shape="rect" id="node9" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="984,81,1096,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2c5c24c4b88dae68aa68c7b043d105b8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_transaction_unlock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Unlocks the instance data </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00184">184</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00168">tcmi_transaction_abort()</a>, <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00223">tcmi_transaction_complete()</a>, and <a class="el" href="../../d4/d2c/tcmi__transaction_8c_source.html#l00130">tcmi_transaction_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    spin_unlock(&amp;self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a1cb150c1999f546753d7571e4b724477" title="spin lock - serializes access to the transaction.">t_lock</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf52ce36271ace80aa4d1928e6a067a00"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_wait </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Waits on a transaction till it expires or is completed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>transaction status </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00310">310</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00275">tcmi_transaction_is_aborted()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00264">tcmi_transaction_is_complete()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00226">tcmi_transaction_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">/* Sleep until the transaction times out or completes (response arrival) */</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    wait_event(self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a28494f80dab2968d98d88cd8a1b500c5" title="Sleeping processes, that are to be notified upon transaction time out or completion.">wq</a>, (<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gafebfbc6a51c59cbdb2bd9470b82afc18" title="&lt;&lt;public&gt;&gt; Checks on aborted transaction.">tcmi_transaction_is_aborted</a>(<span class="keyword">self</span>) || </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                  <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction.">tcmi_transaction_is_complete</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    ret = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor.">tcmi_transaction_state</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_gaf52ce36271ace80aa4d1928e6a067a00_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_gaf52ce36271ace80aa4d1928e6a067a00_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_gaf52ce36271ace80aa4d1928e6a067a00_cgraph" id="d4/d8c/group__tcmi__transaction__class_gaf52ce36271ace80aa4d1928e6a067a00_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#gafebfbc6a51c59cbdb2bd9470b82afc18" title="&lt;&lt;public&gt;&gt; Checks on aborted transaction." alt="" coords="213,5,347,46"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction." alt="" coords="213,70,347,111"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor." alt="" coords="203,136,357,163"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaadc5d69241ec4815bf37e041ec0844dc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_transaction_wait_interruptible </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d4/d8c/group__tcmi__transaction__class.html#d7/d6e/structtcmi__transaction">tcmi_transaction</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Waits on a transaction till it expires or is completed, the task can be prematurely woken up by a signal. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this transaction instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>transaction status or -ERESTARTSYS on signal arrival </dd></dl>

<p>Definition at line <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00328">328</a> of file <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html">tcmi_transaction.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00275">tcmi_transaction_is_aborted()</a>, <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00264">tcmi_transaction_is_complete()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00226">tcmi_transaction_state()</a>.</p>

<p>Referenced by <a class="el" href="../../db/dc8/tcmi__msg_8c_source.html#l00178">tcmi_msg_send_and_receive()</a>.</p>
<div class="fragment"><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">/* Sleep until the transaction times out or completes (response arrival) */</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    ret = wait_event_interruptible(self-&gt;<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#a28494f80dab2968d98d88cd8a1b500c5" title="Sleeping processes, that are to be notified upon transaction time out or completion.">wq</a>, (<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gafebfbc6a51c59cbdb2bd9470b82afc18" title="&lt;&lt;public&gt;&gt; Checks on aborted transaction.">tcmi_transaction_is_aborted</a>(<span class="keyword">self</span>) || </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                          <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction.">tcmi_transaction_is_complete</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0) </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Signal arrived&quot;</span>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        ret = <a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor.">tcmi_transaction_state</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d4/d8c/group__tcmi__transaction__class_gaadc5d69241ec4815bf37e041ec0844dc_cgraph.png" border="0" usemap="#d4/d8c/group__tcmi__transaction__class_gaadc5d69241ec4815bf37e041ec0844dc_cgraph" alt=""/></div>
<map name="d4/d8c/group__tcmi__transaction__class_gaadc5d69241ec4815bf37e041ec0844dc_cgraph" id="d4/d8c/group__tcmi__transaction__class_gaadc5d69241ec4815bf37e041ec0844dc_cgraph">
<area shape="rect" id="node2" href="../../d4/d8c/group__tcmi__transaction__class.html#gafebfbc6a51c59cbdb2bd9470b82afc18" title="&lt;&lt;public&gt;&gt; Checks on aborted transaction." alt="" coords="213,5,347,46"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#ga755c57502b82f1c20a9adcdea11990a9" title="&lt;&lt;public&gt;&gt; Checks on a complete transaction." alt="" coords="213,70,347,111"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga01baf770d7a3fdaa6931024d50f9d039" title="&lt;&lt;public&gt;&gt; Transaction state accessor." alt="" coords="203,136,357,163"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 7 2013 23:20:16 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
