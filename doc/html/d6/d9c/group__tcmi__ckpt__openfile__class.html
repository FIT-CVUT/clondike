<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_ckpt_openfile class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/d9c/group__tcmi__ckpt__openfile__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_ckpt_openfile class<div class="ingroups"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html">tcmi_ckpt class</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This is a helper &lt;&lt;singleton&gt;&gt; class used by the <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html">checkpoint </a> and provides functionality to:  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_openfile class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class.png" border="0" alt="" usemap="#d6_2d9c_2group____tcmi____ckpt____openfile____class"/>
<map name="d6_2d9c_2group____tcmi____ckpt____openfile____class" id="d6_2d9c_2group____tcmi____ckpt____openfile____class">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html" title="This is a helper class used by the checkpointing component that provides functionality to:..." alt="" coords="5,12,120,39"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:da/d2d/structtcmi__ckpt__openfile__generic__hdr"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr">tcmi_ckpt_openfile_generic_hdr</a></td></tr>
<tr class="memdesc:da/d2d/structtcmi__ckpt__openfile__generic__hdr"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes generic header that consists of a file type only - the options are new or dup file.  <a href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr">More...</a><br/></td></tr>
<tr class="separator:da/d2d/structtcmi__ckpt__openfile__generic__hdr"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d9/dba/structtcmi__ckpt__openfile__newfile__hdr"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#d9/dba/structtcmi__ckpt__openfile__newfile__hdr">tcmi_ckpt_openfile_newfile_hdr</a></td></tr>
<tr class="memdesc:d9/dba/structtcmi__ckpt__openfile__newfile__hdr"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes a file occurs in the checkpoint for the first time.  <a href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#d9/dba/structtcmi__ckpt__openfile__newfile__hdr">More...</a><br/></td></tr>
<tr class="separator:d9/dba/structtcmi__ckpt__openfile__newfile__hdr"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:df/d46/structtcmi__ckpt__openfile__dupfile__hdr"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#df/d46/structtcmi__ckpt__openfile__dupfile__hdr">tcmi_ckpt_openfile_dupfile_hdr</a></td></tr>
<tr class="memdesc:df/d46/structtcmi__ckpt__openfile__dupfile__hdr"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes a duplicate file.  <a href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#df/d46/structtcmi__ckpt__openfile__dupfile__hdr">More...</a><br/></td></tr>
<tr class="separator:df/d46/structtcmi__ckpt__openfile__dupfile__hdr"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga6a693d5f473e7e5df156e4780bf9361e"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga6a693d5f473e7e5df156e4780bf9361e">tcmi_ckpt_openfile_chunk_t</a> { <a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea9a1c84edc582c7d3e5f0e04ab5d6e75c">TCMI_CKPT_OPENFILE_NEWFILE</a> = 0, 
<a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea529c292ff4c6bc295a6ff0937789a16a">TCMI_CKPT_OPENFILE_DUPFILE</a>
 }</td></tr>
<tr class="memdesc:ga6a693d5f473e7e5df156e4780bf9361e"><td class="mdescLeft">&#160;</td><td class="mdescRight">describes various chunks of the checkpoint file  <a href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga6a693d5f473e7e5df156e4780bf9361e">More...</a><br/></td></tr>
<tr class="separator:ga6a693d5f473e7e5df156e4780bf9361e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafe70b47b94f4f0cccf013f758d89f046"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gafe70b47b94f4f0cccf013f758d89f046">tcmi_ckpt_openfile_write_dupfd</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a58b8b022922cec0da05d41c361c0760b">dup_fd</a>)</td></tr>
<tr class="memdesc:gafe70b47b94f4f0cccf013f758d89f046"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Writes a duplicate file descriptor chunk into the checkpoint file.  <a href="#gafe70b47b94f4f0cccf013f758d89f046">More...</a><br/></td></tr>
<tr class="separator:gafe70b47b94f4f0cccf013f758d89f046"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabe85fffb1a72d2cf11ccde5f557ec3b6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gabe85fffb1a72d2cf11ccde5f557ec3b6">tcmi_ckpt_openfile_write_newfd</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>, struct file *file)</td></tr>
<tr class="memdesc:gabe85fffb1a72d2cf11ccde5f557ec3b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Writes a new file chunk into the checkpoint file.  <a href="#gabe85fffb1a72d2cf11ccde5f557ec3b6">More...</a><br/></td></tr>
<tr class="separator:gabe85fffb1a72d2cf11ccde5f557ec3b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac7b4f72b5f4bf1f21f74a5bc178284c8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gac7b4f72b5f4bf1f21f74a5bc178284c8">tcmi_ckpt_openfile_read_dupfd</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt)</td></tr>
<tr class="memdesc:gac7b4f72b5f4bf1f21f74a5bc178284c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Reads a duplicate file descriptor chunk from the checkpoint file.  <a href="#gac7b4f72b5f4bf1f21f74a5bc178284c8">More...</a><br/></td></tr>
<tr class="separator:gac7b4f72b5f4bf1f21f74a5bc178284c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga59af0d4928f72054b6034dc4fe11fcab"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga59af0d4928f72054b6034dc4fe11fcab">tcmi_ckpt_openfile_read_newfd</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt)</td></tr>
<tr class="memdesc:ga59af0d4928f72054b6034dc4fe11fcab"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Reads a new file chunk from the checkpoint file.  <a href="#ga59af0d4928f72054b6034dc4fe11fcab">More...</a><br/></td></tr>
<tr class="separator:ga59af0d4928f72054b6034dc4fe11fcab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga50221367e08188fc05da394d19eb51b3"><td class="memItemLeft" align="right" valign="top">struct <br class="typebreak"/>
<a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr">tcmi_ckpt_openfile_generic_hdr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga50221367e08188fc05da394d19eb51b3">__attribute__</a> ((__packed__))</td></tr>
<tr class="separator:ga50221367e08188fc05da394d19eb51b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1ea75bd539338fdc841bcf97c1a32bef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga1ea75bd539338fdc841bcf97c1a32bef">tcmi_ckpt_openfile_write</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>, struct file *file)</td></tr>
<tr class="memdesc:ga1ea75bd539338fdc841bcf97c1a32bef"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes an open file information into the checkpoint file.  <a href="#ga1ea75bd539338fdc841bcf97c1a32bef">More...</a><br/></td></tr>
<tr class="separator:ga1ea75bd539338fdc841bcf97c1a32bef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4fb86af944ddd746553b26ce509b60c8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga4fb86af944ddd746553b26ce509b60c8">tcmi_ckpt_openfile_read</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt)</td></tr>
<tr class="memdesc:ga4fb86af944ddd746553b26ce509b60c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads and restores an open file from the checkpoint file.  <a href="#ga4fb86af944ddd746553b26ce509b60c8">More...</a><br/></td></tr>
<tr class="separator:ga4fb86af944ddd746553b26ce509b60c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga733163f46fde5d5e4502bf35fe4f8a4d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d">tcmi_ckpt_openfile_supported</a> (struct inode *inode)</td></tr>
<tr class="memdesc:ga733163f46fde5d5e4502bf35fe4f8a4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Class method - checks if the specified file(represented by its inode) is supported by checkpoint.  <a href="#ga733163f46fde5d5e4502bf35fe4f8a4d">More...</a><br/></td></tr>
<tr class="separator:ga733163f46fde5d5e4502bf35fe4f8a4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gaf21c5b697bdf548bcbec21e762a194dd"><td class="memItemLeft" align="right" valign="top">typedef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gaf21c5b697bdf548bcbec21e762a194dd">__attribute__</a></td></tr>
<tr class="separator:gaf21c5b697bdf548bcbec21e762a194dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This is a helper &lt;&lt;singleton&gt;&gt; class used by the <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html">checkpoint </a> and provides functionality to: </p>
<ul>
<li>write an information about an open file into the checkpoint</li>
<li>restore/reopen a file based on information in the checkpoint</li>
</ul>
<p>The checkpoint instance during checkpoint image creation passes each file along with its file descriptor and current file descriptor cache to this component. The are two separate cases:</p>
<ul>
<li>the file information has already been written into the checkpoint - this is indicated by a file object being already present in the <a class="el" href="../../dd/d41/group__tcmi__fdcache__class.html">file descriptor cache </a>. In this case only a short information about a file is written into the checkpoint file - it's current file descriptor and the file descriptor that it's duplicating</li>
<li>the file information hasn't been written into the checkpoint (not present in the fd cache). In this case a full record is required:<ul>
<li>file descriptor</li>
<li>current position in file</li>
<li>file flags used when opening the file</li>
<li>file access mode</li>
<li>file type(regular/directory/char/block device/pipe/socket/symlink)</li>
<li>full pathname</li>
</ul>
</li>
</ul>
<p>Initial implementation supports checkpointing of regular files and directories only. There is a limited support when checkpointing open character devices - seek operation is omitted. Future implementation when restoring the open files should consider the circumstances and decided to reopen the original file or special proxy file. The main purpose of the proxy file will be to forward all requests to the original node.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000002">Todo:</a></b></dt><dd>Implement handling of special files (character devices/block devices, pipes, sockets)</dd></dl>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="da/d2d/structtcmi__ckpt__openfile__generic__hdr" id="da/d2d/structtcmi__ckpt__openfile__generic__hdr"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt_openfile_generic_hdr</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Describes generic header that consists of a file type only - the options are new or dup file. </p>

<p>Definition at line <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00101">101</a> of file <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html">tcmi_ckpt_openfile.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_openfile_generic_hdr:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d1e/structtcmi__ckpt__openfile__generic__hdr__coll__graph.png" border="0" usemap="#tcmi__ckpt__openfile__generic__hdr_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a8c18bd286b7d90fac49fc160360dffc7"></a><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga6a693d5f473e7e5df156e4780bf9361e">tcmi_ckpt_openfile_chunk_t</a></td>
<td class="fieldname">
restore_type</td>
<td class="fielddoc">
type of the open file </td></tr>
</table>

</div>
</div>
<a name="d9/dba/structtcmi__ckpt__openfile__newfile__hdr" id="d9/dba/structtcmi__ckpt__openfile__newfile__hdr"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt_openfile_newfile_hdr</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Describes a file occurs in the checkpoint for the first time. </p>

<p>Definition at line <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00108">108</a> of file <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html">tcmi_ckpt_openfile.h</a>.</p>
</div><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_openfile_newfile_hdr:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d8/dd2/structtcmi__ckpt__openfile__newfile__hdr__coll__graph.png" border="0" usemap="#tcmi__ckpt__openfile__newfile__hdr_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ae5e1143dd3049e7c1e6816c3f8c0c640"></a>int32_t</td>
<td class="fieldname">
fd</td>
<td class="fielddoc">
file descriptor </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a6dc1a3950398d9aee741356fe1448f13"></a>u_int32_t</td>
<td class="fieldname">
flags</td>
<td class="fielddoc">
flags specified by the user when opening the file </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a480b7ebcbf2a04c64efb31e220ad6d3f"></a>u_int32_t</td>
<td class="fieldname">
mode</td>
<td class="fielddoc">
access mode for the file </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab37e179954650c9c2a36a4c0c6f1d874"></a>int32_t</td>
<td class="fieldname">
pathname_size</td>
<td class="fielddoc">
length of the pathname string (including trailing zero) </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab795869ae260c5ed9a8f0755a3fcc1ec"></a>u_int64_t</td>
<td class="fieldname">
pos</td>
<td class="fielddoc">
current position in the file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a89960b468de476eb82bd90f39d1c64d8"></a>u_int32_t</td>
<td class="fieldname">
type</td>
<td class="fielddoc">
file type </td></tr>
</table>

</div>
</div>
<a name="df/d46/structtcmi__ckpt__openfile__dupfile__hdr" id="df/d46/structtcmi__ckpt__openfile__dupfile__hdr"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt_openfile_dupfile_hdr</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Describes a duplicate file. </p>
<p>The duplicate file descriptor refers to the original file object that has been open for the first time. That is: 'dup_fd' has to be duplicated into 'fd' upon checkpoint restart. </p>

<p>Definition at line <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00128">128</a> of file <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html">tcmi_ckpt_openfile.h</a>.</p>
</div><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_openfile_dupfile_hdr:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../db/d20/structtcmi__ckpt__openfile__dupfile__hdr__coll__graph.png" border="0" usemap="#tcmi__ckpt__openfile__dupfile__hdr_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a2b47fdd97425197292bd0717de23ad7d"></a>int32_t</td>
<td class="fieldname">
dup_fd</td>
<td class="fielddoc">
file descriptor that refers to the actual file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="adeb2eabc48996f236e15e3665de9c703"></a>int32_t</td>
<td class="fieldname">
fd</td>
<td class="fielddoc">
file descriptor </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="ga6a693d5f473e7e5df156e4780bf9361e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga6a693d5f473e7e5df156e4780bf9361e">tcmi_ckpt_openfile_chunk_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>describes various chunks of the checkpoint file </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="gga6a693d5f473e7e5df156e4780bf9361ea9a1c84edc582c7d3e5f0e04ab5d6e75c"></a>TCMI_CKPT_OPENFILE_NEWFILE</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="gga6a693d5f473e7e5df156e4780bf9361ea529c292ff4c6bc295a6ff0937789a16a"></a>TCMI_CKPT_OPENFILE_DUPFILE</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00092">92</a> of file <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html">tcmi_ckpt_openfile.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;             {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">/* new file */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea9a1c84edc582c7d3e5f0e04ab5d6e75c">TCMI_CKPT_OPENFILE_NEWFILE</a> = 0,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">/* duplicate file descriptor, refers to some regular file */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea529c292ff4c6bc295a6ff0937789a16a">TCMI_CKPT_OPENFILE_DUPFILE</a></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;} <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga6a693d5f473e7e5df156e4780bf9361e" title="describes various chunks of the checkpoint file">tcmi_ckpt_openfile_chunk_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga50221367e08188fc05da394d19eb51b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr">tcmi_ckpt_openfile_generic_hdr</a> __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__packed__)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga4fb86af944ddd746553b26ce509b60c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_openfile_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads and restores an open file from the checkpoint file. </p>
<p>Restoring the open file requires:</p>
<ul>
<li>detecting whether the file to be restored requires only duplication of an existing file descriptor or reopening the file from scratch.</li>
<li>after reading the header, the work is delegated to corresponding method.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint instance, that we are restoring from </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00087">87</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00103">tcmi_ckpt_openfile_generic_hdr::restore_type</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00096">TCMI_CKPT_OPENFILE_DUPFILE</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00094">TCMI_CKPT_OPENFILE_NEWFILE</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00256">tcmi_ckpt_openfile_read_dupfd()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00293">tcmi_ckpt_openfile_read_newfd()</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00223">tcmi_ckpt_read_files()</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">int</span> err = -EINVAL;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr" title="Describes generic header that consists of a file type only - the options are new or dup file...">tcmi_ckpt_openfile_generic_hdr</a> hdr;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, &amp;hdr, <span class="keyword">sizeof</span>(hdr)) &lt; 0) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading file generic header&quot;</span>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            err = -EINVAL;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Read generic file header restore type: %08x&quot;</span>, hdr.restore_type);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">switch</span> (hdr.restore_type) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea9a1c84edc582c7d3e5f0e04ab5d6e75c">TCMI_CKPT_OPENFILE_NEWFILE</a>:</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga59af0d4928f72054b6034dc4fe11fcab" title="&lt;&lt;private&gt;&gt; Reads a new file chunk from the checkpoint file.">tcmi_ckpt_openfile_read_newfd</a>(ckpt);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea529c292ff4c6bc295a6ff0937789a16a">TCMI_CKPT_OPENFILE_DUPFILE</a>:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gac7b4f72b5f4bf1f21f74a5bc178284c8" title="&lt;&lt;private&gt;&gt; Reads a duplicate file descriptor chunk from the checkpoint file.">tcmi_ckpt_openfile_read_dupfd</a>(ckpt);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unknown restore type %x&quot;</span>, hdr.restore_type);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            err = -EINVAL;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; exit0:</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_ga4fb86af944ddd746553b26ce509b60c8_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_ga4fb86af944ddd746553b26ce509b60c8_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_ga4fb86af944ddd746553b26ce509b60c8_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_ga4fb86af944ddd746553b26ce509b60c8_cgraph">
<area shape="rect" id="node2" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gac7b4f72b5f4bf1f21f74a5bc178284c8" title="&lt;&lt;private&gt;&gt; Reads a duplicate file descriptor chunk from the checkpoint file." alt="" coords="216,5,347,46"/><area shape="rect" id="node5" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga59af0d4928f72054b6034dc4fe11fcab" title="&lt;&lt;private&gt;&gt; Reads a new file chunk from the checkpoint file." alt="" coords="216,70,347,111"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="395,77,506,104"/><area shape="rect" id="node4" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="555,77,701,104"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac7b4f72b5f4bf1f21f74a5bc178284c8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_openfile_read_dupfd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Reads a duplicate file descriptor chunk from the checkpoint file. </p>
<p>The original file descriptor (dup_fd) is duplicated into the file descriptor of this chunk (fd). Both then refer to the same file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00256">256</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00132">tcmi_ckpt_openfile_dupfile_hdr::dup_fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00130">tcmi_ckpt_openfile_dupfile_hdr::fd</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00087">tcmi_ckpt_openfile_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#df/d46/structtcmi__ckpt__openfile__dupfile__hdr" title="Describes a duplicate file.">tcmi_ckpt_openfile_dupfile_hdr</a> dup_hdr;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, &amp;dup_hdr, <span class="keyword">sizeof</span>(dup_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading dupfd chunk&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> ((err = sys_dup2(dup_hdr.dup_fd, dup_hdr.fd)) != dup_hdr.fd) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error duplicating file descriptor %d into %d, error=%d!&quot;</span>, </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;             dup_hdr.dup_fd, dup_hdr.fd, err);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Restored duplicate file descriptor fd=%d, dup_fd=%d&quot;</span>, dup_hdr.fd, dup_hdr.dup_fd);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; exit0:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_gac7b4f72b5f4bf1f21f74a5bc178284c8_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_gac7b4f72b5f4bf1f21f74a5bc178284c8_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_gac7b4f72b5f4bf1f21f74a5bc178284c8_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_gac7b4f72b5f4bf1f21f74a5bc178284c8_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="185,12,295,39"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="345,12,490,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga59af0d4928f72054b6034dc4fe11fcab"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_openfile_read_newfd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Reads a new file chunk from the checkpoint file. </p>
<p>This includes:</p>
<ul>
<li>file descriptor</li>
<li>current position in the file</li>
<li>length of the file pathname</li>
<li>filepathname Opens the file with the same descriptor(might require using dup2 system call) and seeks to the specified position. Since the stdin/stdout/stderr might appear in the checkpoint image, we skip those for now - they are of type character device.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00293">293</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00110">tcmi_ckpt_openfile_newfile_hdr::fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00123">fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00114">tcmi_ckpt_openfile_newfile_hdr::flags</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00116">tcmi_ckpt_openfile_newfile_hdr::mode</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00120">tcmi_ckpt_openfile_newfile_hdr::pathname_size</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00112">tcmi_ckpt_openfile_newfile_hdr::pos</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>, and <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00118">tcmi_ckpt_openfile_newfile_hdr::type</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00087">tcmi_ckpt_openfile_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;{</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#d9/dba/structtcmi__ckpt__openfile__newfile__hdr" title="Describes a file occurs in the checkpoint for the first time.">tcmi_ckpt_openfile_newfile_hdr</a> new_hdr;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    mm_segment_t old_fs;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a> = -1;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">/* page for the filepathname */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    old_fs = get_fs();</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    set_fs(get_ds());</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, &amp;new_hdr, <span class="keyword">sizeof</span>(new_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading newfd chunk&quot;</span>);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Read: Fd: %ld, Pos %llu, File name size: %lu, Flags: %08lo, Mode: %08lo&quot;</span>, (<span class="keywordtype">long</span>)new_hdr.fd, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)new_hdr.pos, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.pathname_size, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.flags, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.mode);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span> ( new_hdr.pathname_size &gt;= PAGE_SIZE )</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">/* resolve the path name. */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for file pathname!&quot;</span>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, (<span class="keywordtype">char</span> *)page, new_hdr.pathname_size) &lt; 0) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading file pathname chunk&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">/* reopen directory and regular files  */</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> ((S_ISDIR(new_hdr.type) || S_ISREG(new_hdr.type) || S_ISCHR(new_hdr.type) || S_ISFIFO(new_hdr.type))) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">/* open */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> ((fd = do_sys_open(AT_FDCWD, (<span class="keywordtype">char</span>*)page, (<span class="keywordtype">int</span>)new_hdr.flags, (<span class="keywordtype">int</span>)new_hdr.mode)) &lt; 0) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error opening file &#39;%s&#39;, err=%d&quot;</span>, (<span class="keywordtype">char</span>*)page, fd);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="comment">/* setup the file position */</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">if</span> (new_hdr.pos != vfs_llseek(current-&gt;files-&gt;fdt-&gt;fd[fd], new_hdr.pos, 0)) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to set position %Lx in file &#39;%s&#39;&quot;</span>, new_hdr.pos, (<span class="keywordtype">char</span>*)page);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">    if ( S_ISCHR(new_hdr.type) || S_ISFIFO(new_hdr.type) ){ // Forward operations via proxyfile</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">        mdbg(INFO3, &quot;File &#39;%s&#39; fd = %d will be accesed trought proxyfile&quot;, (char*)page, new_hdr.fd);</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">        tcmi_ckpt_proxy_path((char*)page, (char*)page);</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">        mdbg(INFO3, &quot;Opening file &#39;%s&#39; fd = %d&quot;, (char*)page, new_hdr.fd);</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">        if ((fd = sys_open((char*)page, new_hdr.flags, new_hdr.mode)) &lt; 0) {</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">            mdbg(ERR3, &quot;Error opening file &#39;%s&#39;, err=%d&quot;, (char*)page, fd);</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">            goto exit1;</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/* set the original descriptor of the file */</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (new_hdr.fd != fd) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Duplicating file descriptor %d into %d!&quot;</span>, fd, new_hdr.fd);     </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span> (sys_dup2(fd, new_hdr.fd) != new_hdr.fd) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error duplicating file descriptor %d into %d!&quot;</span>, fd, new_hdr.fd);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        sys_close(fd);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Restored new file descriptor fd=%d, pos=%Lx, type=%0o, &quot;</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;         <span class="stringliteral">&quot;pathname_size=%d, pathname=&#39;%s&#39;&quot;</span>,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;         new_hdr.fd, new_hdr.pos, new_hdr.type, new_hdr.pathname_size, (<span class="keywordtype">char</span>*)page);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    set_fs(old_fs);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; exit1:</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; exit0:</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    set_fs(old_fs);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_ga59af0d4928f72054b6034dc4fe11fcab_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_ga59af0d4928f72054b6034dc4fe11fcab_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_ga59af0d4928f72054b6034dc4fe11fcab_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_ga59af0d4928f72054b6034dc4fe11fcab_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="185,12,295,39"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="345,12,490,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga733163f46fde5d5e4502bf35fe4f8a4d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_openfile_supported </td>
          <td>(</td>
          <td class="paramtype">struct inode *&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Class method - checks if the specified file(represented by its inode) is supported by checkpoint. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*inode</td><td>- inode to be checked </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00147">147</a> of file <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html">tcmi_ckpt_openfile.h</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00344">tcmi_ckpt_file_count()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span> (S_ISREG(inode-&gt;i_mode) || S_ISDIR(inode-&gt;i_mode) || S_ISCHR(inode-&gt;i_mode) || S_ISFIFO(inode-&gt;i_mode) );</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga1ea75bd539338fdc841bcf97c1a32bef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_openfile_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes an open file information into the checkpoint file. </p>
<p>Writing the information about an open file requires:</p>
<ul>
<li>checking if there is the same file object already stored in the file descriptor cache of the checkpoint. This indicates that such file has already been written into the checkpoint. In that case we delegate the work to write_dupfd.</li>
<li>othewise we delegate the work to write_newfd method that stores the full file information in about the file.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint instance, that we are writing into </td></tr>
    <tr><td class="paramname">fd</td><td>- file descriptor of associated with the file object </td></tr>
    <tr><td class="paramname">*file</td><td>- file whose information is be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00060">60</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00137">dup_fd</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00323">tcmi_ckpt_fdcache_lookup()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00133">tcmi_ckpt_openfile_write_dupfd()</a>, and <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00170">tcmi_ckpt_openfile_write_newfd()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00194">tcmi_ckpt_write_files()</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a58b8b022922cec0da05d41c361c0760b" title="file descriptor that refers to the actual file.">dup_fd</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">/* search for the file descriptor in the cache first */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> ( (dup_fd = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5847c258ee160509359de5f5c27a2c33" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file.">tcmi_ckpt_fdcache_lookup</a>(ckpt, file)) &gt;= 0)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gafe70b47b94f4f0cccf013f758d89f046" title="&lt;&lt;private&gt;&gt; Writes a duplicate file descriptor chunk into the checkpoint file.">tcmi_ckpt_openfile_write_dupfd</a>(ckpt, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, dup_fd);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">/* not found, write the whole file details. */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gabe85fffb1a72d2cf11ccde5f557ec3b6" title="&lt;&lt;private&gt;&gt; Writes a new file chunk into the checkpoint file.">tcmi_ckpt_openfile_write_newfd</a>(ckpt, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, file);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_ga1ea75bd539338fdc841bcf97c1a32bef_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_ga1ea75bd539338fdc841bcf97c1a32bef_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_ga1ea75bd539338fdc841bcf97c1a32bef_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_ga1ea75bd539338fdc841bcf97c1a32bef_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5847c258ee160509359de5f5c27a2c33" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file." alt="" coords="184,5,360,32"/><area shape="rect" id="node4" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gafe70b47b94f4f0cccf013f758d89f046" title="&lt;&lt;private&gt;&gt; Writes a duplicate file descriptor chunk into the checkpoint file." alt="" coords="207,57,337,98"/><area shape="rect" id="node7" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gabe85fffb1a72d2cf11ccde5f557ec3b6" title="&lt;&lt;private&gt;&gt; Writes a new file chunk into the checkpoint file." alt="" coords="207,154,337,195"/><area shape="rect" id="node3" href="../../dd/d41/group__tcmi__fdcache__class.html#ga09e6e85f776f3e0a1dc672b1f5c7979c" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file." alt="" coords="428,5,572,32"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="443,60,557,87"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="655,52,801,79"/><area shape="rect" id="node8" href="../../d5/d77/proxyfs__helper_8h.html#a074be037b0aae4d248a61c90c2c68737" title="Checks, whether the file is proxyfs file." alt="" coords="448,111,552,137"/><area shape="rect" id="node9" href="../../d5/d77/proxyfs__helper_8h.html#a25be89ac94beb85ee51564c78d4031d7" title="Returns true, if the path points to a dev null file." alt="" coords="457,161,543,188"/><area shape="rect" id="node10" href="../../db/d78/group__proxyfs__server__class.html#ga0cf24b2ce6d39d211a219c3e0f53ff41" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Make file available trought proxyfs" alt="" coords="409,212,591,239"/><area shape="rect" id="node32" href="../../d5/d77/proxyfs__helper_8h.html#ae73c5991f03548d8f100d7200d80113e" title="Creates a name of a proxy file." alt="" coords="427,263,573,289"/><area shape="rect" id="node33" href="../../df/d54/group__tcmi__ckpt__class.html#ga59be6dd10ef81e4812417bfe0dd5f4c5" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="421,351,579,377"/><area shape="rect" id="node11" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#gaa072b8ffc0485563a02cd199ea44202d" title="&lt;&lt;public&gt;&gt; tty_real_file constructor" alt="" coords="645,103,811,129"/><area shape="rect" id="node17" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gab01c9a2a21e46a82db7716411b088cae" title="&lt;&lt;public&gt;&gt; pipe_real_file construktor" alt="" coords="640,153,816,180"/><area shape="rect" id="node29" href="../../d5/d89/proxyfs__real__file_8c.html#aa8bee110603ba3a6715496c0d4387874" title="&lt;&lt;public&gt;&gt; Adds shadow task into a shadow list of the file" alt="" coords="657,205,799,246"/><area shape="rect" id="node30" href="../../d0/dc1/proxyfs__server_8c.html#ad4aa6f1a2c9ee37939e3cfc52f6c6cd8" title="proxyfs_server_register\l_poll_callback" alt="" coords="651,322,805,363"/><area shape="rect" id="node19" href="../../da/d41/group__proxyfs__real__file__class.html#gad4ca43cdfe83775498c3c52ac5f7df18" title="&lt;&lt;public&gt;&gt; Deinitialize real_file" alt="" coords="867,263,1032,289"/><area shape="rect" id="node12" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#ga115051874a5892b99e1028cc4b6d2738" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="869,103,1030,129"/><area shape="rect" id="node13" href="../../da/d41/group__proxyfs__real__file__class.html#ga3cafcaf17f89ac4e7fe848ecbbdb7dbc" title="&lt;&lt;public&gt;&gt; Initialize real_file" alt="" coords="1083,153,1221,180"/><area shape="rect" id="node14" href="../../d1/d14/group__proxyfs__file__class.html#ga104071e772f98e9a9151a6f9eaff5cfa" title="&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct" alt="" coords="1275,155,1386,181"/><area shape="rect" id="node15" href="../../d4/d27/group__circ__buf__clas.html#ga340b6d6ae954ce66d15dace7f7c54e61" title="circ_buf_init" alt="" coords="1453,155,1544,181"/><area shape="rect" id="node16" href="../../d4/d27/group__circ__buf__clas.html#ga36c9967179adece95b711ac84023b2a4" title="&lt;&lt;public&gt;&gt; Opossite function to circ_buf_init" alt="" coords="1440,205,1557,232"/><area shape="rect" id="node18" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gaf77b5c0d93e89ac2e8fd5ebe74c0b8a2" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="864,204,1035,231"/><area shape="rect" id="node20" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="1085,317,1219,358"/><area shape="rect" id="node21" href="../../d1/d14/group__proxyfs__file__class.html#ga5bbed7e844f5afab2fbd943457de4bf6" title="&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct" alt="" coords="1083,261,1221,288"/><area shape="rect" id="node22" href="../../d3/d52/group__proxyfs__peer__class.html#ga0dc1598ce5116c8fe21c66b8b977ab4b" title="&lt;&lt;public&gt;&gt; Puts proxyfs_peer instance reference and on reaching zero destroys the instance..." alt="" coords="1270,261,1391,288"/><area shape="rect" id="node23" href="../../d6/d8e/group__kkc__sock__class.html#ga00d8b033d3e1118303e7b4c54c6aafe6" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1607,257,1774,284"/><area shape="rect" id="node25" href="../../d6/d8e/group__kkc__sock__class.html#ga9f980056fbf3436596c4cfdf3913e85c" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="1447,308,1550,335"/><area shape="rect" id="node24" href="../../d6/d8e/group__kkc__sock__class.html#gadf1b231c727891d5ac2d32646d574931" title="&lt;&lt;public&gt;&gt; Peer socket name accessor." alt="" coords="1825,257,1985,284"/><area shape="rect" id="node26" href="../../d5/ddf/group__kkc__arch__class.html#ga06049c969ae0324d0607f10db99af65c" title="&lt;&lt;public&gt;&gt; Decrements the reference counter on the module owning the architecture." alt="" coords="1641,308,1741,335"/><area shape="rect" id="node27" href="../../d6/d8e/group__kkc__sock__class.html#gac8e64f52015e75cb76a34c4b7e9ef176" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1605,359,1776,385"/><area shape="rect" id="node28" href="../../d6/d8e/group__kkc__sock__class.html#ga3cae649f56c8f5fa18f755f6c7d53597" title="&lt;&lt;public&gt;&gt; Local socket name accessor." alt="" coords="1824,359,1987,385"/><area shape="rect" id="node31" href="../../d0/dc1/proxyfs__server_8c.html#ab50c180af3b49b9044929be991b6e74d" title="&lt;&lt;private&gt;&gt; Method used for waiting on files, callback for poll structure" alt="" coords="883,319,1015,361"/><area shape="rect" id="node34" href="../../dd/d41/group__tcmi__fdcache__class.html#ga613fb750743c8a42aab62f9bcc230bd6" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="665,388,791,415"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gafe70b47b94f4f0cccf013f758d89f046"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_openfile_write_dupfd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dup_fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Writes a duplicate file descriptor chunk into the checkpoint file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">fd</td><td>- original file descriptor </td></tr>
    <tr><td class="paramname">dup_fd</td><td>- duplicate file descriptor that references the same file as fds </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00133">133</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00132">tcmi_ckpt_openfile_dupfile_hdr::dup_fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00137">dup_fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00123">fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00130">tcmi_ckpt_openfile_dupfile_hdr::fd</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00103">tcmi_ckpt_openfile_generic_hdr::restore_type</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00096">TCMI_CKPT_OPENFILE_DUPFILE</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00219">tcmi_ckpt_write()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00060">tcmi_ckpt_openfile_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr" title="Describes generic header that consists of a file type only - the options are new or dup file...">tcmi_ckpt_openfile_generic_hdr</a> gen_hdr;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#df/d46/structtcmi__ckpt__openfile__dupfile__hdr" title="Describes a duplicate file.">tcmi_ckpt_openfile_dupfile_hdr</a> dup_hdr;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    gen_hdr.restore_type = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea529c292ff4c6bc295a6ff0937789a16a">TCMI_CKPT_OPENFILE_DUPFILE</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">/* restore type identifier header */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, &amp;gen_hdr, <span class="keyword">sizeof</span>(gen_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing file generic header&quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    dup_hdr.fd = <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    dup_hdr.dup_fd = <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a58b8b022922cec0da05d41c361c0760b" title="file descriptor that refers to the actual file.">dup_fd</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, &amp;dup_hdr, <span class="keyword">sizeof</span>(dup_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing dupfd chunk&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Written dupfd  fd=%d, dup_fd=%d&quot;</span>, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a58b8b022922cec0da05d41c361c0760b" title="file descriptor that refers to the actual file.">dup_fd</a>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; exit0:</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_gafe70b47b94f4f0cccf013f758d89f046_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_gafe70b47b94f4f0cccf013f758d89f046_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_gafe70b47b94f4f0cccf013f758d89f046_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_gafe70b47b94f4f0cccf013f758d89f046_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="185,12,298,39"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="347,12,493,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gabe85fffb1a72d2cf11ccde5f557ec3b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_openfile_write_newfd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Writes a new file chunk into the checkpoint file. </p>
<p>This includes:</p>
<ul>
<li>file descriptor</li>
<li>current position in the file</li>
<li>length of the file pathname</li>
<li>filepathname</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">fd</td><td>- file descriptor </td></tr>
    <tr><td class="paramname">*file</td><td>- file object to be written into the checkpoint </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes </dd></dl>

<p>Definition at line <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00170">170</a> of file <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html">tcmi_ckpt_openfile.c</a>.</p>

<p>References <a class="el" href="../../d5/d77/proxyfs__helper_8h_source.html#l00039">create_proxyfs_name()</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00110">tcmi_ckpt_openfile_newfile_hdr::fd</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00123">fd</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00054">proxyfs_file_identifier::file_ident</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00114">tcmi_ckpt_openfile_newfile_hdr::flags</a>, <a class="el" href="../../d5/d77/proxyfs__helper_8h_source.html#l00028">is_dev_null()</a>, <a class="el" href="../../d5/d77/proxyfs__helper_8h_source.html#l00020">is_proxyfs_file()</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00116">tcmi_ckpt_openfile_newfile_hdr::mode</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00120">tcmi_ckpt_openfile_newfile_hdr::pathname_size</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00112">tcmi_ckpt_openfile_newfile_hdr::pos</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00371">proxyfs_server_overtake_file()</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00103">tcmi_ckpt_openfile_generic_hdr::restore_type</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00311">tcmi_ckpt_fdcache_add()</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00094">TCMI_CKPT_OPENFILE_NEWFILE</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00219">tcmi_ckpt_write()</a>, and <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00118">tcmi_ckpt_openfile_newfile_hdr::type</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00060">tcmi_ckpt_openfile_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;{</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#da/d2d/structtcmi__ckpt__openfile__generic__hdr" title="Describes generic header that consists of a file type only - the options are new or dup file...">tcmi_ckpt_openfile_generic_hdr</a> gen_hdr;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#d9/dba/structtcmi__ckpt__openfile__newfile__hdr" title="Describes a file occurs in the checkpoint for the first time.">tcmi_ckpt_openfile_newfile_hdr</a> new_hdr;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">/* page for the filepathname */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">char</span> *pathname;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    gen_hdr.restore_type = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gga6a693d5f473e7e5df156e4780bf9361ea9a1c84edc582c7d3e5f0e04ab5d6e75c">TCMI_CKPT_OPENFILE_NEWFILE</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">/* write the generic header first */</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, &amp;gen_hdr, <span class="keyword">sizeof</span>(gen_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing file generic header&quot;</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    new_hdr.fd = <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    new_hdr.pos = file-&gt;f_pos;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    new_hdr.flags = file-&gt;f_flags;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    new_hdr.mode = file-&gt;f_mode;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    new_hdr.type = file-&gt;f_dentry-&gt;d_inode-&gt;i_mode;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    new_hdr.pathname_size = 0;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;File pos: %llu&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)file-&gt;f_pos);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Write: Fd: %ld, Pos %llu, File name size: %lu, Flags: %08lo, Mode: %08lo&quot;</span>, (<span class="keywordtype">long</span>)new_hdr.fd, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)new_hdr.pos, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.pathname_size, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.flags, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)new_hdr.mode);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">/* resolve the path name. */</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for file pathname!&quot;</span>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// By default files are simply reopened</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// WARNING: Very important! Buffer length is returned as a PAGE_SIZE - 1000. THe d_path fills in path from the end of the buffer</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// and if we return full buffer size, we are not able to append anything to the string, but we want to do that for the proxy files!</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(pathname = d_path(&amp;file-&gt;f_path, (<span class="keywordtype">char</span>*)page, PAGE_SIZE - 1000))) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t resolve pathname for &#39;%s&#39;&quot;</span>, file-&gt;f_dentry-&gt;d_name.name);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d77/proxyfs__helper_8h.html#a074be037b0aae4d248a61c90c2c68737" title="Checks, whether the file is proxyfs file.">is_proxyfs_file</a>(pathname) &amp;&amp; ((S_ISCHR(new_hdr.type) || S_ISFIFO(new_hdr.type))) ){ <span class="comment">// Special file, use proxyfs</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">// Overtake only for shadow tasks and exclude dev-null</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">if</span>( current-&gt;tcmi.tcmi_task &amp;&amp; current-&gt;tcmi.task_type == shadow &amp;&amp; !<a class="code" href="../../d5/d77/proxyfs__helper_8h.html#a25be89ac94beb85ee51564c78d4031d7" title="Returns true, if the path points to a dev null file.">is_dev_null</a>(pathname) ){</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d1/d14/group__proxyfs__file__class.html#d0/d82/structproxyfs__file__identifier" title="Unique identifier of a file managed by the proxy fs system.">proxyfs_file_identifier</a>* fileident = <a class="code" href="../../db/d78/group__proxyfs__server__class.html#ga0cf24b2ce6d39d211a219c3e0f53ff41" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Make file available trought proxyfs">proxyfs_server_overtake_file</a>(<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">if</span>( fileident == NULL ){</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Registering file in proxyfs_server failed!&quot;</span>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;BEFORE PROXY FS NAME: %s&quot;</span>, pathname);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <a class="code" href="../../d5/d77/proxyfs__helper_8h.html#ae73c5991f03548d8f100d7200d80113e" title="Creates a name of a proxy file.">create_proxyfs_name</a>(current, pathname, fileident-&gt;<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#a70f6fcb784266416472a9f887d6661f4" title="Semi-unique number identificating file.">file_ident</a>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;AFTER PROXY FS NAME: %s&quot;</span>, pathname);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    new_hdr.pathname_size = strlen(pathname) + 1;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">/* write the header and the pathname into the checkpoint */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, &amp;new_hdr, <span class="keyword">sizeof</span>(new_hdr)) &lt; 0) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing newfd chunk&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, pathname, new_hdr.pathname_size) &lt; 0) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing file pathname chunk&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga59be6dd10ef81e4812417bfe0dd5f4c5" title="&lt;&lt;public&gt;&gt; Adds a file descriptor - file object pair into the fd cache.">tcmi_ckpt_fdcache_add</a>(ckpt, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, file);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Written new file descriptor fd=%d, type=%0o &#39;%s&#39;&quot;</span>, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, new_hdr.type, pathname);    </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    free_page(page);    </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; exit1:</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; exit0:</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d6/d9c/group__tcmi__ckpt__openfile__class_gabe85fffb1a72d2cf11ccde5f557ec3b6_cgraph.png" border="0" usemap="#d6/d9c/group__tcmi__ckpt__openfile__class_gabe85fffb1a72d2cf11ccde5f557ec3b6_cgraph" alt=""/></div>
<map name="d6/d9c/group__tcmi__ckpt__openfile__class_gabe85fffb1a72d2cf11ccde5f557ec3b6_cgraph" id="d6/d9c/group__tcmi__ckpt__openfile__class_gabe85fffb1a72d2cf11ccde5f557ec3b6_cgraph">
<area shape="rect" id="node2" href="../../d5/d77/proxyfs__helper_8h.html#ae73c5991f03548d8f100d7200d80113e" title="Creates a name of a proxy file." alt="" coords="203,21,349,48"/><area shape="rect" id="node3" href="../../d5/d77/proxyfs__helper_8h.html#a25be89ac94beb85ee51564c78d4031d7" title="Returns true, if the path points to a dev null file." alt="" coords="233,72,319,99"/><area shape="rect" id="node4" href="../../d5/d77/proxyfs__helper_8h.html#a074be037b0aae4d248a61c90c2c68737" title="Checks, whether the file is proxyfs file." alt="" coords="224,123,328,149"/><area shape="rect" id="node5" href="../../db/d78/group__proxyfs__server__class.html#ga0cf24b2ce6d39d211a219c3e0f53ff41" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Make file available trought proxyfs" alt="" coords="185,173,367,200"/><area shape="rect" id="node27" href="../../df/d54/group__tcmi__ckpt__class.html#ga59be6dd10ef81e4812417bfe0dd5f4c5" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="197,240,355,267"/><area shape="rect" id="node29" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="219,324,333,351"/><area shape="rect" id="node6" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#gaa072b8ffc0485563a02cd199ea44202d" title="&lt;&lt;public&gt;&gt; tty_real_file constructor" alt="" coords="421,5,587,32"/><area shape="rect" id="node12" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gab01c9a2a21e46a82db7716411b088cae" title="&lt;&lt;public&gt;&gt; pipe_real_file construktor" alt="" coords="416,56,592,83"/><area shape="rect" id="node24" href="../../d5/d89/proxyfs__real__file_8c.html#aa8bee110603ba3a6715496c0d4387874" title="&lt;&lt;public&gt;&gt; Adds shadow task into a shadow list of the file" alt="" coords="433,107,575,149"/><area shape="rect" id="node25" href="../../d0/dc1/proxyfs__server_8c.html#ad4aa6f1a2c9ee37939e3cfc52f6c6cd8" title="proxyfs_server_register\l_poll_callback" alt="" coords="427,225,581,266"/><area shape="rect" id="node14" href="../../da/d41/group__proxyfs__real__file__class.html#gad4ca43cdfe83775498c3c52ac5f7df18" title="&lt;&lt;public&gt;&gt; Deinitialize real_file" alt="" coords="643,165,808,192"/><area shape="rect" id="node7" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#ga115051874a5892b99e1028cc4b6d2738" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="645,5,806,32"/><area shape="rect" id="node8" href="../../da/d41/group__proxyfs__real__file__class.html#ga3cafcaf17f89ac4e7fe848ecbbdb7dbc" title="&lt;&lt;public&gt;&gt; Initialize real_file" alt="" coords="859,56,997,83"/><area shape="rect" id="node9" href="../../d1/d14/group__proxyfs__file__class.html#ga104071e772f98e9a9151a6f9eaff5cfa" title="&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct" alt="" coords="1051,57,1162,84"/><area shape="rect" id="node10" href="../../d4/d27/group__circ__buf__clas.html#ga340b6d6ae954ce66d15dace7f7c54e61" title="circ_buf_init" alt="" coords="1229,57,1320,84"/><area shape="rect" id="node11" href="../../d4/d27/group__circ__buf__clas.html#ga36c9967179adece95b711ac84023b2a4" title="&lt;&lt;public&gt;&gt; Opossite function to circ_buf_init" alt="" coords="1216,108,1333,135"/><area shape="rect" id="node13" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gaf77b5c0d93e89ac2e8fd5ebe74c0b8a2" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="640,107,811,133"/><area shape="rect" id="node15" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="861,219,995,261"/><area shape="rect" id="node16" href="../../d1/d14/group__proxyfs__file__class.html#ga5bbed7e844f5afab2fbd943457de4bf6" title="&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct" alt="" coords="859,164,997,191"/><area shape="rect" id="node17" href="../../d3/d52/group__proxyfs__peer__class.html#ga0dc1598ce5116c8fe21c66b8b977ab4b" title="&lt;&lt;public&gt;&gt; Puts proxyfs_peer instance reference and on reaching zero destroys the instance..." alt="" coords="1046,164,1167,191"/><area shape="rect" id="node18" href="../../d6/d8e/group__kkc__sock__class.html#ga00d8b033d3e1118303e7b4c54c6aafe6" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1383,160,1550,187"/><area shape="rect" id="node20" href="../../d6/d8e/group__kkc__sock__class.html#ga9f980056fbf3436596c4cfdf3913e85c" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="1223,211,1326,237"/><area shape="rect" id="node19" href="../../d6/d8e/group__kkc__sock__class.html#gadf1b231c727891d5ac2d32646d574931" title="&lt;&lt;public&gt;&gt; Peer socket name accessor." alt="" coords="1601,160,1761,187"/><area shape="rect" id="node21" href="../../d5/ddf/group__kkc__arch__class.html#ga06049c969ae0324d0607f10db99af65c" title="&lt;&lt;public&gt;&gt; Decrements the reference counter on the module owning the architecture." alt="" coords="1417,211,1517,237"/><area shape="rect" id="node22" href="../../d6/d8e/group__kkc__sock__class.html#gac8e64f52015e75cb76a34c4b7e9ef176" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1381,261,1552,288"/><area shape="rect" id="node23" href="../../d6/d8e/group__kkc__sock__class.html#ga3cae649f56c8f5fa18f755f6c7d53597" title="&lt;&lt;public&gt;&gt; Local socket name accessor." alt="" coords="1600,261,1763,288"/><area shape="rect" id="node26" href="../../d0/dc1/proxyfs__server_8c.html#ab50c180af3b49b9044929be991b6e74d" title="&lt;&lt;private&gt;&gt; Method used for waiting on files, callback for poll structure" alt="" coords="659,222,791,263"/><area shape="rect" id="node28" href="../../dd/d41/group__tcmi__fdcache__class.html#ga613fb750743c8a42aab62f9bcc230bd6" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="441,291,567,317"/><area shape="rect" id="node30" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="431,341,577,368"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gaf21c5b697bdf548bcbec21e762a194dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#d9/d4e/structtcmi__ckpt__sig__hdr">tcmi_ckpt_sig_hdr</a> __attribute__</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 7 2013 23:20:12 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
