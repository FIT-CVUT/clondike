<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_ckpt_vm_area class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/dad/group__tcmi__ckpt__vm__area__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_ckpt_vm_area class<div class="ingroups"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html">tcmi_ckpt class</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a particular memory segment (VM area) into the checkpoint file.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_vm_area class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class.png" border="0" alt="" usemap="#d3_2dad_2group____tcmi____ckpt____vm____area____class"/>
<map name="d3_2dad_2group____tcmi____ckpt____vm____area____class" id="d3_2dad_2group____tcmi____ckpt____vm____area____class">
<area shape="rect" id="node1" href="../../df/d54/group__tcmi__ckpt__class.html" title="This is a helper class used by the checkpointing component that provides functionality to:..." alt="" coords="5,5,120,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:d3/d32/structtcmi__ckpt__vm__area__hdr"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a></td></tr>
<tr class="memdesc:d3/d32/structtcmi__ckpt__vm__area__hdr"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compound structure describes a particular memory region.  <a href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">More...</a><br/></td></tr>
<tr class="separator:d3/d32/structtcmi__ckpt__vm__area__hdr"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gaa592b3a7c04c11a2f77967faf0c4930c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">tcmi_ckpt_vm_area_t</a> { <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>, 
<a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb">TCMI_CKPT_VM_AREA_HEAVY</a>
 }</td></tr>
<tr class="memdesc:gaa592b3a7c04c11a2f77967faf0c4930c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes the type of the vm area we store, see above.  <a href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">More...</a><br/></td></tr>
<tr class="separator:gaa592b3a7c04c11a2f77967faf0c4930c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1bf3e24cdf83c3d7506e8eb8c2cea4d5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga1bf3e24cdf83c3d7506e8eb8c2cea4d5">tcmi_ckpt_vm_area_write_l</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct vm_area_struct *vma, struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *hdr)</td></tr>
<tr class="memdesc:ga1bf3e24cdf83c3d7506e8eb8c2cea4d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - light version.  <a href="#ga1bf3e24cdf83c3d7506e8eb8c2cea4d5">More...</a><br/></td></tr>
<tr class="separator:ga1bf3e24cdf83c3d7506e8eb8c2cea4d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb0972a6f0e422425746f27d4411c3f6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gadb0972a6f0e422425746f27d4411c3f6">tcmi_ckpt_vm_area_write_h</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct vm_area_struct *vma, struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *hdr)</td></tr>
<tr class="memdesc:gadb0972a6f0e422425746f27d4411c3f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - heavy version.  <a href="#gadb0972a6f0e422425746f27d4411c3f6">More...</a><br/></td></tr>
<tr class="separator:gadb0972a6f0e422425746f27d4411c3f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga59354104129b38287823b51095c8e144"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga59354104129b38287823b51095c8e144">tcmi_ckpt_vm_area_read_l</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *hdr)</td></tr>
<tr class="memdesc:ga59354104129b38287823b51095c8e144"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - light version.  <a href="#ga59354104129b38287823b51095c8e144">More...</a><br/></td></tr>
<tr class="separator:ga59354104129b38287823b51095c8e144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga48fa3a38bfe17aa6d17636903e08a026"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga48fa3a38bfe17aa6d17636903e08a026">tcmi_ckpt_vm_area_read_h</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *hdr)</td></tr>
<tr class="memdesc:ga48fa3a38bfe17aa6d17636903e08a026"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - heavy version.  <a href="#ga48fa3a38bfe17aa6d17636903e08a026">More...</a><br/></td></tr>
<tr class="separator:ga48fa3a38bfe17aa6d17636903e08a026"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf3bb948cfeb680ab12571de3f8b23dc5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5">tcmi_ckpt_vm_area_stack_fixup</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *hdr)</td></tr>
<tr class="memdesc:gaf3bb948cfeb680ab12571de3f8b23dc5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoint file.  <a href="#gaf3bb948cfeb680ab12571de3f8b23dc5">More...</a><br/></td></tr>
<tr class="separator:gaf3bb948cfeb680ab12571de3f8b23dc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga719850939414c321a7d40a5f14e7e91d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga719850939414c321a7d40a5f14e7e91d">__attribute__</a> ((__packed__))</td></tr>
<tr class="separator:ga719850939414c321a7d40a5f14e7e91d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2da52b7d6a4fc42437ad12d18b7806e5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga2da52b7d6a4fc42437ad12d18b7806e5">tcmi_ckpt_vm_area_write</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct vm_area_struct *vma, <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">tcmi_ckpt_vm_area_t</a> <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h.html#a976c268fd0b6ffe448e05822bc0bb364">type</a>)</td></tr>
<tr class="memdesc:ga2da52b7d6a4fc42437ad12d18b7806e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes a specified memory area into the checkpoint file.  <a href="#ga2da52b7d6a4fc42437ad12d18b7806e5">More...</a><br/></td></tr>
<tr class="separator:ga2da52b7d6a4fc42437ad12d18b7806e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6c230f15a2b7f3995bcabc64e2ce6160"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga6c230f15a2b7f3995bcabc64e2ce6160">tcmi_ckpt_vm_area_read</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt)</td></tr>
<tr class="memdesc:ga6c230f15a2b7f3995bcabc64e2ce6160"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads a memory area from the checkpoint file.  <a href="#ga6c230f15a2b7f3995bcabc64e2ce6160">More...</a><br/></td></tr>
<tr class="separator:ga6c230f15a2b7f3995bcabc64e2ce6160"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gaeab68f17dc686a2f7dc72ab2b712e464"><td class="memItemLeft" align="right" valign="top">typedef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaeab68f17dc686a2f7dc72ab2b712e464">__attribute__</a></td></tr>
<tr class="separator:gaeab68f17dc686a2f7dc72ab2b712e464"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a particular memory segment (VM area) into the checkpoint file. </p>
<p>There are 2 modes supported:</p>
<ul>
<li>heavy checkpoint mode - where the entire segment is dumped page by page into the checkpoint.</li>
<li>light checkpoint mode - if the segment maps a file on disk and the segment is non-writable, only file pathname is dumped into the checkpoint. This decreases the resulting checkpoint size dramatically. Also, when restoring such checkpoint parts, there is a big chance that the file is already mapped in memory. This typically happens with shared libraries and executable code. </li>
</ul>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="d3/d32/structtcmi__ckpt__vm__area__hdr" id="d3/d32/structtcmi__ckpt__vm__area__hdr"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt_vm_area_hdr</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Compound structure describes a particular memory region. </p>
<p>Very similar to vm_area_struct. We don't store the vm_page_prot flags as they can be derived from vm_flags </p>

<p>Definition at line <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00069">69</a> of file <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html">tcmi_ckpt_vm_area.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_vm_area_hdr:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../de/de7/structtcmi__ckpt__vm__area__hdr__coll__graph.png" border="0" usemap="#tcmi__ckpt__vm__area__hdr_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a106b8cd60837f2b06cfe36750b98a4e0"></a>u_int32_t</td>
<td class="fieldname">
pathname_size</td>
<td class="fielddoc">
pathname size in bytes, including trailing zero - for light version only </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="acef560d3a4b8f4468bace7aa00ddd531"></a><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">tcmi_ckpt_vm_area_t</a></td>
<td class="fieldname">
type</td>
<td class="fielddoc">
type of the area </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a205af8d26c823cde39172a23b42f99e4"></a>u_int64_t</td>
<td class="fieldname">
vm_end</td>
<td class="fielddoc">
first linear address after the memory region </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac046b65f4dfc6f1d1dc794e4cb5f7a6e"></a>u_int64_t</td>
<td class="fieldname">
vm_flags</td>
<td class="fielddoc">
flags of the region </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a3ec5c30b7e6520567f59bf94c0db0755"></a>u_int64_t</td>
<td class="fieldname">
vm_pgoff</td>
<td class="fielddoc">
Offset in mapped file, if any. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a5ff467e711eed6a02c1b2a6664c61c78"></a>u_int64_t</td>
<td class="fieldname">
vm_start</td>
<td class="fielddoc">
segment start address </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="gaa592b3a7c04c11a2f77967faf0c4930c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">tcmi_ckpt_vm_area_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Describes the type of the vm area we store, see above. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f"></a>TCMI_CKPT_VM_AREA_LIGHT</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb"></a>TCMI_CKPT_VM_AREA_HEAVY</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00061">61</a> of file <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html">tcmi_ckpt_vm_area.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;             {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb">TCMI_CKPT_VM_AREA_HEAVY</a></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;} <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c" title="Describes the type of the vm area we store, see above.">tcmi_ckpt_vm_area_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga719850939414c321a7d40a5f14e7e91d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__packed__)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga6c230f15a2b7f3995bcabc64e2ce6160"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_vm_area_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads a memory area from the checkpoint file. </p>
<p>Reads the VM area header and checks for the requested type. The actual work is then delegated to the light or heavy version of this method.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00080">80</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00063">TCMI_CKPT_VM_AREA_HEAVY</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00062">TCMI_CKPT_VM_AREA_LIGHT</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00337">tcmi_ckpt_vm_area_read_h()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00262">tcmi_ckpt_vm_area_read_l()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00079">tcmi_ckpt_vm_area_hdr::type</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00073">tcmi_ckpt_vm_area_hdr::vm_end</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00075">tcmi_ckpt_vm_area_hdr::vm_flags</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00077">tcmi_ckpt_vm_area_hdr::vm_pgoff</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00071">tcmi_ckpt_vm_area_hdr::vm_start</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00275">tcmi_ckpt_read_vmas()</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr" title="Compound structure describes a particular memory region.">tcmi_ckpt_vm_area_hdr</a> hdr;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, &amp;hdr, <span class="keyword">sizeof</span>(hdr)) &lt; 0) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error read VM aread header&quot;</span>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Reading VMA start:%08llx, end: %08llx, flags: %08llx, pgoff %08llx&quot;</span>, </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;         (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr.vm_start, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr.vm_end, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr.vm_flags, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr.vm_pgoff);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">/* light version only when it&#39;s non-writable and  maps a file */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (hdr.type == <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga59354104129b38287823b51095c8e144" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - light version.">tcmi_ckpt_vm_area_read_l</a>(ckpt, &amp;hdr);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hdr.type == <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb">TCMI_CKPT_VM_AREA_HEAVY</a>)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga48fa3a38bfe17aa6d17636903e08a026" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - heavy version.">tcmi_ckpt_vm_area_read_h</a>(ckpt, &amp;hdr);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unrecognized header type %x&quot;</span>, hdr.type);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; exit0:</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_ga6c230f15a2b7f3995bcabc64e2ce6160_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_ga6c230f15a2b7f3995bcabc64e2ce6160_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_ga6c230f15a2b7f3995bcabc64e2ce6160_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_ga6c230f15a2b7f3995bcabc64e2ce6160_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="674,56,785,83"/><area shape="rect" id="node4" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga48fa3a38bfe17aa6d17636903e08a026" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file &#45; heavy version." alt="" coords="222,144,402,171"/><area shape="rect" id="node9" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga59354104129b38287823b51095c8e144" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file &#45; light version." alt="" coords="224,5,400,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="835,56,981,83"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="463,173,611,200"/><area shape="rect" id="node6" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5" title="&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoi..." alt="" coords="451,107,624,149"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#gac8491faf16814e68e4da2dbf77c1f9cf" title="&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset..." alt="" coords="466,224,609,251"/><area shape="rect" id="node8" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="672,224,787,251"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga48fa3a38bfe17aa6d17636903e08a026"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_vm_area_read_h </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - heavy version. </p>
<ul>
<li>aligns the position in the file to page boundary</li>
<li>computes memory mapping flags.</li>
<li>performs the memory mapping. There is special case that needs to be handled - if the area grows down which indicates a stack region stack setup work is delegated to <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5" title="&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoi...">tcmi_ckpt_vm_area_stack_fixup()</a>.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is to be stored </td></tr>
    <tr><td class="paramname">*hdr</td><td>- VM area header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00337">337</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00270">tcmi_ckpt_do_mmap()</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00295">tcmi_ckpt_page_align()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00422">tcmi_ckpt_vm_area_stack_fixup()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00073">tcmi_ckpt_vm_area_hdr::vm_end</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00075">tcmi_ckpt_vm_area_hdr::vm_flags</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00071">tcmi_ckpt_vm_area_hdr::vm_start</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00080">tcmi_ckpt_vm_area_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;{</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mmap_flags;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> length;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary.">tcmi_ckpt_page_align</a>(ckpt);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    length = hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a205af8d26c823cde39172a23b42f99e4" title="first linear address after the memory region">vm_end</a> - hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> ( length &lt; PAGE_SIZE ) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Length of the area shorter than one page. Start: %16llx End: %16llx&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a205af8d26c823cde39172a23b42f99e4" title="first linear address after the memory region">vm_end</a>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }   </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">/* check if stack fixup is needed */</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> ((hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a> &amp; VM_GROWSDOWN) ) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5" title="&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoi...">tcmi_ckpt_vm_area_stack_fixup</a>(ckpt, hdr) &lt; 0) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed setting up stack area&quot;</span>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        length -= PAGE_SIZE;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">/* The are was fully maped by the stack fixup */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">if</span> ( length == 0 )</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">/* convert the VM flags to MMAP flags */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    mmap_flags = tcmi_ckpt_vm_area_to_mmap_flags(hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/* prot flags are just the lower bits extracted from vm_flags - see mman.h, mm.h */</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    addr = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac8491faf16814e68e4da2dbf77c1f9cf" title="&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset...">tcmi_ckpt_do_mmap</a>(ckpt, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a205af8d26c823cde39172a23b42f99e4" title="first linear address after the memory region">vm_end</a> - hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                 hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a> &amp; (PROT_READ | PROT_EXEC| PROT_WRITE),   </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                 mmap_flags);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (addr != hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error mapping checkpoint file at: %08lx (hdr-&gt;vm_start: %16llx&quot;</span>, addr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Mapped checkpoint at: %08lx, VM_flags = %16llx, mmap flags = %08lx&quot;</span>, </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;         addr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a>, mmap_flags);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; exit0:</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_ga48fa3a38bfe17aa6d17636903e08a026_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_ga48fa3a38bfe17aa6d17636903e08a026_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_ga48fa3a38bfe17aa6d17636903e08a026_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_ga48fa3a38bfe17aa6d17636903e08a026_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gac8491faf16814e68e4da2dbf77c1f9cf" title="&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset..." alt="" coords="250,5,393,32"/><area shape="rect" id="node4" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="247,56,395,83"/><area shape="rect" id="node5" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5" title="&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoi..." alt="" coords="235,107,408,149"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="456,5,571,32"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="458,115,569,141"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="619,115,765,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga59354104129b38287823b51095c8e144"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_vm_area_read_l </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file - light version. </p>
<p>Reads the pathname of the file that is to be mapped into the area.</p>
<ul>
<li>opens the file</li>
<li>performs the memory mapping,</li>
<li>releases the file - the memory mapping retains its own reference.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is to be stored </td></tr>
    <tr><td class="paramname">*hdr</td><td>- VM area header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00262">262</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00082">tcmi_ckpt_vm_area_hdr::pathname_size</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00062">TCMI_CKPT_VM_AREA_LIGHT</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00079">tcmi_ckpt_vm_area_hdr::type</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00073">tcmi_ckpt_vm_area_hdr::vm_end</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00075">tcmi_ckpt_vm_area_hdr::vm_flags</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00077">tcmi_ckpt_vm_area_hdr::vm_pgoff</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00071">tcmi_ckpt_vm_area_hdr::vm_start</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00080">tcmi_ckpt_vm_area_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">/* page for the filepathname */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">char</span> *pathname = NULL;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keyword">struct </span>file *file; <span class="comment">/* file object for the vm_file */</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mmap_flags;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">/* finish the header */</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#acef560d3a4b8f4468bace7aa00ddd531" title="type of the area">type</a> = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">/* resolve the path name. */</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for file pathname!&quot;</span>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    pathname = (<span class="keywordtype">char</span>*) page;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/* read the header and the pathname from the checkpoint */</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, pathname, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a106b8cd60837f2b06cfe36750b98a4e0" title="pathname size in bytes, including trailing zero - for light version only">pathname_size</a>) &lt; 0) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading pathname&quot;</span>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">/* convert the VM flags to MMAP flags */</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    mmap_flags = tcmi_ckpt_vm_area_to_mmap_flags(hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    file = filp_open(pathname, O_RDONLY, 0); </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(file)) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error opening file &#39;%s&#39;&quot;</span>, pathname);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">/* prot flags are just the lower bits extracted from vm_flags - see mman.h, mm.h */</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    addr = do_mmap_pgoff(file, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a205af8d26c823cde39172a23b42f99e4" title="first linear address after the memory region">vm_end</a> - hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                 hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a> &amp; (PROT_READ | PROT_EXEC| PROT_WRITE),   </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                 mmap_flags, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a3ec5c30b7e6520567f59bf94c0db0755" title="Offset in mapped file, if any.">vm_pgoff</a>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (addr != hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error mapping file &#39;%s&#39; at: %lx&quot;</span>, pathname, addr);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">goto</span> exit2;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">/* or shall we perform filp_close??? */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    fput(file);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Mapped at: 08%lx, VM_flags = %08llx, mmap flags = %08lx&quot;</span>, </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;         addr, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a>, mmap_flags);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; exit2:</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    fput(file);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; exit1:</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; exit0:</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_ga59354104129b38287823b51095c8e144_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_ga59354104129b38287823b51095c8e144_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_ga59354104129b38287823b51095c8e144_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_ga59354104129b38287823b51095c8e144_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="230,5,341,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="390,5,535,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaf3bb948cfeb680ab12571de3f8b23dc5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_vm_area_stack_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoint file. </p>
<p>The idea is the split the supplied VM area into two:</p>
<ul>
<li>one containing the top of the stack</li>
<li>the other will be created by the standard mechanism.</li>
</ul>
<p>What needs to be done is to:</p>
<ul>
<li>create an anonymous mapping with the MAP_GROWSDOWN flag, with start address the same as the VM area in the checkpoint and size of one page.</li>
<li>read the first page of the stack area from the checkpoint file and copy it into the newly created mapping. The current top of the stack is somewhere in this page.</li>
<li>adjust the VM area header read from the checkpoint file: increment vm_start address and reset the VM_GROWSDOWN flag.</li>
</ul>
<p>Why is it so complex? Stack expansion is possible only for areas marked by VM_GROWSDOWN flag. However, it is not possible to create a file memory mapping using MAP_GROWSDOWN. The memory mapping framework simply denies this as a regular user doesn't need it. To change the size of a memory mapping, all processes are encouraged to use mremap(). Further, we would have a problem when the current stack pointer leaves the memory region by the allowed limit(max 32bytes). Where would the expansion get the page? It might end up asking the file to supply the missing page. This is obviously not possible.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the current stack area resides. </td></tr>
    <tr><td class="paramname">*hdr</td><td>- VM area header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00422">422</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00233">tcmi_ckpt_read()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00075">tcmi_ckpt_vm_area_hdr::vm_flags</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00071">tcmi_ckpt_vm_area_hdr::vm_start</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00337">tcmi_ckpt_vm_area_read_h()</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;{</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">/* temporary page allocated for the top of the stack */</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">/* address of the target mapping - must match hdr-&gt;vm_start */</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mmap_flags;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">/* convert the VM flags to MMAP flags */</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    mmap_flags = tcmi_ckpt_vm_area_to_mmap_flags(hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">/* prot flags are just the lower bits extracted from vm_flags - see mman.h, mm.h */</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    down_write(&amp;current-&gt;mm-&gt;mmap_sem);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    addr = do_mmap(NULL, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>, PAGE_SIZE,</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;               hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a> &amp; (PROT_READ | PROT_EXEC| PROT_WRITE), </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;               mmap_flags, 0);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    up_write(&amp;current-&gt;mm-&gt;mmap_sem);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (addr != hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a>) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error creating an anonymous mapping for stack page %d&quot;</span>, (<span class="keywordtype">int</span>)addr);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for stack!&quot;</span>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">/* read the first page of the stack */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, (<span class="keywordtype">void</span>*)page, PAGE_SIZE) &lt; 0) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error stack page!&quot;</span>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Copying stack page to %08lx from %08lx&quot;</span>, addr, page);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (tcmi_ckpt_vm_area_copy_page(addr, page) &lt; 0) {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to copy stack page!!!&quot;</span>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">/* memcpy((void*)addr, (void*)page, PAGE_SIZE); */</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Copying done&quot;</span>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">/* adjust the attributes */</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a> += PAGE_SIZE;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ac046b65f4dfc6f1d1dc794e4cb5f7a6e" title="flags of the region">vm_flags</a> &amp;= ~VM_GROWSDOWN; <span class="comment">/* FIXME: make this unified for all archs!!!*/</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Created anonymous mapping for stack at: %08lx&quot;</span>, addr);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; exit1:</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; exit0:</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_gaf3bb948cfeb680ab12571de3f8b23dc5_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_gaf3bb948cfeb680ab12571de3f8b23dc5_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_gaf3bb948cfeb680ab12571de3f8b23dc5_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_gaf3bb948cfeb680ab12571de3f8b23dc5_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="227,12,338,39"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="387,12,533,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2da52b7d6a4fc42437ad12d18b7806e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_vm_area_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_area_struct *&#160;</td>
          <td class="paramname"><em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c">tcmi_ckpt_vm_area_t</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes a specified memory area into the checkpoint file. </p>
<p>Checks for the requested type - when the light version is required, it will do so only if the area is non-writable and maps a file. The actual work is then delegated to the light or heavy version of this method.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is to be stored </td></tr>
    <tr><td class="paramname">*vma</td><td>- the actual VM area that is being processed </td></tr>
    <tr><td class="paramname">type</td><td>- requested type of the checkpoint </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00052">52</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00062">TCMI_CKPT_VM_AREA_LIGHT</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00197">tcmi_ckpt_vm_area_write_h()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00124">tcmi_ckpt_vm_area_write_l()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00073">tcmi_ckpt_vm_area_hdr::vm_end</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00075">tcmi_ckpt_vm_area_hdr::vm_flags</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00077">tcmi_ckpt_vm_area_hdr::vm_pgoff</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00071">tcmi_ckpt_vm_area_hdr::vm_start</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00243">tcmi_ckpt_write_vmas()</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr" title="Compound structure describes a particular memory region.">tcmi_ckpt_vm_area_hdr</a> hdr;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    hdr.<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a5ff467e711eed6a02c1b2a6664c61c78" title="segment start address">vm_start</a> = vma-&gt;vm_start;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    hdr.vm_end = vma-&gt;vm_end;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    hdr.vm_flags = vma-&gt;vm_flags;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    hdr.vm_pgoff = vma-&gt;vm_pgoff;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">/* light version only when it&#39;s non-writable and  maps a file */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a01e201dc18b51fdb0b7b2238343d9df7" title="file type">type</a> == <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a> &amp;&amp; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        !(vma-&gt;vm_flags &amp; VM_WRITE) &amp;&amp; vma-&gt;vm_file)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga1bf3e24cdf83c3d7506e8eb8c2cea4d5" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - light version.">tcmi_ckpt_vm_area_write_l</a>(ckpt, vma, &amp;hdr);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gadb0972a6f0e422425746f27d4411c3f6" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - heavy version.">tcmi_ckpt_vm_area_write_h</a>(ckpt, vma, &amp;hdr);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_ga2da52b7d6a4fc42437ad12d18b7806e5_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_ga2da52b7d6a4fc42437ad12d18b7806e5_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_ga2da52b7d6a4fc42437ad12d18b7806e5_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_ga2da52b7d6a4fc42437ad12d18b7806e5_cgraph">
<area shape="rect" id="node2" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gadb0972a6f0e422425746f27d4411c3f6" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file &#45; heavy version." alt="" coords="222,56,405,83"/><area shape="rect" id="node7" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga1bf3e24cdf83c3d7506e8eb8c2cea4d5" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file &#45; light version." alt="" coords="224,5,403,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="471,5,585,32"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="454,56,602,83"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="471,107,585,133"/><area shape="rect" id="node4" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="651,5,797,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gadb0972a6f0e422425746f27d4411c3f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_vm_area_write_h </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_area_struct *&#160;</td>
          <td class="paramname"><em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - heavy version. </p>
<p>It fills out the rest of the header, sets pathname size to 0 (not used). and writes the header into the checkpoint file.</p>
<p>It is necessary to align the file to page size. This is required otherwise we wouldn't be able to mmap pages from the file upon restoring the checkpoint.</p>
<p>Following algorithm dumps the pages, the idea comes from a regular core dump handler (e.g. in fs/binfmt_elf.c)</p>
<pre class="fragment"> For each page in the region do:
   - get the page - might trigger pagefaults to load the pages
   - map the page descriptor to a valid linear address (user pages might
   be in high memory)
   - if the page is zero or marked untouched, advance the offset in the
   checkpoint only - there is no need to write 0's to disk, just create
   the gap for them.
   - otherwise write the entire page into the checkpoint file.
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is to be stored </td></tr>
    <tr><td class="paramname">*vma</td><td>- the actual VM area that is being processed </td></tr>
    <tr><td class="paramname">*hdr</td><td>- partially filled VM area header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00197">197</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00082">tcmi_ckpt_vm_area_hdr::pathname_size</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00295">tcmi_ckpt_page_align()</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00251">tcmi_ckpt_seek()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00063">TCMI_CKPT_VM_AREA_HEAVY</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00219">tcmi_ckpt_write()</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00079">tcmi_ckpt_vm_area_hdr::type</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00087">vm_end</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00052">tcmi_ckpt_vm_area_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">/* page for the filepathname */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">/* finish the header */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#acef560d3a4b8f4468bace7aa00ddd531" title="type of the area">type</a> = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb">TCMI_CKPT_VM_AREA_HEAVY</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a106b8cd60837f2b06cfe36750b98a4e0" title="pathname size in bytes, including trailing zero - for light version only">pathname_size</a> = 0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">/* write the header into the checkpoint */</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, hdr, <span class="keyword">sizeof</span>(*hdr)) &lt; 0) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing VM area header chunk&quot;</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">/* align the current file position to page size boundary */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary.">tcmi_ckpt_page_align</a>(ckpt);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">for</span> (addr = vma-&gt;vm_start; addr &lt; vma-&gt;<a class="code" href="../../da/d20/tcmi__ckpt__vm__area_8h.html#a8d85a944bf87327065b6a209e5542075" title="first linear address after the memory region">vm_end</a>; addr += PAGE_SIZE) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keyword">struct </span>page *page;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordtype">void</span> *kaddr;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> (get_user_pages(current, current-&gt;mm, addr, 1, 0, 1,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                   &amp;page, &amp;vma) &lt;= 0) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Skipping untouched page at %08lx&quot;</span>, addr);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset.">tcmi_ckpt_seek</a>(ckpt, PAGE_SIZE, 1);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        } </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">/*if (page == ZERO_PAGE(addr)) {</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">            mdbg(INFO4, &quot;Skipping zero page at %08lx&quot;, addr);</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">            tcmi_ckpt_seek(ckpt, PAGE_SIZE, 1);</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">            continue;</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">/* actual page, that needs to be written. */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        flush_cache_page(vma, addr,  page_to_pfn(page));  <span class="comment">/* TODO: check this fix is correct */</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        kaddr = tcmi_ckpt_vm_area_kmap(page);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">/* write the page into the checkpoint */</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, kaddr, PAGE_SIZE) &lt; 0) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing page at %08lx&quot;</span>, addr);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        tcmi_ckpt_vm_area_kunmap(page);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; exit0:</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_gadb0972a6f0e422425746f27d4411c3f6_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_gadb0972a6f0e422425746f27d4411c3f6_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_gadb0972a6f0e422425746f27d4411c3f6_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_gadb0972a6f0e422425746f27d4411c3f6_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="238,5,386,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="255,56,369,83"/><area shape="rect" id="node4" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="255,107,369,133"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="435,107,581,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga1bf3e24cdf83c3d7506e8eb8c2cea4d5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_vm_area_write_l </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_area_struct *&#160;</td>
          <td class="paramname"><em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#d3/d32/structtcmi__ckpt__vm__area__hdr">tcmi_ckpt_vm_area_hdr</a> *&#160;</td>
          <td class="paramname"><em>hdr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file - light version. </p>
<p>It fills out the rest of the header, extracts the mapped file pathname and stores the header, pathname size and the actual pathname into the checkpoint.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*ckpt</td><td>- checkpoint file where the area is to be stored </td></tr>
    <tr><td class="paramname">*vma</td><td>- the actual VM area that is being processed </td></tr>
    <tr><td class="paramname">*hdr</td><td>- partially filled VM area header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success. </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00124">124</a> of file <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html">tcmi_ckpt_vm_area.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00082">tcmi_ckpt_vm_area_hdr::pathname_size</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00062">TCMI_CKPT_VM_AREA_LIGHT</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00219">tcmi_ckpt_write()</a>, and <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00079">tcmi_ckpt_vm_area_hdr::type</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00052">tcmi_ckpt_vm_area_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">/* page for the filepathname */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">char</span> *pathname;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">/* finish the header */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#acef560d3a4b8f4468bace7aa00ddd531" title="type of the area">type</a> = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">/* resolve the path name. */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for file pathname!&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(pathname = d_path(&amp;vma-&gt;vm_file-&gt;f_path, </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                     (<span class="keywordtype">char</span>*)page, PAGE_SIZE))) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t resolve pathname for &#39;%s&#39;&quot;</span>, </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;             vma-&gt;vm_file-&gt;f_dentry-&gt;d_name.name);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a106b8cd60837f2b06cfe36750b98a4e0" title="pathname size in bytes, including trailing zero - for light version only">pathname_size</a> = strlen(pathname) + 1;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">/* write the header and the pathname into the checkpoint */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, hdr, <span class="keyword">sizeof</span>(*hdr)) &lt; 0) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing VM_area header chunk&quot;</span>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">/* write the header and the pathname into the checkpoint */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, pathname, hdr-&gt;<a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#a106b8cd60837f2b06cfe36750b98a4e0" title="pathname size in bytes, including trailing zero - for light version only">pathname_size</a>) &lt; 0) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing pathname chunk&quot;</span>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; exit1:</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; exit0:</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d3/dad/group__tcmi__ckpt__vm__area__class_ga1bf3e24cdf83c3d7506e8eb8c2cea4d5_cgraph.png" border="0" usemap="#d3/dad/group__tcmi__ckpt__vm__area__class_ga1bf3e24cdf83c3d7506e8eb8c2cea4d5_cgraph" alt=""/></div>
<map name="d3/dad/group__tcmi__ckpt__vm__area__class_ga1bf3e24cdf83c3d7506e8eb8c2cea4d5_cgraph" id="d3/dad/group__tcmi__ckpt__vm__area__class_ga1bf3e24cdf83c3d7506e8eb8c2cea4d5_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="233,5,346,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="395,5,541,32"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gaeab68f17dc686a2f7dc72ab2b712e464"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef    __attribute__</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 7 2013 23:20:13 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
