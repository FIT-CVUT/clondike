<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: C:/CLONDIKE/clondike/sources/kernel_3.7.1/src/tcmi/task/tcmi_shadowtask.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_shadowtask.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;tcmi/comm/tcmi_messages_dsc.h&gt;</code><br/>
<code>#include &lt;tcmi/syscall/tcmi_shadow_rpc.h&gt;</code><br/>
<code>#include &lt;tcmi/comm/tcmi_rpc_procmsg.h&gt;</code><br/>
<code>#include &lt;tcmi/comm/tcmi_rpcresp_procmsg.h&gt;</code><br/>
<code>#include &lt;tcmi/comm/tcmi_ppm_p_migr_back_shadowreq_procmsg.h&gt;</code><br/>
<code>#include &lt;tcmi/manager/tcmi_migman.h&gt;</code><br/>
<code>#include &lt;tcmi/migration/tcmi_npm_params.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="../../db/dbe/kernel__3_87_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html">tcmi_taskhelper.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../d5/d5a/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8h_source.html">tcmi_shadowtask.h</a>&quot;</code><br/>
<code>#include &lt;asm/signal.h&gt;</code><br/>
<code>#include &lt;proxyfs/proxyfs_server.h&gt;</code><br/>
<code>#include &lt;director/director.h&gt;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for tcmi_shadowtask.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../de/dbc/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c__incl.png" border="0" usemap="#C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c" alt=""/></div>
<map name="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c" id="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c">
<area shape="rect" id="node9" href="../../db/dbe/kernel__3_87_81_2src_2tcmi_2task_2tcmi__taskhelper_8h.html" title="tcmi_taskhelper.h" alt="" coords="1337,124,1463,151"/><area shape="rect" id="node38" href="../../d5/d5a/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8h.html" title="tcmi_shadowtask.h" alt="" coords="1487,124,1621,151"/><area shape="rect" id="node19" href="../../d0/dc7/kernel__3_87_81_2src_2tcmi_2task_2tcmi__task_8h.html" title="tcmi_task.h" alt="" coords="1852,213,1943,240"/><area shape="rect" id="node23" href="../../d2/dcc/kernel__3_87_81_2src_2tcmi_2task_2tcmi__method__wrapper_8h.html" title="tcmi_method_wrapper.h" alt="" coords="1475,296,1635,323"/></map>
</div>
</div>
<p><a href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5c904cbbd707445dff0b700689dbf38c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#a5c904cbbd707445dff0b700689dbf38c">TCMI_SHADOWTASK_PRIVATE</a></td></tr>
<tr class="separator:a5c904cbbd707445dff0b700689dbf38c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a353f54eb9fc0224b5ab21ee3ee6e9d92"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#a353f54eb9fc0224b5ab21ee3ee6e9d92">tcmi_shadowtask_signal_handler</a> (int sig)</td></tr>
<tr class="memdesc:a353f54eb9fc0224b5ab21ee3ee6e9d92"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is just a "assertion check" handler.  <a href="#a353f54eb9fc0224b5ab21ee3ee6e9d92">More...</a><br/></td></tr>
<tr class="separator:a353f54eb9fc0224b5ab21ee3ee6e9d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5a1a66f6d53a0cbd079627b64d04b0ed"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/dff/group__tcmi__shadowtask__class.html#ga5a1a66f6d53a0cbd079627b64d04b0ed">tcmi_shadowtask_new</a> (pid_t local_pid, struct <a class="el" href="../../d6/da2/group__tcmi__migman__class.html#d2/d8c/structtcmi__migman">tcmi_migman</a> *migman, struct <a class="el" href="../../d6/d8e/group__kkc__sock__class.html#da/d0d/structkkc__sock">kkc_sock</a> *sock, struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *d_migproc, struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *d_migman)</td></tr>
<tr class="memdesc:ga5a1a66f6d53a0cbd079627b64d04b0ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Instance constructor.  <a href="../../dc/dff/group__tcmi__shadowtask__class.html#ga5a1a66f6d53a0cbd079627b64d04b0ed">More...</a><br/></td></tr>
<tr class="separator:ga5a1a66f6d53a0cbd079627b64d04b0ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafe0d1448f55b9fef0832b44a3128b2ad"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gafe0d1448f55b9fef0832b44a3128b2ad">tcmi_shadowtask_process_msg</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *m)</td></tr>
<tr class="memdesc:gafe0d1448f55b9fef0832b44a3128b2ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes a message specified by the caller.  <a href="#gafe0d1448f55b9fef0832b44a3128b2ad">More...</a><br/></td></tr>
<tr class="separator:gafe0d1448f55b9fef0832b44a3128b2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga13c386f8b5320b2aa774cf5ec9010407"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga13c386f8b5320b2aa774cf5ec9010407">tcmi_shadowtask_vfork_done</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="separator:ga13c386f8b5320b2aa774cf5ec9010407"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6c190ae8422d516d13dc517e2d89d2cd"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga6c190ae8422d516d13dc517e2d89d2cd">tcmi_shadowtask_emigrate_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *npm_params)</td></tr>
<tr class="memdesc:ga6c190ae8422d516d13dc517e2d89d2cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal helper method that can perform both NPM and PPM physical emigration.  <a href="#ga6c190ae8422d516d13dc517e2d89d2cd">More...</a><br/></td></tr>
<tr class="separator:ga6c190ae8422d516d13dc517e2d89d2cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae54626726bfe8d29214acb323742e49e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gae54626726bfe8d29214acb323742e49e">tcmi_shadowtask_emigrate_ppm_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gae54626726bfe8d29214acb323742e49e"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Emigrates a task to a PEN.  <a href="#gae54626726bfe8d29214acb323742e49e">More...</a><br/></td></tr>
<tr class="separator:gae54626726bfe8d29214acb323742e49e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae6a187e64a35dcea926a89060ce6bdae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gae6a187e64a35dcea926a89060ce6bdae">tcmi_shadowtask_emigrate_npm</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *npm_params)</td></tr>
<tr class="separator:gae6a187e64a35dcea926a89060ce6bdae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacff748e4399d3c718a848f9e914e2c04"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gacff748e4399d3c718a848f9e914e2c04">tcmi_shadowtask_migrateback_ppm_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gacff748e4399d3c718a848f9e914e2c04"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Migrates a task back to CCN.  <a href="#gacff748e4399d3c718a848f9e914e2c04">More...</a><br/></td></tr>
<tr class="separator:gacff748e4399d3c718a848f9e914e2c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5aabc354e036491ef0b5466fab4808fb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga5aabc354e036491ef0b5466fab4808fb">tcmi_shadowtask_execve</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga5aabc354e036491ef0b5466fab4808fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Execve notification when merging shadow with migrating process on CCN.  <a href="#ga5aabc354e036491ef0b5466fab4808fb">More...</a><br/></td></tr>
<tr class="separator:ga5aabc354e036491ef0b5466fab4808fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad36c4dd7e78162d76c7341688a8f42b5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gad36c4dd7e78162d76c7341688a8f42b5">tcmi_shadowtask_do_signal</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned long signr, siginfo_t *<a class="el" href="../../db/da0/kernel__3_87_81_2src_2tcmi_2comm_2tcmi__signal__msg_8h.html#a7d5c5f5b173fb960963b2c44980dc940">info</a>)</td></tr>
<tr class="memdesc:gad36c4dd7e78162d76c7341688a8f42b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes a specified signal.  <a href="#gad36c4dd7e78162d76c7341688a8f42b5">More...</a><br/></td></tr>
<tr class="separator:gad36c4dd7e78162d76c7341688a8f42b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac80577a00603ae888241ced646f230e7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gac80577a00603ae888241ced646f230e7">tcmi_shadowtask_verify_migration</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *<a class="el" href="../../d5/d4c/kernel__3_87_81_2src_2tcmi_2comm_2tcmi__msg_8h.html#adb26817b6c4a9eeb3f68c832f24d5471">resp</a>)</td></tr>
<tr class="memdesc:gac80577a00603ae888241ced646f230e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated.  <a href="#gac80577a00603ae888241ced646f230e7">More...</a><br/></td></tr>
<tr class="separator:gac80577a00603ae888241ced646f230e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0329a0dc8d8d862cb40c66faebc21211"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga0329a0dc8d8d862cb40c66faebc21211">tcmi_shadowtask_process_ppm_p_migr_back_guestreq_procmsg</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *m)</td></tr>
<tr class="memdesc:ga0329a0dc8d8d862cb40c66faebc21211"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes the PPM_P emigrate process message.  <a href="#ga0329a0dc8d8d862cb40c66faebc21211">More...</a><br/></td></tr>
<tr class="separator:ga0329a0dc8d8d862cb40c66faebc21211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga881ec0021bc7db3f376bde3d04e77541"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga881ec0021bc7db3f376bde3d04e77541">tcmi_shadowtask_free</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga881ec0021bc7db3f376bde3d04e77541"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Custom free method  <a href="#ga881ec0021bc7db3f376bde3d04e77541">More...</a><br/></td></tr>
<tr class="separator:ga881ec0021bc7db3f376bde3d04e77541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3224d8fc9ab8c8765f1b803cb91c861c"><td class="memItemLeft" align="right" valign="top">enum tcmi_task_type&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/dff/group__tcmi__shadowtask__class.html#ga3224d8fc9ab8c8765f1b803cb91c861c">tcmi_shadowtask_get_type</a> (void)</td></tr>
<tr class="memdesc:ga3224d8fc9ab8c8765f1b803cb91c861c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return type of task.  <a href="../../dc/dff/group__tcmi__shadowtask__class.html#ga3224d8fc9ab8c8765f1b803cb91c861c">More...</a><br/></td></tr>
<tr class="separator:ga3224d8fc9ab8c8765f1b803cb91c861c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2c12247d069df548dc334deea6441e7d"><td class="memItemLeft" align="right" valign="top">static struct k_sigaction&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#a2c12247d069df548dc334deea6441e7d">signal_action</a></td></tr>
<tr class="separator:a2c12247d069df548dc334deea6441e7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ce31f95511b3a387b75a304c9464f3e"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d5/d04/structtcmi__task__ops">tcmi_task_ops</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/dff/group__tcmi__shadowtask__class.html#ga4ce31f95511b3a387b75a304c9464f3e">shadowtask_ops</a></td></tr>
<tr class="memdesc:ga4ce31f95511b3a387b75a304c9464f3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">TCMI task operations that support polymorphism.  <a href="../../dc/dff/group__tcmi__shadowtask__class.html#ga4ce31f95511b3a387b75a304c9464f3e">More...</a><br/></td></tr>
<tr class="separator:ga4ce31f95511b3a387b75a304c9464f3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a5c904cbbd707445dff0b700689dbf38c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_SHADOWTASK_PRIVATE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00040">40</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gad36c4dd7e78162d76c7341688a8f42b5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_do_signal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>signr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">siginfo_t *&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes a specified signal. </p>
<p>All signals are forwared to the guest task.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
    <tr><td class="paramname">signr</td><td>- signal that is to be processed </td></tr>
    <tr><td class="paramname">*info</td><td>- info for signal to be processed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TCMI_TASK_KEEP_PUMPING on any signal but second or more SIGKILL </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00384">384</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d9/d03/kernel__2_86_833_81_2src_2proxyfs_2proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../df/d9b/kernel__2_86_833_81_2src_2tcmi_2manager_2tcmi__migman_8h_source.html#l00307">tcmi_migman_sock()</a>, <a class="el" href="../../dd/ddb/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8c_source.html#l00138">tcmi_msg_send_anonymous()</a>, <a class="el" href="../../df/d35/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__signal__msg_8c_source.html#l00168">tcmi_signal_msg_new()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, and <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;{</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *msg;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Shadow is processing signal %lu&quot;</span>, signr);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    msg = <a class="code" href="../../d8/d7b/group__tcmi__signal__msg__class.html#gaf1e2be73e14e6b57351003b2a19e72c6" title="&lt;&lt;public&gt;&gt; Construktor for sending with initialization">tcmi_signal_msg_new</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), <a class="code" href="../../d2/d82/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__signal__msg_8h.html#a7d5c5f5b173fb960963b2c44980dc940" title="Siginfo structure (we can use directly this structure as it is padded to be exactly 128 bytes)...">info</a>);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span>( msg ){</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection.">tcmi_msg_send_anonymous</a>(msg, <a class="code" href="../../d6/da2/group__tcmi__migman__class.html#ga91bf5b41a1d4faa3eab11e6867ec34e4" title="&lt;&lt;public&gt;&gt; Communication socket accesor.">tcmi_migman_sock</a>(self-&gt;<a class="code" href="../../de/d2f/group__tcmi__task__class.html#a9aba1cd10b1d60757060157c978f59b9" title="Reference to a migration manager to which this task belongs to.">migman</a>)));</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Signal message send&quot;</span>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gad36c4dd7e78162d76c7341688a8f42b5_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gad36c4dd7e78162d76c7341688a8f42b5_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gad36c4dd7e78162d76c7341688a8f42b5_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gad36c4dd7e78162d76c7341688a8f42b5_cgraph">
<area shape="rect" id="node2" href="../../d6/da2/group__tcmi__migman__class.html#ga91bf5b41a1d4faa3eab11e6867ec34e4" title="&lt;&lt;public&gt;&gt; Communication socket accesor." alt="" coords="225,5,359,32"/><area shape="rect" id="node4" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="198,56,386,83"/><area shape="rect" id="node5" href="../../d8/d7b/group__tcmi__signal__msg__class.html#gaf1e2be73e14e6b57351003b2a19e72c6" title="&lt;&lt;public&gt;&gt; Construktor for sending with initialization" alt="" coords="217,107,367,133"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="201,157,383,184"/><area shape="rect" id="node12" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="217,208,367,235"/><area shape="rect" id="node3" href="../../d3/d7e/group__tcmi__sock__class.html#ga8573cfac9adbb5996cd90395d8a78502" title="&lt;&lt;public&gt;&gt; KKC socket accessor." alt="" coords="440,5,611,32"/><area shape="rect" id="node6" href="../../d8/d7b/group__tcmi__signal__msg__class.html#gadec6208e448cacf50a000cc04a866381" title="&lt;&lt;public&gt;&gt; Skeleton message tx constructor." alt="" coords="441,107,609,133"/><area shape="rect" id="node8" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="435,157,615,184"/><area shape="rect" id="node9" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="665,157,834,184"/><area shape="rect" id="node10" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="893,132,1011,159"/><area shape="rect" id="node11" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="883,183,1021,209"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae6a187e64a35dcea926a89060ce6bdae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_emigrate_npm </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *&#160;</td>
          <td class="paramname"><em>npm_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00313">313</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00205">tcmi_shadowtask_emigrate_p()</a>.</p>
<div class="fragment"><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;{</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga6c190ae8422d516d13dc517e2d89d2cd" title="Internal helper method that can perform both NPM and PPM physical emigration.">tcmi_shadowtask_emigrate_p</a>(<span class="keyword">self</span>, npm_params);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae6a187e64a35dcea926a89060ce6bdae_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae6a187e64a35dcea926a89060ce6bdae_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae6a187e64a35dcea926a89060ce6bdae_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae6a187e64a35dcea926a89060ce6bdae_cgraph">
<area shape="rect" id="node2" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga6c190ae8422d516d13dc517e2d89d2cd" title="Internal helper method that can perform both NPM and PPM physical emigration." alt="" coords="267,433,461,460"/><area shape="rect" id="node3" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1217,352,1354,379"/><area shape="rect" id="node4" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="509,141,693,168"/><area shape="rect" id="node9" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga93e25269556be44be9de2b73713d7081" title="&lt;&lt;public&gt;&gt; Physical emigration message tx constructor." alt="" coords="526,193,677,234"/><area shape="rect" id="node10" href="../../de/d2f/group__tcmi__task__class.html#ga86b8af90f121c51ad718c6965441972f" title="&lt;&lt;public&gt;&gt; Transactions accessor &#45; needed when tasks construct their own messages." alt="" coords="523,259,680,285"/><area shape="rect" id="node11" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="526,309,677,336"/><area shape="rect" id="node12" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="511,40,692,67"/><area shape="rect" id="node16" href="../../de/d2f/group__tcmi__task__class.html#ga6f509d7a61c069c641e99fe32a57ef75" title="&lt;&lt;public&gt;&gt; Sends a specified message and waits for a response." alt="" coords="530,361,673,402"/><area shape="rect" id="node18" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gac80577a00603ae888241ced646f230e7" title="&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated." alt="" coords="522,426,681,467"/><area shape="rect" id="node24" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="516,543,687,569"/><area shape="rect" id="node25" href="../../d2/daf/group__tcmi__taskhelper__class.html#gac1c217309f2f0c54aa2ee7802f31eab2" title="&lt;&lt;public&gt;&gt; Set action for all signals accept SIGKILL and SIGSTOP" alt="" coords="525,594,678,635"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="514,660,689,687"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga491523e65c3fb2f665013a2f15899cb8" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Processes one message from the message queue." alt="" coords="519,711,683,737"/><area shape="rect" id="node28" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="549,761,653,788"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="757,56,933,83"/><area shape="rect" id="node6" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="742,107,949,133"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="781,157,910,184"/><area shape="rect" id="node8" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="742,208,949,235"/><area shape="rect" id="node13" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="755,5,935,32"/><area shape="rect" id="node14" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="998,132,1167,159"/><area shape="rect" id="node15" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1226,132,1345,159"/><area shape="rect" id="node17" href="../../d6/dc2/group__tcmi__msg__class.html#gadcb05f36b8afb930d1a825ae12ff7d3c" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection and waits for the response." alt="" coords="751,259,940,285"/><area shape="rect" id="node19" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="797,360,893,387"/><area shape="rect" id="node20" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor." alt="" coords="774,411,917,453"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="758,477,933,504"/><area shape="rect" id="node22" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="1010,477,1155,504"/><area shape="rect" id="node23" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="1001,386,1164,427"/><area shape="rect" id="node29" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="774,761,917,788"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga6c190ae8422d516d13dc517e2d89d2cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_emigrate_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *&#160;</td>
          <td class="paramname"><em>npm_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal helper method that can perform both NPM and PPM physical emigration. </p>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00205">205</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../da/d3b/kernel__2_86_833_81_2src_2tcmi_2migration_2tcmi__npm__params_8h_source.html#l00034">tcmi_npm_params::file_name</a>, <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00114">req</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00116">resp</a>, <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00059">signal_action</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../df/d9a/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__p__emigrate__msg_8c_source.html#l00102">tcmi_p_emigrate_msg_new_tx()</a>, <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00412">tcmi_shadowtask_verify_migration()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00400">tcmi_task_ckpt_name()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00398">tcmi_task_process_msg()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00257">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00567">tcmi_task_send_and_receive_msg()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00270">tcmi_task_submit_method()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00344">tcmi_task_transactions()</a>, <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00756">tcmi_taskhelper_catch_all_signals()</a>, <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00620">tcmi_taskhelper_checkpoint()</a>, and <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00728">tcmi_taskhelper_flushfiles()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00313">tcmi_shadowtask_emigrate_npm()</a>, and <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00308">tcmi_shadowtask_emigrate_ppm_p()</a>.</p>
<div class="fragment"><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                                                                                  {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *<a class="code" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h.html#a523c18bfd05e923b099719721b24db7d" title="request transaction ID">req</a>, *<a class="code" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h.html#adb26817b6c4a9eeb3f68c832f24d5471" title="response transaction ID">resp</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">char</span>* exec_name;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    u64 beg_time, end_time;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    beg_time = cpu_clock(smp_processor_id());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> ( npm_params ) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// For NPM, the exec name is name of the file being executed</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        exec_name = npm_params-&gt;<a class="code" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#a72fbbfb4551a31a666529d3d60794c09" title="Name of the file that is being &quot;execve-ed&quot;.">file_name</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// TODO: Detect this from current in case of PPM.. how? ;)  </span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        exec_name = current-&gt;comm;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Process &#39;%s&#39; - local PID %d, emigrating&quot;</span>,</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         current-&gt;comm, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process.">tcmi_taskhelper_checkpoint</a>(<span class="keyword">self</span>, npm_params) &lt; 0) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to create a checkpoint&quot;</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (!(req = <a class="code" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga93e25269556be44be9de2b73713d7081" title="&lt;&lt;public&gt;&gt; Physical emigration message tx constructor.">tcmi_p_emigrate_msg_new_tx</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga86b8af90f121c51ad718c6965441972f" title="&lt;&lt;public&gt;&gt; Transactions accessor - needed when tasks construct their own messages.">tcmi_task_transactions</a>(<span class="keyword">self</span>), </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                           <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                           exec_name,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                           <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor.">tcmi_task_ckpt_name</a>(<span class="keyword">self</span>),</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                           current_euid(),</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                           current_egid(),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                           current_fsuid(),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                           current_fsgid()))) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error creating an emigration message&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga6f509d7a61c069c641e99fe32a57ef75" title="&lt;&lt;public&gt;&gt; Sends a specified message and waits for a response.">tcmi_task_send_and_receive_msg</a>(<span class="keyword">self</span>, req, &amp;resp)) &lt; 0) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to send message!!&quot;</span>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gac80577a00603ae888241ced646f230e7" title="&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated.">tcmi_shadowtask_verify_migration</a>(<span class="keyword">self</span>, resp) &lt; 0) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to migrate the task &#39;%s&#39;&quot;</span>, current-&gt;comm);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">goto</span> exit2;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    end_time = cpu_clock(smp_processor_id());</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Emigration (npm: %d) took &#39;%llu&#39; ms.&#39;&quot;</span>, npm_params != NULL, (end_time - beg_time) / 1000000);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    printk(<span class="stringliteral">&quot;Emigration (npm: %d) took &#39;%llu&#39; ms.\n&#39;&quot;</span>, npm_params != NULL, (end_time - beg_time) / 1000000);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/* </span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">       Files are flushed only after we have confirmation that the migration have succeeded.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">       Otherwise we keep them open so that we can eventually continue execution of the current</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">           process.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request.">tcmi_taskhelper_flushfiles</a>();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#gac1c217309f2f0c54aa2ee7802f31eab2" title="&lt;&lt;public&gt;&gt; Set action for all signals accept SIGKILL and SIGSTOP">tcmi_taskhelper_catch_all_signals</a>(&amp;<a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#a2c12247d069df548dc334deea6441e7d">signal_action</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Submitting process_msg&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution.">tcmi_task_submit_method</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga491523e65c3fb2f665013a2f15899cb8" title="&lt;&lt;public&gt;&gt; Called from method queue - Processes one message from the message queue.">tcmi_task_process_msg</a>, NULL, 0);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">/* release the message */</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(req);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(resp);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// In case the emigration succeeded, we are responsible for freeing of npm params, as the caller won&#39;t ever get chance</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> ( npm_params )</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        vfree(npm_params);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; exit2:</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(resp);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; exit1:</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(req);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; exit0:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">/* either checkpointing,communication or restart has failed. In either case we simply continue execution of the current task */</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bade59423de18b4fdc67a09f36b7cd71aa">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;};</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga6c190ae8422d516d13dc517e2d89d2cd_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga6c190ae8422d516d13dc517e2d89d2cd_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga6c190ae8422d516d13dc517e2d89d2cd_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga6c190ae8422d516d13dc517e2d89d2cd_cgraph">
<area shape="rect" id="node2" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="288,27,392,53"/><area shape="rect" id="node4" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga93e25269556be44be9de2b73713d7081" title="&lt;&lt;public&gt;&gt; Physical emigration message tx constructor." alt="" coords="265,111,415,153"/><area shape="rect" id="node5" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gac80577a00603ae888241ced646f230e7" title="&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated." alt="" coords="261,177,419,218"/><area shape="rect" id="node12" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="249,365,431,392"/><area shape="rect" id="node16" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="265,315,415,341"/><area shape="rect" id="node8" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="955,249,1093,276"/><area shape="rect" id="node17" href="../../de/d2f/group__tcmi__task__class.html#ga491523e65c3fb2f665013a2f15899cb8" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Processes one message from the message queue." alt="" coords="258,416,422,443"/><area shape="rect" id="node18" href="../../de/d2f/group__tcmi__task__class.html#ga6f509d7a61c069c641e99fe32a57ef75" title="&lt;&lt;public&gt;&gt; Sends a specified message and waits for a response." alt="" coords="269,467,411,509"/><area shape="rect" id="node20" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="253,533,427,560"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#ga86b8af90f121c51ad718c6965441972f" title="&lt;&lt;public&gt;&gt; Transactions accessor &#45; needed when tasks construct their own messages." alt="" coords="261,584,419,611"/><area shape="rect" id="node22" href="../../d2/daf/group__tcmi__taskhelper__class.html#gac1c217309f2f0c54aa2ee7802f31eab2" title="&lt;&lt;public&gt;&gt; Set action for all signals accept SIGKILL and SIGSTOP" alt="" coords="263,635,417,677"/><area shape="rect" id="node23" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="248,701,432,728"/><area shape="rect" id="node28" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="255,752,425,779"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="513,5,655,32"/><area shape="rect" id="node6" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="536,56,632,83"/><area shape="rect" id="node7" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor." alt="" coords="513,107,655,149"/><area shape="rect" id="node9" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="497,173,671,200"/><area shape="rect" id="node10" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="749,173,894,200"/><area shape="rect" id="node11" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="740,107,903,149"/><area shape="rect" id="node13" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="494,356,674,383"/><area shape="rect" id="node14" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="737,345,906,372"/><area shape="rect" id="node15" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="965,345,1083,372"/><area shape="rect" id="node19" href="../../d6/dc2/group__tcmi__msg__class.html#gadcb05f36b8afb930d1a825ae12ff7d3c" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection and waits for the response." alt="" coords="489,475,679,501"/><area shape="rect" id="node24" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="496,625,672,652"/><area shape="rect" id="node25" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="481,676,687,703"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="519,727,649,753"/><area shape="rect" id="node27" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="481,777,687,804"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae54626726bfe8d29214acb323742e49e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_emigrate_ppm_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Emigrates a task to a PEN. </p>
<ul>
<li>create a new checkpoint</li>
<li>flush open files of the current process (prevents write conflicts after checkpoint restart)</li>
<li>creates a new emigration message specifying latest checkpoint name and shadow task PID</li>
<li>send the message waiting for a response</li>
<li>if the guest has been succesfully started submit process_msg method into the method queue and quit (migration verification). The submitted method will keep on processing any message that will arrive on the queue.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TCMI_TASK_KEEP_PUMPING, if the shadow has received a positive response and the task has been successfully migrated.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000013">Todo:</a></b></dt><dd><ul>
<li>after creating a checkpoint and preparing the emigration message there a few things that need to be done:</li>
</ul>
</dd></dl>
<ul>
<li>some component should scan all open files and close all regular files as they will be accessed from the network filesystem.</li>
<li>character, block devices, pipes, sockets should stay open so that remote operations can be forwarded locally.</li>
<li>the current execution image should be flushed as it is not needed anymore </li>
</ul>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00308">308</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00205">tcmi_shadowtask_emigrate_p()</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga6c190ae8422d516d13dc517e2d89d2cd" title="Internal helper method that can perform both NPM and PPM physical emigration.">tcmi_shadowtask_emigrate_p</a>(<span class="keyword">self</span>, NULL);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae54626726bfe8d29214acb323742e49e_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae54626726bfe8d29214acb323742e49e_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae54626726bfe8d29214acb323742e49e_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gae54626726bfe8d29214acb323742e49e_cgraph">
<area shape="rect" id="node2" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga6c190ae8422d516d13dc517e2d89d2cd" title="Internal helper method that can perform both NPM and PPM physical emigration." alt="" coords="235,416,429,443"/><area shape="rect" id="node3" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="517,27,621,53"/><area shape="rect" id="node5" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga93e25269556be44be9de2b73713d7081" title="&lt;&lt;public&gt;&gt; Physical emigration message tx constructor." alt="" coords="494,111,645,153"/><area shape="rect" id="node6" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#gac80577a00603ae888241ced646f230e7" title="&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated." alt="" coords="490,177,649,218"/><area shape="rect" id="node13" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="479,365,660,392"/><area shape="rect" id="node17" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="494,315,645,341"/><area shape="rect" id="node9" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1185,249,1322,276"/><area shape="rect" id="node18" href="../../de/d2f/group__tcmi__task__class.html#ga491523e65c3fb2f665013a2f15899cb8" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Processes one message from the message queue." alt="" coords="487,416,651,443"/><area shape="rect" id="node19" href="../../de/d2f/group__tcmi__task__class.html#ga6f509d7a61c069c641e99fe32a57ef75" title="&lt;&lt;public&gt;&gt; Sends a specified message and waits for a response." alt="" coords="498,467,641,509"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="482,533,657,560"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#ga86b8af90f121c51ad718c6965441972f" title="&lt;&lt;public&gt;&gt; Transactions accessor &#45; needed when tasks construct their own messages." alt="" coords="491,584,648,611"/><area shape="rect" id="node23" href="../../d2/daf/group__tcmi__taskhelper__class.html#gac1c217309f2f0c54aa2ee7802f31eab2" title="&lt;&lt;public&gt;&gt; Set action for all signals accept SIGKILL and SIGSTOP" alt="" coords="493,635,646,677"/><area shape="rect" id="node24" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="477,701,661,728"/><area shape="rect" id="node29" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="484,752,655,779"/><area shape="rect" id="node4" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="742,5,885,32"/><area shape="rect" id="node7" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="765,56,861,83"/><area shape="rect" id="node8" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor." alt="" coords="742,107,885,149"/><area shape="rect" id="node10" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="726,173,901,200"/><area shape="rect" id="node11" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="978,173,1123,200"/><area shape="rect" id="node12" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="969,107,1132,149"/><area shape="rect" id="node14" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="723,356,903,383"/><area shape="rect" id="node15" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="966,345,1135,372"/><area shape="rect" id="node16" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1194,345,1313,372"/><area shape="rect" id="node20" href="../../d6/dc2/group__tcmi__msg__class.html#gadcb05f36b8afb930d1a825ae12ff7d3c" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection and waits for the response." alt="" coords="719,475,908,501"/><area shape="rect" id="node25" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="725,625,901,652"/><area shape="rect" id="node26" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="710,676,917,703"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="749,727,878,753"/><area shape="rect" id="node28" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="710,777,917,804"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga5aabc354e036491ef0b5466fab4808fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_execve </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Execve notification when merging shadow with migrating process on CCN. </p>
<p>This method is called right before issuing the actual execve on the checkpoint image of the migrated task. Since the task will be merged with the original process, it needs to be remove from the TCMI. All that needs to be done is scheduling a <a class="el" href="../../de/d2f/group__tcmi__task__class.html#ga724d575729c5a3f2be09db7ee6833999" title="&lt;&lt;public&gt;&gt; Called from method queue - Exits a task.">tcmi_task_exit()</a> method. The migration mode handler takes care of the rest.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00365">365</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00635">tcmi_task_exit()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00295">tcmi_task_flush_and_submit_method()</a>, and <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00092">tcmi_taskhelper_enter_mig_mode()</a>.</p>
<div class="fragment"><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;{</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution.">tcmi_task_flush_and_submit_method</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga724d575729c5a3f2be09db7ee6833999" title="&lt;&lt;public&gt;&gt; Called from method queue - Exits a task.">tcmi_task_exit</a>, NULL, 0);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">/* migration mode is entered when the actual execve resumes to</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">     * user mode */</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga9dbb48f23b9ec6a00498db53f026ef4b" title="&lt;&lt;public&gt;&gt; Switches the task into migration mode.">tcmi_taskhelper_enter_mig_mode</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga5aabc354e036491ef0b5466fab4808fb_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga5aabc354e036491ef0b5466fab4808fb_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga5aabc354e036491ef0b5466fab4808fb_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga5aabc354e036491ef0b5466fab4808fb_cgraph">
<area shape="rect" id="node2" href="../../de/d2f/group__tcmi__task__class.html#ga724d575729c5a3f2be09db7ee6833999" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Exits a task." alt="" coords="247,5,353,32"/><area shape="rect" id="node3" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="229,57,371,98"/><area shape="rect" id="node4" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga9dbb48f23b9ec6a00498db53f026ef4b" title="&lt;&lt;public&gt;&gt; Switches the task into migration mode." alt="" coords="225,122,375,163"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="425,104,594,131"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="643,155,781,181"/><area shape="rect" id="node6" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="653,104,771,131"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga881ec0021bc7db3f376bde3d04e77541"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_shadowtask_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Custom free method </p>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00495">495</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;{</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gacff748e4399d3c718a848f9e914e2c04"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_migrateback_ppm_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Migrates a task back to CCN. </p>
<p>This is done simply by sending a migrate back request to the associated ghost task, which will handle its migration home the same way as if it was requested on PEN</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>result of the task specific migrate back method or TCMI_TASK_KEEP_PUMPING </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00328">328</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d3/dab/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__ppm__p__migr__back__shadowreq__procmsg_8c_source.html#l00065">tcmi_ppm_p_migr_back_shadowreq_procmsg_new_tx()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, and <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *msg;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">/* struct tcmi_shadowtask *self_tsk = TCMI_SHADOWTASK(self); */</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Process &#39;%s&#39; - local PID %d, remote PID %d, migrate home requested&quot;</span>,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;         current-&gt;comm, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> ( !(msg = <a class="code" href="../../d9/d3f/group__tcmi__ppm__p__migr__back__shadowreq__procmsg__class.html#gafb12a19188e60dfa400e079803f17cb4" title="&lt;&lt;public&gt;&gt; Shadow request for migration back tx constructor.">tcmi_ppm_p_migr_back_shadowreq_procmsg_new_tx</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>))) ) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error creating a migrate back message&quot;</span>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, msg)) &lt; 0) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to send message!!&quot;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;exit1:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(msg);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;exit0:  </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gacff748e4399d3c718a848f9e914e2c04_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gacff748e4399d3c718a848f9e914e2c04_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gacff748e4399d3c718a848f9e914e2c04_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gacff748e4399d3c718a848f9e914e2c04_cgraph">
<area shape="rect" id="node2" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="315,5,419,32"/><area shape="rect" id="node4" href="../../d9/d3f/group__tcmi__ppm__p__migr__back__shadowreq__procmsg__class.html#gafb12a19188e60dfa400e079803f17cb4" title="&lt;&lt;public&gt;&gt; Shadow request for migration back tx constructor." alt="" coords="269,57,465,98"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="276,123,457,149"/><area shape="rect" id="node9" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="982,173,1119,200"/><area shape="rect" id="node10" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="291,224,442,251"/><area shape="rect" id="node11" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="257,275,477,301"/><area shape="rect" id="node3" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="549,5,691,32"/><area shape="rect" id="node6" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="530,123,710,149"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="763,123,933,149"/><area shape="rect" id="node8" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="991,123,1110,149"/><area shape="rect" id="node12" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="526,275,714,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gafe0d1448f55b9fef0832b44a3128b2ad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_process_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes a message specified by the caller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
    <tr><td class="paramname">*m</td><td>- message to be processed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>depends on the type of message that has been processed </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00127">127</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00221">minfo</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00116">resp</a>, <a class="el" href="../../d7/df8/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__exit__procmsg_8h_source.html#l00070">TCMI_EXIT_PROCMSG</a>, <a class="el" href="../../d7/df8/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__exit__procmsg_8h_source.html#l00078">tcmi_exit_procmsg_code()</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00132">TCMI_EXIT_PROCMSG_ID</a>, <a class="el" href="../../d7/d8c/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__guest__started__procmsg_8h_source.html#l00075">TCMI_GUEST_STARTED_PROCMSG</a>, <a class="el" href="../../d7/d8c/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__guest__started__procmsg_8h_source.html#l00083">tcmi_guest_started_procmsg_guest_pid()</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00134">TCMI_GUEST_STARTED_PROCMSG_ID</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00194">tcmi_msg_get()</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00231">tcmi_msg_id()</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00135">TCMI_PPM_P_MIGR_BACK_GUESTREQ_PROCMSG_ID</a>, <a class="el" href="../../d0/d39/kernel__2_86_833_81_2src_2tcmi_2syscall_2tcmi__rpc_8h_source.html#l00091">tcmi_rpc_call2()</a>, <a class="el" href="../../de/d7d/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__rpc__procmsg_8h_source.html#l00100">TCMI_RPC_PROCMSG</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00137">TCMI_RPC_PROCMSG_ID</a>, <a class="el" href="../../de/d7d/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__rpc__procmsg_8h_source.html#l00089">tcmi_rpc_procmsg_num()</a>, <a class="el" href="../../db/de1/kernel__2_86_833_81_2src_2tcmi_2syscall_2tcmi__shadow__rpc_8c_source.html#l00036">tcmi_shadow_rpc</a>, <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00467">tcmi_shadowtask_process_ppm_p_migr_back_guestreq_procmsg()</a>, <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00196">tcmi_shadowtask_vfork_done()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00255">TCMI_TASK_KILL_ME</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00450">tcmi_task_send_message()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00367">tcmi_task_set_exit_code()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00270">tcmi_task_submit_method()</a>, and <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00133">TCMI_VFORK_DONE_PROCMSG_ID</a>.</p>
<div class="fragment"><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *<a class="code" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h.html#adb26817b6c4a9eeb3f68c832f24d5471" title="response transaction ID">resp</a> = NULL;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    pid_t remote_pid;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">/* struct tcmi_shadowtask *self_tsk = TCMI_SHADOWTASK(self); */</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(m)) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9eabc7c4c942574da98e10199c6b4c6e638">TCMI_RPC_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO1, <span class="stringliteral">&quot;Receiced RPC message: %x&quot;</span>, <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(m));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <a class="code" href="../../d2/d43/group__tcmi__rpc__class.html#gac256a36ecc415dfbf0427af0d3e7e902" title="&lt;&lt;public&gt;&gt; Do a rpc with 2 parameters.">tcmi_rpc_call2</a>(<a class="code" href="../../d5/d8f/group__tcmi__shadow__rpc__class.html#ga768b223612ab8656e18a3bdc0ae6aec8" title="tcmi_shadow_rpc class declaration">tcmi_shadow_rpc</a>, <a class="code" href="../../d2/da2/group__tcmi__rpc__procmsg__class.html#ga3faa701b0512840c23a97dc58e13e75c" title="&lt;&lt;public&gt;&gt; Return RPC number.">tcmi_rpc_procmsg_num</a>(<a class="code" href="../../d2/da2/group__tcmi__rpc__procmsg__class.html#ga31e7e4639350a91cfc415bc0620c0217" title="Casts to the tcmi_rpc_procmsg instance.">TCMI_RPC_PROCMSG</a>(m)), (<span class="keywordtype">long</span>)m, (<span class="keywordtype">long</span>)(&amp;resp));</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> ( resp == NULL ) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(ERR3, <span class="stringliteral">&quot;RPC#%d didn&#39;t returned rpc response message&quot;</span>, </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        <a class="code" href="../../d2/da2/group__tcmi__rpc__procmsg__class.html#ga3faa701b0512840c23a97dc58e13e75c" title="&lt;&lt;public&gt;&gt; Return RPC number.">tcmi_rpc_procmsg_num</a>(<a class="code" href="../../d2/da2/group__tcmi__rpc__procmsg__class.html#ga31e7e4639350a91cfc415bc0620c0217" title="Casts to the tcmi_rpc_procmsg instance.">TCMI_RPC_PROCMSG</a>(m)));</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> ( <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, (err = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, resp)) ) ){</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(ERR3, <span class="stringliteral">&quot;Error sending RPC response message %d&quot;</span>, err);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="keywordflow">if</span> ( err == -ERESTARTSYS ) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(INFO3, <span class="stringliteral">&quot;Scheduling message for resubmission&quot;</span>);  </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                    <span class="comment">/* Protect response reference, retransmission method will be responsible for releasing of the msg */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga23d3ca435be85adedc5c1385469d707f" title="&lt;&lt;public&gt;&gt; Instance accessor, increments the reference count.">tcmi_msg_get</a>(resp);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution.">tcmi_task_submit_method</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga85318d71dab1a903c2799134c696990d" title="&lt;&lt;public&gt;&gt; Called from method queue - Sends a message to peer task.">tcmi_task_send_message</a>, resp, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a>));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>( resp );</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">/* exit request */</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea3655cb6b34c18303cc6a15da6919b8da">TCMI_EXIT_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Process &#39;%s&#39; local PID=%d, remote PID=%d terminating, &quot;</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    <span class="stringliteral">&quot;code: %ld, anounced by guest&quot;</span>,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    current-&gt;comm, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>),</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    (<span class="keywordtype">long</span>)<a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga14abd449ec55da5c984307167916af0e" title="Exit code accessor.">tcmi_exit_procmsg_code</a>(<a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga498ab81a7b3fd783c5311c86c3400f65" title="Casts to the tcmi_exit_procmsg instance.">TCMI_EXIT_PROCMSG</a>(m)));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gad2304b37598ad3c64f6a24f0ed0064de" title="&lt;&lt;public&gt;&gt; Exit code setter.">tcmi_task_set_exit_code</a>(<span class="keyword">self</span>, <a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga14abd449ec55da5c984307167916af0e" title="Exit code accessor.">tcmi_exit_procmsg_code</a>(<a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga498ab81a7b3fd783c5311c86c3400f65" title="Casts to the tcmi_exit_procmsg instance.">TCMI_EXIT_PROCMSG</a>(m)));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bad619e483cc5231333ada87518fb2b301">TCMI_TASK_KILL_ME</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">/* vfork done on guest side */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9eacbe4a89e5620a43b51b1889ea5e4713a">TCMI_VFORK_DONE_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Process &#39;%s&#39; local PID=%d, remote PID=%d vfork done&quot;</span>,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    current-&gt;comm, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga13c386f8b5320b2aa774cf5ec9010407">tcmi_shadowtask_vfork_done</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="comment">/* migrate back request */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9eaa41d6302c56a5fbe80be4a688ac77301">TCMI_PPM_P_MIGR_BACK_GUESTREQ_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            res = <a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga0329a0dc8d8d862cb40c66faebc21211" title="&lt;&lt;private&gt;&gt; Processes the PPM_P emigrate process message.">tcmi_shadowtask_process_ppm_p_migr_back_guestreq_procmsg</a>(<span class="keyword">self</span>, m);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea1fff522372aae1c3fa549658ef13d5ab">TCMI_GUEST_STARTED_PROCMSG_ID</a>: <span class="comment">// We can get here only in double-fork</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            remote_pid = <a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor.">tcmi_guest_started_procmsg_guest_pid</a>(<a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga47d048883e032d7dfdfb9c7421bd91b6" title="Casts to the tcmi_guest_started_procmsg instance.">TCMI_GUEST_STARTED_PROCMSG</a>(m));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Fork confirmation from guesttask - task migrated, local PID %d, guest PID %d&quot;</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), remote_pid);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter.">tcmi_task_set_remote_pid</a>(<span class="keyword">self</span>, remote_pid);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unexpected message from the guest task: %x&quot;</span>, <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(m));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gafe0d1448f55b9fef0832b44a3128b2ad_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gafe0d1448f55b9fef0832b44a3128b2ad_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gafe0d1448f55b9fef0832b44a3128b2ad_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gafe0d1448f55b9fef0832b44a3128b2ad_cgraph">
<area shape="rect" id="node2" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga14abd449ec55da5c984307167916af0e" title="Exit code accessor." alt="" coords="289,5,455,32"/><area shape="rect" id="node3" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor." alt="" coords="301,57,443,98"/><area shape="rect" id="node4" href="../../d6/dc2/group__tcmi__msg__class.html#ga23d3ca435be85adedc5c1385469d707f" title="&lt;&lt;public&gt;&gt; Instance accessor, increments the reference count." alt="" coords="320,123,424,149"/><area shape="rect" id="node5" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="324,173,420,200"/><area shape="rect" id="node6" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="320,224,424,251"/><area shape="rect" id="node8" href="../../d2/d43/group__tcmi__rpc__class.html#gac256a36ecc415dfbf0427af0d3e7e902" title="&lt;&lt;public&gt;&gt; Do a rpc with 2 parameters." alt="" coords="319,275,425,301"/><area shape="rect" id="node10" href="../../d2/da2/group__tcmi__rpc__procmsg__class.html#ga3faa701b0512840c23a97dc58e13e75c" title="&lt;&lt;public&gt;&gt; Return RPC number." alt="" coords="291,325,453,352"/><area shape="rect" id="node11" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga0329a0dc8d8d862cb40c66faebc21211" title="&lt;&lt;private&gt;&gt; Processes the PPM_P emigrate process message." alt="" coords="276,477,468,533"/><area shape="rect" id="node20" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#ga13c386f8b5320b2aa774cf5ec9010407" title="tcmi_shadowtask_vfork_done" alt="" coords="277,427,467,453"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="281,376,463,403"/><area shape="rect" id="node15" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1011,588,1149,615"/><area shape="rect" id="node13" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="559,593,710,620"/><area shape="rect" id="node25" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="262,659,482,685"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga85318d71dab1a903c2799134c696990d" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Sends a message to peer task." alt="" coords="285,709,459,736"/><area shape="rect" id="node28" href="../../de/d2f/group__tcmi__task__class.html#gad2304b37598ad3c64f6a24f0ed0064de" title="&lt;&lt;public&gt;&gt; Exit code setter." alt="" coords="289,760,455,787"/><area shape="rect" id="node29" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="285,608,459,635"/><area shape="rect" id="node32" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="285,861,459,888"/><area shape="rect" id="node7" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="563,223,706,249"/><area shape="rect" id="node9" href="../../d2/d43/group__tcmi__rpc__class.html#ga3b19dd529d8c1bc18d24bca70107003f" title="&lt;&lt;public&gt;&gt; Universal procedure to do RPC" alt="" coords="588,273,681,300"/><area shape="rect" id="node12" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#ga595504c7571b0e3a1e50b198672cc9dc" title="Checkpoint name accessor." alt="" coords="531,375,738,417"/><area shape="rect" id="node14" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home." alt="" coords="554,441,715,468"/><area shape="rect" id="node16" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image." alt="" coords="555,492,714,519"/><area shape="rect" id="node17" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="787,432,963,459"/><area shape="rect" id="node18" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="804,483,945,525"/><area shape="rect" id="node19" href="../../de/d2f/group__tcmi__task__class.html#gab1a418ac9d8b708dcee524671db07518" title="&lt;&lt;public&gt;&gt; Executes the file that has been previously setup for execution." alt="" coords="811,381,938,408"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="545,324,725,351"/><area shape="rect" id="node23" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="790,327,959,353"/><area shape="rect" id="node24" href="../../d7/d75/kernel__2_86_833_81_2src_2tcmi_2lib_2util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1021,327,1139,353"/><area shape="rect" id="node26" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="541,745,729,772"/><area shape="rect" id="node30" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="562,695,707,721"/><area shape="rect" id="node31" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="793,618,956,659"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga0329a0dc8d8d862cb40c66faebc21211"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_process_ppm_p_migr_back_guestreq_procmsg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes the PPM_P emigrate process message. </p>
<p>The remote PID is extracted from the emigration message and stored in the guest task. The checkpoint name is also extracted and passed to the task helper to schedule a restart. This also sets the checkpoint image as the most recent checkpoint of the task.</p>
<p>A response is sent back that will contain the guest task local PID. This PID is needed for further communication between the shadow and guest tasks.</p>
<p>The restart is only scheduled and will be processed upon next iteration of the method pump.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this guest task instance </td></tr>
    <tr><td class="paramname">*m</td><td>- PPM_P migrate back guest request </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TASK_KEEP_PUMPING if the restart has been successfully scheduled </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00467">467</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c_source.html#l00118">director_migrated_home()</a>, <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d2/de0/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__ppm__p__migr__back__guestreq__procmsg_8h_source.html#l00074">TCMI_PPM_P_MIGR_BACK_GUESTREQ_PROCMSG</a>, <a class="el" href="../../d2/de0/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__ppm__p__migr__back__guestreq__procmsg_8h_source.html#l00082">tcmi_ppm_p_migr_back_guestreq_procmsg_ckpt_name()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00255">TCMI_TASK_KILL_ME</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, and <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00700">tcmi_taskhelper_restart()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00127">tcmi_shadowtask_process_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">char</span> *ckpt_name;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">/* extract the checkpoint name */</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    ckpt_name =  <a class="code" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#ga595504c7571b0e3a1e50b198672cc9dc" title="Checkpoint name accessor.">tcmi_ppm_p_migr_back_guestreq_procmsg_ckpt_name</a></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        (<a class="code" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#ga407c2dcfc13e9cf95f56f6ca10dc386e" title="Casts to the tcmi_ppm_p_migr_back_guestreq_procmsg instance.">TCMI_PPM_P_MIGR_BACK_GUESTREQ_PROCMSG</a>(m));</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Processing migrate back request, remote PID=%d, checkpoint: &#39;%s&#39;&quot;</span>,</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;             <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), ckpt_name);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home.">director_migrated_home</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">/* schedules process restart from a checkpoint image */</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image.">tcmi_taskhelper_restart</a>(<span class="keyword">self</span>, ckpt_name) &lt; 0) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Cannot setup task restart!!&quot;</span>);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; exit0:</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bad619e483cc5231333ada87518fb2b301">TCMI_TASK_KILL_ME</a>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga0329a0dc8d8d862cb40c66faebc21211_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga0329a0dc8d8d862cb40c66faebc21211_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga0329a0dc8d8d862cb40c66faebc21211_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_ga0329a0dc8d8d862cb40c66faebc21211_cgraph">
<area shape="rect" id="node2" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home." alt="" coords="269,5,430,32"/><area shape="rect" id="node3" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#ga595504c7571b0e3a1e50b198672cc9dc" title="Checkpoint name accessor." alt="" coords="246,57,453,98"/><area shape="rect" id="node4" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="281,123,418,149"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="274,173,425,200"/><area shape="rect" id="node6" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image." alt="" coords="270,224,429,251"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="501,165,677,192"/><area shape="rect" id="node8" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="519,217,660,258"/><area shape="rect" id="node9" href="../../de/d2f/group__tcmi__task__class.html#gab1a418ac9d8b708dcee524671db07518" title="&lt;&lt;public&gt;&gt; Executes the file that has been previously setup for execution." alt="" coords="526,283,653,309"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a353f54eb9fc0224b5ab21ee3ee6e9d92"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_shadowtask_signal_handler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This is just a "assertion check" handler. </p>
<p>It should never be calles since all signals of the CCN should be processed in its main processing loop.</p>
<p>When the process is migrated away, this handler is registered as a handler of all its assocaited signals. When the process is migrated back, its real handlers are restored. </p>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00054">54</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Shadow signal handler for signal %d called&quot;</span>, sig);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac80577a00603ae888241ced646f230e7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_shadowtask_verify_migration </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *&#160;</td>
          <td class="paramname"><em>resp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Verifies, that the task has been successfully migrated. </p>
<p>The verification is done based on response message the has to be TCMI_GUEST_STARTED_PROCMSG and has to carry a non-zero guest PID. If the verification is positive, the guest PID is stored inside this shadow instance. It will be used for further communication with the guest.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
    <tr><td class="paramname">*resp</td><td>- pointer to the response to be processed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the task has been successfully migrated </dd></dl>

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00412">412</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d7/d8c/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__guest__started__procmsg_8h_source.html#l00075">TCMI_GUEST_STARTED_PROCMSG</a>, <a class="el" href="../../d7/d8c/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__guest__started__procmsg_8h_source.html#l00083">tcmi_guest_started_procmsg_guest_pid()</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00134">TCMI_GUEST_STARTED_PROCMSG_ID</a>, <a class="el" href="../../de/df5/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__messages__id_8h_source.html#l00102">TCMI_MSG_FLG_SET_ERR</a>, <a class="el" href="../../df/d27/kernel__2_86_833_81_2src_2tcmi_2comm_2tcmi__msg_8h_source.html#l00231">tcmi_msg_id()</a>, <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, and <a class="el" href="../../d8/d48/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00205">tcmi_shadowtask_emigrate_p()</a>.</p>
<div class="fragment"><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">int</span> err = -EINVAL;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    pid_t remote_pid;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (!resp) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;No response from guest task has arrived..&quot;</span>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(resp)) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="comment">/* regular version */</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea1fff522372aae1c3fa549658ef13d5ab">TCMI_GUEST_STARTED_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        remote_pid = <a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor.">tcmi_guest_started_procmsg_guest_pid</a>(<a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga47d048883e032d7dfdfb9c7421bd91b6" title="Casts to the tcmi_guest_started_procmsg instance.">TCMI_GUEST_STARTED_PROCMSG</a>(resp));</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Confirmation from guesttask - task migrated, local PID %d, guest PID %d&quot;</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), remote_pid);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">if</span> ( remote_pid == -1 ) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            err = -EINVAL;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter.">tcmi_task_set_remote_pid</a>(<span class="keyword">self</span>, remote_pid);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          err = 0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">/* error version */</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gaa343f0b91b9cee9415f0fcf40f53b2ea" title="Sets an error flag.">TCMI_MSG_FLG_SET_ERR</a>(<a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea1fff522372aae1c3fa549658ef13d5ab">TCMI_GUEST_STARTED_PROCMSG_ID</a>):</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Stub hasn&#39;t been started, migration failed..&quot;</span>);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unexpected response from the guest task: %x&quot;</span>, <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(resp));</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; exit0:</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gac80577a00603ae888241ced646f230e7_cgraph.png" border="0" usemap="#d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gac80577a00603ae888241ced646f230e7_cgraph" alt=""/></div>
<map name="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gac80577a00603ae888241ced646f230e7_cgraph" id="d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_gac80577a00603ae888241ced646f230e7_cgraph">
<area shape="rect" id="node2" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#gad1e35a7478f07eccff72ce8d47045d1a" title="&lt;&lt;public&gt;&gt; Stub PID accessor." alt="" coords="230,5,373,46"/><area shape="rect" id="node3" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="253,71,349,97"/><area shape="rect" id="node4" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="649,176,786,203"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="214,172,389,199"/><area shape="rect" id="node6" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="446,172,591,199"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="437,223,600,265"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga13c386f8b5320b2aa774cf5ec9010407"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_shadowtask_vfork_done </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00196">196</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00127">tcmi_shadowtask_process_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                                               {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">struct </span>completion *vfork_done = current-&gt;vfork_done;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> ( current-&gt;vfork_done ) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        current-&gt;vfork_done = NULL;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        complete(vfork_done);               </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a2c12247d069df548dc334deea6441e7d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct k_sigaction signal_action</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .sa = {</div>
<div class="line">        .sa_handler = &amp;<a class="code" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html#a353f54eb9fc0224b5ab21ee3ee6e9d92" title="This is just a &quot;assertion check&quot; handler.">tcmi_shadowtask_signal_handler</a>,</div>
<div class="line">        .sa_mask = {</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            .sig = { 0xffffFFFF, 0xffffFFFF },</div>
<div class="line"></div>
<div class="line">        },</div>
<div class="line">        .sa_flags = SA_SIGINFO,</div>
<div class="line">        .sa_restorer = NULL,</div>
<div class="line">    },</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00059">59</a> of file <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html">tcmi_shadowtask.c</a>.</p>

<p>Referenced by <a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c_source.html#l00205">tcmi_shadowtask_emigrate_p()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_08d237fc27d4ecd563f71c5d52f2fecc.html">sources</a></li><li class="navelem"><a class="el" href="../../dir_08cfbe165ea603e6d179ff1f702f26c2.html">kernel_3.7.1</a></li><li class="navelem"><a class="el" href="../../dir_54993795d38a4b0939659b8e486bb0f5.html">src</a></li><li class="navelem"><a class="el" href="../../dir_d6db29d45a6ebf6e3bfdbb75b7b3a396.html">tcmi</a></li><li class="navelem"><a class="el" href="../../dir_71d58f3053c02109282c88f1307d7766.html">task</a></li><li class="navelem"><a class="el" href="../../d9/d42/kernel__3_87_81_2src_2tcmi_2task_2tcmi__shadowtask_8c.html">tcmi_shadowtask.c</a></li>
    <li class="footer">Generated on Mon Apr 1 2013 16:10:55 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
