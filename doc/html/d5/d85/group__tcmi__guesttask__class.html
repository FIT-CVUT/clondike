<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_guesttask class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d5/d85/group__tcmi__guesttask__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_guesttask class<div class="ingroups"><a class="el" href="../../de/d2f/group__tcmi__task__class.html">tcmi_task class</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This class is an abstraction for an 'immigrated' process on PEN.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_guesttask class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d5/d85/group__tcmi__guesttask__class.png" border="0" alt="" usemap="#d5_2d85_2group____tcmi____guesttask____class"/>
<map name="d5_2d85_2group____tcmi____guesttask____class" id="d5_2d85_2group____tcmi____guesttask____class">
<area shape="rect" id="node2" href="../../de/d2f/group__tcmi__task__class.html" title="TCMI task is an abstraction for any process in the system that participates in migration." alt="" coords="5,5,120,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:db/db9/structtcmi__guesttask"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">tcmi_guesttask</a></td></tr>
<tr class="memdesc:db/db9/structtcmi__guesttask"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compound structure for the shadow task.  <a href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">More...</a><br/></td></tr>
<tr class="separator:db/db9/structtcmi__guesttask"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gadedcec2c4c224a350634718c4d4af3ff"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#gadedcec2c4c224a350634718c4d4af3ff">TCMI_GUESTTASK</a>(t)&#160;&#160;&#160;((struct <a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">tcmi_guesttask</a>*)t)</td></tr>
<tr class="memdesc:gadedcec2c4c224a350634718c4d4af3ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Casts to the task instance.  <a href="#gadedcec2c4c224a350634718c4d4af3ff">More...</a><br/></td></tr>
<tr class="separator:gadedcec2c4c224a350634718c4d4af3ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga0855b260ad0e6d9be756d54d5b566d5d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga0855b260ad0e6d9be756d54d5b566d5d">tcmi_guesttask_process_msg</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *m)</td></tr>
<tr class="memdesc:ga0855b260ad0e6d9be756d54d5b566d5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes a message specified by the caller.  <a href="#ga0855b260ad0e6d9be756d54d5b566d5d">More...</a><br/></td></tr>
<tr class="separator:ga0855b260ad0e6d9be756d54d5b566d5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac8d8c619e9dc86a39ebce00d01030831"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#gac8d8c619e9dc86a39ebce00d01030831">tcmi_guesttask_emigrate_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gac8d8c619e9dc86a39ebce00d01030831"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Emigrates a task to a PEN.  <a href="#gac8d8c619e9dc86a39ebce00d01030831">More...</a><br/></td></tr>
<tr class="separator:gac8d8c619e9dc86a39ebce00d01030831"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga43e0985d5863cbc32047f46a1d910824"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga43e0985d5863cbc32047f46a1d910824">tcmi_guesttask_migrateback_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *npm_params)</td></tr>
<tr class="memdesc:ga43e0985d5863cbc32047f46a1d910824"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal helper method for performing both npm/ppm physical migration back to ccn.  <a href="#ga43e0985d5863cbc32047f46a1d910824">More...</a><br/></td></tr>
<tr class="separator:ga43e0985d5863cbc32047f46a1d910824"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1f99fbedfc6a18e6cfb4d6502f1a8825"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga1f99fbedfc6a18e6cfb4d6502f1a8825">tcmi_guesttask_migrateback_ppm_p</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga1f99fbedfc6a18e6cfb4d6502f1a8825"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Migrates a task back to CCN using PPM with physical checkpoint image.  <a href="#ga1f99fbedfc6a18e6cfb4d6502f1a8825">More...</a><br/></td></tr>
<tr class="separator:ga1f99fbedfc6a18e6cfb4d6502f1a8825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabab4bd5d57978aab262f5ac1ee9044bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#gabab4bd5d57978aab262f5ac1ee9044bb">tcmi_guesttask_migrateback_npm</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *npm_params)</td></tr>
<tr class="memdesc:gabab4bd5d57978aab262f5ac1ee9044bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles non-preemptive migration back of guest tasks.  <a href="#gabab4bd5d57978aab262f5ac1ee9044bb">More...</a><br/></td></tr>
<tr class="separator:gabab4bd5d57978aab262f5ac1ee9044bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga21fc3a398e6663b285ea3ef21f81629f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga21fc3a398e6663b285ea3ef21f81629f">tcmi_guesttask_exit</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, long code)</td></tr>
<tr class="memdesc:ga21fc3a398e6663b285ea3ef21f81629f"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Exit notification for the shadow on CCN.  <a href="#ga21fc3a398e6663b285ea3ef21f81629f">More...</a><br/></td></tr>
<tr class="separator:ga21fc3a398e6663b285ea3ef21f81629f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0d7c79c7e1a2ef3a36c46056621576f2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga0d7c79c7e1a2ef3a36c46056621576f2">tcmi_guesttask_do_signal</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned long signr, siginfo_t *<a class="el" href="../../d6/d23/tcmi__signal__msg_8h.html#a7d5c5f5b173fb960963b2c44980dc940">info</a>)</td></tr>
<tr class="memdesc:ga0d7c79c7e1a2ef3a36c46056621576f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes a specified signal.  <a href="#ga0d7c79c7e1a2ef3a36c46056621576f2">More...</a><br/></td></tr>
<tr class="separator:ga0d7c79c7e1a2ef3a36c46056621576f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16ed0a2983a1fc31c158cb1327af6580"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga16ed0a2983a1fc31c158cb1327af6580">tcmi_guesttask_process_p_emigrate_msg</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *m)</td></tr>
<tr class="memdesc:ga16ed0a2983a1fc31c158cb1327af6580"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Processes the physical emigrate process message (both NPM and PPM)  <a href="#ga16ed0a2983a1fc31c158cb1327af6580">More...</a><br/></td></tr>
<tr class="separator:ga16ed0a2983a1fc31c158cb1327af6580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa439390162db6c39e89ece50c0119d61"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#gaa439390162db6c39e89ece50c0119d61">tcmi_guesttask_post_fork</a> (struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *child, long fork_result, pid_t remote_child_pid)</td></tr>
<tr class="memdesc:gaa439390162db6c39e89ece50c0119d61"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Called on post-fork hook on guest task that was forked (parent)  <a href="#gaa439390162db6c39e89ece50c0119d61">More...</a><br/></td></tr>
<tr class="separator:gaa439390162db6c39e89ece50c0119d61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6af3f9afe2a77220f2407c4c79648018"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga6af3f9afe2a77220f2407c4c79648018">tcmi_guesttask_post_fork_set_tid</a> (void *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct <a class="el" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#d3/d01/structtcmi__method__wrapper">tcmi_method_wrapper</a> *wr)</td></tr>
<tr class="memdesc:ga6af3f9afe2a77220f2407c4c79648018"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Used to set proper tid after a new process was forked.  <a href="#ga6af3f9afe2a77220f2407c4c79648018">More...</a><br/></td></tr>
<tr class="separator:ga6af3f9afe2a77220f2407c4c79648018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8adddfca18c4106695fe90181fec0378"><td class="memItemLeft" align="right" valign="top">static enum tcmi_task_type&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga8adddfca18c4106695fe90181fec0378">tcmi_guesttask_get_type</a> (void)</td></tr>
<tr class="memdesc:ga8adddfca18c4106695fe90181fec0378"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return type of task.  <a href="#ga8adddfca18c4106695fe90181fec0378">More...</a><br/></td></tr>
<tr class="separator:ga8adddfca18c4106695fe90181fec0378"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga31b4326716941bc138080c4f3bb07984"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga31b4326716941bc138080c4f3bb07984">tcmi_guesttask_new</a> (pid_t local_pid, struct <a class="el" href="../../d6/da2/group__tcmi__migman__class.html#d2/d8c/structtcmi__migman">tcmi_migman</a> *migman, struct <a class="el" href="../../d6/d8e/group__kkc__sock__class.html#da/d0d/structkkc__sock">kkc_sock</a> *sock, struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *d_migproc, struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *d_migman)</td></tr>
<tr class="memdesc:ga31b4326716941bc138080c4f3bb07984"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Creates a new guest task.  <a href="#ga31b4326716941bc138080c4f3bb07984">More...</a><br/></td></tr>
<tr class="separator:ga31b4326716941bc138080c4f3bb07984"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga5df59fd8e4298423a9bb56f2b859fc5f"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d5/d04/structtcmi__task__ops">tcmi_task_ops</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#ga5df59fd8e4298423a9bb56f2b859fc5f">guesttask_ops</a></td></tr>
<tr class="memdesc:ga5df59fd8e4298423a9bb56f2b859fc5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">TCMI task operations that support polymorphism.  <a href="#ga5df59fd8e4298423a9bb56f2b859fc5f">More...</a><br/></td></tr>
<tr class="separator:ga5df59fd8e4298423a9bb56f2b859fc5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab7fde47a0d6fae4c11cdca33413a6f72"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">tcmi_guesttask</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#gab7fde47a0d6fae4c11cdca33413a6f72">__attribute__</a></td></tr>
<tr class="separator:gab7fde47a0d6fae4c11cdca33413a6f72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This class is an abstraction for an 'immigrated' process on PEN. </p>
<p>It represents the migrated process, so that the TCMI framework is able to control it.</p>
<p>This class also does all the migration work including migration back to CCN. For this purpose, there are various methods that implement various types of migration:</p>
<ul>
<li>preemptive migration using physical checkpoint image (tcmi_guesttask_*_ppm_p())</li>
<li>preemptive migration using virtual checkpoint image (tcmi_guesttask_*_ppm_v())</li>
<li>non-preemptive migration via execve hook (tcmi_guesttask_*_npm()) </li>
</ul>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="db/db9/structtcmi__guesttask" id="db/db9/structtcmi__guesttask"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_guesttask</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Compound structure for the shadow task. </p>

<p>Definition at line <a class="el" href="../../da/dc0/tcmi__guesttask_8h_source.html#l00057">57</a> of file <a class="el" href="../../da/dc0/tcmi__guesttask_8h_source.html">tcmi_guesttask.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_guesttask:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/d1a/structtcmi__guesttask__coll__graph.png" border="0" usemap="#tcmi__guesttask_coll__map" alt="Collaboration graph"/></div>
<map name="tcmi__guesttask_coll__map" id="tcmi__guesttask_coll__map">
<area shape="rect" id="node2" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task" title="Compound structure that gathers necessary process information." alt="" coords="396,1315,519,1583"/><area shape="rect" id="node3" href="../../de/d2f/group__tcmi__task__class.html#d5/d04/structtcmi__task__ops" title="TCMI task operations that support polymorphism." alt="" coords="5,1011,155,1250"/><area shape="rect" id="node4" href="../../d0/db7/group__tcmi__slotvec__class.html#da/ded/structtcmi__slotvec" title="A slot vector compound structure." alt="" coords="354,723,464,888"/><area shape="rect" id="node6" href="../../d6/da2/group__tcmi__migman__class.html#d2/d8c/structtcmi__migman" title="A compound structure that holds all current shadow processes and other migration related data..." alt="" coords="537,1041,660,1221"/><area shape="rect" id="node5" href="../../da/d0c/group__tcmi__slot__class.html#d9/dbb/structtcmi__slot" title="A slot compound structure." alt="" coords="521,451,631,616"/><area shape="rect" id="node7" href="../../d3/d7e/group__tcmi__sock__class.html#da/dba/structtcmi__sock" title="A compound structure that holds the actual KKC listening." alt="" coords="489,759,575,851"/><area shape="rect" id="node8" href="../../d6/d8e/group__kkc__sock__class.html#da/d0d/structkkc__sock" title="A coumpound structure that contains generic information about a KKC socket." alt="" coords="215,458,344,609"/><area shape="rect" id="node16" href="../../d9/dfc/group__tcmi__comm__class.html#de/d0f/structtcmi__comm" title="Compound structure that holds reference to the connection and the user method." alt="" coords="231,737,329,873"/><area shape="rect" id="node9" href="../../d5/ddf/group__kkc__arch__class.html#db/d0a/structkkc__arch" title="Compound structure, describes one particular architecture." alt="" coords="135,213,209,320"/><area shape="rect" id="node10" href="../../d5/ddf/group__kkc__arch__class.html#d0/d60/structkkc__arch__ops" title="Architecture specific operations." alt="" coords="101,5,243,83"/><area shape="rect" id="node11" href="../../d6/d8e/group__kkc__sock__class.html#d9/db1/structkkc__sock__ops" title="Socket operations that support polymorphism." alt="" coords="234,147,397,386"/><area shape="rect" id="node12" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure." alt="" coords="857,487,972,579"/><area shape="rect" id="node13" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops" title="entry operations that support polymorphism" alt="" coords="859,228,971,305"/><area shape="rect" id="node14" href="../../d6/da2/group__tcmi__migman__class.html#d6/d88/structtcmi__migman__ops" title="Migration manager operations that support polymorphism." alt="" coords="739,723,867,888"/><area shape="rect" id="node15" href="../../dc/d0c/group__tcmi__queue__class.html#d5/d9a/structtcmi__queue" title="compound structure" alt="" coords="1013,737,1101,873"/></map>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a101ae26a3924f7c84cb7bd57ff82d0a3"></a>struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a></td>
<td class="fieldname">
super</td>
<td class="fielddoc">
parent class instance. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gadedcec2c4c224a350634718c4d4af3ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_GUESTTASK</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">t</td><td>)</td>
          <td>&#160;&#160;&#160;((struct <a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">tcmi_guesttask</a>*)t)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Casts to the task instance. </p>

<p>Definition at line <a class="el" href="../../da/dc0/tcmi__guesttask_8h_source.html#l00065">65</a> of file <a class="el" href="../../da/dc0/tcmi__guesttask_8h_source.html">tcmi_guesttask.h</a>.</p>

<p>Referenced by <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00058">tcmi_guesttask_new()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga0d7c79c7e1a2ef3a36c46056621576f2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_do_signal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>signr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">siginfo_t *&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes a specified signal. </p>
<p>Currently only SIGKILL signal is handled that causes the task to terminate returned status for the method pump - TCMI_TASK_KILL_ME. Final solution should do a full signal handling and communicate with the shadow too.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
    <tr><td class="paramname">signr</td><td>- signal that is to be processed </td></tr>
    <tr><td class="paramname">*info</td><td>- info for signal to be processed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TCMI_TASK_KEEP_PUMPING on any signal but SIGKILL </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00272">272</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00367">tcmi_task_set_exit_code()</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Stub is processing signal %lu&quot;</span>, signr);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span> (signr == SIGKILL || signr == SIGQUIT || signr == SIGINT) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gad2304b37598ad3c64f6a24f0ed0064de" title="&lt;&lt;public&gt;&gt; Exit code setter.">tcmi_task_set_exit_code</a>(<span class="keyword">self</span>, signr);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="comment">// We have to return keep pumping, because following do_exit call will invoke exit hook and it should be handled by the method pump!</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga0d7c79c7e1a2ef3a36c46056621576f2_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga0d7c79c7e1a2ef3a36c46056621576f2_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga0d7c79c7e1a2ef3a36c46056621576f2_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga0d7c79c7e1a2ef3a36c46056621576f2_cgraph">
<area shape="rect" id="node2" href="../../de/d2f/group__tcmi__task__class.html#gad2304b37598ad3c64f6a24f0ed0064de" title="&lt;&lt;public&gt;&gt; Exit code setter." alt="" coords="227,5,394,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac8d8c619e9dc86a39ebce00d01030831"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_emigrate_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Emigrates a task to a PEN. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>result of the task specific emigrate method or TCMI_TASK_KEEP_PUMPING </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00136">136</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">/*  struct tcmi_guesttask *self_tsk = TCMI_GUESTTASK(self);*/</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga21fc3a398e6663b285ea3ef21f81629f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_exit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Exit notification for the shadow on CCN. </p>
<p>This method is scheduled by the exit system call hook that also invokes the migration mode handler. It sends an exit process control message to the shadow. No response is expected, the message content is the exit code. The method terminates with TCMI_TASK_REMOVE_AND_LET_ME_GO - explained below</p>
<dl class="section return"><dt>Returns</dt><dd>TCMI_TASK_REMOVE_AND_LET_ME_GO, so that the migration component destroys this task. It doesn't itentionally return TCMI_TASK_KILL_ME as it would cause another round of exit, this time using complete_and_exit() </dd></dl>
<p>Sync proxyfs files only if peer is alive, else this call makes no sense </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00237">237</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d5/d77/proxyfs__helper_8h_source.html#l00208">proxyfs_sync_files_on_exit()</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../d3/dbc/tcmi__exit__procmsg_8c_source.html#l00092">tcmi_exit_procmsg_new_tx()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00257">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;{</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *m;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">    /** Sync proxyfs files only if peer is alive, else this call makes no sense */</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> ( !self-&gt;<a class="code" href="../../de/d2f/group__tcmi__task__class.html#abe0af04d790416a4840a39d2ef5465ea" title="Flag used to inform the task that its peer is lost and it should terminate.">peer_lost</a> )</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="../../d5/d77/proxyfs__helper_8h.html#a9c20f5bd7542a43136e9ac435aa9dee5" title="Synchronizes all files open by &quot;current&quot; process.">proxyfs_sync_files_on_exit</a>();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Stub process &#39;%s&#39; local PID=%d terminating&quot;</span>, </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          current-&gt;comm, current-&gt;pid);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (!(m = <a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga4d0e9afc9e69c4260b898e672262aa04" title="&lt;&gt;&gt; Exit message tx constructor.">tcmi_exit_procmsg_new_tx</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), code))) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t create error message&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">/* send it as anonymous since no response is expected. */</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, m);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">/* dispose the message not needed anymore. */</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(m);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; exit0:</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bade59423de18b4fdc67a09f36b7cd71aa">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga21fc3a398e6663b285ea3ef21f81629f_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga21fc3a398e6663b285ea3ef21f81629f_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga21fc3a398e6663b285ea3ef21f81629f_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga21fc3a398e6663b285ea3ef21f81629f_cgraph">
<area shape="rect" id="node2" href="../../d5/d77/proxyfs__helper_8h.html#a9c20f5bd7542a43136e9ac435aa9dee5" title="Synchronizes all files open by &quot;current&quot; process." alt="" coords="238,193,367,234"/><area shape="rect" id="node3" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga4d0e9afc9e69c4260b898e672262aa04" title="&lt;&gt;&gt; Exit message tx constructor." alt="" coords="213,259,393,285"/><area shape="rect" id="node25" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="504,309,608,336"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="227,360,378,387"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="193,411,413,437"/><area shape="rect" id="node4" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="483,259,629,285"/><area shape="rect" id="node5" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="699,208,821,235"/><area shape="rect" id="node6" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="900,107,1049,133"/><area shape="rect" id="node7" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="901,157,1049,184"/><area shape="rect" id="node13" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1541,208,1675,235"/><area shape="rect" id="node8" href="../../d4/d8c/group__tcmi__transaction__class.html#gad66082869d71dbe73b9a0b60cb2f437c" title="&lt;&lt;private&gt;&gt; Generates a transaction ID." alt="" coords="1128,5,1291,32"/><area shape="rect" id="node9" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor." alt="" coords="1129,56,1290,83"/><area shape="rect" id="node10" href="../../d4/d8c/group__tcmi__transaction__class.html#ga244e6188e1c4f9e1faba20d0892f5441" title="&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts." alt="" coords="1132,208,1287,235"/><area shape="rect" id="node22" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4f973395848150fbebecf3cc292c80ba" title="&lt;&lt;public&gt;&gt; The index where the insertion takes place has to be a valid slot." alt="" coords="1339,107,1490,133"/><area shape="rect" id="node11" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1343,309,1486,336"/><area shape="rect" id="node12" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1545,259,1671,285"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1547,360,1669,387"/><area shape="rect" id="node21" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="1539,309,1677,336"/><area shape="rect" id="node15" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1726,335,1863,361"/><area shape="rect" id="node19" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1741,272,1848,299"/><area shape="rect" id="node20" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1735,215,1855,241"/><area shape="rect" id="node16" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="1934,335,2053,361"/><area shape="rect" id="node17" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="1913,248,2074,275"/><area shape="rect" id="node18" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="2123,205,2235,232"/><area shape="rect" id="node23" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index." alt="" coords="1552,107,1664,133"/><area shape="rect" id="node24" href="../../da/d0c/group__tcmi__slot__class.html#gaefe294678d9d6922b3af1e452a318fa1" title="&lt;&lt;public&gt;&gt; Inserts a new node into the slot." alt="" coords="1551,157,1665,184"/><area shape="rect" id="node28" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="462,411,650,437"/><area shape="rect" id="node29" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="703,411,817,437"/><area shape="rect" id="node30" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="918,360,1031,387"/><area shape="rect" id="node32" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="869,411,1080,437"/><area shape="rect" id="node33" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="899,461,1050,488"/><area shape="rect" id="node34" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768" title="&lt;&lt;public&gt;&gt; Starts a transaction." alt="" coords="899,512,1050,539"/><area shape="rect" id="node31" href="../../d6/d8e/group__kkc__sock__class.html#gaff5e8804c93f0cb2a4b5e2e12f64e743" title="&lt;&lt;private&gt;&gt; Transfers a required number of bytes." alt="" coords="1138,360,1281,387"/><area shape="rect" id="node35" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1135,436,1284,463"/><area shape="rect" id="node36" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor." alt="" coords="1138,487,1281,513"/><area shape="rect" id="node37" href="../../d4/d8c/group__tcmi__transaction__class.html#ga1dfece4fcea1c1b9ce676f560957077f" title="&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes." alt="" coords="1138,538,1281,579"/><area shape="rect" id="node38" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1128,604,1291,631"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga8adddfca18c4106695fe90181fec0378"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum tcmi_task_type tcmi_guesttask_get_type </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return type of task. </p>
<p>Only for setting task type to kernel task_struct. Polymorphism cannot be used in kernel, bacause <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task" title="Compound structure that gathers necessary process information.">tcmi_task</a> is defined outside of kernel. </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00421">421</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                                        {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> guest;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gabab4bd5d57978aab262f5ac1ee9044bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_guesttask_migrateback_npm </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *&#160;</td>
          <td class="paramname"><em>npm_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles non-preemptive migration back of guest tasks. </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00211">211</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00149">tcmi_guesttask_migrateback_p()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00255">TCMI_TASK_KILL_ME</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00257">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga43e0985d5863cbc32047f46a1d910824" title="Internal helper method for performing both npm/ppm physical migration back to ccn.">tcmi_guesttask_migrateback_p</a>(<span class="keyword">self</span>, npm_params);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span> ( res ) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// npm migration has failed =&gt; continue with execution locally (we may try pre-emptive migration later and if that fails we kill the task)</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bade59423de18b4fdc67a09f36b7cd71aa">TCMI_TASK_REMOVE_AND_LET_ME_GO</a>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// migration home succeeded =&gt; remove and kill guest task</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bad619e483cc5231333ada87518fb2b301">TCMI_TASK_KILL_ME</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_gabab4bd5d57978aab262f5ac1ee9044bb_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_gabab4bd5d57978aab262f5ac1ee9044bb_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_gabab4bd5d57978aab262f5ac1ee9044bb_cgraph" id="d5/d85/group__tcmi__guesttask__class_gabab4bd5d57978aab262f5ac1ee9044bb_cgraph">
<area shape="rect" id="node2" href="../../d5/d85/group__tcmi__guesttask__class.html#ga43e0985d5863cbc32047f46a1d910824" title="Internal helper method for performing both npm/ppm physical migration back to ccn." alt="" coords="275,820,477,847"/><area shape="rect" id="node3" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1311,644,1449,671"/><area shape="rect" id="node4" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="544,447,728,473"/><area shape="rect" id="node24" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="551,693,721,720"/><area shape="rect" id="node25" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#gab81fab79aef64096fe5ec4a5cb95ac56" title="&lt;&lt;public&gt;&gt; Guest request for migration back tx constructor." alt="" coords="544,897,728,938"/><area shape="rect" id="node31" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="561,795,711,821"/><area shape="rect" id="node32" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="561,845,711,872"/><area shape="rect" id="node33" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="545,744,727,771"/><area shape="rect" id="node37" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="526,963,746,989"/><area shape="rect" id="node43" href="../../d8/d87/director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home." alt="" coords="555,1013,717,1040"/><area shape="rect" id="node46" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="584,1089,688,1116"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="811,523,987,549"/><area shape="rect" id="node8" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="795,447,1002,473"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="834,396,963,423"/><area shape="rect" id="node23" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="795,333,1002,360"/><area shape="rect" id="node6" href="../../de/d2f/group__tcmi__task__class.html#gad41453e0aefb9dd79c2d3b65d8b9b16c" title="&lt;&lt;private&gt;&gt; Releases the execve context (execve file, argv, envp) Since the argv/envp have alloca..." alt="" coords="1051,577,1226,618"/><area shape="rect" id="node7" href="../../de/d84/tcmi__task_8c.html#ab73603e4adaf2a1bb6b7cf6a01a1c2f3" title="&lt;&lt;private&gt;&gt; Class method &#45; copies an array of strings terminated by NULL string (standard argv/envp f..." alt="" coords="1059,525,1219,552"/><area shape="rect" id="node9" href="../../db/d70/tcmi__ckptcom_8c.html#ac319abd397f2a8d28b1e248939019385" title="&lt;&lt;private&gt;&gt; Helper method that handles both PPM and NPM checkpoint creation" alt="" coords="1051,327,1226,353"/><area shape="rect" id="node10" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html#ad65f0acd5657cfc139569bd3a8a01bd4" title="Currently only current &quot;pwd&quot; of the process is migrated." alt="" coords="1315,477,1445,518"/><area shape="rect" id="node11" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#ga5cc088b9c94de359d62e62be57b79636" title="Writes a current process memory descriptor into the checkpoint file." alt="" coords="1309,543,1451,569"/><area shape="rect" id="node12" href="../../df/d54/group__tcmi__ckpt__class.html#gaa428792c45bff6d4c204a1888bc45bb2" title="&lt;&lt;public&gt;&gt; Checkpoint constructor." alt="" coords="1325,593,1435,620"/><area shape="rect" id="node13" href="../../dd/d4a/tcmi__ckpt__npm__params_8h.html#a0ae460251927e9177b1b60734cdaf5ed" title="Writes non&#45;preemptive process startup params to the checkpoint." alt="" coords="1299,5,1461,46"/><area shape="rect" id="node14" href="../../df/d54/group__tcmi__ckpt__class.html#ga28018eb420ebe27ee907314d4c232241" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1328,71,1432,97"/><area shape="rect" id="node15" href="../../de/d5f/tcmi__ckpt__regs_8h.html#afb361994d078435388619ea117d71ac0" title="Writes a current process registers into the checkpoint file." alt="" coords="1307,121,1453,148"/><area shape="rect" id="node16" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#ga1ec03aa6289cb466c125b813455d9452" title="Writes a current process memory descriptor into the checkpoint file." alt="" coords="1311,172,1449,199"/><area shape="rect" id="node17" href="../../df/d07/tcmi__ckpt__thread_8h.html#a20e379cecfe566fc7fbf8cad15092e01" title="tcmi_ckpt_tls_write" alt="" coords="1313,223,1447,249"/><area shape="rect" id="node18" href="../../df/d54/group__tcmi__ckpt__class.html#ga8eb79d798591739f7234bae67265e097" title="&lt;&lt;public&gt;&gt; Writes open files into the checkpoint." alt="" coords="1309,273,1451,300"/><area shape="rect" id="node19" href="../../df/d54/group__tcmi__ckpt__class.html#gaecf1343fc1988bd210f6fc1ef349e256" title="&lt;&lt;public&gt;&gt; Writes a checkpoint header." alt="" coords="1311,324,1449,351"/><area shape="rect" id="node20" href="../../da/dab/tcmi__ckpt__resources_8h.html#a774918866032e6c1d6cccf240b145d9a" title="Writes a current process rlimits into the file." alt="" coords="1306,375,1454,401"/><area shape="rect" id="node21" href="../../df/d54/group__tcmi__ckpt__class.html#ga9d1cb4bfd021a3a845689a7262fe8190" title="&lt;&lt;public&gt;&gt; Writes all process memory regions into the checkpoint." alt="" coords="1305,425,1455,452"/><area shape="rect" id="node26" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="825,893,972,920"/><area shape="rect" id="node27" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="1078,872,1199,899"/><area shape="rect" id="node28" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="1305,811,1455,837"/><area shape="rect" id="node29" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="1306,861,1454,888"/><area shape="rect" id="node30" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1534,912,1669,939"/><area shape="rect" id="node34" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="809,720,989,747"/><area shape="rect" id="node35" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="1054,695,1223,721"/><area shape="rect" id="node36" href="../../d8/d3c/util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1321,695,1439,721"/><area shape="rect" id="node38" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="805,963,993,989"/><area shape="rect" id="node39" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="1081,963,1196,989"/><area shape="rect" id="node40" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="1323,963,1437,989"/><area shape="rect" id="node41" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="1275,1013,1485,1040"/><area shape="rect" id="node42" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="1305,1064,1455,1091"/><area shape="rect" id="node44" href="../../d7/d8d/migrated__home__msg_8c.html#a9b2ead1e47b190743680527571b54d63" title="Called, when a task is migrated home (called on ccn)" alt="" coords="843,1013,954,1040"/><area shape="rect" id="node45" href="../../d9/df4/comm_8c.html#af68cf85dec3fb86013cb79568bb30026" title="Performs a netlink transaction." alt="" coords="1069,1013,1208,1040"/><area shape="rect" id="node47" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="827,1115,970,1141"/><area shape="rect" id="node48" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1076,1115,1201,1141"/><area shape="rect" id="node49" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1077,1216,1200,1243"/><area shape="rect" id="node50" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="1069,1064,1208,1091"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga43e0985d5863cbc32047f46a1d910824"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_migrateback_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#db/d53/structtcmi__npm__params">tcmi_npm_params</a> *&#160;</td>
          <td class="paramname"><em>npm_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal helper method for performing both npm/ppm physical migration back to ccn. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00149">149</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d8/d87/director_8c_source.html#l00118">director_migrated_home()</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00114">req</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d2/dd7/tcmi__ppm__p__migr__back__guestreq__procmsg_8c_source.html#l00096">tcmi_ppm_p_migr_back_guestreq_procmsg_new_tx()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00400">tcmi_task_ckpt_name()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>, <a class="el" href="../../d7/d05/tcmi__taskhelper_8h_source.html#l00620">tcmi_taskhelper_checkpoint()</a>, and <a class="el" href="../../d7/d05/tcmi__taskhelper_8h_source.html#l00728">tcmi_taskhelper_flushfiles()</a>.</p>

<p>Referenced by <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00211">tcmi_guesttask_migrateback_npm()</a>, and <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00201">tcmi_guesttask_migrateback_ppm_p()</a>.</p>
<div class="fragment"><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                                                                    {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *<a class="code" href="../../d1/d6d/tcmi__msg_8h.html#a523c18bfd05e923b099719721b24db7d" title="request transaction ID">req</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Process &#39;%s&#39; - guest local PID %d, migrating back (npm params: %p)&quot;</span>, current-&gt;comm, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>), npm_params);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process.">tcmi_taskhelper_checkpoint</a>(<span class="keyword">self</span>, npm_params) &lt; 0) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to create a checkpoint&quot;</span>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request.">tcmi_taskhelper_flushfiles</a>();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (!(req = <a class="code" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#gab81fab79aef64096fe5ec4a5cb95ac56" title="&lt;&lt;public&gt;&gt; Guest request for migration back tx constructor.">tcmi_ppm_p_migr_back_guestreq_procmsg_new_tx</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor.">tcmi_task_ckpt_name</a>(<span class="keyword">self</span>)))) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error creating a migration back message&quot;</span>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, req)) &lt; 0) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to send message!!&quot;</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="../../d8/d87/director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home.">director_migrated_home</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; exit1:</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(req);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; exit0:</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga43e0985d5863cbc32047f46a1d910824_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga43e0985d5863cbc32047f46a1d910824_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga43e0985d5863cbc32047f46a1d910824_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga43e0985d5863cbc32047f46a1d910824_cgraph">
<area shape="rect" id="node2" href="../../d8/d87/director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home." alt="" coords="286,208,447,235"/><area shape="rect" id="node7" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="315,359,419,385"/><area shape="rect" id="node16" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#gab81fab79aef64096fe5ec4a5cb95ac56" title="&lt;&lt;public&gt;&gt; Guest request for migration back tx constructor." alt="" coords="275,561,459,602"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="276,899,457,925"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="291,949,442,976"/><area shape="rect" id="node25" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1042,848,1179,875"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="291,1000,442,1027"/><area shape="rect" id="node28" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="257,1051,477,1077"/><area shape="rect" id="node35" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="275,713,459,740"/><area shape="rect" id="node50" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="281,1101,452,1128"/><area shape="rect" id="node3" href="../../d7/d8d/migrated__home__msg_8c.html#a9b2ead1e47b190743680527571b54d63" title="Called, when a task is migrated home (called on ccn)" alt="" coords="574,107,685,133"/><area shape="rect" id="node4" href="../../d9/df4/comm_8c.html#af68cf85dec3fb86013cb79568bb30026" title="Performs a netlink transaction." alt="" coords="800,56,939,83"/><area shape="rect" id="node5" href="../../d9/df4/comm_8c.html#ab708cd00ae28bb68e7a53b6784f6f937" title="Helper method to create&amp;send request." alt="" coords="1027,5,1195,32"/><area shape="rect" id="node6" href="../../d9/df4/comm_8c.html#a66ea56ce29053fb1d9ab6d337429652d" title="msg_transaction_response" alt="" coords="1021,56,1200,83"/><area shape="rect" id="node8" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="558,208,701,235"/><area shape="rect" id="node9" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="807,157,932,184"/><area shape="rect" id="node10" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1265,309,1399,336"/><area shape="rect" id="node11" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="808,208,931,235"/><area shape="rect" id="node15" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="800,107,939,133"/><area shape="rect" id="node12" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1042,157,1179,184"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1057,208,1164,235"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1051,107,1171,133"/><area shape="rect" id="node17" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="556,481,703,508"/><area shape="rect" id="node18" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="809,385,930,412"/><area shape="rect" id="node19" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="1036,360,1185,387"/><area shape="rect" id="node20" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="1037,309,1185,336"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="539,899,719,925"/><area shape="rect" id="node23" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="785,899,954,925"/><area shape="rect" id="node24" href="../../d8/d3c/util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1051,899,1170,925"/><area shape="rect" id="node29" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="535,1051,723,1077"/><area shape="rect" id="node30" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="812,1051,927,1077"/><area shape="rect" id="node31" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="1054,1076,1167,1103"/><area shape="rect" id="node32" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="1005,1127,1216,1153"/><area shape="rect" id="node33" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="1035,975,1186,1001"/><area shape="rect" id="node34" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768" title="&lt;&lt;public&gt;&gt; Starts a transaction." alt="" coords="1035,1025,1186,1052"/><area shape="rect" id="node36" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="541,764,717,791"/><area shape="rect" id="node39" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="526,663,733,689"/><area shape="rect" id="node48" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="565,713,694,740"/><area shape="rect" id="node49" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="526,612,733,639"/><area shape="rect" id="node37" href="../../de/d2f/group__tcmi__task__class.html#gad41453e0aefb9dd79c2d3b65d8b9b16c" title="&lt;&lt;private&gt;&gt; Releases the execve context (execve file, argv, envp) Since the argv/envp have alloca..." alt="" coords="782,681,957,722"/><area shape="rect" id="node38" href="../../de/d84/tcmi__task_8c.html#ab73603e4adaf2a1bb6b7cf6a01a1c2f3" title="&lt;&lt;private&gt;&gt; Class method &#45; copies an array of strings terminated by NULL string (standard argv/envp f..." alt="" coords="789,797,949,824"/><area shape="rect" id="node40" href="../../db/d70/tcmi__ckptcom_8c.html#ac319abd397f2a8d28b1e248939019385" title="&lt;&lt;private&gt;&gt; Helper method that handles both PPM and NPM checkpoint creation" alt="" coords="782,629,957,656"/><area shape="rect" id="node41" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html#ad65f0acd5657cfc139569bd3a8a01bd4" title="Currently only current &quot;pwd&quot; of the process is migrated." alt="" coords="1046,782,1175,823"/><area shape="rect" id="node42" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#ga5cc088b9c94de359d62e62be57b79636" title="Writes a current process memory descriptor into the checkpoint file." alt="" coords="1039,461,1182,488"/><area shape="rect" id="node43" href="../../df/d54/group__tcmi__ckpt__class.html#gaa428792c45bff6d4c204a1888bc45bb2" title="&lt;&lt;public&gt;&gt; Checkpoint constructor." alt="" coords="1056,512,1165,539"/><area shape="rect" id="node44" href="../../dd/d4a/tcmi__ckpt__npm__params_8h.html#a0ae460251927e9177b1b60734cdaf5ed" title="Writes non&#45;preemptive process startup params to the checkpoint." alt="" coords="1030,563,1191,605"/><area shape="rect" id="node45" href="../../df/d54/group__tcmi__ckpt__class.html#ga28018eb420ebe27ee907314d4c232241" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1059,629,1163,656"/><area shape="rect" id="node46" href="../../de/d5f/tcmi__ckpt__regs_8h.html#afb361994d078435388619ea117d71ac0" title="Writes a current process registers into the checkpoint file." alt="" coords="1038,680,1183,707"/><area shape="rect" id="node47" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#ga1ec03aa6289cb466c125b813455d9452" title="Writes a current process memory descriptor into the checkpoint file." alt="" coords="1042,731,1179,757"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga1f99fbedfc6a18e6cfb4d6502f1a8825"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_migrateback_ppm_p </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Migrates a task back to CCN using PPM with physical checkpoint image. </p>
<p>This requires:</p>
<ul>
<li>creating a new checkpoint of the current process (task helper job)</li>
<li>flush open files of the current process (prevents write conflicts after checkpoint restart)</li>
<li>communicating the checkpoint name to the shadow</li>
<li>terminating (via KILL_ME status)</li>
</ul>
<p>There are two modes how the migration back can be initiated:</p>
<ol type="1">
<li>PEN decides to migrate the task back - in that case, the migration back message is sent as a request (trans_id is set to invalid)</li>
<li>CCN decides to migrate the task back - the migration back message is sent back as a response and as such is associated with a transaction. This method handles the first case. : The second method is also handled here, but not exactly as described.. CCN send asynchronous request to migrate back and then the guest initiates the processing of migration back.. we should likely rework it on transactional case described above</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TCMI_KILL_ME in either case (should it fail or not) as we want the task away from the PEN. </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00201">201</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00149">tcmi_guesttask_migrateback_p()</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00255">TCMI_TASK_KILL_ME</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga43e0985d5863cbc32047f46a1d910824" title="Internal helper method for performing both npm/ppm physical migration back to ccn.">tcmi_guesttask_migrateback_p</a>(<span class="keyword">self</span>, NULL);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Migration back was requested so we kill in either case</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bad619e483cc5231333ada87518fb2b301">TCMI_TASK_KILL_ME</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga1f99fbedfc6a18e6cfb4d6502f1a8825_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga1f99fbedfc6a18e6cfb4d6502f1a8825_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga1f99fbedfc6a18e6cfb4d6502f1a8825_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga1f99fbedfc6a18e6cfb4d6502f1a8825_cgraph">
<area shape="rect" id="node2" href="../../d5/d85/group__tcmi__guesttask__class.html#ga43e0985d5863cbc32047f46a1d910824" title="Internal helper method for performing both npm/ppm physical migration back to ccn." alt="" coords="243,571,445,597"/><area shape="rect" id="node3" href="../../d8/d87/director_8c.html#a9fd5fd27dc9136a646bb89efa3c909f7" title="Called, when a task migrates home." alt="" coords="523,156,685,183"/><area shape="rect" id="node8" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="552,280,656,307"/><area shape="rect" id="node17" href="../../d4/d84/group__tcmi__ppm__p__migr__back__guestreq__procmsg__class.html#gab81fab79aef64096fe5ec4a5cb95ac56" title="&lt;&lt;public&gt;&gt; Guest request for migration back tx constructor." alt="" coords="512,429,696,470"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="513,495,695,521"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga44b0c0c985d4c3954c6e35d748d9638b" title="&lt;&lt;public&gt;&gt; Task checkpoint pathname accessor." alt="" coords="529,651,679,677"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1279,588,1417,615"/><area shape="rect" id="node28" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="529,701,679,728"/><area shape="rect" id="node29" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="494,752,714,779"/><area shape="rect" id="node36" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga6c7491a9027159fd5a293bae24689a3c" title="&lt;&lt;public&gt;&gt; Creates a new checkpoint of the process." alt="" coords="512,600,696,627"/><area shape="rect" id="node50" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga403923e3422bd06870e36c8951def7fb" title="&lt;&lt;public&gt;&gt; Flushing files is required prior to issuing a migrate request." alt="" coords="519,803,689,829"/><area shape="rect" id="node4" href="../../d7/d8d/migrated__home__msg_8c.html#a9b2ead1e47b190743680527571b54d63" title="Called, when a task is migrated home (called on ccn)" alt="" coords="811,81,922,108"/><area shape="rect" id="node5" href="../../d9/df4/comm_8c.html#af68cf85dec3fb86013cb79568bb30026" title="Performs a netlink transaction." alt="" coords="1037,31,1176,57"/><area shape="rect" id="node6" href="../../d9/df4/comm_8c.html#ab708cd00ae28bb68e7a53b6784f6f937" title="Helper method to create&amp;send request." alt="" coords="1264,56,1432,83"/><area shape="rect" id="node7" href="../../d9/df4/comm_8c.html#a66ea56ce29053fb1d9ab6d337429652d" title="msg_transaction_response" alt="" coords="1259,5,1437,32"/><area shape="rect" id="node9" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="795,183,938,209"/><area shape="rect" id="node10" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1044,132,1169,159"/><area shape="rect" id="node11" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1502,385,1637,412"/><area shape="rect" id="node12" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1045,259,1168,285"/><area shape="rect" id="node16" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="1037,81,1176,108"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1279,233,1417,260"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1295,284,1401,311"/><area shape="rect" id="node15" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1288,335,1408,361"/><area shape="rect" id="node18" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="793,436,940,463"/><area shape="rect" id="node19" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="1046,436,1167,463"/><area shape="rect" id="node20" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="1273,487,1423,513"/><area shape="rect" id="node21" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="1274,436,1422,463"/><area shape="rect" id="node23" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="777,495,957,521"/><area shape="rect" id="node24" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="1022,495,1191,521"/><area shape="rect" id="node25" href="../../d8/d3c/util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1289,537,1407,564"/><area shape="rect" id="node30" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="773,919,961,945"/><area shape="rect" id="node31" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="1049,1025,1164,1052"/><area shape="rect" id="node32" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="1291,1025,1405,1052"/><area shape="rect" id="node33" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="1243,1076,1453,1103"/><area shape="rect" id="node34" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="1273,1127,1423,1153"/><area shape="rect" id="node35" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768" title="&lt;&lt;public&gt;&gt; Starts a transaction." alt="" coords="1273,975,1423,1001"/><area shape="rect" id="node37" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="779,604,955,631"/><area shape="rect" id="node40" href="../../d4/dcf/group__tcmi__ckptcom__class.html#gaf223b90f9bab6b4b553448917adbbd08" title="&lt;&lt;public&gt;&gt; Creates a non&#45;preemptive process checkpoint." alt="" coords="763,707,970,733"/><area shape="rect" id="node48" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="802,655,931,681"/><area shape="rect" id="node49" href="../../d4/dcf/group__tcmi__ckptcom__class.html#ga87d900819b5cc6bbe1144e22d4e03836" title="&lt;&lt;public&gt;&gt; Creates a preemptive process checkpoint." alt="" coords="763,761,970,788"/><area shape="rect" id="node38" href="../../de/d2f/group__tcmi__task__class.html#gad41453e0aefb9dd79c2d3b65d8b9b16c" title="&lt;&lt;private&gt;&gt; Releases the execve context (execve file, argv, envp) Since the argv/envp have alloca..." alt="" coords="1019,597,1194,638"/><area shape="rect" id="node39" href="../../de/d84/tcmi__task_8c.html#ab73603e4adaf2a1bb6b7cf6a01a1c2f3" title="&lt;&lt;private&gt;&gt; Class method &#45; copies an array of strings terminated by NULL string (standard argv/envp f..." alt="" coords="1027,713,1187,740"/><area shape="rect" id="node41" href="../../db/d70/tcmi__ckptcom_8c.html#ac319abd397f2a8d28b1e248939019385" title="&lt;&lt;private&gt;&gt; Helper method that handles both PPM and NPM checkpoint creation" alt="" coords="1019,764,1194,791"/><area shape="rect" id="node42" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html#ad65f0acd5657cfc139569bd3a8a01bd4" title="Currently only current &quot;pwd&quot; of the process is migrated." alt="" coords="1283,639,1413,681"/><area shape="rect" id="node43" href="../../d9/d57/group__tcmi__ckpt__mm__class.html#ga5cc088b9c94de359d62e62be57b79636" title="Writes a current process memory descriptor into the checkpoint file." alt="" coords="1277,705,1419,732"/><area shape="rect" id="node44" href="../../df/d54/group__tcmi__ckpt__class.html#gaa428792c45bff6d4c204a1888bc45bb2" title="&lt;&lt;public&gt;&gt; Checkpoint constructor." alt="" coords="1293,756,1403,783"/><area shape="rect" id="node45" href="../../dd/d4a/tcmi__ckpt__npm__params_8h.html#a0ae460251927e9177b1b60734cdaf5ed" title="Writes non&#45;preemptive process startup params to the checkpoint." alt="" coords="1267,807,1429,849"/><area shape="rect" id="node46" href="../../df/d54/group__tcmi__ckpt__class.html#ga28018eb420ebe27ee907314d4c232241" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1296,873,1400,900"/><area shape="rect" id="node47" href="../../de/d5f/tcmi__ckpt__regs_8h.html#afb361994d078435388619ea117d71ac0" title="Writes a current process registers into the checkpoint file." alt="" coords="1275,924,1421,951"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga31b4326716941bc138080c4f3bb07984"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a>* tcmi_guesttask_new </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>local_pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/da2/group__tcmi__migman__class.html#d2/d8c/structtcmi__migman">tcmi_migman</a> *&#160;</td>
          <td class="paramname"><em>migman</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/d8e/group__kkc__sock__class.html#da/d0d/structkkc__sock">kkc_sock</a> *&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>d_migproc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>d_migman</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Creates a new guest task. </p>
<p>&lt;&lt;public&gt;&gt; Creates a new guest task.</p>
<ul>
<li>allocates a new instance.</li>
<li>delegates its initialization to the super class.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_pid</td><td>- local PID on PEN </td></tr>
    <tr><td class="paramname">migman</td><td>- The migration manager that maintains this task </td></tr>
    <tr><td class="paramname">*sock</td><td>- socket used for communication with shadow task on CCN </td></tr>
    <tr><td class="paramname">*d_migproc</td><td>- directory where ctlfs entries of migrated processes reside </td></tr>
    <tr><td class="paramname">*d_migman</td><td>- TCMI ctlfs directory of the migration manager responsible for this task </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00058">58</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00426">guesttask_ops</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00221">minfo</a>, <a class="el" href="../../da/dc0/tcmi__guesttask_8h_source.html#l00065">TCMI_GUESTTASK</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00261">TCMI_TASK</a>, and <a class="el" href="../../de/d84/tcmi__task_8c_source.html#l00112">tcmi_task_init()</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d44/tcmi__migcom_8c_source.html#l00528">tcmi_migcom_guest_fork()</a>, and <a class="el" href="../../dc/d44/tcmi__migcom_8c_source.html#l00293">tcmi_migcom_immigrate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask" title="Compound structure for the shadow task.">tcmi_guesttask</a> *task;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(INFO2, <span class="stringliteral">&quot;Creating new TCMI guest task&quot;</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (!(task = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#gadedcec2c4c224a350634718c4d4af3ff" title="Casts to the task instance.">TCMI_GUESTTASK</a>(kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask" title="Compound structure for the shadow task.">tcmi_guesttask</a>), </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                           GFP_ATOMIC)))) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate memory for TCMI ppm guest task&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4b3a924515ad4005bc713b135d75f6b9" title="Initializes the task.">tcmi_task_init</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#gaf05e0c401db433deef4d95a64ce9117b" title="Casts to the task instance.">TCMI_TASK</a>(task), local_pid, migman, sock, </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;               d_migproc, d_migman, &amp;<a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga5df59fd8e4298423a9bb56f2b859fc5f" title="TCMI task operations that support polymorphism.">guesttask_ops</a>) &lt; 0) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;TCMI ppm guest task initialization failed!&quot;</span>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gaf05e0c401db433deef4d95a64ce9117b" title="Casts to the task instance.">TCMI_TASK</a>(task);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; exit1:</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    kfree(task);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; exit0:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga31b4326716941bc138080c4f3bb07984_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga31b4326716941bc138080c4f3bb07984_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga31b4326716941bc138080c4f3bb07984_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga31b4326716941bc138080c4f3bb07984_cgraph">
<area shape="rect" id="node2" href="../../de/d2f/group__tcmi__task__class.html#ga4b3a924515ad4005bc713b135d75f6b9" title="Initializes the task." alt="" coords="195,309,298,336"/><area shape="rect" id="node3" href="../../d6/da2/group__tcmi__migman__class.html#gacd13117046ccc1fa12ac743b893fcfca" title="&lt;&lt;public&gt;&gt; Instance accessor, increments the reference counter." alt="" coords="377,5,503,32"/><area shape="rect" id="node4" href="../../d6/d8e/group__kkc__sock__class.html#gabada9f8c5976a6aff07529239acdf727" title="&lt;&lt;public&gt;&gt; Instance accessor, increments the reference count." alt="" coords="389,56,491,83"/><area shape="rect" id="node5" href="../../dc/d0c/group__tcmi__queue__class.html#ga10c0b527cad2d814db860b28847ca543" title="&lt;&lt;public&gt;&gt; Queue initializer &#45; for static allocation." alt="" coords="383,107,497,133"/><area shape="rect" id="node6" href="../../d0/db7/group__tcmi__slotvec__class.html#ga25d6b55df23662a9fc2c613762134a85" title="&lt;&lt;public&gt;&gt; This method creates a slot vector of the size $2^{order}$." alt="" coords="375,157,505,184"/><area shape="rect" id="node9" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#ga1f51ad6279415ce522a3a932178702d6" title="&lt;&lt;public&gt;&gt; Creates a new directory entry in the tcmi_ctlfs tree." alt="" coords="375,208,505,235"/><area shape="rect" id="node17" href="../../dd/d30/group__tcmi__ctlfs__symlink__class.html#ga952244eff8b5630626b305e1b6c68b97" title="&lt;&lt;public&gt;&gt; Symbolic link is created as a regular ctlfs entry." alt="" coords="588,309,748,336"/><area shape="rect" id="node19" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="367,259,513,285"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#ga17c54fbcb86f7f3158426742c3ff04ba" title="&lt;&lt;private&gt;&gt; Read method for the TCMI ctlfs &#45; reports remote PID." alt="" coords="347,959,533,985"/><area shape="rect" id="node23" href="../../d6/da2/group__tcmi__migman__class.html#ga936802da41af02ca6c660e18ade52dbb" title="&lt;&lt;public&gt;&gt; Registers tcmi task into the migration manager tasks slotvec" alt="" coords="360,857,520,884"/><area shape="rect" id="node33" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga6d6cbcd957efaaa590b335ac3150bb30" title="&lt;&lt;public&gt;&gt; Calls the instance custom put method(if any) and Decrements the reference counter of the d..." alt="" coords="1056,419,1195,445"/><area shape="rect" id="node34" href="../../d0/db7/group__tcmi__slotvec__class.html#ga2376bcc84e5bbd48a8f92400f5ad5f25" title="&lt;&lt;public&gt;&gt; Decrements the reference counter, when the count reaches 0, the instance is destroyed..." alt="" coords="839,731,958,757"/><area shape="rect" id="node36" href="../../d6/d8e/group__kkc__sock__class.html#ga9f980056fbf3436596c4cfdf3913e85c" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="1074,629,1177,656"/><area shape="rect" id="node42" href="../../d6/da2/group__tcmi__migman__class.html#gab536c262c24d8fc76cdbdfa8d6d65b81" title="&lt;&lt;public&gt;&gt; The manager is shutdown exactly in this order:" alt="" coords="377,495,503,521"/><area shape="rect" id="node7" href="../../d0/db7/group__tcmi__slotvec__class.html#gaf11359c8cb20ddd7549296737eaf348d" title="&lt;&lt;public&gt;&gt; Creates new instance." alt="" coords="606,149,730,176"/><area shape="rect" id="node8" href="../../da/d0c/group__tcmi__slot__class.html#ga347147be22f868eacdae39a2846c0e3f" title="Initializes a slot." alt="" coords="849,141,948,168"/><area shape="rect" id="node10" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#ga571b8ac681691e3ceca2e833b89b6a21" title="&lt;&lt;public&gt;&gt; Creates a new directory entry in the tcmi_ctlfs tree." alt="" coords="601,208,735,235"/><area shape="rect" id="node11" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="829,259,968,285"/><area shape="rect" id="node16" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga71558bf14c4a13eed4e4b9ca240fd016" title="&lt;&lt;public&gt;&gt; Increments the number of links referencing this entry&#39;s inode." alt="" coords="829,193,968,234"/><area shape="rect" id="node12" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="1265,368,1418,395"/><area shape="rect" id="node13" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga4fbd3f1c3789bd79d4e2c684fc08d1a2" title="&lt;&lt;private&gt;&gt; Checks whether a directory entry contains entry of the specified name" alt="" coords="1047,149,1203,176"/><area shape="rect" id="node14" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="1055,200,1196,227"/><area shape="rect" id="node15" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaeeb7fba5f385c90d93878a60a4dcf1dc" title="&lt;&lt;private&gt;&gt; The new dentry is allocated based on the parent&#39;s dentry and the current name of the ..." alt="" coords="1051,251,1199,293"/><area shape="rect" id="node18" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaab2e404bb2da373a66578541e2dc4ba9" title="&lt;&lt;public&gt;&gt; Instance accessor, Calls instance custom get method and increments the reference counter..." alt="" coords="1056,368,1195,395"/><area shape="rect" id="node20" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="581,259,755,285"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="593,1009,743,1036"/><area shape="rect" id="node24" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor." alt="" coords="587,959,749,985"/><area shape="rect" id="node25" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4f973395848150fbebecf3cc292c80ba" title="&lt;&lt;public&gt;&gt; The index where the insertion takes place has to be a valid slot." alt="" coords="593,807,743,833"/><area shape="rect" id="node31" href="../../de/d2f/group__tcmi__task__class.html#ga00ff41ed284360c257ed41138ad58d99" title="&lt;&lt;public&gt;&gt; Computes the hash value of the task (to be used in tasks slotvec of migman)" alt="" coords="611,857,725,884"/><area shape="rect" id="node32" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="599,908,737,935"/><area shape="rect" id="node26" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index." alt="" coords="843,883,955,909"/><area shape="rect" id="node27" href="../../da/d0c/group__tcmi__slot__class.html#gaefe294678d9d6922b3af1e452a318fa1" title="&lt;&lt;public&gt;&gt; Inserts a new node into the slot." alt="" coords="841,832,956,859"/><area shape="rect" id="node28" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1072,832,1179,859"/><area shape="rect" id="node29" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="1069,883,1181,909"/><area shape="rect" id="node30" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1065,781,1185,808"/><area shape="rect" id="node35" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="1066,731,1185,757"/><area shape="rect" id="node37" href="../../d5/ddf/group__kkc__arch__class.html#ga06049c969ae0324d0607f10db99af65c" title="&lt;&lt;public&gt;&gt; Decrements the reference counter on the module owning the architecture." alt="" coords="1291,579,1391,605"/><area shape="rect" id="node38" href="../../d6/d8e/group__kkc__sock__class.html#ga00d8b033d3e1118303e7b4c54c6aafe6" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1258,629,1425,656"/><area shape="rect" id="node40" href="../../d6/d8e/group__kkc__sock__class.html#gac8e64f52015e75cb76a34c4b7e9ef176" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1256,680,1427,707"/><area shape="rect" id="node39" href="../../d6/d8e/group__kkc__sock__class.html#gadf1b231c727891d5ac2d32646d574931" title="&lt;&lt;public&gt;&gt; Peer socket name accessor." alt="" coords="1476,629,1636,656"/><area shape="rect" id="node41" href="../../d6/d8e/group__kkc__sock__class.html#ga3cae649f56c8f5fa18f755f6c7d53597" title="&lt;&lt;public&gt;&gt; Local socket name accessor." alt="" coords="1475,680,1637,707"/><area shape="rect" id="node43" href="../../d6/da2/group__tcmi__migman__class.html#ga94df994d6d2ad3dd9aa6543ee67bf934" title="&lt;&lt;private&gt;&gt; Free method is has two purposes:when the last reference is released, it will free all ins..." alt="" coords="604,549,732,576"/><area shape="rect" id="node44" href="../../d9/dfc/group__tcmi__comm__class.html#ga89dc5a63295a65407cc93606c79ca314" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="841,629,956,656"/><area shape="rect" id="node45" href="../../d6/da2/group__tcmi__migman__class.html#ga39c491f49b4e5b3cc533c816d27135a3" title="&lt;&lt;private&gt;&gt; Destroys all TCMI ctlfs directories" alt="" coords="803,411,994,437"/><area shape="rect" id="node46" href="../../d6/da2/group__tcmi__migman__class.html#ga5b56a5213e9dbcba9973b9530692fd27" title="&lt;&lt;private&gt;&gt; Unregisters and releases all control files." alt="" coords="817,513,980,554"/><area shape="rect" id="node48" href="../../d6/da2/group__tcmi__migman__class.html#gae4ad418d705edeca23e38eb383343978" title="&lt;&lt;private&gt;&gt; The TCMI manager listening thread is to be terminated by forcing a signal and waiting for..." alt="" coords="811,461,986,488"/><area shape="rect" id="node49" href="../../d6/da2/group__tcmi__migman__class.html#ga71f49cd0661e81a859daab82ae7676de" title="Removes migman from a list of migration managers of the associated manager." alt="" coords="824,781,973,808"/><area shape="rect" id="node50" href="../../d3/d7e/group__tcmi__sock__class.html#gaa64951d80cedfaf76bb82ee811255d69" title="&lt;&lt;public&gt;&gt; Decrements the reference counter and if it reaches 0, the instance." alt="" coords="845,579,952,605"/><area shape="rect" id="node47" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93" title="&lt;&lt;public&gt;&gt; This method unregisters the file uses the semaphore lock as protection from races..." alt="" coords="1043,549,1208,576"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaa439390162db6c39e89ece50c0119d61"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_guesttask_post_fork </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>fork_result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>remote_child_pid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Called on post-fork hook on guest task that was forked (parent) </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00358">358</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d3/dbc/tcmi__exit__procmsg_8c_source.html#l00092">tcmi_exit_procmsg_new_tx()</a>, <a class="el" href="../../d3/dce/tcmi__guest__started__procmsg_8c_source.html#l00094">tcmi_guest_started_procmsg_new_tx()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>, and <a class="el" href="../../dd/d1d/tcmi__transaction_8h_source.html#l00099">TCMI_TRANSACTION_INVAL_ID</a>.</p>

<p>Referenced by <a class="el" href="../../db/d35/tcmi__syscallhooks__other_8c_source.html#l00131">tcmi_syscall_hooks_post_fork()</a>.</p>
<div class="fragment"><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                                                                                        {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *m;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> ( fork_result &lt; 0 ) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// Notify CCN about fork-failed</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="comment">// We&#39;re reusing exit msg here, but it may be better to introduce a specific event for this, right?</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">if</span> (!(m = <a class="code" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga4d0e9afc9e69c4260b898e672262aa04" title="&lt;&gt;&gt; Exit message tx constructor.">tcmi_exit_procmsg_new_tx</a>(remote_child_pid, fork_result))) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t create failed-fork exit message&quot;</span>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        BUG_ON(child == NULL); <span class="comment">// If fork succeeded, child cannot be null, right?</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter.">tcmi_task_set_remote_pid</a>(child, remote_child_pid);      </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (!(m = <a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga68c13e4eb03cdbc808140006bcb5a2f7" title="&lt;&lt;public&gt;&gt; Guest started process message tx constructor.">tcmi_guest_started_procmsg_new_tx</a>(<a class="code" href="../../d4/d8c/group__tcmi__transaction__class.html#gac546d01fab4d43f08caecc3f4fd7a90f" title="denotes an invalid transaction ID">TCMI_TRANSACTION_INVAL_ID</a>, </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                  <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(child), </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                  <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(child)))) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Cannot create a guest response in post-fork!&quot;</span>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }       </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, m);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(m);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;exit0:</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// TODO: Some better failure handling? Shall we stop this task, if we&#39;ve failed to inform CCN that it is running? CCN does not know it&#39;s ID in this case...</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_gaa439390162db6c39e89ece50c0119d61_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_gaa439390162db6c39e89ece50c0119d61_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_gaa439390162db6c39e89ece50c0119d61_cgraph" id="d5/d85/group__tcmi__guesttask__class_gaa439390162db6c39e89ece50c0119d61_cgraph">
<area shape="rect" id="node2" href="../../d4/d5a/group__tcmi__exit__procmsg__class.html#ga4d0e9afc9e69c4260b898e672262aa04" title="&lt;&gt;&gt; Exit message tx constructor." alt="" coords="245,313,425,340"/><area shape="rect" id="node24" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga68c13e4eb03cdbc808140006bcb5a2f7" title="&lt;&lt;public&gt;&gt; Guest started process message tx constructor." alt="" coords="268,247,401,289"/><area shape="rect" id="node25" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="536,361,640,388"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="749,548,886,575"/><area shape="rect" id="node27" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="259,465,410,492"/><area shape="rect" id="node28" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="225,415,445,441"/><area shape="rect" id="node40" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="247,575,422,601"/><area shape="rect" id="node3" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="515,255,661,281"/><area shape="rect" id="node4" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="757,120,878,147"/><area shape="rect" id="node5" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="983,5,1132,32"/><area shape="rect" id="node6" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="983,183,1131,209"/><area shape="rect" id="node12" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1623,157,1758,184"/><area shape="rect" id="node7" href="../../d4/d8c/group__tcmi__transaction__class.html#gad66082869d71dbe73b9a0b60cb2f437c" title="&lt;&lt;private&gt;&gt; Generates a transaction ID." alt="" coords="1211,208,1373,235"/><area shape="rect" id="node8" href="../../d0/db7/group__tcmi__slotvec__class.html#ga463d8dd03bd30b24c3ebfed5a0239d8a" title="&lt;&lt;public&gt;&gt; Hashmask accessor." alt="" coords="1211,259,1373,285"/><area shape="rect" id="node9" href="../../d4/d8c/group__tcmi__transaction__class.html#ga244e6188e1c4f9e1faba20d0892f5441" title="&lt;&lt;private&gt;&gt; Callback for the kernel timer that handles transaction timeouts." alt="" coords="1215,309,1369,336"/><area shape="rect" id="node21" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4f973395848150fbebecf3cc292c80ba" title="&lt;&lt;public&gt;&gt; The index where the insertion takes place has to be a valid slot." alt="" coords="1422,5,1573,32"/><area shape="rect" id="node10" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1426,284,1569,311"/><area shape="rect" id="node11" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1628,321,1753,348"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1629,208,1752,235"/><area shape="rect" id="node20" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="1621,271,1760,297"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1809,208,1946,235"/><area shape="rect" id="node18" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1824,107,1931,133"/><area shape="rect" id="node19" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1817,157,1937,184"/><area shape="rect" id="node15" href="../../da/d0c/group__tcmi__slot__class.html#ga6dd63ff2854a9939a5aa094f6543a5d1" title="&lt;&lt;public&gt;&gt; Checks if the slot is empty." alt="" coords="2017,208,2135,235"/><area shape="rect" id="node16" href="../../da/d0c/group__tcmi__slot__class.html#ga2550a3e6624b54e323c73cb1d06e6cd0" title="&lt;&lt;public&gt;&gt; Moves a slot among unused_slots." alt="" coords="1995,132,2157,159"/><area shape="rect" id="node17" href="../../da/d0c/group__tcmi__slot__class.html#ga8d6885be2677819158e0d956f0cca5b2" title="&lt;&lt;private&gt;&gt; Moves a slot into the specified list." alt="" coords="2205,95,2317,121"/><area shape="rect" id="node22" href="../../d0/db7/group__tcmi__slotvec__class.html#ga876670f605631a5deb930412dae02b28" title="&lt;&lt;public&gt;&gt; Accesses a slot at a given index." alt="" coords="1635,5,1747,32"/><area shape="rect" id="node23" href="../../da/d0c/group__tcmi__slot__class.html#gaefe294678d9d6922b3af1e452a318fa1" title="&lt;&lt;public&gt;&gt; Inserts a new node into the slot." alt="" coords="1633,81,1748,108"/><area shape="rect" id="node29" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="494,464,682,491"/><area shape="rect" id="node30" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="760,468,875,495"/><area shape="rect" id="node31" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="1001,600,1114,627"/><area shape="rect" id="node33" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="952,417,1163,444"/><area shape="rect" id="node34" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="982,468,1133,495"/><area shape="rect" id="node35" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768" title="&lt;&lt;public&gt;&gt; Starts a transaction." alt="" coords="982,519,1133,545"/><area shape="rect" id="node32" href="../../d6/d8e/group__kkc__sock__class.html#gaff5e8804c93f0cb2a4b5e2e12f64e743" title="&lt;&lt;private&gt;&gt; Transfers a required number of bytes." alt="" coords="1221,629,1363,656"/><area shape="rect" id="node36" href="../../d4/d8c/group__tcmi__transaction__class.html#gaba57811a17b10df187e7918d02e3679e" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1217,411,1367,437"/><area shape="rect" id="node37" href="../../d4/d8c/group__tcmi__transaction__class.html#ga176151d0f528ed8cda13e21da8551519" title="&lt;&lt;public&gt;&gt; Instance accessor." alt="" coords="1221,461,1363,488"/><area shape="rect" id="node38" href="../../d4/d8c/group__tcmi__transaction__class.html#ga1dfece4fcea1c1b9ce676f560957077f" title="&lt;&lt;public&gt;&gt; Sets flags in the transaction that denote additional transaction attributes." alt="" coords="1221,513,1363,554"/><area shape="rect" id="node39" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2c5c24c4b88dae68aa68c7b043d105b8" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="1211,579,1373,605"/><area shape="rect" id="node41" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="515,659,661,685"/><area shape="rect" id="node48" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="507,567,669,609"/><area shape="rect" id="node42" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="731,709,904,736"/><area shape="rect" id="node43" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="988,731,1127,757"/><area shape="rect" id="node44" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="1215,680,1369,707"/><area shape="rect" id="node45" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga4fbd3f1c3789bd79d4e2c684fc08d1a2" title="&lt;&lt;private&gt;&gt; Checks whether a directory entry contains entry of the specified name" alt="" coords="1214,731,1370,757"/><area shape="rect" id="node46" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="1221,781,1363,808"/><area shape="rect" id="node47" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaeeb7fba5f385c90d93878a60a4dcf1dc" title="&lt;&lt;private&gt;&gt; The new dentry is allocated based on the parent&#39;s dentry and the current name of the ..." alt="" coords="1218,833,1366,874"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga6af3f9afe2a77220f2407c4c79648018"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_guesttask_post_fork_set_tid </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#d3/d01/structtcmi__method__wrapper">tcmi_method_wrapper</a> *&#160;</td>
          <td class="paramname"><em>wr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Used to set proper tid after a new process was forked. </p>
<p>. it must be run in that process context </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00392">392</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d5/d77/proxyfs__helper_8h_source.html#l00112">proxyfs_clone_file_names()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00261">TCMI_TASK</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d44/tcmi__migcom_8c_source.html#l00528">tcmi_migcom_guest_fork()</a>.</p>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                                                                 {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task" title="Compound structure that gathers necessary process information.">tcmi_task</a> *self_tsk = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gaf05e0c401db433deef4d95a64ce9117b" title="Casts to the task instance.">TCMI_TASK</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Task - remote pid %d being set after fork&quot;</span>,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;         <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(self_tsk));</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">if</span> (current-&gt;set_child_tid) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Tid set required&quot;</span>);            </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                put_user(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(self_tsk), current-&gt;set_child_tid);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> ( thread_group_leader(current) ) { <span class="comment">// Proxyfs file names changing is required only for group leaders</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">// TODO: Make a separate method for this, it does not belong here</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="comment">// Modifies proxyfs file references to references specific to this task</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d77/proxyfs__helper_8h.html#afe83a59a45354c9be0c0d92d6ef4c307" title="This method is used after remote-fork on a client side.">proxyfs_clone_file_names</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(self_tsk)) ) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Task proxy fs clonning has failed. Pid %d&quot;</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(self_tsk));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="comment">// We cannot simply return KILL_ME here.. this would remove current TCMI task and kill the process,</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="comment">// but the exit hook won&#39;t be called!</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            force_sig(SIGKILL, current);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga6af3f9afe2a77220f2407c4c79648018_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga6af3f9afe2a77220f2407c4c79648018_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga6af3f9afe2a77220f2407c4c79648018_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga6af3f9afe2a77220f2407c4c79648018_cgraph">
<area shape="rect" id="node2" href="../../d5/d77/proxyfs__helper_8h.html#afe83a59a45354c9be0c0d92d6ef4c307" title="This method is used after remote&#45;fork on a client side." alt="" coords="211,63,336,105"/><area shape="rect" id="node6" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="198,129,349,156"/><area shape="rect" id="node3" href="../../d5/d77/proxyfs__helper_8h.html#ab59a1cd53be257804c046bd384ea59ad" title="Modifies proxyfs file name to reflect a new owner of the file." alt="" coords="398,5,533,46"/><area shape="rect" id="node4" href="../../d5/d77/proxyfs__helper_8h.html#a074be037b0aae4d248a61c90c2c68737" title="Checks, whether the file is proxyfs file." alt="" coords="581,41,685,68"/><area shape="rect" id="node5" href="../../d5/d77/proxyfs__helper_8h.html#afd09b6bc667dba6516ff4458eb0dabad" title="Helper method, that is used for altering file names on distant fork." alt="" coords="401,121,529,148"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga0855b260ad0e6d9be756d54d5b566d5d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_process_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes a message specified by the caller. </p>
<p>It handles:</p>
<ul>
<li>physical emigration request - this is special - as the guest should turn eventually into a migrated process.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this task instance </td></tr>
    <tr><td class="paramname">*m</td><td>- message to be processed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>depends on the type of message that has been processed </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00101">101</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00223">memory_sanity_check</a>, <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00307">tcmi_guesttask_process_p_emigrate_msg()</a>, <a class="el" href="../../dc/d44/tcmi__migcom_8c_source.html#l00409">tcmi_migcom_migrate_home_ppm_p()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00231">tcmi_msg_id()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../dd/dd5/tcmi__messages__id_8h_source.html#l00122">TCMI_P_EMIGRATE_MSG_ID</a>, <a class="el" href="../../dd/dd5/tcmi__messages__id_8h_source.html#l00136">TCMI_PPM_P_MIGR_BACK_SHADOWREQ_PROCMSG_ID</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordtype">int</span> res = <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">/* struct tcmi_guesttask *self_tsk = TCMI_GUESTTASK(self); */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<a class="code" href="../../d6/d01/dbg_8h.html#a9c4ed0974203b4d07545e0f6904da15e">memory_sanity_check</a>(<span class="stringliteral">&quot;On process message&quot;</span>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(m)) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">/* task PPM phys. migration request */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#ggadc29c2ff13d900c2f185ee95427fb06caa8805a547c5695d62df4ae7e7b91e845">TCMI_P_EMIGRATE_MSG_ID</a>:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        res = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga16ed0a2983a1fc31c158cb1327af6580" title="&lt;&lt;private&gt;&gt; Processes the physical emigrate process message (both NPM and PPM)">tcmi_guesttask_process_p_emigrate_msg</a>(<span class="keyword">self</span>, m);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea45c0e477e22d4de0a617c7dd19b75f16">TCMI_PPM_P_MIGR_BACK_SHADOWREQ_PROCMSG_ID</a>:</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">/* dispose the message not needed anymore. */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(m);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="comment">/* Is there some better way to invoke self migration home? If we call directly migrate back of this task the method queue won&#39;t be flushed as in the case of this call. */</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <a class="code" href="../../da/d93/group__tcmi__migcom__class.html#gadc5871d3fb9ab2901eabc69f9e3accc4" title="&lt;&lt;public&gt;&gt; Migrates a task back to its home node using preemptive migration with physical checkpoint ...">tcmi_migcom_migrate_home_ppm_p</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>));</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unexpected message from the guest task: %x&quot;</span>, <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor.">tcmi_msg_id</a>(m));</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<a class="code" href="../../d6/d01/dbg_8h.html#a9c4ed0974203b4d07545e0f6904da15e">memory_sanity_check</a>(<span class="stringliteral">&quot;After process message&quot;</span>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga0855b260ad0e6d9be756d54d5b566d5d_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga0855b260ad0e6d9be756d54d5b566d5d_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga0855b260ad0e6d9be756d54d5b566d5d_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga0855b260ad0e6d9be756d54d5b566d5d_cgraph">
<area shape="rect" id="node2" href="../../d5/d85/group__tcmi__guesttask__class.html#ga16ed0a2983a1fc31c158cb1327af6580" title="&lt;&lt;private&gt;&gt; Processes the physical emigrate process message (both NPM and PPM)" alt="" coords="251,377,415,418"/><area shape="rect" id="node42" href="../../da/d93/group__tcmi__migcom__class.html#gadc5871d3fb9ab2901eabc69f9e3accc4" title="&lt;&lt;public&gt;&gt; Migrates a task back to its home node using preemptive migration with physical checkpoint ..." alt="" coords="258,792,409,833"/><area shape="rect" id="node49" href="../../d6/dc2/group__tcmi__msg__class.html#ga73489766817f528da25369a3f4c713a1" title="&lt;&lt;public&gt;&gt; Message ID accessor." alt="" coords="1012,891,1108,918"/><area shape="rect" id="node37" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="1008,1144,1112,1171"/><area shape="rect" id="node8" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="1201,376,1338,403"/><area shape="rect" id="node3" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga4a20154039e0b8fe71be244c0cdb0919" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="499,501,650,542"/><area shape="rect" id="node4" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="487,334,662,360"/><area shape="rect" id="node9" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga63d0332412d2add383784a9b9ef2062d" title="&lt;&lt;public&gt;&gt; Checkpoint name accessor." alt="" coords="499,436,650,477"/><area shape="rect" id="node10" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="753,891,903,918"/><area shape="rect" id="node11" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image." alt="" coords="495,384,654,411"/><area shape="rect" id="node24" href="../../d2/d60/group__tcmi__err__procmsg__class.html#gae5322efeefc565378866b96c6cb101b3" title="&lt;&lt;public&gt;&gt; Error message constructor for transferring." alt="" coords="487,64,662,91"/><area shape="rect" id="node28" href="../../d6/dc2/group__tcmi__msg__class.html#ga5a09e9d377637eba6c3df1236fc97926" title="&lt;&lt;public&gt;&gt; Request transaction ID accessor." alt="" coords="514,182,635,208"/><area shape="rect" id="node29" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga68c13e4eb03cdbc808140006bcb5a2f7" title="&lt;&lt;public&gt;&gt; Guest started process message tx constructor." alt="" coords="508,116,641,157"/><area shape="rect" id="node30" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="484,774,665,800"/><area shape="rect" id="node34" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="465,232,685,259"/><area shape="rect" id="node5" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="755,322,901,348"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="747,250,909,292"/><area shape="rect" id="node6" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="973,216,1147,243"/><area shape="rect" id="node12" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="740,375,916,402"/><area shape="rect" id="node15" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="757,593,899,634"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gab1a418ac9d8b708dcee524671db07518" title="&lt;&lt;public&gt;&gt; Executes the file that has been previously setup for execution." alt="" coords="765,435,891,462"/><area shape="rect" id="node13" href="../../de/d2f/group__tcmi__task__class.html#gad41453e0aefb9dd79c2d3b65d8b9b16c" title="&lt;&lt;private&gt;&gt; Releases the execve context (execve file, argv, envp) Since the argv/envp have alloca..." alt="" coords="973,369,1147,410"/><area shape="rect" id="node14" href="../../de/d84/tcmi__task_8c.html#ab73603e4adaf2a1bb6b7cf6a01a1c2f3" title="&lt;&lt;private&gt;&gt; Class method &#45; copies an array of strings terminated by NULL string (standard argv/envp f..." alt="" coords="980,267,1140,294"/><area shape="rect" id="node16" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#ga57cd57a64f1ec847f1b71452daf4b3b1" title="&lt;&lt;public&gt;&gt; Creates a new wrapper for the specified method." alt="" coords="971,688,1149,715"/><area shape="rect" id="node17" href="../../dc/d0c/group__tcmi__queue__class.html#ga3ae4d7e0a4d5d21ec8b9fff138f5b0d4" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1000,536,1120,563"/><area shape="rect" id="node18" href="../../dc/d0c/group__tcmi__queue__class.html#ga2b0f1376bcd561196e77599cbc23090f" title="tcmi_queue_empty" alt="" coords="994,739,1126,766"/><area shape="rect" id="node19" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#gad93018cc0894a434a94703eed0f869f9" title="&lt;&lt;public&gt;&gt; Decrements the reference counter, when the count reaches 0, the instance is destroyed..." alt="" coords="973,587,1147,614"/><area shape="rect" id="node20" href="../../dc/d0c/group__tcmi__queue__class.html#ga40921ea3b077d55d70fb7b94ac666292" title="&lt;&lt;public&gt;&gt; Adds an element to the queue &#45; lock free version, assumes the lock is already held..." alt="" coords="995,638,1125,664"/><area shape="rect" id="node21" href="../../dc/d0c/group__tcmi__queue__class.html#ga2e0e25eec1d5e4ea6e89dfde81ed43f4" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="993,486,1127,512"/><area shape="rect" id="node23" href="../../da/d7c/i386_2make__syscall_8h.html#a042af8adc43a2caa376c6a5dfddfeb6c" title="TODO: Export the original kernel_execve in kernel and use that instead." alt="" coords="985,435,1135,462"/><area shape="rect" id="node25" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="755,64,901,91"/><area shape="rect" id="node26" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="1209,144,1330,171"/><area shape="rect" id="node27" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1391,518,1526,544"/><area shape="rect" id="node31" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="738,840,918,867"/><area shape="rect" id="node32" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="975,942,1145,968"/><area shape="rect" id="node33" href="../../d8/d3c/util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="1210,979,1329,1006"/><area shape="rect" id="node35" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="734,116,922,143"/><area shape="rect" id="node36" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="1003,64,1117,91"/><area shape="rect" id="node38" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="1198,1068,1341,1095"/><area shape="rect" id="node39" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="1396,1068,1521,1095"/><area shape="rect" id="node40" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="1397,1119,1520,1146"/><area shape="rect" id="node41" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="1389,1018,1528,1044"/><area shape="rect" id="node43" href="../../d2/daf/group__tcmi__taskhelper__class.html#gae8f5d2b311ca92e60b598076b578327d" title="&lt;&lt;public&gt;&gt; Submits a specified method to a TCMI task identified by PID." alt="" coords="499,708,651,749"/><area shape="rect" id="node50" href="../../de/d2f/group__tcmi__task__class.html#ga7e6ecd94a71cc78169ab8f5ab8f00f86" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Migrates a task back to CCN &#45; PPM w/ physical checkpoint..." alt="" coords="496,876,653,917"/><area shape="rect" id="node44" href="../../d2/daf/group__tcmi__taskhelper__class.html#gab89ca5c0deb987d20cf94fe2d000c58f" title="&lt;&lt;public&gt;&gt; Finds a TCMI task based on PID, in addition checks whether the task has a valid migration ..." alt="" coords="757,1044,899,1085"/><area shape="rect" id="node46" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="741,672,915,699"/><area shape="rect" id="node47" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga9dbb48f23b9ec6a00498db53f026ef4b" title="&lt;&lt;public&gt;&gt; Switches the task into migration mode." alt="" coords="753,774,903,816"/><area shape="rect" id="node48" href="../../de/d2f/group__tcmi__task__class.html#ga9317afe43a9b9343c70eaf42409864b7" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="776,723,880,750"/><area shape="rect" id="node45" href="../../de/d2f/group__tcmi__task__class.html#gafb7d2e6227e173c0bdc6fb99ff12bcbc" title="&lt;&lt;public&gt;&gt; Instance accessor, increments the reference counter." alt="" coords="1008,1043,1112,1070"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga16ed0a2983a1fc31c158cb1327af6580"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_guesttask_process_p_emigrate_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d1/dd2/structtcmi__task">tcmi_task</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg">tcmi_msg</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Processes the physical emigrate process message (both NPM and PPM) </p>
<p>The remote PID is extracted from the emigration message and stored in the guest task. The checkpoint name is also extracted and passed to the task helper to schedule a restart. This also sets the checkpoint image as the most recent checkpoint of the task.</p>
<p>A response is sent back that will contain the guest task local PID. This PID is needed for further communication between the shadow and guest tasks.</p>
<p>The restart is only scheduled and will be processed upon next iteration of the method pump.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this guest task instance </td></tr>
    <tr><td class="paramname">*m</td><td>- Physical emigration message that will be proceseed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TCMI_TASK_KEEP_PUMPING if the restart has been successfully scheduled </dd></dl>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00307">307</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00220">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00223">memory_sanity_check</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00116">resp</a>, <a class="el" href="../../d9/dc1/tcmi__err__procmsg_8c_source.html#l00095">tcmi_err_procmsg_new_tx()</a>, <a class="el" href="../../dd/dd5/tcmi__messages__id_8h_source.html#l00134">TCMI_GUEST_STARTED_PROCMSG_ID</a>, <a class="el" href="../../d3/dce/tcmi__guest__started__procmsg_8c_source.html#l00094">tcmi_guest_started_procmsg_new_tx()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00212">tcmi_msg_put()</a>, <a class="el" href="../../d1/d6d/tcmi__msg_8h_source.html#l00255">tcmi_msg_req_id()</a>, <a class="el" href="../../d5/d20/tcmi__p__emigrate__msg_8h_source.html#l00106">TCMI_P_EMIGRATE_MSG</a>, <a class="el" href="../../d5/d20/tcmi__p__emigrate__msg_8h_source.html#l00136">tcmi_p_emigrate_msg_ckpt_name()</a>, <a class="el" href="../../d5/d20/tcmi__p__emigrate__msg_8h_source.html#l00114">tcmi_p_emigrate_msg_reply_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00648">tcmi_task_check_peer_lost()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00252">TCMI_TASK_KEEP_PUMPING</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00255">TCMI_TASK_KILL_ME</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00411">tcmi_task_local_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00422">tcmi_task_remote_pid()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00524">tcmi_task_send_anonymous_msg()</a>, <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>, and <a class="el" href="../../d7/d05/tcmi__taskhelper_8h_source.html#l00700">tcmi_taskhelper_restart()</a>.</p>

<p>Referenced by <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00101">tcmi_guesttask_process_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#d0/d5b/structtcmi__msg" title="A coumpound structure that carries a generic TCMI message.">tcmi_msg</a> *<a class="code" href="../../d1/d6d/tcmi__msg_8h.html#adb26817b6c4a9eeb3f68c832f24d5471" title="response transaction ID">resp</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    pid_t remote_pid;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">char</span> *ckpt_name;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">/* extract the remote PID */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    remote_pid = <a class="code" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga4a20154039e0b8fe71be244c0cdb0919" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_p_emigrate_msg_reply_pid</a>(<a class="code" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#gaff84a941c39a708a128fb640ede3e9b4" title="Casts to the tcmi_p_emigrate_msg instance.">TCMI_P_EMIGRATE_MSG</a>(m));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter.">tcmi_task_set_remote_pid</a>(<span class="keyword">self</span>, remote_pid);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">/* extract the checkpoint name */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    ckpt_name =  <a class="code" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga63d0332412d2add383784a9b9ef2062d" title="&lt;&lt;public&gt;&gt; Checkpoint name accessor.">tcmi_p_emigrate_msg_ckpt_name</a>(<a class="code" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#gaff84a941c39a708a128fb640ede3e9b4" title="Casts to the tcmi_p_emigrate_msg instance.">TCMI_P_EMIGRATE_MSG</a>(m));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Processing emigration request, remote PID=%d, checkpoint: &#39;%s&#39;&quot;</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), ckpt_name);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<a class="code" href="../../d6/d01/dbg_8h.html#a9c4ed0974203b4d07545e0f6904da15e">memory_sanity_check</a>(<span class="stringliteral">&quot;On processing&quot;</span>);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">/* schedules process restart from a checkpoint image */</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image.">tcmi_taskhelper_restart</a>(<span class="keyword">self</span>, ckpt_name) &lt; 0) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">/* report a problem */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> (!(resp = <a class="code" href="../../d2/d60/group__tcmi__err__procmsg__class.html#gae5322efeefc565378866b96c6cb101b3" title="&lt;&lt;public&gt;&gt; Error message constructor for transferring.">tcmi_err_procmsg_new_tx</a>(<a class="code" href="../../d8/d9d/group__tcmi__messages__id.html#gga61dadd085c1777f559549e05962b2c9ea1fff522372aae1c3fa549658ef13d5ab">TCMI_GUEST_STARTED_PROCMSG_ID</a>, </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                             <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga5a09e9d377637eba6c3df1236fc97926" title="&lt;&lt;public&gt;&gt; Request transaction ID accessor.">tcmi_msg_req_id</a>(m), -ENOEXEC,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                             <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>)))) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                            </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Cannot create a guest error response!!&quot;</span>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        } </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a9c4ed0974203b4d07545e0f6904da15e">memory_sanity_check</a>(<span class="stringliteral">&quot;After restart&quot;</span>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }   </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">/* restart successfully scheduled, respond with our local PID */</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (!(resp = <a class="code" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga68c13e4eb03cdbc808140006bcb5a2f7" title="&lt;&lt;public&gt;&gt; Guest started process message tx constructor.">tcmi_guest_started_procmsg_new_tx</a>(<a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#ga5a09e9d377637eba6c3df1236fc97926" title="&lt;&lt;public&gt;&gt; Request transaction ID accessor.">tcmi_msg_req_id</a>(m), </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                  <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor.">tcmi_task_remote_pid</a>(<span class="keyword">self</span>), </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                  <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor.">tcmi_task_local_pid</a>(<span class="keyword">self</span>)))) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Cannot create a guest response!!&quot;</span>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a9c4ed0974203b4d07545e0f6904da15e">memory_sanity_check</a>(<span class="stringliteral">&quot;After restart 2&quot;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">/* preliminary announce - the guest has been started (execve still might fail) */</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer...">tcmi_task_check_peer_lost</a>(<span class="keyword">self</span>, <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message.">tcmi_task_send_anonymous_msg</a>(<span class="keyword">self</span>, resp));</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined...">tcmi_msg_put</a>(resp);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bafa7c813a4364ccccdc1edfd29839c675">TCMI_TASK_KEEP_PUMPING</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; exit0:</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d2f/group__tcmi__task__class.html#ggaa81f1a7178bfcf01d74e57d6bbcb869bad619e483cc5231333ada87518fb2b301">TCMI_TASK_KILL_ME</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d5/d85/group__tcmi__guesttask__class_ga16ed0a2983a1fc31c158cb1327af6580_cgraph.png" border="0" usemap="#d5/d85/group__tcmi__guesttask__class_ga16ed0a2983a1fc31c158cb1327af6580_cgraph" alt=""/></div>
<map name="d5/d85/group__tcmi__guesttask__class_ga16ed0a2983a1fc31c158cb1327af6580_cgraph" id="d5/d85/group__tcmi__guesttask__class_ga16ed0a2983a1fc31c158cb1327af6580_cgraph">
<area shape="rect" id="node2" href="../../d2/d60/group__tcmi__err__procmsg__class.html#gae5322efeefc565378866b96c6cb101b3" title="&lt;&lt;public&gt;&gt; Error message constructor for transferring." alt="" coords="242,57,417,84"/><area shape="rect" id="node8" href="../../d1/dc2/group__tcmi__guest__started__procmsg__class.html#ga68c13e4eb03cdbc808140006bcb5a2f7" title="&lt;&lt;public&gt;&gt; Guest started process message tx constructor." alt="" coords="263,109,396,150"/><area shape="rect" id="node9" href="../../d6/dc2/group__tcmi__msg__class.html#gac86a4090b7e1902ef603cb03191d6281" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="277,175,381,201"/><area shape="rect" id="node17" href="../../d6/dc2/group__tcmi__msg__class.html#ga5a09e9d377637eba6c3df1236fc97926" title="&lt;&lt;public&gt;&gt; Request transaction ID accessor." alt="" coords="269,225,390,252"/><area shape="rect" id="node18" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga63d0332412d2add383784a9b9ef2062d" title="&lt;&lt;public&gt;&gt; Checkpoint name accessor." alt="" coords="254,277,405,318"/><area shape="rect" id="node19" href="../../df/df9/group__tcmi__p__emigrate__msg__class.html#ga4a20154039e0b8fe71be244c0cdb0919" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="254,342,405,383"/><area shape="rect" id="node20" href="../../de/d2f/group__tcmi__task__class.html#gac04862f389dea22fbd5b8dc8f642ca9c" title="Simple error checking method to be used after communication operations to detect lost peer..." alt="" coords="239,408,420,435"/><area shape="rect" id="node24" href="../../de/d2f/group__tcmi__task__class.html#ga0232aeae006148ffa6c760e7f1979865" title="&lt;&lt;public&gt;&gt; Local PID accessor." alt="" coords="989,509,1126,536"/><area shape="rect" id="node25" href="../../de/d2f/group__tcmi__task__class.html#ga2f054ae4772c0921004eebdb48d39dcf" title="&lt;&lt;public&gt;&gt; Remote PID accessor." alt="" coords="254,669,405,696"/><area shape="rect" id="node26" href="../../de/d2f/group__tcmi__task__class.html#ga4e660ea948542a5a057e25640a762efc" title="&lt;&lt;public&gt;&gt; Sends a specified message." alt="" coords="219,891,439,917"/><area shape="rect" id="node33" href="../../de/d2f/group__tcmi__task__class.html#ga60a2a872664867b7a86ec278b570fef2" title="&lt;&lt;public&gt;&gt; Remote PID setter." alt="" coords="242,517,417,544"/><area shape="rect" id="node38" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga1ff741911c123bcd7eb94d193f3bdc59" title="&lt;&lt;public&gt;&gt; Schedules a task restart from a given checkpoint image." alt="" coords="250,619,409,645"/><area shape="rect" id="node3" href="../../d7/dc8/group__tcmi__procmsg__class.html#gaa22b26ec117d20a804758f501e9d3e59" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="509,57,656,84"/><area shape="rect" id="node4" href="../../d6/dc2/group__tcmi__msg__class.html#gace79df438ec4f7c8f7cee3bfe42f6d93" title="&lt;&lt;public&gt;&gt; Initializes the message for transferring." alt="" coords="754,40,875,67"/><area shape="rect" id="node5" href="../../db/dc8/tcmi__msg_8c.html#a5c394462e393c496f11d949b265b8a9e" title="Shared initialization fuction of both rx and tx messages." alt="" coords="983,32,1132,59"/><area shape="rect" id="node6" href="../../d4/d8c/group__tcmi__transaction__class.html#gada9d9436def8919a10997233cd6b5ea1" title="&lt;&lt;public&gt;&gt; Creates a new transaction." alt="" coords="983,83,1131,109"/><area shape="rect" id="node7" href="../../d4/d8c/group__tcmi__transaction__class.html#gaac666feaaab1fe5c341237a3e0283501" title="&lt;&lt;public&gt;&gt; Transaction ID accessor." alt="" coords="1211,83,1346,109"/><area shape="rect" id="node10" href="../../d4/d8c/group__tcmi__transaction__class.html#ga2748d267a8fddd1ced86e73ba8efd079" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="511,184,654,211"/><area shape="rect" id="node11" href="../../d0/db7/group__tcmi__slotvec__class.html#ga5b4586b2e897ec306862a0b6901f39e7" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="752,184,877,211"/><area shape="rect" id="node12" href="../../da/d0c/group__tcmi__slot__class.html#ga1d6232adcf00094597a66d9f5740d5f8" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="753,235,876,261"/><area shape="rect" id="node16" href="../../d0/db7/group__tcmi__slotvec__class.html#ga4df343d549736d3dc994ad0f43529a57" title="&lt;&lt;public&gt;&gt; Unlocks the instance data." alt="" coords="745,285,884,312"/><area shape="rect" id="node13" href="../../da/d0c/group__tcmi__slot__class.html#ga29d8101c5815a6519567c548da4a3c7e" title="&lt;&lt;public&gt;&gt; Removes a given node from a slot." alt="" coords="989,184,1126,211"/><area shape="rect" id="node14" href="../../da/d0c/group__tcmi__slot__class.html#ga109d6d783ebf06046f364f970f84da1f" title="&lt;&lt;public&gt;&gt; Locks the slot data." alt="" coords="1004,235,1111,261"/><area shape="rect" id="node15" href="../../da/d0c/group__tcmi__slot__class.html#ga5447231fec5f42040c40307eb2e6a13c" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="997,285,1117,312"/><area shape="rect" id="node21" href="../../de/d2f/group__tcmi__task__class.html#gad2d3dad02cf555da12cb2926cebb25f6" title="Notifies task that it peer is lost and sends a kill signal to that task." alt="" coords="493,408,673,435"/><area shape="rect" id="node22" href="../../de/d2f/group__tcmi__task__class.html#gac263213bf219960dea9c7d4b4e6f3b34" title="Returns a task_struct associated with the tcmi_task." alt="" coords="730,408,899,435"/><area shape="rect" id="node23" href="../../d8/d3c/util_8h.html#a5f449355b8f54aaed664de85f89092ea" title="task_find_by_pid" alt="" coords="998,408,1117,435"/><area shape="rect" id="node27" href="../../d6/dc2/group__tcmi__msg__class.html#ga7a8fe8cbfd4b25c15589c8599f66e574" title="&lt;&lt;public&gt;&gt; Sends a message via a specified connection." alt="" coords="489,1061,677,1088"/><area shape="rect" id="node28" href="../../d6/dc2/group__tcmi__msg__class.html#ga1c21eeafb9a0d56dabb025d5fbdc0bc3" title="&lt;&lt;private&gt;&gt; Sends a message via a specified connection." alt="" coords="757,1133,872,1160"/><area shape="rect" id="node29" href="../../d6/d8e/group__kkc__sock__class.html#gad734b131e2ab00e8d7fa30737fc2f5ad" title="&lt;&lt;public&gt;&gt; Sends out specified data." alt="" coords="1001,1159,1114,1185"/><area shape="rect" id="node30" href="../../d6/d8e/group__kkc__sock__class.html#ga141590d302ece9990e5c8cdd82a3c3d8" title="&lt;&lt;public&gt;&gt; Locks this socket instance for sending, interruptible version, the process can be woken up..." alt="" coords="952,1209,1163,1236"/><area shape="rect" id="node31" href="../../d6/d8e/group__kkc__sock__class.html#ga841d6dff84842f19540eae27c37fcb4c" title="&lt;&lt;public&gt;&gt; Unlocks this socket instance for sending." alt="" coords="982,1057,1133,1084"/><area shape="rect" id="node32" href="../../d4/d8c/group__tcmi__transaction__class.html#ga653b1761a1b6e9fef415196c54e00768" title="&lt;&lt;public&gt;&gt; Starts a transaction." alt="" coords="982,1108,1133,1135"/><area shape="rect" id="node34" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541" title="&lt;&lt;public&gt;&gt; Creates a new instance of a file." alt="" coords="510,699,655,725"/><area shape="rect" id="node37" href="../../de/d2f/group__tcmi__task__class.html#ga401654abdc812f0a923d05c95b412fb1" title="tcmi_task_show_remote\l_pid_rev" alt="" coords="501,510,664,551"/><area shape="rect" id="node35" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="728,728,901,755"/><area shape="rect" id="node36" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="988,728,1127,755"/><area shape="rect" id="node39" href="../../de/d2f/group__tcmi__task__class.html#ga24a9d8c612da1a4484b1b3a28a181c15" title="&lt;&lt;public&gt;&gt; Prepares execution of a file given the arrays of arguments and environment." alt="" coords="495,619,671,645"/><area shape="rect" id="node42" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="512,923,653,965"/><area shape="rect" id="node49" href="../../de/d2f/group__tcmi__task__class.html#gab1a418ac9d8b708dcee524671db07518" title="&lt;&lt;public&gt;&gt; Executes the file that has been previously setup for execution." alt="" coords="519,779,646,805"/><area shape="rect" id="node40" href="../../de/d2f/group__tcmi__task__class.html#gad41453e0aefb9dd79c2d3b65d8b9b16c" title="&lt;&lt;private&gt;&gt; Releases the execve context (execve file, argv, envp) Since the argv/envp have alloca..." alt="" coords="727,611,902,653"/><area shape="rect" id="node41" href="../../de/d84/tcmi__task_8c.html#ab73603e4adaf2a1bb6b7cf6a01a1c2f3" title="&lt;&lt;private&gt;&gt; Class method &#45; copies an array of strings terminated by NULL string (standard argv/envp f..." alt="" coords="735,677,895,704"/><area shape="rect" id="node43" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#ga57cd57a64f1ec847f1b71452daf4b3b1" title="&lt;&lt;public&gt;&gt; Creates a new wrapper for the specified method." alt="" coords="725,931,904,957"/><area shape="rect" id="node44" href="../../dc/d0c/group__tcmi__queue__class.html#ga3ae4d7e0a4d5d21ec8b9fff138f5b0d4" title="&lt;&lt;public&gt;&gt; Locks the instance data." alt="" coords="755,981,875,1008"/><area shape="rect" id="node45" href="../../dc/d0c/group__tcmi__queue__class.html#ga2b0f1376bcd561196e77599cbc23090f" title="tcmi_queue_empty" alt="" coords="749,1032,881,1059"/><area shape="rect" id="node46" href="../../d1/d5d/group__tcmi__method__wrapper__class.html#gad93018cc0894a434a94703eed0f869f9" title="&lt;&lt;public&gt;&gt; Decrements the reference counter, when the count reaches 0, the instance is destroyed..." alt="" coords="727,829,902,856"/><area shape="rect" id="node47" href="../../dc/d0c/group__tcmi__queue__class.html#ga40921ea3b077d55d70fb7b94ac666292" title="&lt;&lt;public&gt;&gt; Adds an element to the queue &#45; lock free version, assumes the lock is already held..." alt="" coords="749,1083,880,1109"/><area shape="rect" id="node48" href="../../dc/d0c/group__tcmi__queue__class.html#ga2e0e25eec1d5e4ea6e89dfde81ed43f4" title="&lt;&lt;public&gt;&gt; Unlocks the instance data" alt="" coords="747,880,882,907"/><area shape="rect" id="node50" href="../../da/d7c/i386_2make__syscall_8h.html#a042af8adc43a2caa376c6a5dfddfeb6c" title="TODO: Export the original kernel_execve in kernel and use that instead." alt="" coords="740,779,889,805"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gab7fde47a0d6fae4c11cdca33413a6f72"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d5/d85/group__tcmi__guesttask__class.html#db/db9/structtcmi__guesttask">tcmi_guesttask</a>   __attribute__</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga5df59fd8e4298423a9bb56f2b859fc5f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../de/d2f/group__tcmi__task__class.html#d5/d04/structtcmi__task__ops">tcmi_task_ops</a> guesttask_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .process_msg = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga0855b260ad0e6d9be756d54d5b566d5d" title="&lt;&lt;private&gt;&gt; Processes a message specified by the caller.">tcmi_guesttask_process_msg</a>,</div>
<div class="line">    .emigrate_ppm_p = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#gac8d8c619e9dc86a39ebce00d01030831" title="&lt;&lt;private&gt;&gt; Emigrates a task to a PEN.">tcmi_guesttask_emigrate_p</a>,    </div>
<div class="line">    .migrateback_ppm_p = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga1f99fbedfc6a18e6cfb4d6502f1a8825" title="&lt;&lt;private&gt;&gt; Migrates a task back to CCN using PPM with physical checkpoint image.">tcmi_guesttask_migrateback_ppm_p</a>,</div>
<div class="line">    .migrateback_npm = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#gabab4bd5d57978aab262f5ac1ee9044bb" title="Handles non-preemptive migration back of guest tasks.">tcmi_guesttask_migrateback_npm</a>,</div>
<div class="line">    .exit = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga21fc3a398e6663b285ea3ef21f81629f" title="&lt;&lt;private&gt;&gt; Exit notification for the shadow on CCN.">tcmi_guesttask_exit</a>,</div>
<div class="line">    .get_type = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga8adddfca18c4106695fe90181fec0378" title="Return type of task.">tcmi_guesttask_get_type</a>,</div>
<div class="line">    .do_signal = <a class="code" href="../../d5/d85/group__tcmi__guesttask__class.html#ga0d7c79c7e1a2ef3a36c46056621576f2" title="&lt;&lt;private&gt;&gt; Processes a specified signal.">tcmi_guesttask_do_signal</a></div>
<div class="line">}</div>
</div><!-- fragment -->
<p>TCMI task operations that support polymorphism. </p>

<p>Definition at line <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00426">426</a> of file <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html">tcmi_guesttask.c</a>.</p>

<p>Referenced by <a class="el" href="../../da/d61/tcmi__guesttask_8c_source.html#l00058">tcmi_guesttask_new()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 7 2013 23:20:23 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
