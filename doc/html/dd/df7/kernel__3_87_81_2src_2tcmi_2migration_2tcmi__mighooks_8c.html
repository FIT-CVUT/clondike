<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: C:/CLONDIKE/clondike/sources/kernel_3.7.1/src/tcmi/migration/tcmi_mighooks.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_mighooks.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kernel.h&gt;</code><br/>
<code>#include &lt;linux/types.h&gt;</code><br/>
<code>#include &lt;linux/module.h&gt;</code><br/>
<code>#include &lt;linux/vmalloc.h&gt;</code><br/>
<code>#include &lt;linux/resource.h&gt;</code><br/>
<code>#include &lt;tcmi/task/tcmi_taskhelper.h&gt;</code><br/>
<code>#include &lt;tcmi/comm/tcmi_vfork_done_procmsg.h&gt;</code><br/>
<code>#include &lt;tcmi/manager/tcmi_ccnman.h&gt;</code><br/>
<code>#include &lt;tcmi/manager/tcmi_penman.h&gt;</code><br/>
<code>#include &lt;clondike/tcmi/tcmi_hooks.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="../../d5/dd8/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8h_source.html">tcmi_mighooks.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h_source.html">tcmi_npm_params.h</a>&quot;</code><br/>
<code>#include &lt;arch/current/regs.h&gt;</code><br/>
<code>#include &lt;dbg.h&gt;</code><br/>
<code>#include &lt;director/director.h&gt;</code><br/>
<code>#include &lt;proxyfs/proxyfs_server.h&gt;</code><br/>
<code>#include &lt;proxyfs/proxyfs_helper.h&gt;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for tcmi_mighooks.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d03/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c__incl.png" border="0" usemap="#C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c" alt=""/></div>
<map name="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c" id="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c">
<area shape="rect" id="node12" href="../../d5/dd8/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8h.html" title="tcmi_mighooks.h" alt="" coords="129,133,249,160"/><area shape="rect" id="node14" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html" title="tcmi_npm_params.h" alt="" coords="1697,133,1836,160"/></map>
</div>
</div>
<p><a href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2e9e8c70896a53d297e59c13a7dc3caf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html#a2e9e8c70896a53d297e59c13a7dc3caf">TCMI_MIGHOOKS_PRIVATE</a></td></tr>
<tr class="separator:a2e9e8c70896a53d297e59c13a7dc3caf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga705196ddd4c33752e6b4950899d17d84"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/dfc/group__tcmi__mighooks__class.html#ga705196ddd4c33752e6b4950899d17d84">tcmi_mighooks_init</a> (void)</td></tr>
<tr class="memdesc:ga705196ddd4c33752e6b4950899d17d84"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Registers all hooks with the kernel.  <a href="../../df/dfc/group__tcmi__mighooks__class.html#ga705196ddd4c33752e6b4950899d17d84">More...</a><br/></td></tr>
<tr class="separator:ga705196ddd4c33752e6b4950899d17d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga98946c2d33eafff9d4a992eae05a3ad4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/dfc/group__tcmi__mighooks__class.html#ga98946c2d33eafff9d4a992eae05a3ad4">tcmi_mighooks_exit</a> (void)</td></tr>
<tr class="memdesc:ga98946c2d33eafff9d4a992eae05a3ad4"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Unregisters all hooks.  <a href="../../df/dfc/group__tcmi__mighooks__class.html#ga98946c2d33eafff9d4a992eae05a3ad4">More...</a><br/></td></tr>
<tr class="separator:ga98946c2d33eafff9d4a992eae05a3ad4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa0601a7d19329d21b4257278c16357e0"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html#gaa0601a7d19329d21b4257278c16357e0">tcmi_mighooks_do_exit</a> (long code)</td></tr>
<tr class="memdesc:gaa0601a7d19329d21b4257278c16357e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Exit system call hook.  <a href="#gaa0601a7d19329d21b4257278c16357e0">More...</a><br/></td></tr>
<tr class="separator:gaa0601a7d19329d21b4257278c16357e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf99c6402f3cf1ac0b25d9c396cd33e48"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html#gaf99c6402f3cf1ac0b25d9c396cd33e48">tcmi_mighooks_mig_mode</a> (struct pt_regs *regs)</td></tr>
<tr class="memdesc:gaf99c6402f3cf1ac0b25d9c396cd33e48"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; This hook is called upon SIGUNUSED delivery to a particular process.  <a href="#gaf99c6402f3cf1ac0b25d9c396cd33e48">More...</a><br/></td></tr>
<tr class="separator:gaf99c6402f3cf1ac0b25d9c396cd33e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad2ecd15466a7569be6030ee4a59ac3dc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/dfc/group__tcmi__mighooks__class.html#gad2ecd15466a7569be6030ee4a59ac3dc">tcmi_try_npm_on_exec</a> (const char *filename, const char __user *const __user *argv, const char __user *const __user *<a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#aeebc47a01a74a156c1843bcc37b2bd02">envp</a>, struct pt_regs *regs, struct <a class="el" href="../../d6/de0/group__tcmi__man__class.html#da/d15/structtcmi__man">tcmi_man</a> *man, int is_guest)</td></tr>
<tr class="separator:gad2ecd15466a7569be6030ee4a59ac3dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga976d4842862f35103b7a2844f8a73e7c"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/dfc/group__tcmi__mighooks__class.html#ga976d4842862f35103b7a2844f8a73e7c">tcmi_mighooks_execve</a> (const char *filename, const char __user *const __user *argv, const char __user *const __user *<a class="el" href="../../df/d60/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__npm__params_8h.html#aeebc47a01a74a156c1843bcc37b2bd02">envp</a>, struct pt_regs *regs)</td></tr>
<tr class="separator:ga976d4842862f35103b7a2844f8a73e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacba0b88eda0371f2be5be630a8ac24a0"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html#gacba0b88eda0371f2be5be630a8ac24a0">tcmi_mighooks_replace_proc_self_file</a> (const char *filename, const char **result)</td></tr>
<tr class="separator:gacba0b88eda0371f2be5be630a8ac24a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a2e9e8c70896a53d297e59c13a7dc3caf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_MIGHOOKS_PRIVATE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00043">43</a> of file <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html">tcmi_mighooks.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa0601a7d19329d21b4257278c16357e0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long tcmi_mighooks_do_exit </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>code</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Exit system call hook. </p>
<p>Delegates work to the task helper that notifies current process by submitting a task_exit method and supplying the exit code. The task handles the rest on its own.</p>
<p>The priority notification is used, so that the exit follows immediately.</p>
<p>This hook is called for every process in the system, but does something only for TCMI tasks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">code</td><td>- process exit code </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- status of how the notification went. </dd></dl>

<p>Definition at line <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00135">135</a> of file <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html">tcmi_mighooks.c</a>.</p>

<p>References <a class="el" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c_source.html#l00096">director_task_exit()</a>, <a class="el" href="../../d9/d03/kernel__2_86_833_81_2src_2proxyfs_2proxyfs__server_8c_source.html#l00325">proxyfs_server_release_all()</a>, <a class="el" href="../../d9/d21/kernel__2_86_833_81_2src_2proxyfs_2proxyfs__helper_8h_source.html#l00208">proxyfs_sync_files_on_exit()</a>, <a class="el" href="../../dd/d5d/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__task_8c_source.html#l00635">tcmi_task_exit()</a>, and <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00574">tcmi_taskhelper_notify_current()</a>.</p>

<p>Referenced by <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00058">tcmi_mighooks_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">int</span> prio = 1, is_shadow;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keyword">struct </span>rusage rusage;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    mm_segment_t old_fs;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordtype">long</span> res;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    is_shadow = (current-&gt;tcmi.task_type == shadow || current-&gt;tcmi.task_type == shadow_detached);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    old_fs = get_fs();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    set_fs(get_ds());</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    res = getrusage(current, RUSAGE_SELF, &amp;rusage);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    set_fs(old_fs);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c.html#afc6e7c293f7c2ac0d34c2937058fe734" title="Called, when a task exits.">director_task_exit</a>(current-&gt;pid, code, &amp;rusage);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    res = <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga7421f53cc8c717b52a92daaac326f81d" title="&lt;&lt;public&gt;&gt; current process notification - submission of a method.">tcmi_taskhelper_notify_current</a>(<a class="code" href="../../de/d2f/group__tcmi__task__class.html#ga724d575729c5a3f2be09db7ee6833999" title="&lt;&lt;public&gt;&gt; Called from method queue - Exits a task.">tcmi_task_exit</a>, &amp;code, </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                          <span class="keyword">sizeof</span>(code), prio);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> ( is_shadow ) { <span class="comment">// If the exitting task is a shadow task, we release all its proxy files as they won&#39;t be needed</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="../../d9/d21/kernel__2_86_833_81_2src_2proxyfs_2proxyfs__helper_8h.html#a9c20f5bd7542a43136e9ac435aa9dee5" title="Synchronizes all files open by &quot;current&quot; process.">proxyfs_sync_files_on_exit</a>(); <span class="comment">// We have to synchronize all files first so that no new writes occur after server release</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="../../db/d78/group__proxyfs__server__class.html#ga77d912a797d8b74f05bda041fa8c489a" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Release all files taken from current proccess">proxyfs_server_release_all</a>();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaa0601a7d19329d21b4257278c16357e0_cgraph.png" border="0" usemap="#dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaa0601a7d19329d21b4257278c16357e0_cgraph" alt=""/></div>
<map name="dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaa0601a7d19329d21b4257278c16357e0_cgraph" id="dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaa0601a7d19329d21b4257278c16357e0_cgraph">
<area shape="rect" id="node2" href="../../d7/d4a/kernel__2_86_833_81_2src_2director_2director_8c.html#afc6e7c293f7c2ac0d34c2937058fe734" title="Called, when a task exits." alt="" coords="239,5,364,32"/><area shape="rect" id="node3" href="../../db/d78/group__proxyfs__server__class.html#ga77d912a797d8b74f05bda041fa8c489a" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Release all files taken from current proccess" alt="" coords="214,56,389,83"/><area shape="rect" id="node4" href="../../d9/d21/kernel__2_86_833_81_2src_2proxyfs_2proxyfs__helper_8h.html#a9c20f5bd7542a43136e9ac435aa9dee5" title="Synchronizes all files open by &quot;current&quot; process." alt="" coords="237,107,366,149"/><area shape="rect" id="node5" href="../../de/d2f/group__tcmi__task__class.html#ga724d575729c5a3f2be09db7ee6833999" title="&lt;&lt;public&gt;&gt; Called from method queue &#45; Exits a task." alt="" coords="248,173,355,200"/><area shape="rect" id="node6" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga7421f53cc8c717b52a92daaac326f81d" title="&lt;&lt;public&gt;&gt; current process notification &#45; submission of a method." alt="" coords="225,225,377,266"/><area shape="rect" id="node7" href="../../de/d2f/group__tcmi__task__class.html#ga2bf62635c09738ef0c1385ea258bec2f" title="&lt;&lt;public&gt;&gt; Flushes all pending methods in the queue submits a method for execution." alt="" coords="455,137,596,178"/><area shape="rect" id="node8" href="../../de/d2f/group__tcmi__task__class.html#ga0409e631915b37fbcfe096dfc498bbbb" title="&lt;&lt;public&gt;&gt; Submits a method for execution." alt="" coords="438,203,613,229"/><area shape="rect" id="node9" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga2420f9c7c246746d3bbc87578357338f" title="&lt;&lt;public&gt;&gt; This method is registered by CCN or PEN component as the SIGUNUSED signal handler..." alt="" coords="458,254,593,295"/><area shape="rect" id="node11" href="../../de/d2f/group__tcmi__task__class.html#gade1e8f7b12614ca0fecbc40aaae9a6c5" title="&lt;&lt;public&gt;&gt; Process context accessor." alt="" coords="461,320,590,347"/><area shape="rect" id="node10" href="../../de/d2f/group__tcmi__task__class.html#gabc853647b7b732333c5909e617030f44" title="&lt;&lt;public&gt;&gt; Process context setter." alt="" coords="661,261,816,288"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaf99c6402f3cf1ac0b25d9c396cd33e48"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long tcmi_mighooks_mig_mode </td>
          <td>(</td>
          <td class="paramtype">struct pt_regs *&#160;</td>
          <td class="paramname"><em>regs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; This hook is called upon SIGUNUSED delivery to a particular process. </p>
<p>All work is delegated to the task helper. The context passed onto the task helper is used for updating the TCMI task. Any potential migration request thus operates on the latest process context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*regs</td><td>- process context right before entering kernel mode. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00171">171</a> of file <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html">tcmi_mighooks.c</a>.</p>

<p>References <a class="el" href="../../dd/d82/kernel__2_86_833_81_2src_2tcmi_2task_2tcmi__taskhelper_8h_source.html#l00547">tcmi_taskhelper_do_mig_mode()</a>.</p>

<p>Referenced by <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00058">tcmi_mighooks_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga2420f9c7c246746d3bbc87578357338f" title="&lt;&lt;public&gt;&gt; This method is registered by CCN or PEN component as the SIGUNUSED signal handler...">tcmi_taskhelper_do_mig_mode</a>(regs);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaf99c6402f3cf1ac0b25d9c396cd33e48_cgraph.png" border="0" usemap="#dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaf99c6402f3cf1ac0b25d9c396cd33e48_cgraph" alt=""/></div>
<map name="dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaf99c6402f3cf1ac0b25d9c396cd33e48_cgraph" id="dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_gaf99c6402f3cf1ac0b25d9c396cd33e48_cgraph">
<area shape="rect" id="node2" href="../../d2/daf/group__tcmi__taskhelper__class.html#ga2420f9c7c246746d3bbc87578357338f" title="&lt;&lt;public&gt;&gt; This method is registered by CCN or PEN component as the SIGUNUSED signal handler..." alt="" coords="233,5,367,46"/><area shape="rect" id="node3" href="../../de/d2f/group__tcmi__task__class.html#gabc853647b7b732333c5909e617030f44" title="&lt;&lt;public&gt;&gt; Process context setter." alt="" coords="416,12,571,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gacba0b88eda0371f2be5be630a8ac24a0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long tcmi_mighooks_replace_proc_self_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00264">264</a> of file <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html">tcmi_mighooks.c</a>.</p>

<p>References <a class="el" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h_source.html#l00220">mdbg</a>.</p>

<p>Referenced by <a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c_source.html#l00058">tcmi_mighooks_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                                                                            {   </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> ( strncmp(<span class="stringliteral">&quot;/proc/self&quot;</span>,filename,10) == 0 ) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">int</span> len;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordtype">char</span> * tmp_result = __getname();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span> ( !(tmp_result) )</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">//len = sprintf((tmp_result), &quot;/proc/%d%s&quot;, tcmi_task_remote_pid(current-&gt;tcmi.tcmi_task), filename+10);</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        len = sprintf((tmp_result), <span class="stringliteral">&quot;/mnt/local/proc/self%s&quot;</span>, filename+10);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="../../de/d8f/kernel__2_86_833_81_2src_2dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Replaced open filename from %s to %s (len: %d)&quot;</span>, filename, (tmp_result), len);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        *result = tmp_result;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }   </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_08d237fc27d4ecd563f71c5d52f2fecc.html">sources</a></li><li class="navelem"><a class="el" href="../../dir_08cfbe165ea603e6d179ff1f702f26c2.html">kernel_3.7.1</a></li><li class="navelem"><a class="el" href="../../dir_54993795d38a4b0939659b8e486bb0f5.html">src</a></li><li class="navelem"><a class="el" href="../../dir_d6db29d45a6ebf6e3bfdbb75b7b3a396.html">tcmi</a></li><li class="navelem"><a class="el" href="../../dir_6ebfab4bea1a2dad3e790c18abe362e5.html">migration</a></li><li class="navelem"><a class="el" href="../../dd/df7/kernel__3_87_81_2src_2tcmi_2migration_2tcmi__mighooks_8c.html">tcmi_mighooks.c</a></li>
    <li class="footer">Generated on Mon Apr 1 2013 16:10:44 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
