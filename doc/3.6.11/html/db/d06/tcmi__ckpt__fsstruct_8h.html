<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: C:/CLONDIKE/clondike/sources/kernel_3.6.11/src/tcmi/ckpt/tcmi_ckpt_fsstruct.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
   <div id="projectbrief">Supported to Linux kernel 3.6.11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/d06/tcmi__ckpt__fsstruct_8h.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_ckpt_fsstruct.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/err.h&gt;</code><br/>
<code>#include &lt;linux/mount.h&gt;</code><br/>
<code>#include &lt;linux/fs.h&gt;</code><br/>
<code>#include &lt;linux/fs_struct.h&gt;</code><br/>
<code>#include &lt;linux/namei.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for tcmi_ckpt_fsstruct.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d2/d6c/tcmi__ckpt__fsstruct_8h__incl.png" border="0" usemap="#C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8h" alt=""/></div>
<map name="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8h" id="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8h">
<area shape="rect" id="node7" href="../../d6/db7/tcmi__ckpt_8h.html" title="a helper class that provides functionality to create a process checkpoint" alt="" coords="605,125,696,152"/><area shape="rect" id="node13" href="../../de/d64/tcmi__fdcache_8h.html" title="a helper class that allows caching of used file descriptors." alt="" coords="885,200,995,227"/><area shape="rect" id="node20" href="../../d2/def/arch__ids_8h.html" title="arch/arch_ids.h" alt="" coords="1019,200,1129,227"/><area shape="rect" id="node16" href="../../d6/d01/dbg_8h.html" title="a debugging and logging framework, based on mdbg library by Martin Kacer." alt="" coords="1107,275,1161,301"/></map>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/d4e/tcmi__ckpt__fsstruct_8h__dep__incl.png" border="0" usemap="#C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8hdep" alt=""/></div>
<map name="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8hdep" id="C_1_2CLONDIKE_2clondike_2sources_2kernel__3_86_811_2src_2tcmi_2ckpt_2tcmi__ckpt__fsstruct_8hdep">
<area shape="rect" id="node2" href="../../db/d70/tcmi__ckptcom_8c.html" title="Process checkpointing component." alt="" coords="5,125,203,181"/></map>
</div>
</div>
<p><a href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad65f0acd5657cfc139569bd3a8a01bd4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html#ad65f0acd5657cfc139569bd3a8a01bd4">tcmi_ckpt_fsstruct_write</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct task_struct *task)</td></tr>
<tr class="memdesc:ad65f0acd5657cfc139569bd3a8a01bd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Currently only current "pwd" of the process is migrated.  <a href="#ad65f0acd5657cfc139569bd3a8a01bd4">More...</a><br/></td></tr>
<tr class="separator:ad65f0acd5657cfc139569bd3a8a01bd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc97f7b27fc9e694976226d31836ad8a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html#abc97f7b27fc9e694976226d31836ad8a">tcmi_ckpt_fsstruct_read</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *ckpt, struct task_struct *task)</td></tr>
<tr class="memdesc:abc97f7b27fc9e694976226d31836ad8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads and resotres task's pwd.  <a href="#abc97f7b27fc9e694976226d31836ad8a">More...</a><br/></td></tr>
<tr class="separator:abc97f7b27fc9e694976226d31836ad8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="abc97f7b27fc9e694976226d31836ad8a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_fsstruct_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct task_struct *&#160;</td>
          <td class="paramname"><em>task</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Loads and resotres task's pwd. </p>
<p>It is assumed the task is already chrooted in its new root if required.</p>
<p>There are 3 basic cases: 1) (PEN) Migrated processes are running chrooted into the distributed file system 2) (PEN) Migrated processes are running in standard PEN fs and for shared files a distributed filesystem is used. Only file in this filesystem may be used by the process 3) (CCN) Process is migrated back to its UHN and it has to open real files in the fs (or files in distributed filesystem if option 2 is used)</p>
<p>Option 1) does not need any pwdmnt resolution as it is equal to new process current dir. Options 2&amp;3 need resolution of pwdmnt by pwd path. We do the resolution in all 3 options for simplicity. </p>

<p>Definition at line <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html#l00069">69</a> of file <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html">tcmi_ckpt_fsstruct.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00234">tcmi_ckpt_read()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    int32_t pwd_len, error = -EINVAL;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">char</span>* pwd = NULL;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">struct </span>path path;                           <span class="comment">//Changed struct nameidata to struct path for function kern_path and another  | by Jiri Rakosnik</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, &amp;pwd_len, <span class="keyword">sizeof</span>(pwd_len)) &lt; 0) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading from ckpt (fsstruct pwdlen)&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    pwd = kmalloc(pwd_len, GFP_KERNEL);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> ( !pwd )</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(ckpt, pwd, pwd_len) &lt; 0) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error reading from ckpt (fsstruct pwd)&quot;</span>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">/* Lookup path data */</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    error = kern_path(pwd, LOOKUP_FOLLOW, &amp;path);      <span class="comment">// Fix for kernel 3.x.x substitute function path_lookup to kerm_path by Jiri Rakosnik </span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> ( error ) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Cannot lookup path: %s&quot;</span>, pwd);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">/* Set current process pwd */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">//path_get(&amp;nd.path);</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    task-&gt;fs-&gt;pwd = path;                 <span class="comment">// Changed nd.path to path | by Jiri Rakosnik</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">//path_put(&amp;nd.path);</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Pwd set to path: %s&quot;</span>, pwd);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    kfree(pwd);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; exit0:</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    kfree(pwd);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../db/d06/tcmi__ckpt__fsstruct_8h_abc97f7b27fc9e694976226d31836ad8a_cgraph.png" border="0" usemap="#db/d06/tcmi__ckpt__fsstruct_8h_abc97f7b27fc9e694976226d31836ad8a_cgraph" alt=""/></div>
<map name="db/d06/tcmi__ckpt__fsstruct_8h_abc97f7b27fc9e694976226d31836ad8a_cgraph" id="db/d06/tcmi__ckpt__fsstruct_8h_abc97f7b27fc9e694976226d31836ad8a_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="217,5,327,32"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="377,5,522,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad65f0acd5657cfc139569bd3a8a01bd4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_fsstruct_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>ckpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct task_struct *&#160;</td>
          <td class="paramname"><em>task</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Currently only current "pwd" of the process is migrated. </p>
<p>If more data are required (like current mount point) extend it (though for current mount point we have to be careful as on PENs process may run chrooted into distributed FS)</p>
<p>: If process is in not "rooted" in root of root fs, we do not handle the migration properly. </p>

<p>Definition at line <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html#l00016">16</a> of file <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html">tcmi_ckpt_fsstruct.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00220">tcmi_ckpt_write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>.</p>
<div class="fragment"><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordtype">char</span>* pwd = NULL;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    int32_t pwdlen;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span> (!(page = __get_free_page(GFP_KERNEL))) {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate page for pwd pathname!&quot;</span>);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    pwd = d_path(&amp;task-&gt;fs-&gt;pwd, (<span class="keywordtype">char</span>*)page, PAGE_SIZE);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> ( IS_ERR(pwd) ) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to lookup pwd path!&quot;</span>);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    pwdlen = strlen(pwd)+1;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, &amp;pwdlen, <span class="keyword">sizeof</span>(pwdlen)) &lt; 0) {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing to checkpoint&quot;</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(ckpt, pwd, pwdlen) &lt; 0) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error writing to checkpoint&quot;</span>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Written pwd path: %s&quot;</span>, pwd);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; exit1:</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    kfree(pwd);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; exit0:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    free_page(page);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../db/d06/tcmi__ckpt__fsstruct_8h_ad65f0acd5657cfc139569bd3a8a01bd4_cgraph.png" border="0" usemap="#db/d06/tcmi__ckpt__fsstruct_8h_ad65f0acd5657cfc139569bd3a8a01bd4_cgraph" alt=""/></div>
<map name="db/d06/tcmi__ckpt__fsstruct_8h_ad65f0acd5657cfc139569bd3a8a01bd4_cgraph" id="db/d06/tcmi__ckpt__fsstruct_8h_ad65f0acd5657cfc139569bd3a8a01bd4_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="185,12,298,39"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="347,12,493,39"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_8f82a767cc51fe89d179736eabaccdf4.html">sources</a></li><li class="navelem"><a class="el" href="../../dir_a979464daf01ae794274baf94d64f269.html">kernel_3.6.11</a></li><li class="navelem"><a class="el" href="../../dir_9674632d8583b1c158c2b58e4b736b2e.html">src</a></li><li class="navelem"><a class="el" href="../../dir_2557c5da8d7f7af94de52d26fb33b5b8.html">tcmi</a></li><li class="navelem"><a class="el" href="../../dir_e8c2c6b553f823691c83fbbc4760cc3b.html">ckpt</a></li><li class="navelem"><a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h.html">tcmi_ckpt_fsstruct.h</a></li>
    <li class="footer">Generated on Sun May 12 2013 19:05:58 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
