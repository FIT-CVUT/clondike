<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: proxyfs_proxy_file class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
   <div id="projectbrief">Supported to Linux kernel 3.6.11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d8e/group__proxyfs__proxy__file__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">proxyfs_proxy_file class<div class="ingroups"><a class="el" href="../../d1/d14/group__proxyfs__file__class.html">proxyfs_file class</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This is used on between VFS and proxyfs_client task.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for proxyfs_proxy_file class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../da/d8e/group__proxyfs__proxy__file__class.png" border="0" alt="" usemap="#da_2d8e_2group____proxyfs____proxy____file____class"/>
<map name="da_2d8e_2group____proxyfs____proxy____file____class" id="da_2d8e_2group____proxyfs____proxy____file____class">
<area shape="rect" id="node1" href="../../d6/dfe/group__proxyfs__generic__proxy__file__class.html" title="This is used between VFS and proxyfs_client task for proxying generics." alt="" coords="352,5,504,46"/><area shape="rect" id="node3" href="../../d1/d8c/group__proxyfs__pipe__proxy__file__class.html" title="This is used between VFS and proxyfs_client task for proxying pipes." alt="" coords="361,70,495,111"/><area shape="rect" id="node4" href="../../d1/d14/group__proxyfs__file__class.html" title="This is used on between VFS and proxyfs_client task." alt="" coords="5,45,128,72"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:d6/dfe/group__proxyfs__generic__proxy__file__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfe/group__proxyfs__generic__proxy__file__class.html">proxyfs_generic_proxy_file class</a></td></tr>
<tr class="memdesc:d6/dfe/group__proxyfs__generic__proxy__file__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is used between VFS and proxyfs_client task for proxying generics. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d1/d8c/group__proxyfs__pipe__proxy__file__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d8c/group__proxyfs__pipe__proxy__file__class.html">proxyfs_pipe_proxy_file class</a></td></tr>
<tr class="memdesc:d1/d8c/group__proxyfs__pipe__proxy__file__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is used between VFS and proxyfs_client task for proxying pipes. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gab2e4bbb0b934c20b6ce5f0e834d400ea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gab2e4bbb0b934c20b6ce5f0e834d400ea">PROXYFS_PROXY_FILE</a>(arg)&#160;&#160;&#160;((struct proxyfs_proxy_file_t *)(arg))</td></tr>
<tr class="memdesc:gab2e4bbb0b934c20b6ce5f0e834d400ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Cast to struct proxyfs_proxy_file_t *  <a href="#gab2e4bbb0b934c20b6ce5f0e834d400ea">More...</a><br/></td></tr>
<tr class="separator:gab2e4bbb0b934c20b6ce5f0e834d400ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad733540f4f45cc23a1a323bd0f3bc551"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gad733540f4f45cc23a1a323bd0f3bc551">proxyfs_proxy_file_write_user</a> (struct proxyfs_proxy_file_t *proxyfile, const char *buf, size_t <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>)</td></tr>
<tr class="memdesc:gad733540f4f45cc23a1a323bd0f3bc551"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Write to file from user space buffer  <a href="#gad733540f4f45cc23a1a323bd0f3bc551">More...</a><br/></td></tr>
<tr class="separator:gad733540f4f45cc23a1a323bd0f3bc551"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaed9be391b9d0edca16db9a7cc57410b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gaed9be391b9d0edca16db9a7cc57410b4">proxyfs_proxy_file_read_user</a> (struct proxyfs_proxy_file_t *proxyfile, char *buf, size_t <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>)</td></tr>
<tr class="memdesc:gaed9be391b9d0edca16db9a7cc57410b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Read from file to user space buffer  <a href="#gaed9be391b9d0edca16db9a7cc57410b4">More...</a><br/></td></tr>
<tr class="separator:gaed9be391b9d0edca16db9a7cc57410b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0957a03255bb2c20e99bf5453e3ba03e"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e">proxyfs_proxy_file_wait_interruptible</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned status)</td></tr>
<tr class="memdesc:ga0957a03255bb2c20e99bf5453e3ba03e"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads from file to peer - reads from write buffer  <a href="#ga0957a03255bb2c20e99bf5453e3ba03e">More...</a><br/></td></tr>
<tr class="separator:ga0957a03255bb2c20e99bf5453e3ba03e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab5441b421f8ff6a78d75935d3a8abecc"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gab5441b421f8ff6a78d75935d3a8abecc">proxyfs_proxy_file_ioctl_user</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned int cmd, unsigned long arg)</td></tr>
<tr class="memdesc:gab5441b421f8ff6a78d75935d3a8abecc"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Call ioctl with arg in user space  <a href="#gab5441b421f8ff6a78d75935d3a8abecc">More...</a><br/></td></tr>
<tr class="separator:gab5441b421f8ff6a78d75935d3a8abecc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa9d851b7b5915f5a1d9649cab6a8abdd"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gaa9d851b7b5915f5a1d9649cab6a8abdd">proxyfs_file_poll</a> (struct file *file, struct poll_table_struct *wait)</td></tr>
<tr class="memdesc:gaa9d851b7b5915f5a1d9649cab6a8abdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Poll for VFS  <a href="#gaa9d851b7b5915f5a1d9649cab6a8abdd">More...</a><br/></td></tr>
<tr class="separator:gaa9d851b7b5915f5a1d9649cab6a8abdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga739e370e057295d11ec4a5d0f1994073"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga739e370e057295d11ec4a5d0f1994073">proxyfs_proxy_file_init</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga739e370e057295d11ec4a5d0f1994073"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct  <a href="#ga739e370e057295d11ec4a5d0f1994073">More...</a><br/></td></tr>
<tr class="separator:ga739e370e057295d11ec4a5d0f1994073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c4445187e166dccddc4893af9d53632"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga8c4445187e166dccddc4893af9d53632">proxyfs_proxy_file_destroy</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga8c4445187e166dccddc4893af9d53632"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct  <a href="#ga8c4445187e166dccddc4893af9d53632">More...</a><br/></td></tr>
<tr class="separator:ga8c4445187e166dccddc4893af9d53632"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac0acfce3dd7f0b3e2a10323343c2f6f0"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gac0acfce3dd7f0b3e2a10323343c2f6f0">proxyfs_proxy_file_wait_for_space_interruptible</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned space)</td></tr>
<tr class="memdesc:gac0acfce3dd7f0b3e2a10323343c2f6f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Interruptible wait for space in file  <a href="#gac0acfce3dd7f0b3e2a10323343c2f6f0">More...</a><br/></td></tr>
<tr class="separator:gac0acfce3dd7f0b3e2a10323343c2f6f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga786e04c56d3383d9a73bddd70ab6eae0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga786e04c56d3383d9a73bddd70ab6eae0">proxyfs_proxy_file_close</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga786e04c56d3383d9a73bddd70ab6eae0"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Close proxyfile  <a href="#ga786e04c56d3383d9a73bddd70ab6eae0">More...</a><br/></td></tr>
<tr class="separator:ga786e04c56d3383d9a73bddd70ab6eae0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad6c55519101a728f1fee6ac262975c78"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8e/group__proxyfs__proxy__file__class.html#gad6c55519101a728f1fee6ac262975c78">proxyfs_proxy_file_fsync</a> (struct proxyfs_proxy_file_t *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gad6c55519101a728f1fee6ac262975c78"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Fsync proxyfile and coresponding real file  <a href="#gad6c55519101a728f1fee6ac262975c78">More...</a><br/></td></tr>
<tr class="separator:gad6c55519101a728f1fee6ac262975c78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This is used on between VFS and proxyfs_client task. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gab2e4bbb0b934c20b6ce5f0e834d400ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROXYFS_PROXY_FILE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">arg</td><td>)</td>
          <td>&#160;&#160;&#160;((struct proxyfs_proxy_file_t *)(arg))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Cast to struct proxyfs_proxy_file_t * </p>

<p>Definition at line <a class="el" href="../../db/d4d/proxyfs__proxy__file_8h_source.html#l00084">84</a> of file <a class="el" href="../../db/d4d/proxyfs__proxy__file_8h_source.html">proxyfs_proxy_file.h</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00409">proxyfs_client_handle_dead_peer()</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00197">proxyfs_client_handle_msg()</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00313">proxyfs_client_open_proxy()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00109">proxyfs_proxy_file_read_to_peer()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00128">proxyfs_proxy_file_submit_read_to_peer()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00367">proxyfs_proxy_file_write_buf_info()</a>, and <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00084">proxyfs_proxy_file_write_from_peer()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa9d851b7b5915f5a1d9649cab6a8abdd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int proxyfs_file_poll </td>
          <td>(</td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct poll_table_struct *&#160;</td>
          <td class="paramname"><em>wait</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Poll for VFS </p>
<p>&lt;&lt;public&gt;&gt; Poll for VFS</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">*wait</td><td>- pointer to poll table</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- mask of file status </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00346">346</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00115">PROXYFS_FILE_CAN_READ</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00113">PROXYFS_FILE_CAN_WRITE</a>, and <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00046">proxyfs_file_get_status()</a>.</p>
<div class="fragment"><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">struct </span>proxyfs_proxy_file_t *proxyfile = file-&gt;private_data;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">unsigned</span> mask = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    poll_wait(file, &amp;proxyfile-&gt;waiting_procs, wait);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(proxyfile), <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga07424b1d364a4cb66460f2d9642b71d8" title="There is space in read buffer (read only state)">PROXYFS_FILE_CAN_READ</a> ) )</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        mask |= POLLIN | POLLRDNORM;   </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(proxyfile), <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gacab2930b6ceb0439f7a8237a20d7924b" title="There is space in write buffer (read only state)">PROXYFS_FILE_CAN_WRITE</a> ) )</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            mask |= POLLOUT | POLLWRNORM; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">return</span> mask;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_gaa9d851b7b5915f5a1d9649cab6a8abdd_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_gaa9d851b7b5915f5a1d9649cab6a8abdd_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_gaa9d851b7b5915f5a1d9649cab6a8abdd_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_gaa9d851b7b5915f5a1d9649cab6a8abdd_cgraph">
<area shape="rect" id="node2" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="168,85,323,112"/><area shape="rect" id="node3" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="371,5,528,32"/><area shape="rect" id="node4" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="396,56,503,83"/><area shape="rect" id="node6" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="382,107,517,149"/><area shape="rect" id="node7" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="372,173,527,200"/><area shape="rect" id="node5" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="577,56,714,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga786e04c56d3383d9a73bddd70ab6eae0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int proxyfs_proxy_file_close </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Close proxyfile </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on succes </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00268">268</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00211">minfo</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00089">MSG_CLOSE</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00109">MSG_CLOSE_RESP</a>, <a class="el" href="../../d8/d8b/proxyfs__peer_8h_source.html#l00053">PEER_CONNECTED</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00379">proxyfs_client_do_syscall()</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00117">PROXYFS_FILE_ALL_WRITTEN</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00076">proxyfs_file_get_file_ident()</a>, <a class="el" href="../../db/dbe/proxyfs__msg_8c_source.html#l00077">proxyfs_msg_new()</a>, <a class="el" href="../../d8/d8b/proxyfs__peer_8h_source.html#l00113">proxyfs_peer_get_state()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00146">proxyfs_proxy_file_wait_interruptible()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00234">proxyfs_fs_fdinode_release()</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg_resp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">long</span> rtn = -ERESTARTSYS;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    u_int32_t exitting = current-&gt;flags &amp; PF_EXITING;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Close proxy file requested. Ident: %lu Exitting: %d&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)), exitting );</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// We have to wait for a write buffer empty event..</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// TODO: however, if the peer connection is broken, this will never happen, and the close method will block.. what to do? Likely we should wait with some long timeout and then just break (or at least recheck connection)</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file">proxyfs_proxy_file_wait_interruptible</a>(<span class="keyword">self</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga4d01fcbb095821daa8adc7ea010e56b8" title="There are no data pending in write buffer (read only state)">PROXYFS_FILE_ALL_WRITTEN</a> ) == 0 ) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(ERR2, <span class="stringliteral">&quot;Closing of ident: %lu failed. Not all written&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">return</span> -ERESTARTSYS;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    msg = <a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor">proxyfs_msg_new</a>(<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga44dca88b5b5105e02e2db8aff8bae5ed" title="&lt;&lt;public&gt;&gt; msg_num for message which is send when closing file">MSG_CLOSE</a>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)), <span class="keyword">sizeof</span>(exitting), &amp;exitting); </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span>(msg != NULL){</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        msg_resp = <a class="code" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file">proxyfs_client_do_syscall</a>(<a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;task, <span class="keyword">self</span>, msg);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// What the fck?????</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span>( msg_resp == (<span class="keywordtype">void</span>*)<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#gae39a4d97bf64f21cba02de89bb73f92d" title="&lt;&lt;public&gt;&gt; msg_num for message which can be send as reply for MSG_CLOSE">MSG_CLOSE_RESP</a> )</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            rtn = 0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> ( rtn != 0 &amp;&amp; <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state">proxyfs_peer_get_state</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;peer) != <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#gga30b4ed2721f174baa3012a7c9a673f43af3d87f56116881c391433b49524cad57">PEER_CONNECTED</a>) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          <span class="comment">// Even if our remote syscall has failed, we have to pretend it succeded as the peer is no longer connected and there is no chance of further close success</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          rtn = 0;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Close proxy file request DONE, Res: %ld&quot;</span>, rtn);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> rtn;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_ga786e04c56d3383d9a73bddd70ab6eae0_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_ga786e04c56d3383d9a73bddd70ab6eae0_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_ga786e04c56d3383d9a73bddd70ab6eae0_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_ga786e04c56d3383d9a73bddd70ab6eae0_cgraph">
<area shape="rect" id="node2" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file" alt="" coords="181,115,352,141"/><area shape="rect" id="node7" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="841,187,975,229"/><area shape="rect" id="node14" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor" alt="" coords="203,392,330,419"/><area shape="rect" id="node13" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state" alt="" coords="624,325,781,352"/><area shape="rect" id="node16" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file" alt="" coords="425,275,551,317"/><area shape="rect" id="node3" href="../../d1/d14/group__proxyfs__file__class.html#ga09bf2c02a87032c44fd9872fa157bf8e" title="&lt;&lt;public&gt;&gt; Set file status" alt="" coords="411,5,565,32"/><area shape="rect" id="node4" href="../../d3/d52/group__proxyfs__peer__class.html#gadd03a0c5d82eb8400ef3e5b1babbef59" title="&lt;&lt;public&gt;&gt; Add message to sending queue" alt="" coords="407,56,569,83"/><area shape="rect" id="node5" href="../../da/ddf/group__proxyfs__task__class.html#gaa74f23008a777c38e461fa771869d14f" title="&lt;&lt;public&gt;&gt; Notifies task that there are data ready (either for writing/reading/both)" alt="" coords="421,107,555,149"/><area shape="rect" id="node6" href="../../d3/d9d/proxyfs__client_8c.html#a3f5b4cfa07e02953d2623d0d53c05d82" title="check_syscall_done" alt="" coords="418,224,558,251"/><area shape="rect" id="node8" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="625,275,780,301"/><area shape="rect" id="node9" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="829,253,987,280"/><area shape="rect" id="node10" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="855,304,961,331"/><area shape="rect" id="node12" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="831,355,985,381"/><area shape="rect" id="node11" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="1035,304,1173,331"/><area shape="rect" id="node15" href="../../db/dbe/proxyfs__msg_8c.html#a5235c4aa2ee920fc26ce339e7fd20a6f" title="Maximum message size." alt="" coords="401,392,575,419"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga8c4445187e166dccddc4893af9d53632"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxyfs_proxy_file_destroy </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>- pointer to uninitialized proxyfs_proxy_file_t structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00402">402</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00162">proxyfs_file_destroy()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00234">proxyfs_fs_fdinode_release()</a>.</p>
<div class="fragment"><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    wake_up( &amp; <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;waiting_procs );</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga5bbed7e844f5afab2fbd943457de4bf6" title="&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct">proxyfs_file_destroy</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>) );</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_ga8c4445187e166dccddc4893af9d53632_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_ga8c4445187e166dccddc4893af9d53632_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_ga8c4445187e166dccddc4893af9d53632_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_ga8c4445187e166dccddc4893af9d53632_cgraph">
<area shape="rect" id="node2" href="../../d1/d14/group__proxyfs__file__class.html#ga5bbed7e844f5afab2fbd943457de4bf6" title="&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct" alt="" coords="182,31,319,57"/><area shape="rect" id="node3" href="../../d4/d27/group__circ__buf__clas.html#ga36c9967179adece95b711ac84023b2a4" title="&lt;&lt;public&gt;&gt; Opossite function to circ_buf_init" alt="" coords="371,5,488,32"/><area shape="rect" id="node4" href="../../d3/d52/group__proxyfs__peer__class.html#ga0dc1598ce5116c8fe21c66b8b977ab4b" title="&lt;&lt;public&gt;&gt; Puts proxyfs_peer instance reference and on reaching zero destroys the instance..." alt="" coords="369,56,490,83"/><area shape="rect" id="node5" href="../../d6/d8e/group__kkc__sock__class.html#ga00d8b033d3e1118303e7b4c54c6aafe6" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="693,31,859,57"/><area shape="rect" id="node7" href="../../d6/d8e/group__kkc__sock__class.html#ga9f980056fbf3436596c4cfdf3913e85c" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="539,81,642,108"/><area shape="rect" id="node6" href="../../d6/d8e/group__kkc__sock__class.html#gadf1b231c727891d5ac2d32646d574931" title="&lt;&lt;public&gt;&gt; Peer socket name accessor." alt="" coords="911,31,1071,57"/><area shape="rect" id="node8" href="../../d5/ddf/group__kkc__arch__class.html#ga06049c969ae0324d0607f10db99af65c" title="&lt;&lt;public&gt;&gt; Decrements the reference counter on the module owning the architecture." alt="" coords="726,81,826,108"/><area shape="rect" id="node9" href="../../d6/d8e/group__kkc__sock__class.html#gac8e64f52015e75cb76a34c4b7e9ef176" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="691,132,861,159"/><area shape="rect" id="node10" href="../../d6/d8e/group__kkc__sock__class.html#ga3cae649f56c8f5fa18f755f6c7d53597" title="&lt;&lt;public&gt;&gt; Local socket name accessor." alt="" coords="909,132,1072,159"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gad6c55519101a728f1fee6ac262975c78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int proxyfs_proxy_file_fsync </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Fsync proxyfile and coresponding real file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on succes </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00308">308</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00091">MSG_FSYNC</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00111">MSG_FSYNC_RESP</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00379">proxyfs_client_do_syscall()</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00117">PROXYFS_FILE_ALL_WRITTEN</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00123">PROXYFS_FILE_CLOSED</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00076">proxyfs_file_get_file_ident()</a>, <a class="el" href="../../db/dbe/proxyfs__msg_8c_source.html#l00077">proxyfs_msg_new()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00146">proxyfs_proxy_file_wait_interruptible()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00257">proxyfs_fs_fdinode_fsync()</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg_resp;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">long</span> rtn = -ERESTARTSYS;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Fsync requested. Ident: %lu&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// empty write buf</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">switch</span> ( <a class="code" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file">proxyfs_proxy_file_wait_interruptible</a>(<span class="keyword">self</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga4d01fcbb095821daa8adc7ea010e56b8" title="There are no data pending in write buffer (read only state)">PROXYFS_FILE_ALL_WRITTEN</a> ) ) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Cannot fsync, interrupted. Ident: %lu&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">return</span> -ERESTARTSYS;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga0500df7efcc31d752a22e40d51ee2b80" title="The file is opened and both sides known about it.">PROXYFS_FILE_CLOSED</a>:</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Cannot fsync, already closed. Ident: %lu&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Fsync all written, may proceed&quot;</span>);      </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">// Otherwise process further</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Sending fsync request. Ident: %lu&quot;</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)));</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    msg = <a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor">proxyfs_msg_new</a>(<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga225b5499b870c6d6ce98c26e8a92c82d" title="&lt;&lt;public&gt;&gt; msg_num for message which is send when syncing file">MSG_FSYNC</a>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)), 0, NULL); </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(msg != NULL){</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        msg_resp = <a class="code" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file">proxyfs_client_do_syscall</a>(<a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;task, <span class="keyword">self</span>, msg);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span>( msg_resp == (<span class="keywordtype">void</span>*)<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga8f28952dd33558e4590ca29978cbb502" title="&lt;&lt;public&gt;&gt; msg_num for message which can be send as reply for MSG_FSYNC">MSG_FSYNC_RESP</a> )</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            rtn = 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">return</span> rtn;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_gad6c55519101a728f1fee6ac262975c78_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_gad6c55519101a728f1fee6ac262975c78_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_gad6c55519101a728f1fee6ac262975c78_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_gad6c55519101a728f1fee6ac262975c78_cgraph">
<area shape="rect" id="node2" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file" alt="" coords="181,115,352,141"/><area shape="rect" id="node7" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="841,187,975,229"/><area shape="rect" id="node14" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor" alt="" coords="203,308,330,335"/><area shape="rect" id="node16" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file" alt="" coords="425,275,551,317"/><area shape="rect" id="node3" href="../../d1/d14/group__proxyfs__file__class.html#ga09bf2c02a87032c44fd9872fa157bf8e" title="&lt;&lt;public&gt;&gt; Set file status" alt="" coords="411,5,565,32"/><area shape="rect" id="node4" href="../../d3/d52/group__proxyfs__peer__class.html#gadd03a0c5d82eb8400ef3e5b1babbef59" title="&lt;&lt;public&gt;&gt; Add message to sending queue" alt="" coords="407,56,569,83"/><area shape="rect" id="node5" href="../../da/ddf/group__proxyfs__task__class.html#gaa74f23008a777c38e461fa771869d14f" title="&lt;&lt;public&gt;&gt; Notifies task that there are data ready (either for writing/reading/both)" alt="" coords="421,107,555,149"/><area shape="rect" id="node6" href="../../d3/d9d/proxyfs__client_8c.html#a3f5b4cfa07e02953d2623d0d53c05d82" title="check_syscall_done" alt="" coords="418,224,558,251"/><area shape="rect" id="node8" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="625,275,780,301"/><area shape="rect" id="node13" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state" alt="" coords="624,325,781,352"/><area shape="rect" id="node9" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="829,253,987,280"/><area shape="rect" id="node10" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="855,304,961,331"/><area shape="rect" id="node12" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="831,355,985,381"/><area shape="rect" id="node11" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="1035,304,1173,331"/><area shape="rect" id="node15" href="../../db/dbe/proxyfs__msg_8c.html#a5235c4aa2ee920fc26ce339e7fd20a6f" title="Maximum message size." alt="" coords="401,341,575,368"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga739e370e057295d11ec4a5d0f1994073"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int proxyfs_proxy_file_init </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>- pointer to uninitialized proxyfs_proxy_file_t structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00383">383</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00136">proxyfs_file_init()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00313">proxyfs_client_open_proxy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;{</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">int</span> rtn;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span>( (rtn = <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga104071e772f98e9a9151a6f9eaff5cfa" title="&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct">proxyfs_file_init</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>) )) == 0 ){</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        sema_init(&amp; <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;write_buf_sem, 1);        <span class="comment">// Replaced init_MUTEX macro to sema_init by Jiri Rakosnik</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        sema_init(&amp; <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;read_buf_sem, 1);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        init_waitqueue_head( &amp; <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;waiting_procs );</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;ops = &amp;proxy_file_ops;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> rtn;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_ga739e370e057295d11ec4a5d0f1994073_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_ga739e370e057295d11ec4a5d0f1994073_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_ga739e370e057295d11ec4a5d0f1994073_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_ga739e370e057295d11ec4a5d0f1994073_cgraph">
<area shape="rect" id="node2" href="../../d1/d14/group__proxyfs__file__class.html#ga104071e772f98e9a9151a6f9eaff5cfa" title="&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct" alt="" coords="206,31,317,57"/><area shape="rect" id="node3" href="../../d4/d27/group__circ__buf__clas.html#ga340b6d6ae954ce66d15dace7f7c54e61" title="circ_buf_init" alt="" coords="379,5,469,32"/><area shape="rect" id="node4" href="../../d4/d27/group__circ__buf__clas.html#ga36c9967179adece95b711ac84023b2a4" title="&lt;&lt;public&gt;&gt; Opossite function to circ_buf_init" alt="" coords="365,56,483,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gab5441b421f8ff6a78d75935d3a8abecc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long proxyfs_proxy_file_ioctl_user </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Call ioctl with arg in user space </p>
<p>&lt;&lt;public&gt;&gt; Call ioctl with arg in user space</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">cmd</td><td>- ioctl cmd </td></tr>
    <tr><td class="paramname">arg</td><td>- ioctl arg</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- return code of ioctl </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00190">190</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00057">proxyfs_msg_header::data</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00063">proxyfs_msg::header</a>, <a class="el" href="../../d1/dd7/proxyfs__ioctl_8h_source.html#l00011">IOCTL_ARG_SIZE</a>, <a class="el" href="../../d1/dd7/proxyfs__ioctl_8h_source.html#l00016">ioctl_get_info()</a>, <a class="el" href="../../d1/dd7/proxyfs__ioctl_8h_source.html#l00010">IOCTL_WILL_READ</a>, <a class="el" href="../../d1/dd7/proxyfs__ioctl_8h_source.html#l00009">IOCTL_WILL_WRITE</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00087">MSG_IOCTL</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00379">proxyfs_client_do_syscall()</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00117">PROXYFS_FILE_ALL_WRITTEN</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00123">PROXYFS_FILE_CLOSED</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00076">proxyfs_file_get_file_ident()</a>, <a class="el" href="../../db/dbe/proxyfs__msg_8c_source.html#l00077">proxyfs_msg_new()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00146">proxyfs_proxy_file_wait_interruptible()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00441">proxyfs_fs_fdinode_ioctl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ioctl_info;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg_resp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">size_t</span> arg_size;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">void</span> *ker_buf = NULL;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    u_int32_t command = cmd;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">long</span> rtn = -ERESTARTSYS;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    ioctl_info = <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#ae637eabe129538b62d3036da7d3af08a">ioctl_get_info</a>(cmd);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    arg_size = <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a0bc48cd9b9d7291051f0839179a94fdb">IOCTL_ARG_SIZE</a>(ioctl_info);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// Check access to memory </span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a4acf918819750ad5620a96e5d7421e35">IOCTL_WILL_READ</a>(ioctl_info) &amp;&amp; !access_ok(VERIFY_WRITE, (<span class="keywordtype">void</span>*)arg, arg_size) ){</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Bad read pointer&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a000a67ff749066fae84e65a90ba6afd4">IOCTL_WILL_WRITE</a>(ioctl_info) &amp;&amp; !access_ok(VERIFY_READ, (<span class="keywordtype">void</span>*)arg, arg_size) ){</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Bad write pointer&quot;</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// empty write buf</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">switch</span> ( <a class="code" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file">proxyfs_proxy_file_wait_interruptible</a>(<span class="keyword">self</span>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga4d01fcbb095821daa8adc7ea010e56b8" title="There are no data pending in write buffer (read only state)">PROXYFS_FILE_ALL_WRITTEN</a> ) ) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">return</span> -ERESTARTSYS;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga0500df7efcc31d752a22e40d51ee2b80" title="The file is opened and both sides known about it.">PROXYFS_FILE_CLOSED</a>:</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">// Otherwise process further</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a000a67ff749066fae84e65a90ba6afd4">IOCTL_WILL_WRITE</a>(ioctl_info) ){</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        ker_buf = kmalloc( arg_size + <span class="keyword">sizeof</span>(u_int32_t), GFP_KERNEL );</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span>( ker_buf == NULL ){</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Allocating memory for message data failed&quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        *(u_int32_t*)ker_buf = command;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>( __copy_from_user( ker_buf + <span class="keyword">sizeof</span>(u_int32_t), (<span class="keywordtype">void</span>*)arg, arg_size ) != 0 )</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        msg = <a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor">proxyfs_msg_new</a>(<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga8ac355ed0e800684c76ce1d208bbc3e7" title="&lt;&lt;public&gt;&gt; msg_num for ioctl message">MSG_IOCTL</a>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)), <span class="keyword">sizeof</span>(u_int32_t) + arg_size, ker_buf); </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span>(msg == NULL)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        msg = <a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor">proxyfs_msg_new</a>(<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga8ac355ed0e800684c76ce1d208bbc3e7" title="&lt;&lt;public&gt;&gt; msg_num for ioctl message">MSG_IOCTL</a>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)), <span class="keyword">sizeof</span>(u_int32_t), &amp;command); </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">if</span>(msg == NULL)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    msg_resp = <a class="code" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file">proxyfs_client_do_syscall</a>(<a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;task, <span class="keyword">self</span>, msg);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span>( msg_resp ){</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        rtn = msg_resp-&gt;<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#a881a537e78b1ef059ad37973c7d68ad8" title="Message header.">header</a>.<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#a0dc14840ae3ff0d871d55310094b32be" title="Open structure...">data</a>[0];</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a4acf918819750ad5620a96e5d7421e35">IOCTL_WILL_READ</a>(ioctl_info) ){</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">if</span>( __copy_to_user( (<span class="keywordtype">void</span>*)arg, &amp;msg_resp-&gt;<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#a881a537e78b1ef059ad37973c7d68ad8" title="Message header.">header</a>.<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#a0dc14840ae3ff0d871d55310094b32be" title="Open structure...">data</a>[1], arg_size ) != 0 )</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Copying result back failed&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        kfree( msg_resp );  </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="../../d1/dd7/proxyfs__ioctl_8h.html#a000a67ff749066fae84e65a90ba6afd4">IOCTL_WILL_WRITE</a>(ioctl_info) )</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        kfree(ker_buf);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> rtn;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;exit1:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    kfree(ker_buf);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;exit0:</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">return</span> -ERESTARTSYS;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_gab5441b421f8ff6a78d75935d3a8abecc_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_gab5441b421f8ff6a78d75935d3a8abecc_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_gab5441b421f8ff6a78d75935d3a8abecc_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_gab5441b421f8ff6a78d75935d3a8abecc_cgraph">
<area shape="rect" id="node2" href="../../d1/dd7/proxyfs__ioctl_8h.html#ae637eabe129538b62d3036da7d3af08a" title="ioctl_get_info" alt="" coords="217,5,316,32"/><area shape="rect" id="node3" href="../../d5/d8c/group__proxyfs__client__class.html#gaa45a08a64f9738ddf6126ed360c94cb7" title="&lt;&lt;public&gt;&gt; Forward a syscall on file" alt="" coords="181,183,352,209"/><area shape="rect" id="node8" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="841,123,975,165"/><area shape="rect" id="node15" href="../../dc/d71/group__proxyfs__msg__class.html#ga60323723423ceaadf6fe16da2243d9b8" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor" alt="" coords="203,344,330,371"/><area shape="rect" id="node17" href="../../da/d8e/group__proxyfs__proxy__file__class.html#ga0957a03255bb2c20e99bf5453e3ba03e" title="&lt;&lt;public&gt;&gt; Interruptible wait on file" alt="" coords="425,325,551,366"/><area shape="rect" id="node4" href="../../d1/d14/group__proxyfs__file__class.html#ga09bf2c02a87032c44fd9872fa157bf8e" title="&lt;&lt;public&gt;&gt; Set file status" alt="" coords="411,107,565,133"/><area shape="rect" id="node5" href="../../d3/d52/group__proxyfs__peer__class.html#gadd03a0c5d82eb8400ef3e5b1babbef59" title="&lt;&lt;public&gt;&gt; Add message to sending queue" alt="" coords="407,208,569,235"/><area shape="rect" id="node6" href="../../da/ddf/group__proxyfs__task__class.html#gaa74f23008a777c38e461fa771869d14f" title="&lt;&lt;public&gt;&gt; Notifies task that there are data ready (either for writing/reading/both)" alt="" coords="421,259,555,301"/><area shape="rect" id="node7" href="../../d3/d9d/proxyfs__client_8c.html#a3f5b4cfa07e02953d2623d0d53c05d82" title="check_syscall_done" alt="" coords="418,157,558,184"/><area shape="rect" id="node9" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="625,239,780,265"/><area shape="rect" id="node14" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state" alt="" coords="624,187,781,213"/><area shape="rect" id="node10" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="829,291,987,317"/><area shape="rect" id="node11" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="855,189,961,216"/><area shape="rect" id="node13" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="831,240,985,267"/><area shape="rect" id="node12" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="1035,189,1173,216"/><area shape="rect" id="node16" href="../../db/dbe/proxyfs__msg_8c.html#a5235c4aa2ee920fc26ce339e7fd20a6f" title="Maximum message size." alt="" coords="401,391,575,417"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaed9be391b9d0edca16db9a7cc57410b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int proxyfs_proxy_file_read_user </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Read from file to user space buffer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">*buf</td><td>- pointer to buffer in userspace </td></tr>
    <tr><td class="paramname">count</td><td>- size of data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of bytes read or error (negative number) </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00065">65</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d7/d05/proxyfs__msg_8h_source.html#l00105">MSG_WRITE_RESP</a>, <a class="el" href="../../d3/d9d/proxyfs__client_8c_source.html#l00400">proxyfs_client_send_message()</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00076">proxyfs_file_get_file_ident()</a>, <a class="el" href="../../db/dbe/proxyfs__msg_8c_source.html#l00098">proxyfs_msg_compose_new()</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00054">virtual_proxyfs_proxy_file_read_user()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00360">proxyfs_fs_fdinode_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#dd/d9d/structproxyfs__msg" title="Proxyfs message structure.">proxyfs_msg</a> *msg;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    u_int32_t read_count = <a class="code" href="../../d7/dd3/proxyfs__proxy__file_8c.html#a5b627881b4d10d07153deb9a28435bf9">virtual_proxyfs_proxy_file_read_user</a>(<span class="keyword">self</span>, buf, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    msg = <a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#gae386d833d535603242dfdff6e97cdc2f" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor">proxyfs_msg_compose_new</a>(<a class="code" href="../../dc/d71/group__proxyfs__msg__class.html#ga5018eba84874e3d11b71002e5f82035c" title="&lt;&lt;public&gt;&gt; msg_num for message which can be send as reply for MSG_WRITE">MSG_WRITE_RESP</a>, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier">proxyfs_file_get_file_ident</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)),</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keyword">sizeof</span>(u_int32_t), &amp;read_count, 0 );            </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="../../d5/d8c/group__proxyfs__client__class.html#ga0b7563077d76effeebc0b23f425d6716" title="&lt;&lt;public&gt;&gt; Asynchronously sends a message">proxyfs_client_send_message</a>( <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;task, <span class="keyword">self</span>, msg );</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> read_count;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_gaed9be391b9d0edca16db9a7cc57410b4_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_gaed9be391b9d0edca16db9a7cc57410b4_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_gaed9be391b9d0edca16db9a7cc57410b4_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_gaed9be391b9d0edca16db9a7cc57410b4_cgraph">
<area shape="rect" id="node2" href="../../d5/d8c/group__proxyfs__client__class.html#ga0b7563077d76effeebc0b23f425d6716" title="&lt;&lt;public&gt;&gt; Asynchronously sends a message" alt="" coords="206,5,343,46"/><area shape="rect" id="node4" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="207,70,342,111"/><area shape="rect" id="node5" href="../../dc/d71/group__proxyfs__msg__class.html#gae386d833d535603242dfdff6e97cdc2f" title="&lt;&lt;public&gt;&gt; Proxyfs message constructor" alt="" coords="181,136,368,163"/><area shape="rect" id="node6" href="../../d7/dd3/proxyfs__proxy__file_8c.html#a5b627881b4d10d07153deb9a28435bf9" title="virtual_proxyfs_proxy\l_file_read_user" alt="" coords="203,187,346,229"/><area shape="rect" id="node3" href="../../d3/d52/group__proxyfs__peer__class.html#gadd03a0c5d82eb8400ef3e5b1babbef59" title="&lt;&lt;public&gt;&gt; Add message to sending queue" alt="" coords="416,12,579,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac0acfce3dd7f0b3e2a10323343c2f6f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned proxyfs_proxy_file_wait_for_space_interruptible </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>space</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Interruptible wait for space in file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">space</td><td>- wanted amount of bytes</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- file status or zero if interrupted by signal </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00173">173</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d5/d08/buffer_8h_source.html#l00197">circ_buf_free_space()</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00046">proxyfs_file_get_status()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00275">proxyfs_fs_fdinode_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span>( wait_event_interruptible( <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;waiting_procs, </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <a class="code" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer">circ_buf_free_space</a>( &amp;<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;write_buf ) &gt;= space) == -ERESTARTSYS )</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>), 0xffffFFFF );</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_gac0acfce3dd7f0b3e2a10323343c2f6f0_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_gac0acfce3dd7f0b3e2a10323343c2f6f0_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_gac0acfce3dd7f0b3e2a10323343c2f6f0_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_gac0acfce3dd7f0b3e2a10323343c2f6f0_cgraph">
<area shape="rect" id="node2" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="651,24,789,51"/><area shape="rect" id="node3" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="243,75,397,102"/><area shape="rect" id="node4" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="445,24,603,51"/><area shape="rect" id="node5" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="471,75,577,102"/><area shape="rect" id="node6" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="457,126,591,168"/><area shape="rect" id="node7" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="447,192,601,219"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga0957a03255bb2c20e99bf5453e3ba03e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned proxyfs_proxy_file_wait_interruptible </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads from file to peer - reads from write buffer </p>
<p>&lt;&lt;public&gt;&gt; Reads from file to peer - reads from write buffer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">status</td><td>- status on which function returns</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- file status or zero if interrupted by signal </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00146">146</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d8/d8b/proxyfs__peer_8h_source.html#l00053">PEER_CONNECTED</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00099">PROXYFS_FILE</a>, <a class="el" href="../../d1/de9/proxyfs__file_8h_source.html#l00123">PROXYFS_FILE_CLOSED</a>, <a class="el" href="../../d6/d66/proxyfs__file_8c_source.html#l00046">proxyfs_file_get_status()</a>, <a class="el" href="../../d8/d8b/proxyfs__peer_8h_source.html#l00113">proxyfs_peer_get_state()</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00360">proxyfs_fs_fdinode_read()</a>, <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00275">proxyfs_fs_fdinode_write()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00268">proxyfs_proxy_file_close()</a>, <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00308">proxyfs_proxy_file_fsync()</a>, and <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00190">proxyfs_proxy_file_ioctl_user()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">unsigned</span> rtn = 0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;wait:   <span class="keywordflow">if</span> ( wait_event_interruptible( <a class="code" href="../../d0/dc1/proxyfs__server_8c.html#acffc38573c809dad4512ce637724ab7e">self</a>-&gt;waiting_procs, </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>), status ) ||</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state">proxyfs_peer_get_state</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;peer) != <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#gga30b4ed2721f174baa3012a7c9a673f43af3d87f56116881c391433b49524cad57">PEER_CONNECTED</a>) == -ERESTARTSYS) </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state">proxyfs_peer_get_state</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;peer) != <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#gga30b4ed2721f174baa3012a7c9a673f43af3d87f56116881c391433b49524cad57">PEER_CONNECTED</a> ) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Peer not connected in wait. Peer state: %d\n&quot;</span>, <a class="code" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state">proxyfs_peer_get_state</a>(<a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>)-&gt;peer));      </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga0500df7efcc31d752a22e40d51ee2b80" title="The file is opened and both sides known about it.">PROXYFS_FILE_CLOSED</a>; <span class="comment">// TODO: Or rather some BROKEN state?</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        rtn = <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>), status );</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Waiting on state: %u ... was interrupted in state %u\n&quot;</span>, status, <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status">proxyfs_file_get_status</a>( <a class="code" href="../../d1/d14/group__proxyfs__file__class.html#ga35d2463a834ca99968a077d96dd28ba8" title="Cast to struct proxyfs_file_t*.">PROXYFS_FILE</a>(<span class="keyword">self</span>), status ));</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span>( rtn &amp; status)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">return</span> rtn;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">goto</span> wait;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../da/d8e/group__proxyfs__proxy__file__class_ga0957a03255bb2c20e99bf5453e3ba03e_cgraph.png" border="0" usemap="#da/d8e/group__proxyfs__proxy__file__class_ga0957a03255bb2c20e99bf5453e3ba03e_cgraph" alt=""/></div>
<map name="da/d8e/group__proxyfs__proxy__file__class_ga0957a03255bb2c20e99bf5453e3ba03e_cgraph" id="da/d8e/group__proxyfs__proxy__file__class_ga0957a03255bb2c20e99bf5453e3ba03e_cgraph">
<area shape="rect" id="node2" href="../../d1/d14/group__proxyfs__file__class.html#gaf339a236eacb30281cf28cd69e943722" title="&lt;&lt;public&gt;&gt; Get file status" alt="" coords="183,85,337,112"/><area shape="rect" id="node8" href="../../d3/d52/group__proxyfs__peer__class.html#ga8947b90fdcf4dc5fbc4857d0d060bf2b" title="&lt;&lt;public&gt;&gt; Getter of peer state" alt="" coords="181,136,339,163"/><area shape="rect" id="node3" href="../../d4/d27/group__circ__buf__clas.html#ga7ad831f37b33980f97873c607e1838bd" title="&lt;&lt;public&gt;&gt; Returns maximum amount of free space which is continuos &#45; can by filled with one memcpy ca..." alt="" coords="387,5,544,32"/><area shape="rect" id="node4" href="../../d4/d27/group__circ__buf__clas.html#ga3004ef37f6c2f6542b3f65e54151e620" title="&lt;&lt;public&gt;&gt; get count of total data contained in the buffer" alt="" coords="412,56,519,83"/><area shape="rect" id="node6" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="398,107,533,149"/><area shape="rect" id="node7" href="../../d4/d27/group__circ__buf__clas.html#ga41d1f494f53a00e4654c8aedada9b046" title="&lt;&lt;public&gt;&gt; Returns maximum amount of data which are continuos &#45; can by copied with one memcpy call..." alt="" coords="388,173,543,200"/><area shape="rect" id="node5" href="../../d4/d27/group__circ__buf__clas.html#gab9f1d2fcd5ef64fc22c52fb44847e8a0" title="&lt;&lt;public&gt;&gt; get total free space in buffer" alt="" coords="593,56,730,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gad733540f4f45cc23a1a323bd0f3bc551"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int proxyfs_proxy_file_write_user </td>
          <td>(</td>
          <td class="paramtype">struct proxyfs_proxy_file_t *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Write to file from user space buffer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">*buf</td><td>- pointer to data in userspace </td></tr>
    <tr><td class="paramname">count</td><td>- size of data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of bytes written or error (negative number) </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html#l00048">48</a> of file <a class="el" href="../../d7/dd3/proxyfs__proxy__file_8c_source.html">proxyfs_proxy_file.c</a>.</p>

<p>References <a class="el" href="../../d0/dc1/virtual_8h_source.html#l00009">VIRTUAL_FUNC</a>.</p>

<p>Referenced by <a class="el" href="../../d4/dd9/proxyfs__fs_8c_source.html#l00275">proxyfs_fs_fdinode_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="../../d0/dc1/virtual_8h.html#a73a1f6479e17bb3acc879d0d0caeadaa">VIRTUAL_FUNC</a>(write_user, buf, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2013 19:06:04 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
