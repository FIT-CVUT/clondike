<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_ctlfs_file class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
   <div id="projectbrief">Supported to Linux kernel 3.6.11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/de7/group__tcmi__ctlfs__file__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_ctlfs_file class<div class="ingroups"><a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html">tcmi_ctlfs_entry class</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A file in the TCMI control file system is used to export object interfaces.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ctlfs_file class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d1/de7/group__tcmi__ctlfs__file__class.png" border="0" alt="" usemap="#d1_2de7_2group____tcmi____ctlfs____file____class"/>
<map name="d1_2de7_2group____tcmi____ctlfs____file____class" id="d1_2de7_2group____tcmi____ctlfs____file____class">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html" title="This class represents a generic entry in the tcmi control file system." alt="" coords="5,5,155,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:d0/d6c/structtcmi__ctlfs__file"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a></td></tr>
<tr class="memdesc:d0/d6c/structtcmi__ctlfs__file"><td class="mdescLeft">&#160;</td><td class="mdescRight">A file compound structure, extends the parent entry class.  <a href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">More...</a><br/></td></tr>
<tr class="separator:d0/d6c/structtcmi__ctlfs__file"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga62afce9d94cc308319a57e437928224f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f">TCMI_CTLFS_FILE</a>(e)&#160;&#160;&#160;((struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *)e)</td></tr>
<tr class="memdesc:ga62afce9d94cc308319a57e437928224f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Casts an entry to file.  <a href="#ga62afce9d94cc308319a57e437928224f">More...</a><br/></td></tr>
<tr class="separator:ga62afce9d94cc308319a57e437928224f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga6c67af9bc3bdb400ea6f664d464aa316"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316">tcmi_ctlfs_file_unreg_t</a> { <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gga6c67af9bc3bdb400ea6f664d464aa316a52b4e42cd4fd3958acda8d44c5c0ab7b">TCMI_CTLFS_FILE_REGULAR</a>, 
<a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gga6c67af9bc3bdb400ea6f664d464aa316a99f3a5eb7ee2e58abd8bd9323937ee6b">TCMI_CTLFS_FILE_FROM_METHOD</a>
 }</td></tr>
<tr class="memdesc:ga6c67af9bc3bdb400ea6f664d464aa316"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes the type of the file unregistration that is taking place.  <a href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316">More...</a><br/></td></tr>
<tr class="separator:ga6c67af9bc3bdb400ea6f664d464aa316"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafcb50575d3f6cc783130766295300741"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741">tcmi_ctlfs_genericfile_new</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *parent, mode_t <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77">mode</a>, void *object, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *read_method, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *write_method, int maxlen, proc_handler *proc_handler, const char namefmt[], va_list <a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#aa24f72e6a4d6a997528142211b375496">args</a>)</td></tr>
<tr class="memdesc:gafcb50575d3f6cc783130766295300741"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:  <a href="#gafcb50575d3f6cc783130766295300741">More...</a><br/></td></tr>
<tr class="separator:gafcb50575d3f6cc783130766295300741"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab6631117d63524adab7ac44fffecf48d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gab6631117d63524adab7ac44fffecf48d">tcmi_ctlfs_file_release</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *entry)</td></tr>
<tr class="memdesc:gab6631117d63524adab7ac44fffecf48d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; This method is used to free the data associated with the file.  <a href="#gab6631117d63524adab7ac44fffecf48d">More...</a><br/></td></tr>
<tr class="separator:gab6631117d63524adab7ac44fffecf48d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga329a1b3818c83d9f759a9aafff561e7d"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga329a1b3818c83d9f759a9aafff561e7d">tcmi_ctlfs_file_read</a> (struct file *filp, char __user *buf, size_t <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, loff_t *ppos)</td></tr>
<tr class="memdesc:ga329a1b3818c83d9f759a9aafff561e7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; The read file operation, called by the read system call.  <a href="#ga329a1b3818c83d9f759a9aafff561e7d">More...</a><br/></td></tr>
<tr class="separator:ga329a1b3818c83d9f759a9aafff561e7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8f323214eb55691b4f5a76bc08072aa8"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8f323214eb55691b4f5a76bc08072aa8">tcmi_ctlfs_file_write</a> (struct file *filp, const char __user *buf, size_t <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, loff_t *ppos)</td></tr>
<tr class="memdesc:ga8f323214eb55691b4f5a76bc08072aa8"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; The write file operation, called by the write system call.  <a href="#ga8f323214eb55691b4f5a76bc08072aa8">More...</a><br/></td></tr>
<tr class="separator:ga8f323214eb55691b4f5a76bc08072aa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddf76bb53a90657e6773b485e0a89248"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248">__tcmi_ctlfs_file_unregister</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaddf76bb53a90657e6773b485e0a89248"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is used when object associated with the file wants to unregister with the file.  <a href="#gaddf76bb53a90657e6773b485e0a89248">More...</a><br/></td></tr>
<tr class="separator:gaddf76bb53a90657e6773b485e0a89248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac720ca77312808db7cbbc645be8e3541"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac720ca77312808db7cbbc645be8e3541">tcmi_ctlfs_intfile_new</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *parent, mode_t <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77">mode</a>, void *object, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *read_method, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *write_method, int maxlen, const char namefmt[],...)</td></tr>
<tr class="memdesc:gac720ca77312808db7cbbc645be8e3541"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Creates a new integer file instance.  <a href="#gac720ca77312808db7cbbc645be8e3541">More...</a><br/></td></tr>
<tr class="separator:gac720ca77312808db7cbbc645be8e3541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeaa21c9f35d22ab9ea81f97a39ef3e95"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaeaa21c9f35d22ab9ea81f97a39ef3e95">tcmi_ctlfs_strfile_new</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *parent, mode_t <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77">mode</a>, void *object, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *read_method, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *write_method, int maxlen, const char namefmt[],...)</td></tr>
<tr class="memdesc:gaeaa21c9f35d22ab9ea81f97a39ef3e95"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Creates a new string file instance.  <a href="#gaeaa21c9f35d22ab9ea81f97a39ef3e95">More...</a><br/></td></tr>
<tr class="separator:gaeaa21c9f35d22ab9ea81f97a39ef3e95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c5ae69d807fe7b5f60bad8734915129"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga1c5ae69d807fe7b5f60bad8734915129">tcmi_ctlfs_rawfile_new</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *parent, mode_t <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77">mode</a>, void *object, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *read_method, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *write_method, int maxlen, const char namefmt[],...)</td></tr>
<tr class="memdesc:ga1c5ae69d807fe7b5f60bad8734915129"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Creates a raw file instance.  <a href="#ga1c5ae69d807fe7b5f60bad8734915129">More...</a><br/></td></tr>
<tr class="separator:ga1c5ae69d807fe7b5f60bad8734915129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c97fc25ab3bd060017a3539edf7d6f0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8c97fc25ab3bd060017a3539edf7d6f0">tcmi_ctlfs_file_unregister_prepare</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga8c97fc25ab3bd060017a3539edf7d6f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file.  <a href="#ga8c97fc25ab3bd060017a3539edf7d6f0">More...</a><br/></td></tr>
<tr class="separator:ga8c97fc25ab3bd060017a3539edf7d6f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga665210941a04fda118949874767ced93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93">tcmi_ctlfs_file_unregister</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga665210941a04fda118949874767ced93"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Unregisters the file.  <a href="#ga665210941a04fda118949874767ced93">More...</a><br/></td></tr>
<tr class="separator:ga665210941a04fda118949874767ced93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaead344003750e43cb4a0326876a191bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaead344003750e43cb4a0326876a191bc">tcmi_ctlfs_file_unregister2</a> (struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316">tcmi_ctlfs_file_unreg_t</a> unreg)</td></tr>
<tr class="memdesc:gaead344003750e43cb4a0326876a191bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Unregisters the file, advanced version  <a href="#gaead344003750e43cb4a0326876a191bc">More...</a><br/></td></tr>
<tr class="separator:gaead344003750e43cb4a0326876a191bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac6849f2eba3ed48a99a64189af02766d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac6849f2eba3ed48a99a64189af02766d">tcmi_ctlfs_file_lock_interruptible</a> (struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gac6849f2eba3ed48a99a64189af02766d"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal.  <a href="#gac6849f2eba3ed48a99a64189af02766d">More...</a><br/></td></tr>
<tr class="separator:gac6849f2eba3ed48a99a64189af02766d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5323f5b0f103dd3c42defc6c4494e641"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga5323f5b0f103dd3c42defc6c4494e641">tcmi_ctlfs_file_lock</a> (struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga5323f5b0f103dd3c42defc6c4494e641"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Locks this file instance.  <a href="#ga5323f5b0f103dd3c42defc6c4494e641">More...</a><br/></td></tr>
<tr class="separator:ga5323f5b0f103dd3c42defc6c4494e641"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad49b6ab401eeac4dab0ecd314796d569"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569">tcmi_ctlfs_file_unlock</a> (struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gad49b6ab401eeac4dab0ecd314796d569"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Unlocks this file instance.  <a href="#gad49b6ab401eeac4dab0ecd314796d569">More...</a><br/></td></tr>
<tr class="separator:gad49b6ab401eeac4dab0ecd314796d569"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga15bcf0f86a99e591cf1fca2e5eb243cf"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops">tcmi_ctlfs_ops</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga15bcf0f86a99e591cf1fca2e5eb243cf">tcmi_ctlfs_file_ops</a></td></tr>
<tr class="memdesc:ga15bcf0f86a99e591cf1fca2e5eb243cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">A file requires special entry operations to free all resources.  <a href="#ga15bcf0f86a99e591cf1fca2e5eb243cf">More...</a><br/></td></tr>
<tr class="separator:ga15bcf0f86a99e591cf1fca2e5eb243cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6911dc18604b7dee048e271144be65bb"><td class="memItemLeft" align="right" valign="top">static struct file_operations&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6911dc18604b7dee048e271144be65bb">tcmi_ctlfs_file_operations</a></td></tr>
<tr class="memdesc:ga6911dc18604b7dee048e271144be65bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">File operations for VFS.  <a href="#ga6911dc18604b7dee048e271144be65bb">More...</a><br/></td></tr>
<tr class="separator:ga6911dc18604b7dee048e271144be65bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16b2f7358650939f2f5d18cc906ba318"><td class="memItemLeft" align="right" valign="top">static struct inode_operations&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga16b2f7358650939f2f5d18cc906ba318">tcmi_ctlfs_file_inode_operations</a></td></tr>
<tr class="memdesc:ga16b2f7358650939f2f5d18cc906ba318"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inode operations for VFS, the only method getattr is taken from fs/libfs.c.  <a href="#ga16b2f7358650939f2f5d18cc906ba318">More...</a><br/></td></tr>
<tr class="separator:ga16b2f7358650939f2f5d18cc906ba318"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A file in the TCMI control file system is used to export object interfaces. </p>
<p>An object or a component creates a new control file for each method it wants to made available to the user space. The design idea is an extension of how linux sysctl works.</p>
<ul>
<li>When a user space application reads from a file, the associated object is notified by calling its registered method. The result is communicated back to user space. Similarly to sysctl, there are various data types that can be passed to the objects method. Their conversion from/to ascii is handled by special handlers.</li>
</ul>
<ul>
<li>When a user space program writes data to the file, the data is parsed by the TCMI file object and the binary form is passed on to the registered object's method.</li>
</ul>
<p>As in sysctl, following functions for parsing ascii input data are provided:</p>
<ul>
<li>string</li>
<li>an array of integers</li>
<li>in addition, a raw data can be passed into the method of the registered object.</li>
</ul>
<p>Based on this we can create three types of files:</p>
<ul>
<li>integer files - methods of file instantiators accept/return integer data. Conversion from/to ascii is handled internally by this class</li>
<li>string files - methods of file instantiators accept/return string data. String parsing (overflow checks, new lines conversion) is handled internally by this class.</li>
<li>raw files - methods of file instantiators accept raw data. No conversion is performed.</li>
</ul>
<p>The object that creates the control file, specifies maximum allowed data length as it is in sysctl.</p>
<p>To prevent code duplication, this class reuses the procfs functions(sysctl.c) - proc_dostring(), proc_dointvec() for ascii/binary conversions.</p>
<p>When the data is being passed to registered object's method, a mutual access guarantees integrity (implemented using mutex) </p>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="d0/d6c/structtcmi__ctlfs__file" id="d0/d6c/structtcmi__ctlfs__file"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ctlfs_file</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>A file compound structure, extends the parent entry class. </p>
<p>Contains a reference to the object whose read/write methods are to be called. </p>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00114">114</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ctlfs_file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../dd/dfa/structtcmi__ctlfs__file__coll__graph.png" border="0" usemap="#tcmi__ctlfs__file_coll__map" alt="Collaboration graph"/></div>
<map name="tcmi__ctlfs__file_coll__map" id="tcmi__ctlfs__file_coll__map">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure." alt="" coords="5,147,120,239"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops" title="entry operations that support polymorphism" alt="" coords="7,5,119,83"/></map>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aaadd449f3a276ee78742883a0e4ffb85"></a>void *</td>
<td class="fieldname">
data</td>
<td class="fielddoc">
storage for the data associated with the file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad374b788617e63b26129fe482f30448e"></a>struct semaphore</td>
<td class="fieldname">
f_sem</td>
<td class="fielddoc">
mutex semaphore to serialized the file access via read/write methods. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a81356428d247c2154015e0502ef4555d"></a>int</td>
<td class="fieldname">
maxlen</td>
<td class="fielddoc">
maximal data length. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="acaec43263d2efdee97246ff30ba0d367"></a>void *</td>
<td class="fieldname">
object</td>
<td class="fielddoc">
object that instantiated this file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a979339e98efa039c44247c16d10cf661"></a>proc_handler *</td>
<td class="fieldname">
proc_handler</td>
<td class="fielddoc">
data parsing handler (reused from sysctl). </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aee16a1f2ca593ac89422f5f88d7eead9"></a><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *</td>
<td class="fieldname">
read_method</td>
<td class="fielddoc">
read method that the file instantiator registers. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a09707052453a85bde8401bf1cc4c120c"></a>struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a></td>
<td class="fieldname">
super</td>
<td class="fielddoc">
parent class instance. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a3a22fb0b3925c7a95ea30ad06198ca29"></a>int</td>
<td class="fieldname">
unregistered</td>
<td class="fielddoc">
flag that indicates when the object unregisters with the file </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a70546b7f8fe1812ed6fd8691aafadbb7"></a><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *</td>
<td class="fieldname">
write_method</td>
<td class="fielddoc">
write method that the file instantiator registers. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga62afce9d94cc308319a57e437928224f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_CTLFS_FILE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">e</td><td>)</td>
          <td>&#160;&#160;&#160;((struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *)e)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Casts an entry to file. </p>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">140</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00447">__tcmi_ctlfs_file_unregister()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00321">tcmi_ctlfs_file_read()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00285">tcmi_ctlfs_file_release()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">tcmi_ctlfs_file_unregister()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00179">tcmi_ctlfs_file_unregister_prepare()</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00392">tcmi_ctlfs_file_write()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="ga6c67af9bc3bdb400ea6f664d464aa316"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316">tcmi_ctlfs_file_unreg_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Describes the type of the file unregistration that is taking place. </p>
<ul>
<li>regular way - is explicit file unregistration without using the file. This is requires locking the actual file, before unregistering its object.</li>
<li>from a method of the registered object - this is a special situation when the file is already locked (access is serialized by read/write file operations). Therefore, no locking is needed. </li>
</ul>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="gga6c67af9bc3bdb400ea6f664d464aa316a52b4e42cd4fd3958acda8d44c5c0ab7b"></a>TCMI_CTLFS_FILE_REGULAR</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="gga6c67af9bc3bdb400ea6f664d464aa316a99f3a5eb7ee2e58abd8bd9323937ee6b"></a>TCMI_CTLFS_FILE_FROM_METHOD</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00104">104</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;             {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gga6c67af9bc3bdb400ea6f664d464aa316a52b4e42cd4fd3958acda8d44c5c0ab7b">TCMI_CTLFS_FILE_REGULAR</a>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gga6c67af9bc3bdb400ea6f664d464aa316a99f3a5eb7ee2e58abd8bd9323937ee6b">TCMI_CTLFS_FILE_FROM_METHOD</a></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;} <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316" title="Describes the type of the file unregistration that is taking place.">tcmi_ctlfs_file_unreg_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaddf76bb53a90657e6773b485e0a89248"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __tcmi_ctlfs_file_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This method is used when object associated with the file wants to unregister with the file. </p>
<p>The calling object is responsible for waking up a user process currently using this file (e.g. that have it open and might be sleeping in the read/write methods of the object).</p>
<p>This method assumes, that the file lock is already held by the caller. A typical use can be when the file is supposed to destroy itself upon user reading from or writing into the file (from inside the registered object's methods).</p>
<p>The unregistration requires resetting read/write methods and associated proc_handler and object pointer. The unregistered flag ensures that the methods will be ignored on the next read/write issued by any user process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00447">447</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00123">tcmi_ctlfs_file::object</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00129">tcmi_ctlfs_file::proc_handler</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00125">tcmi_ctlfs_file::read_method</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00179">tcmi_ctlfs_file_unregister_prepare()</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00127">tcmi_ctlfs_file::write_method</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">tcmi_ctlfs_file_unregister()</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00181">tcmi_ctlfs_file_unregister2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;{</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *self_f = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (self_f) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">/* in case the object hasn&#39;t set the unregistered flag in advance */</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8c97fc25ab3bd060017a3539edf7d6f0" title="&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file.">tcmi_ctlfs_file_unregister_prepare</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        self_f-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#acaec43263d2efdee97246ff30ba0d367" title="object that instantiated this file.">object</a> = NULL;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        self_f-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aee16a1f2ca593ac89422f5f88d7eead9" title="read method that the file instantiator registers.">read_method</a> = NULL;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        self_f-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a70546b7f8fe1812ed6fd8691aafadbb7" title="write method that the file instantiator registers.">write_method</a> = NULL;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        self_f-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a> = NULL;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_gaddf76bb53a90657e6773b485e0a89248_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_gaddf76bb53a90657e6773b485e0a89248_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_gaddf76bb53a90657e6773b485e0a89248_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_gaddf76bb53a90657e6773b485e0a89248_cgraph">
<area shape="rect" id="node2" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8c97fc25ab3bd060017a3539edf7d6f0" title="&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file." alt="" coords="232,5,397,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga5323f5b0f103dd3c42defc6c4494e641"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_ctlfs_file_lock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Locks this file instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00209">209</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">tcmi_ctlfs_file_unregister()</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        down(&amp;self-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ad374b788617e63b26129fe482f30448e" title="mutex semaphore to serialized the file access via read/write methods.">f_sem</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac6849f2eba3ed48a99a64189af02766d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ctlfs_file_lock_interruptible </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00199">199</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00321">tcmi_ctlfs_file_read()</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00392">tcmi_ctlfs_file_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span> (down_interruptible(&amp;self-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ad374b788617e63b26129fe482f30448e" title="mutex semaphore to serialized the file access via read/write methods.">f_sem</a>));</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga329a1b3818c83d9f759a9aafff561e7d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t tcmi_ctlfs_file_read </td>
          <td>(</td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>filp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char __user *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t *&#160;</td>
          <td class="paramname"><em>ppos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; The read file operation, called by the read system call. </p>
<p>The access to the file associated data is serialized, so that the object method always receives consistent data.</p>
<ul>
<li>Read requests are possible only from offset (ppos) 0.</li>
<li>Initial check whether an object is already unregistered with the file is performed. This is to prevent calling the method when the the object is currently detaching from the file. The associated object might have already taken steps that don't allow calling the read method - E.g. has already woken up the sleeping process and doesn't want another process to call the method again.</li>
<li>The registered object is first sent a read request and data is returned</li>
<li>The data is then processed by the proc_handler. It is necessary to setup the ctl_table, so that the we can reuse the sysctl.c data parsing code for integers and strings.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*filp</td><td>- pointer to the kernel file object that is being read </td></tr>
    <tr><td class="paramname">*buf</td><td>- user buffer where to store the result </td></tr>
    <tr><td class="paramname">count</td><td>- number of bytes to be read </td></tr>
    <tr><td class="paramname">*ppos</td><td>- pointer to the current position in the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- when &gt;= 0 - number of bytes written, the result from the proc_handler is usually 0, just to denote success converting from binary to ascii when &lt; 0 - error </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00321">321</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d4/d2b/tcmi__npm__params_8c_source.html#l00017">count()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00132">tcmi_ctlfs_file::data</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00134">tcmi_ctlfs_file::maxlen</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00123">tcmi_ctlfs_file::object</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00129">tcmi_ctlfs_file::proc_handler</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00125">tcmi_ctlfs_file::read_method</a>, <a class="el" href="../../df/d2f/tcmi__ctlfs__entry_8h_source.html#l00124">TCMI_CTLFS_DENTRY_TO_ENTRY</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00199">tcmi_ctlfs_file_lock_interruptible()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00219">tcmi_ctlfs_file_unlock()</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00136">tcmi_ctlfs_file::unregistered</a>.</p>
<div class="fragment"><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;{</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *file = </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(<a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gabd32888576caebe57e30d25081d77698" title="Extracts the entry object from the dentry.">TCMI_CTLFS_DENTRY_TO_ENTRY</a>(filp-&gt;f_dentry));</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordtype">size_t</span> res;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    ssize_t error = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">struct </span>ctl_table tbl = {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        .data = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        .maxlen = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a>,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    };</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;file read in progress count=%lu, ppos=%Ld&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, *ppos);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac6849f2eba3ed48a99a64189af02766d" title="&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal...">tcmi_ctlfs_file_lock_interruptible</a>(file)) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        error = -ERESTARTSYS;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">/* when object unregistering is in progress don&#39;t start any operation */</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a3a22fb0b3925c7a95ea30ad06198ca29" title="flag that indicates when the object unregisters with the file">unregistered</a>)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">/* when trying from other position than 0, reset the file position and quit */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (*ppos) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        *ppos = 0;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aee16a1f2ca593ac89422f5f88d7eead9" title="read method that the file instantiator registers.">read_method</a>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> ((error = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aee16a1f2ca593ac89422f5f88d7eead9" title="read method that the file instantiator registers.">read_method</a>(file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#acaec43263d2efdee97246ff30ba0d367" title="object that instantiated this file.">object</a>, file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>)))</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a>) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment">/* res is in/out parameter, initially stores the number of requested bytes.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">         The handler then returns the number of bytes really processed */</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        res = <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span> ((error = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a>(&amp;tbl, 0, buf, &amp;res, ppos)))</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        error = (ssize_t)res;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; exit1:</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance.">tcmi_ctlfs_file_unlock</a>(file);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">/* signal arrived, semaphore still busy */</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; exit0: </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_ga329a1b3818c83d9f759a9aafff561e7d_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_ga329a1b3818c83d9f759a9aafff561e7d_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_ga329a1b3818c83d9f759a9aafff561e7d_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_ga329a1b3818c83d9f759a9aafff561e7d_cgraph">
<area shape="rect" id="node2" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="233,5,287,32"/><area shape="rect" id="node3" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac6849f2eba3ed48a99a64189af02766d" title="&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal..." alt="" coords="194,57,326,98"/><area shape="rect" id="node4" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance." alt="" coords="187,123,333,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gab6631117d63524adab7ac44fffecf48d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_ctlfs_file_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; This method is used to free the data associated with the file. </p>
<p>No explicit locking is needed since:</p>
<ul>
<li>the semaphore is already held by the unregister function or</li>
<li>the method of the registered object is currently executing and the file protects itself and this is an attempt to destroy the file from inside the object method.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*entry</td><td>- points to the file that is to be freed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon succes. </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00285">285</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00132">tcmi_ctlfs_file::data</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *file = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(entry);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Freeing file associated data(%p)&quot;</span>, file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    kfree(file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a> = NULL;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gad49b6ab401eeac4dab0ecd314796d569"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_ctlfs_file_unlock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">tcmi_ctlfs_file</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Unlocks this file instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00219">219</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00321">tcmi_ctlfs_file_read()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">tcmi_ctlfs_file_unregister()</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00392">tcmi_ctlfs_file_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        up(&amp;self-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ad374b788617e63b26129fe482f30448e" title="mutex semaphore to serialized the file access via read/write methods.">f_sem</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga665210941a04fda118949874767ced93"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcmi_ctlfs_file_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Unregisters the file. </p>
<p>&lt;&lt;public&gt;&gt; Unregisters the file.</p>
<p>This is the prefered way of detaching the file from an object. If the file is to unregister itself (e.g. from inside the registered object's methods), the previous version is recommended to prevent deadlocks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">155</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00447">__tcmi_ctlfs_file_unregister()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00209">tcmi_ctlfs_file_lock()</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00219">tcmi_ctlfs_file_unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../d2/de0/tcmi__ccnman_8c_source.html#l00258">tcmi_ccnman_stop_ctlfs_files()</a>, <a class="el" href="../../dd/d56/tcmi__ccnmigman_8c_source.html#l00161">tcmi_ccnmigman_stop_ctlfs_files()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00181">tcmi_ctlfs_file_unregister2()</a>, <a class="el" href="../../dd/dbd/tcmi__man_8c_source.html#l00276">tcmi_man_init_ctlfs_files()</a>, <a class="el" href="../../dd/dbd/tcmi__man_8c_source.html#l00341">tcmi_man_stop_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00404">tcmi_migman_init_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00472">tcmi_migman_stop_ctlfs_files()</a>, <a class="el" href="../../d0/d0f/tcmi__module_8c_source.html#l00168">tcmi_module_exit()</a>, <a class="el" href="../../d9/d86/tcmi__penman_8c_source.html#l00123">tcmi_penman_stop_ctlfs_files()</a>, <a class="el" href="../../d9/ded/tcmi__penmigman_8c_source.html#l00177">tcmi_penmigman_stop_ctlfs_files()</a>, <a class="el" href="../../da/d37/tcmi__sock_8c_source.html#l00058">tcmi_sock_new()</a>, <a class="el" href="../../da/d37/tcmi__sock_8c_source.html#l00128">tcmi_sock_put()</a>, and <a class="el" href="../../de/d84/tcmi__task_8c_source.html#l00211">tcmi_task_put()</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *self_f = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (self_f) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga5323f5b0f103dd3c42defc6c4494e641" title="&lt;&lt;public&gt;&gt; Locks this file instance.">tcmi_ctlfs_file_lock</a>(self_f);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248" title="This method is used when object associated with the file wants to unregister with the file...">__tcmi_ctlfs_file_unregister</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance.">tcmi_ctlfs_file_unlock</a>(self_f);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_ga665210941a04fda118949874767ced93_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_ga665210941a04fda118949874767ced93_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_ga665210941a04fda118949874767ced93_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_ga665210941a04fda118949874767ced93_cgraph">
<area shape="rect" id="node2" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248" title="This method is used when object associated with the file wants to unregister with the file..." alt="" coords="219,12,397,39"/><area shape="rect" id="node4" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga5323f5b0f103dd3c42defc6c4494e641" title="&lt;&lt;public&gt;&gt; Locks this file instance." alt="" coords="242,63,374,89"/><area shape="rect" id="node5" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance." alt="" coords="235,113,381,140"/><area shape="rect" id="node3" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8c97fc25ab3bd060017a3539edf7d6f0" title="&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file." alt="" coords="445,5,611,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaead344003750e43cb4a0326876a191bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcmi_ctlfs_file_unregister2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6c67af9bc3bdb400ea6f664d464aa316">tcmi_ctlfs_file_unreg_t</a>&#160;</td>
          <td class="paramname"><em>unreg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Unregisters the file, advanced version </p>
<p>&lt;&lt;public&gt;&gt; Unregisters the file, advanced version</p>
<p>It is typically used if owning object uses this file is for unregistering other files including this file. All work is delegate to either <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248" title="This method is used when object associated with the file wants to unregister with the file...">__tcmi_ctlfs_file_unregister()</a> or <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93" title="&lt;&lt;public&gt;&gt; This method unregisters the file uses the semaphore lock as protection from races...">tcmi_ctlfs_file_unregister()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
    <tr><td class="paramname">unreg</td><td>- describes a unregistration type, if a regular shutdown is requested, the file is unregistered using the lock version. A file unregistrationn from inside the registered object's method requires using a lock free version. The access to the file is already serialized. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00181">181</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00447">__tcmi_ctlfs_file_unregister()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00106">TCMI_CTLFS_FILE_FROM_METHOD</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00155">tcmi_ctlfs_file_unregister()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00472">tcmi_migman_stop_ctlfs_files()</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">/* unregistration issued from owning object&#39;s method, no locking */</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (unreg == <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gga6c67af9bc3bdb400ea6f664d464aa316a99f3a5eb7ee2e58abd8bd9323937ee6b">TCMI_CTLFS_FILE_FROM_METHOD</a>)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248" title="This method is used when object associated with the file wants to unregister with the file...">__tcmi_ctlfs_file_unregister</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">/* default case - explicit unregistration , requires locking*/</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93" title="&lt;&lt;public&gt;&gt; This method unregisters the file uses the semaphore lock as protection from races...">tcmi_ctlfs_file_unregister</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_gaead344003750e43cb4a0326876a191bc_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_gaead344003750e43cb4a0326876a191bc_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_gaead344003750e43cb4a0326876a191bc_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_gaead344003750e43cb4a0326876a191bc_cgraph">
<area shape="rect" id="node2" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gaddf76bb53a90657e6773b485e0a89248" title="This method is used when object associated with the file wants to unregister with the file..." alt="" coords="440,12,619,39"/><area shape="rect" id="node4" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93" title="&lt;&lt;public&gt;&gt; This method unregisters the file uses the semaphore lock as protection from races..." alt="" coords="227,63,392,89"/><area shape="rect" id="node3" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8c97fc25ab3bd060017a3539edf7d6f0" title="&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file." alt="" coords="667,5,832,46"/><area shape="rect" id="node5" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga5323f5b0f103dd3c42defc6c4494e641" title="&lt;&lt;public&gt;&gt; Locks this file instance." alt="" coords="463,63,595,89"/><area shape="rect" id="node6" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance." alt="" coords="456,113,603,140"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga8c97fc25ab3bd060017a3539edf7d6f0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_ctlfs_file_unregister_prepare </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Sets the unregistered flag of the file. </p>
<p>This is used when the associated object is about to unregister from the file. However, the object needs to be guaranteed that from now on, no new process will send him a read/write message. This is exactly what the unregistered flag does.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this file instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga665210941a04fda118949874767ced93" title="&lt;&lt;public&gt;&gt; This method unregisters the file uses the semaphore lock as protection from races...">tcmi_ctlfs_file_unregister()</a> </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00179">179</a> of file <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html">tcmi_ctlfs_file.h</a>.</p>

<p>References <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00447">__tcmi_ctlfs_file_unregister()</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(<span class="keyword">self</span>)-&gt;unregistered = 1;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga8f323214eb55691b4f5a76bc08072aa8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t tcmi_ctlfs_file_write </td>
          <td>(</td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>filp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char __user *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t *&#160;</td>
          <td class="paramname"><em>ppos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; The write file operation, called by the write system call. </p>
<p>The access to the file associated data is serialized, so that the object method always receives consistent data.</p>
<ul>
<li>Initial check whether an object is already unregistered with the file is performed. This is to prevent calling the method when the the object is currently detaching from the file. The associated object might have already taken steps that don't allow calling the write method - E.g. has already woken up the sleeping process and doesn't want another process to call the method again.</li>
<li>The requested file offset can be arbitrary, but must not exceed the size of the data assoicated with the file - handled by the proc_handler</li>
<li>The data is first processed by the proc_handler. It is necessary to setup the ctl_table, so that the we can reuse the sysctl.c data parsing code for integers and strings.</li>
<li>Finally, the registered object is notified about the write event and the data is passed to it.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*filp</td><td>- pointer to the kernel file object that is being written </td></tr>
    <tr><td class="paramname">*buf</td><td>- user buffer where to take the source data </td></tr>
    <tr><td class="paramname">count</td><td>- number of bytes to be written </td></tr>
    <tr><td class="paramname">*ppos</td><td>- pointer to the current position in the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- when &gt;= 0 - number of bytes written, the result from the proc_handler is usually 0, just to denote success converting the ascii data to binary when &lt; 0 - error </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00392">392</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d4/d2b/tcmi__npm__params_8c_source.html#l00017">count()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00132">tcmi_ctlfs_file::data</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00134">tcmi_ctlfs_file::maxlen</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00123">tcmi_ctlfs_file::object</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00129">tcmi_ctlfs_file::proc_handler</a>, <a class="el" href="../../df/d2f/tcmi__ctlfs__entry_8h_source.html#l00124">TCMI_CTLFS_DENTRY_TO_ENTRY</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00140">TCMI_CTLFS_FILE</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00199">tcmi_ctlfs_file_lock_interruptible()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00219">tcmi_ctlfs_file_unlock()</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00136">tcmi_ctlfs_file::unregistered</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00127">tcmi_ctlfs_file::write_method</a>.</p>
<div class="fragment"><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;{</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *file = </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga62afce9d94cc308319a57e437928224f" title="Casts an entry to file.">TCMI_CTLFS_FILE</a>(<a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gabd32888576caebe57e30d25081d77698" title="Extracts the entry object from the dentry.">TCMI_CTLFS_DENTRY_TO_ENTRY</a>(filp-&gt;f_dentry));</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">size_t</span> res;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    ssize_t error = 0;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">struct </span>ctl_table tbl = {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        .data = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        .maxlen = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a>,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    };</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;file write in progress count=%lu, ppos=%Ld&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, *ppos);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac6849f2eba3ed48a99a64189af02766d" title="&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal...">tcmi_ctlfs_file_lock_interruptible</a>(file)) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        error = -ERESTARTSYS;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">/* when object unregistering is in progress don&#39;t start any operation */</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a3a22fb0b3925c7a95ea30ad06198ca29" title="flag that indicates when the object unregisters with the file">unregistered</a>)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a>) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        res = <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">if</span> ((error = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a>(&amp;tbl, 1, (<span class="keywordtype">char</span> __user *)buf, &amp;res, ppos)))</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a70546b7f8fe1812ed6fd8691aafadbb7" title="write method that the file instantiator registers.">write_method</a>) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> ((error = file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a70546b7f8fe1812ed6fd8691aafadbb7" title="write method that the file instantiator registers.">write_method</a>(file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#acaec43263d2efdee97246ff30ba0d367" title="object that instantiated this file.">object</a>, file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>)))</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        error = (ssize_t)res;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; exit1:</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance.">tcmi_ctlfs_file_unlock</a>(file);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">/* signal arrived, semaphore still busy */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; exit0: </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_ga8f323214eb55691b4f5a76bc08072aa8_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_ga8f323214eb55691b4f5a76bc08072aa8_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_ga8f323214eb55691b4f5a76bc08072aa8_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_ga8f323214eb55691b4f5a76bc08072aa8_cgraph">
<area shape="rect" id="node2" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="235,5,290,32"/><area shape="rect" id="node3" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gac6849f2eba3ed48a99a64189af02766d" title="&lt;&lt;public&gt;&gt; Locks this file instance, interruptible version, the process can be woken up by a signal..." alt="" coords="197,57,329,98"/><area shape="rect" id="node4" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gad49b6ab401eeac4dab0ecd314796d569" title="&lt;&lt;public&gt;&gt; Unlocks this file instance." alt="" coords="189,123,336,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gafcb50575d3f6cc783130766295300741"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a>* tcmi_ctlfs_genericfile_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>read_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>write_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">proc_handler *&#160;</td>
          <td class="paramname"><em>proc_handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>namefmt</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows: </p>
<ul>
<li>allocates a new instance and delegates the entry initialization to the parent class. There is a custom <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops" title="entry operations that support polymorphism">tcmi_ctlfs_ops</a> vector as file destruction needs special handling. There are also file and inode specific operations.</li>
<li>allocates file associated data</li>
<li>registers the object and its 2 methods with the file. None of the methods are mandatory</li>
<li>there is a custom entry_free operation that releases the above allocated file data upon file destruction</li>
<li>proc_handler is associated with the data, so that ascii data can be parsed when passing from/to the object's read/write method</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*parent</td><td>- pointer to the parent entry - has to be a directory </td></tr>
    <tr><td class="paramname">*mode</td><td>- access rights for the inode </td></tr>
    <tr><td class="paramname">*object</td><td>- points to the object that creates the file </td></tr>
    <tr><td class="paramname">*read_method</td><td>- method of the file creator that will be called upon file read </td></tr>
    <tr><td class="paramname">*write_method</td><td>- method of the file creator that will be called upon file write </td></tr>
    <tr><td class="paramname">maxlen</td><td>- maximum length of the data in bytes </td></tr>
    <tr><td class="paramname">*proc_handler</td><td>- data parsing handler that does the conversion from/to ascii </td></tr>
    <tr><td class="paramname">namefmt</td><td>- nameformat string (printf style) </td></tr>
    <tr><td class="paramname">args</td><td>- arguments to the format string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the new file or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">225</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00132">tcmi_ctlfs_file::data</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00120">tcmi_ctlfs_file::f_sem</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00134">tcmi_ctlfs_file::maxlen</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00123">tcmi_ctlfs_file::object</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00129">tcmi_ctlfs_file::proc_handler</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00125">tcmi_ctlfs_file::read_method</a>, <a class="el" href="../../df/d2f/tcmi__ctlfs__entry_8h_source.html#l00126">TCMI_CTLFS_ENTRY</a>, <a class="el" href="../../df/d1c/tcmi__ctlfs__entry_8c_source.html#l00066">tcmi_ctlfs_entry_init()</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00471">tcmi_ctlfs_file_inode_operations</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00465">tcmi_ctlfs_file_operations</a>, <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00461">tcmi_ctlfs_file_ops</a>, <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00136">tcmi_ctlfs_file::unregistered</a>, and <a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h_source.html#l00127">tcmi_ctlfs_file::write_method</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00063">tcmi_ctlfs_intfile_new()</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00100">tcmi_ctlfs_strfile_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a> *file;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Creating new file&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (!(file = kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file" title="A file compound structure, extends the parent entry class.">tcmi_ctlfs_file</a>), GFP_ATOMIC))) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to allocate memory for file&quot;</span>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry.">tcmi_ctlfs_entry_init</a>(<a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga9d0f1b0d82e9c3872aa08724a9be306b" title="Casts a child entry to the super class.">TCMI_CTLFS_ENTRY</a>(file), </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                  <a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga9d0f1b0d82e9c3872aa08724a9be306b" title="Casts a child entry to the super class.">TCMI_CTLFS_ENTRY</a>(parent), </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                  S_IFREG | <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77" title="access mode for the file">mode</a>, </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                  &amp;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga15bcf0f86a99e591cf1fca2e5eb243cf" title="A file requires special entry operations to free all resources.">tcmi_ctlfs_file_ops</a>, </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                  &amp;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga16b2f7358650939f2f5d18cc906ba318" title="Inode operations for VFS, the only method getattr is taken from fs/libfs.c.">tcmi_ctlfs_file_inode_operations</a>,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                  &amp;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga6911dc18604b7dee048e271144be65bb" title="File operations for VFS.">tcmi_ctlfs_file_operations</a>, namefmt, <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#aa24f72e6a4d6a997528142211b375496" title="Arrays of args and envps.">args</a>)) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to create the file&quot;</span>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">goto</span> exit1;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (!(file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a> = kmalloc(<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a>, GFP_ATOMIC))) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed to allocate %d bytes of file data&quot;</span>, <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">goto</span> exit2;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a> = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a81356428d247c2154015e0502ef4555d" title="maximal data length.">maxlen</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    sema_init(&amp;file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ad374b788617e63b26129fe482f30448e" title="mutex semaphore to serialized the file access via read/write methods.">f_sem</a>, 1); <span class="comment">//Replaced macro init_MUTEX to sema_init for kernel 3.x.x | by Jiri Rakosnik</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">/* object associated with the file */</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#acaec43263d2efdee97246ff30ba0d367" title="object that instantiated this file.">object</a> = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#acaec43263d2efdee97246ff30ba0d367" title="object that instantiated this file.">object</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aee16a1f2ca593ac89422f5f88d7eead9" title="read method that the file instantiator registers.">read_method</a> = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aee16a1f2ca593ac89422f5f88d7eead9" title="read method that the file instantiator registers.">read_method</a>; <span class="comment">/*TESTING */</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a70546b7f8fe1812ed6fd8691aafadbb7" title="write method that the file instantiator registers.">write_method</a> = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a70546b7f8fe1812ed6fd8691aafadbb7" title="write method that the file instantiator registers.">write_method</a>; <span class="comment">/*TESTING */</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a> = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a979339e98efa039c44247c16d10cf661" title="data parsing handler (reused from sysctl).">proc_handler</a>; <span class="comment">/* TESTING */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">/* indicates a valid object has registered with the file */</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#a3a22fb0b3925c7a95ea30ad06198ca29" title="flag that indicates when the object unregisters with the file">unregistered</a> = 0; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga9d0f1b0d82e9c3872aa08724a9be306b" title="Casts a child entry to the super class.">TCMI_CTLFS_ENTRY</a>(file);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; exit2:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    kfree(file-&gt;<a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#aaadd449f3a276ee78742883a0e4ffb85" title="storage for the data associated with the file.">data</a>);   </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; exit1:</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    kfree(file);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; exit0:</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_gafcb50575d3f6cc783130766295300741_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_gafcb50575d3f6cc783130766295300741_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_gafcb50575d3f6cc783130766295300741_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_gafcb50575d3f6cc783130766295300741_cgraph">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="227,81,365,108"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="415,5,569,32"/><area shape="rect" id="node4" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga4fbd3f1c3789bd79d4e2c684fc08d1a2" title="&lt;&lt;private&gt;&gt; Checks whether a directory entry contains entry of the specified name" alt="" coords="414,56,570,83"/><area shape="rect" id="node5" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="421,107,563,133"/><area shape="rect" id="node6" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaeeb7fba5f385c90d93878a60a4dcf1dc" title="&lt;&lt;private&gt;&gt; The new dentry is allocated based on the parent&#39;s dentry and the current name of the ..." alt="" coords="418,158,566,199"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac720ca77312808db7cbbc645be8e3541"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a>* tcmi_ctlfs_intfile_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>read_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>write_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>namefmt</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Creates a new integer file instance. </p>
<p>&lt;&lt;public&gt;&gt; Creates a new integer file instance.</p>
<p>The file will be used as an interface of the registered object to the user space. It allows calling object methods and pass integer numbers as arguments in ascii form.</p>
<p>For conversion ascii&lt;-&gt;integer, the proc_dointvec() function is used from kernel/sysctl.c</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*parent</td><td>- pointer to the parent entry - has to be a directory </td></tr>
    <tr><td class="paramname">*mode</td><td>- access rights for the inode </td></tr>
    <tr><td class="paramname">*object</td><td>- points to the object that creates the file </td></tr>
    <tr><td class="paramname">*read_method</td><td>- method of the file creator that will be called upon file read </td></tr>
    <tr><td class="paramname">*write_method</td><td>- method of the file creator that will be called upon file write </td></tr>
    <tr><td class="paramname">maxlen</td><td>- maximum length of the data in bytes </td></tr>
    <tr><td class="paramname">namefmt</td><td>- nameformat string (printf style) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the new file or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00063">63</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d9/d10/tcmi__npm__params_8h_source.html#l00052">args</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">tcmi_ctlfs_genericfile_new()</a>.</p>

<p>Referenced by <a class="el" href="../../d2/de0/tcmi__ccnman_8c_source.html#l00159">tcmi_ccnman_init_ctlfs_files()</a>, <a class="el" href="../../dd/d56/tcmi__ccnmigman_8c_source.html#l00137">tcmi_ccnmigman_init_ctlfs_files()</a>, <a class="el" href="../../dd/dbd/tcmi__man_8c_source.html#l00276">tcmi_man_init_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00404">tcmi_migman_init_ctlfs_files()</a>, <a class="el" href="../../d0/d0f/tcmi__module_8c_source.html#l00122">tcmi_module_init()</a>, <a class="el" href="../../d9/ded/tcmi__penmigman_8c_source.html#l00154">tcmi_penmigman_init_ctlfs_files()</a>, <a class="el" href="../../de/d84/tcmi__task_8c_source.html#l00114">tcmi_task_init()</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure.">tcmi_ctlfs_entry</a> *file;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    va_list <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#aa24f72e6a4d6a997528142211b375496" title="Arrays of args and envps.">args</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    va_start(args, namefmt);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    file = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:">tcmi_ctlfs_genericfile_new</a>(parent, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77" title="access mode for the file">mode</a>, <span class="keywordtype">object</span>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                      read_method, write_method,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                      maxlen, proc_dointvec, namefmt, args);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    va_end(args);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> file;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_gac720ca77312808db7cbbc645be8e3541_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_gac720ca77312808db7cbbc645be8e3541_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_gac720ca77312808db7cbbc645be8e3541_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_gac720ca77312808db7cbbc645be8e3541_cgraph">
<area shape="rect" id="node2" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="200,81,373,108"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="421,81,560,108"/><area shape="rect" id="node4" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="610,5,763,32"/><area shape="rect" id="node5" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga4fbd3f1c3789bd79d4e2c684fc08d1a2" title="&lt;&lt;private&gt;&gt; Checks whether a directory entry contains entry of the specified name" alt="" coords="609,56,765,83"/><area shape="rect" id="node6" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="616,107,757,133"/><area shape="rect" id="node7" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaeeb7fba5f385c90d93878a60a4dcf1dc" title="&lt;&lt;private&gt;&gt; The new dentry is allocated based on the parent&#39;s dentry and the current name of the ..." alt="" coords="613,158,761,199"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga1c5ae69d807fe7b5f60bad8734915129"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a>* tcmi_ctlfs_rawfile_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>read_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>write_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>namefmt</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Creates a raw file instance. </p>
<p>The file will be used as an interface of the registered object to the user space. It allows calling object methods and passing raw unprocessed data as an argument.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*parent</td><td>- pointer to the parent entry - has to be a directory </td></tr>
    <tr><td class="paramname">*mode</td><td>- access rights for the inode </td></tr>
    <tr><td class="paramname">*object</td><td>- points to the object that creates the file </td></tr>
    <tr><td class="paramname">*read_method</td><td>- method of the file creator that will be called upon file read </td></tr>
    <tr><td class="paramname">*write_method</td><td>- method of the file creator that will be called upon file write </td></tr>
    <tr><td class="paramname">maxlen</td><td>- maximum length of the data in bytes </td></tr>
    <tr><td class="paramname">namefmt</td><td>- nameformat string (printf style) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the new file or NULL </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Currently not implemented </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00134">134</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaeaa21c9f35d22ab9ea81f97a39ef3e95"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a>* tcmi_ctlfs_strfile_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>read_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/dc9/tcmi__ctlfs__file_8h.html#a7362f0f03cb643bf7a806bcedb56f9c5">object_method</a> *&#160;</td>
          <td class="paramname"><em>write_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>namefmt</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Creates a new string file instance. </p>
<p>&lt;&lt;public&gt;&gt; Creates a new string file instance.</p>
<p>The file will be used as an interface of the registered object to the user space. It allows calling object methods and pass strings as an argument.</p>
<p>For conversion overflow checking and newlines conversions are handled by proc_dostring(). The function is used from kernel/sysctl.c</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*parent</td><td>- pointer to the parent entry - has to be a directory </td></tr>
    <tr><td class="paramname">*mode</td><td>- access rights for the inode </td></tr>
    <tr><td class="paramname">*object</td><td>- points to the object that creates the file </td></tr>
    <tr><td class="paramname">*read_method</td><td>- method of the file creator that will be called upon file read </td></tr>
    <tr><td class="paramname">*write_method</td><td>- method of the file creator that will be called upon file write </td></tr>
    <tr><td class="paramname">maxlen</td><td>- maximum length of the data in bytes </td></tr>
    <tr><td class="paramname">namefmt</td><td>- nameformat string (printf style) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the new file or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00100">100</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>References <a class="el" href="../../d9/d10/tcmi__npm__params_8h_source.html#l00052">args</a>, and <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">tcmi_ctlfs_genericfile_new()</a>.</p>

<p>Referenced by <a class="el" href="../../d2/de0/tcmi__ccnman_8c_source.html#l00159">tcmi_ccnman_init_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00404">tcmi_migman_init_ctlfs_files()</a>, <a class="el" href="../../d9/d86/tcmi__penman_8c_source.html#l00103">tcmi_penman_init_ctlfs_files()</a>, and <a class="el" href="../../da/d37/tcmi__sock_8c_source.html#l00058">tcmi_sock_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure.">tcmi_ctlfs_entry</a> *file;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    va_list <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#aa24f72e6a4d6a997528142211b375496" title="Arrays of args and envps.">args</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    va_start(args, namefmt);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    file = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:">tcmi_ctlfs_genericfile_new</a>(parent, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a511a8806c63b72ff1b8b5f1a7f9d7c77" title="access mode for the file">mode</a>, <span class="keywordtype">object</span>,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                      read_method, write_method,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                      maxlen, proc_dostring, namefmt, args);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    va_end(args);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">return</span> file;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/de7/group__tcmi__ctlfs__file__class_gaeaa21c9f35d22ab9ea81f97a39ef3e95_cgraph.png" border="0" usemap="#d1/de7/group__tcmi__ctlfs__file__class_gaeaa21c9f35d22ab9ea81f97a39ef3e95_cgraph" alt=""/></div>
<map name="d1/de7/group__tcmi__ctlfs__file__class_gaeaa21c9f35d22ab9ea81f97a39ef3e95_cgraph" id="d1/de7/group__tcmi__ctlfs__file__class_gaeaa21c9f35d22ab9ea81f97a39ef3e95_cgraph">
<area shape="rect" id="node2" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gafcb50575d3f6cc783130766295300741" title="&lt;&lt;private&gt;&gt; This is a generic method, that creates a new instance of a file as follows:" alt="" coords="200,81,373,108"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga532181c3f7224fe5aa7651a69e6ad6b4" title="&lt;&lt;public&gt;&gt; This method is used when initializing a new entry." alt="" coords="421,81,560,108"/><area shape="rect" id="node4" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="610,5,763,32"/><area shape="rect" id="node5" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga4fbd3f1c3789bd79d4e2c684fc08d1a2" title="&lt;&lt;private&gt;&gt; Checks whether a directory entry contains entry of the specified name" alt="" coords="609,56,765,83"/><area shape="rect" id="node6" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="616,107,757,133"/><area shape="rect" id="node7" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaeeb7fba5f385c90d93878a60a4dcf1dc" title="&lt;&lt;private&gt;&gt; The new dentry is allocated based on the parent&#39;s dentry and the current name of the ..." alt="" coords="613,158,761,199"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga16b2f7358650939f2f5d18cc906ba318"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct inode_operations tcmi_ctlfs_file_inode_operations</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .getattr    = simple_getattr,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Inode operations for VFS, the only method getattr is taken from fs/libfs.c. </p>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00471">471</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">tcmi_ctlfs_genericfile_new()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6911dc18604b7dee048e271144be65bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct file_operations tcmi_ctlfs_file_operations</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .read       = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga329a1b3818c83d9f759a9aafff561e7d" title="&lt;&lt;private&gt;&gt; The read file operation, called by the read system call.">tcmi_ctlfs_file_read</a>,</div>
<div class="line">    .write      = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#ga8f323214eb55691b4f5a76bc08072aa8" title="&lt;&lt;private&gt;&gt; The write file operation, called by the write system call.">tcmi_ctlfs_file_write</a>,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>File operations for VFS. </p>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00465">465</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">tcmi_ctlfs_genericfile_new()</a>.</p>

</div>
</div>
<a class="anchor" id="ga15bcf0f86a99e591cf1fca2e5eb243cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops">tcmi_ctlfs_ops</a> tcmi_ctlfs_file_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .entry_release = <a class="code" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#gab6631117d63524adab7ac44fffecf48d" title="&lt;&lt;private&gt;&gt; This method is used to free the data associated with the file.">tcmi_ctlfs_file_release</a>,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>A file requires special entry operations to free all resources. </p>

<p>Definition at line <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00461">461</a> of file <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html">tcmi_ctlfs_file.c</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d0f/tcmi__ctlfs__file_8c_source.html#l00225">tcmi_ctlfs_genericfile_new()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2013 19:06:07 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
