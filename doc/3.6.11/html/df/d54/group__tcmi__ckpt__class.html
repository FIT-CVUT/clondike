<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: tcmi_ckpt class</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
   <div id="projectbrief">Supported to Linux kernel 3.6.11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/d54/group__tcmi__ckpt__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcmi_ckpt class<div class="ingroups"><a class="el" href="../../d4/dcf/group__tcmi__ckptcom__class.html">checkpointing component</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This is a helper class used by the checkpointing component that provides functionality to:  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt class:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../df/d54/group__tcmi__ckpt__class.png" border="0" alt="" usemap="#df_2d54_2group____tcmi____ckpt____class"/>
<map name="df_2d54_2group____tcmi____ckpt____class" id="df_2d54_2group____tcmi____ckpt____class">
<area shape="rect" id="node1" href="../../d9/d57/group__tcmi__ckpt__mm__class.html" title="This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a process memory descriptor." alt="" coords="401,5,543,32"/><area shape="rect" id="node2" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html" title="This is a helper &lt;&lt;singleton&gt;&gt; class used by the checkpoint &#160;and provides functionality to:..." alt="" coords="407,57,537,98"/><area shape="rect" id="node3" href="../../d4/dcf/group__tcmi__ckptcom__class.html" title="&lt;&lt;Singleton&gt;&gt; class that creates a checkpoint of a process." alt="" coords="5,93,176,120"/><area shape="rect" id="node4" href="../../dd/d41/group__tcmi__fdcache__class.html" title="This is a helper class used by the checkpoint to keep track of already open file descriptors." alt="" coords="405,173,539,200"/><area shape="rect" id="node6" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html" title="This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a particular memory segment (VM area) into the..." alt="" coords="387,123,557,149"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:d9/d57/group__tcmi__ckpt__mm__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d57/group__tcmi__ckpt__mm__class.html">tcmi_ckpt_mm class</a></td></tr>
<tr class="memdesc:d9/d57/group__tcmi__ckpt__mm__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a process memory descriptor. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d6/d9c/group__tcmi__ckpt__openfile__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html">tcmi_ckpt_openfile class</a></td></tr>
<tr class="memdesc:d6/d9c/group__tcmi__ckpt__openfile__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a helper &lt;&lt;singleton&gt;&gt; class used by the <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html">checkpoint </a> and provides functionality to: <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d3/dad/group__tcmi__ckpt__vm__area__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html">tcmi_ckpt_vm_area class</a></td></tr>
<tr class="memdesc:d3/dad/group__tcmi__ckpt__vm__area__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a &lt;&lt;singleton&gt;&gt; that takes care of (re)storing a particular memory segment (VM area) into the checkpoint file. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:dd/d41/group__tcmi__fdcache__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d41/group__tcmi__fdcache__class.html">tcmi_fdcache class</a></td></tr>
<tr class="memdesc:dd/d41/group__tcmi__fdcache__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a helper class used by the checkpoint to keep track of already open file descriptors. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:dd/d57/structtcmi__ckpt__hdr"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr">tcmi_ckpt_hdr</a></td></tr>
<tr class="memdesc:dd/d57/structtcmi__ckpt__hdr"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes the checkpoint header.  <a href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr">More...</a><br/></td></tr>
<tr class="separator:dd/d57/structtcmi__ckpt__hdr"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:dd/d41/structtcmi__ckpt"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a></td></tr>
<tr class="memdesc:dd/d41/structtcmi__ckpt"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compound structure that gathers necessary process information.  <a href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">More...</a><br/></td></tr>
<tr class="separator:dd/d41/structtcmi__ckpt"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga43e5b79349d2e05a9110832b53d94178"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga43e5b79349d2e05a9110832b53d94178">TCMI_CKPT</a>(ckpt)&#160;&#160;&#160;((struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>*)ckpt)</td></tr>
<tr class="memdesc:ga43e5b79349d2e05a9110832b53d94178"><td class="mdescLeft">&#160;</td><td class="mdescRight">Casts to the checkpoint instance.  <a href="#ga43e5b79349d2e05a9110832b53d94178">More...</a><br/></td></tr>
<tr class="separator:ga43e5b79349d2e05a9110832b53d94178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae5a75a75cafe1195ce2aebb5a53e3970"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gae5a75a75cafe1195ce2aebb5a53e3970">TCMI_CKPT_MAGIC</a>&#160;&#160;&#160;0xdeadbeef</td></tr>
<tr class="memdesc:gae5a75a75cafe1195ce2aebb5a53e3970"><td class="mdescLeft">&#160;</td><td class="mdescRight">a magic number for the header  <a href="#gae5a75a75cafe1195ce2aebb5a53e3970">More...</a><br/></td></tr>
<tr class="separator:gae5a75a75cafe1195ce2aebb5a53e3970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab07e0068ff7b0d4b9b577cb3d5fcf715"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gab07e0068ff7b0d4b9b577cb3d5fcf715">tcmi_ckpt_foreach_openfile</a>(file, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>)</td></tr>
<tr class="memdesc:gab07e0068ff7b0d4b9b577cb3d5fcf715"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Iterates through all open files  <a href="#gab07e0068ff7b0d4b9b577cb3d5fcf715">More...</a><br/></td></tr>
<tr class="separator:gab07e0068ff7b0d4b9b577cb3d5fcf715"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gacd057c681c2da8004f43de8075b9af1b"><td class="memItemLeft" align="right" valign="top">typedef ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gacd057c681c2da8004f43de8075b9af1b">vfs_method_t</a> (struct file *, char __user *, size_t, loff_t *)</td></tr>
<tr class="memdesc:gacd057c681c2da8004f43de8075b9af1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes the signature of the VFS method (typically vfs_read or vfs_write.  <a href="#gacd057c681c2da8004f43de8075b9af1b">More...</a><br/></td></tr>
<tr class="separator:gacd057c681c2da8004f43de8075b9af1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gacea45b22c76a0bff6422d8d4e3731925"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gacea45b22c76a0bff6422d8d4e3731925">tcmi_ckpt_map_count</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gacea45b22c76a0bff6422d8d4e3731925"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process.  <a href="#gacea45b22c76a0bff6422d8d4e3731925">More...</a><br/></td></tr>
<tr class="separator:gacea45b22c76a0bff6422d8d4e3731925"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1c519443be61f5923b9f6cc8fe92d1e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e">tcmi_ckpt_file_count</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gac1c519443be61f5923b9f6cc8fe92d1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process.  <a href="#gac1c519443be61f5923b9f6cc8fe92d1e">More...</a><br/></td></tr>
<tr class="separator:gac1c519443be61f5923b9f6cc8fe92d1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9205a2afa702f67fabb78960205f32eb"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr">tcmi_ckpt_hdr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga9205a2afa702f67fabb78960205f32eb">__attribute__</a> ((__packed__))</td></tr>
<tr class="separator:ga9205a2afa702f67fabb78960205f32eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa428792c45bff6d4c204a1888bc45bb2"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gaa428792c45bff6d4c204a1888bc45bb2">tcmi_ckpt_new</a> (struct file *file)</td></tr>
<tr class="memdesc:gaa428792c45bff6d4c204a1888bc45bb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Checkpoint constructor.  <a href="#gaa428792c45bff6d4c204a1888bc45bb2">More...</a><br/></td></tr>
<tr class="separator:gaa428792c45bff6d4c204a1888bc45bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaecf1343fc1988bd210f6fc1ef349e256"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gaecf1343fc1988bd210f6fc1ef349e256">tcmi_ckpt_write_hdr</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, int <a class="el" href="../../d6/db7/tcmi__ckpt_8h.html#a3b020b8f86ab9a3376dd028e485ae04b">is_npm</a>)</td></tr>
<tr class="memdesc:gaecf1343fc1988bd210f6fc1ef349e256"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes a checkpoint header.  <a href="#gaecf1343fc1988bd210f6fc1ef349e256">More...</a><br/></td></tr>
<tr class="separator:gaecf1343fc1988bd210f6fc1ef349e256"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa4a98f5ffdffde67b04f87c68a2069c9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gaa4a98f5ffdffde67b04f87c68a2069c9">tcmi_ckpt_read_hdr</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gaa4a98f5ffdffde67b04f87c68a2069c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads a checkpoint header.  <a href="#gaa4a98f5ffdffde67b04f87c68a2069c9">More...</a><br/></td></tr>
<tr class="separator:gaa4a98f5ffdffde67b04f87c68a2069c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8eb79d798591739f7234bae67265e097"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga8eb79d798591739f7234bae67265e097">tcmi_ckpt_write_files</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga8eb79d798591739f7234bae67265e097"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes open files into the checkpoint.  <a href="#ga8eb79d798591739f7234bae67265e097">More...</a><br/></td></tr>
<tr class="separator:ga8eb79d798591739f7234bae67265e097"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga154d03e60367f3aed764af1964e4c2e5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga154d03e60367f3aed764af1964e4c2e5">tcmi_ckpt_read_files</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga154d03e60367f3aed764af1964e4c2e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads open files from the checkpoint.  <a href="#ga154d03e60367f3aed764af1964e4c2e5">More...</a><br/></td></tr>
<tr class="separator:ga154d03e60367f3aed764af1964e4c2e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9d1cb4bfd021a3a845689a7262fe8190"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga9d1cb4bfd021a3a845689a7262fe8190">tcmi_ckpt_write_vmas</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, int heavy)</td></tr>
<tr class="memdesc:ga9d1cb4bfd021a3a845689a7262fe8190"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes process memory regions into the checkpoint.  <a href="#ga9d1cb4bfd021a3a845689a7262fe8190">More...</a><br/></td></tr>
<tr class="separator:ga9d1cb4bfd021a3a845689a7262fe8190"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab1744bf2ddd6823f2a24202dbcd47f2b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gab1744bf2ddd6823f2a24202dbcd47f2b">tcmi_ckpt_read_vmas</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gab1744bf2ddd6823f2a24202dbcd47f2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads process memory regions from the checkpoint.  <a href="#gab1744bf2ddd6823f2a24202dbcd47f2b">More...</a><br/></td></tr>
<tr class="separator:gab1744bf2ddd6823f2a24202dbcd47f2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5efebada8a7a33c270340b392412db81"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga5efebada8a7a33c270340b392412db81">tcmi_ckpt_write_regs</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct pt_regs *regs)</td></tr>
<tr class="memdesc:ga5efebada8a7a33c270340b392412db81"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes process CPU registers into the checkpoint.  <a href="#ga5efebada8a7a33c270340b392412db81">More...</a><br/></td></tr>
<tr class="separator:ga5efebada8a7a33c270340b392412db81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga112f108010a7082198d92ca2d343e0a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga112f108010a7082198d92ca2d343e0a1">tcmi_ckpt_read_regs</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct pt_regs *regs)</td></tr>
<tr class="memdesc:ga112f108010a7082198d92ca2d343e0a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads process CPU registers from the checkpoint.  <a href="#ga112f108010a7082198d92ca2d343e0a1">More...</a><br/></td></tr>
<tr class="separator:ga112f108010a7082198d92ca2d343e0a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf27fca9610524e47356db9a893cac692"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gaf27fca9610524e47356db9a893cac692">tcmi_ckpt_check_magic</a> (void *buf)</td></tr>
<tr class="memdesc:gaf27fca9610524e47356db9a893cac692"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes signals related stuff into the checkpoint.  <a href="#gaf27fca9610524e47356db9a893cac692">More...</a><br/></td></tr>
<tr class="separator:gaf27fca9610524e47356db9a893cac692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab3a6ea550b2eb33a2814543bf82bc430"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gab3a6ea550b2eb33a2814543bf82bc430">tcmi_ckpt_get</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gab3a6ea550b2eb33a2814543bf82bc430"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Instance accessor, increments the reference counter.  <a href="#gab3a6ea550b2eb33a2814543bf82bc430">More...</a><br/></td></tr>
<tr class="separator:gab3a6ea550b2eb33a2814543bf82bc430"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga28018eb420ebe27ee907314d4c232241"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga28018eb420ebe27ee907314d4c232241">tcmi_ckpt_put</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:ga28018eb420ebe27ee907314d4c232241"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Releases the instance.  <a href="#ga28018eb420ebe27ee907314d4c232241">More...</a><br/></td></tr>
<tr class="separator:ga28018eb420ebe27ee907314d4c232241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6b8d00619b038e49b552f87cea4a8129"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129">tcmi_ckpt_read_write</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, void *<a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084">data</a>, int <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gacd057c681c2da8004f43de8075b9af1b">vfs_method_t</a> *vfs_method)</td></tr>
<tr class="memdesc:ga6b8d00619b038e49b552f87cea4a8129"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file.  <a href="#ga6b8d00619b038e49b552f87cea4a8129">More...</a><br/></td></tr>
<tr class="separator:ga6b8d00619b038e49b552f87cea4a8129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab3d478dd860126047413a05828c02360"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360">tcmi_ckpt_write</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, void *<a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084">data</a>, int <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>)</td></tr>
<tr class="memdesc:gab3d478dd860126047413a05828c02360"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.  <a href="#gab3d478dd860126047413a05828c02360">More...</a><br/></td></tr>
<tr class="separator:gab3d478dd860126047413a05828c02360"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5cd1d8b3a1dbbc588cf3fe538b39e385"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385">tcmi_ckpt_read</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, void *<a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084">data</a>, int <a class="el" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>)</td></tr>
<tr class="memdesc:ga5cd1d8b3a1dbbc588cf3fe538b39e385"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.  <a href="#ga5cd1d8b3a1dbbc588cf3fe538b39e385">More...</a><br/></td></tr>
<tr class="separator:ga5cd1d8b3a1dbbc588cf3fe538b39e385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6128870e21ea3aef1bf88d8e34e4cd48"><td class="memItemLeft" align="right" valign="top">static loff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48">tcmi_ckpt_seek</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, loff_t offset, int origin)</td></tr>
<tr class="memdesc:ga6128870e21ea3aef1bf88d8e34e4cd48"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset.  <a href="#ga6128870e21ea3aef1bf88d8e34e4cd48">More...</a><br/></td></tr>
<tr class="separator:ga6128870e21ea3aef1bf88d8e34e4cd48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac8491faf16814e68e4da2dbf77c1f9cf"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gac8491faf16814e68e4da2dbf77c1f9cf">tcmi_ckpt_do_mmap</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, unsigned long addr, unsigned long len, unsigned long prot, unsigned long <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97">flags</a>)</td></tr>
<tr class="memdesc:gac8491faf16814e68e4da2dbf77c1f9cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset.  <a href="#gac8491faf16814e68e4da2dbf77c1f9cf">More...</a><br/></td></tr>
<tr class="separator:gac8491faf16814e68e4da2dbf77c1f9cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac5d7b45cd57fdd09ac83ce079260ec7e"><td class="memItemLeft" align="right" valign="top">static loff_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e">tcmi_ckpt_page_align</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>)</td></tr>
<tr class="memdesc:gac5d7b45cd57fdd09ac83ce079260ec7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary.  <a href="#gac5d7b45cd57fdd09ac83ce079260ec7e">More...</a><br/></td></tr>
<tr class="separator:gac5d7b45cd57fdd09ac83ce079260ec7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga59be6dd10ef81e4812417bfe0dd5f4c5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga59be6dd10ef81e4812417bfe0dd5f4c5">tcmi_ckpt_fdcache_add</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>, struct file *file)</td></tr>
<tr class="memdesc:ga59be6dd10ef81e4812417bfe0dd5f4c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Adds a file descriptor - file object pair into the fd cache.  <a href="#ga59be6dd10ef81e4812417bfe0dd5f4c5">More...</a><br/></td></tr>
<tr class="separator:ga59be6dd10ef81e4812417bfe0dd5f4c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5847c258ee160509359de5f5c27a2c33"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#ga5847c258ee160509359de5f5c27a2c33">tcmi_ckpt_fdcache_lookup</a> (struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *<a class="el" href="../../db/d61/group__tcmi__penman__class.html#gae3924f624412b270d461d2543744407e">self</a>, struct file *file)</td></tr>
<tr class="memdesc:ga5847c258ee160509359de5f5c27a2c33"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file.  <a href="#ga5847c258ee160509359de5f5c27a2c33">More...</a><br/></td></tr>
<tr class="separator:ga5847c258ee160509359de5f5c27a2c33"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gadc15809038086006d81c961e1ead21b6"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gadc15809038086006d81c961e1ead21b6">__attribute__</a></td></tr>
<tr class="separator:gadc15809038086006d81c961e1ead21b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This is a helper class used by the checkpointing component that provides functionality to: </p>
<ul>
<li>write current process into a checkpoint file</li>
<li>restore a current process from a checkpoint file</li>
</ul>
<p>It doesn't do the whole job at once, it relies on its controlling class (<a class="el" href="../../d4/dcf/group__tcmi__ckptcom__class.html">checkpointing component </a>). The checkpointing component instructs the checkpoint instance what to do in each step (this applies to creating the checkpoint as well as restoring the process execution).</p>
<p>Implementation is Linux kernel specific. </p>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="dd/d57/structtcmi__ckpt__hdr" id="dd/d57/structtcmi__ckpt__hdr"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt_hdr</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Describes the checkpoint header. </p>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00069">69</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt_hdr:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d1/d63/structtcmi__ckpt__hdr__coll__graph.png" border="0" usemap="#tcmi__ckpt__hdr_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a73051ab25767e5c39f0ba4f6b3f61fd8"></a>enum <a class="el" href="../../d2/def/arch__ids_8h.html#adbc45da5aabb1eb49345f13d3eed13a9">arch_ids</a></td>
<td class="fieldname">
checkpoint_arch</td>
<td class="fielddoc">
Architecture (hw) of the checkpointed data. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ae5b29a78354f731c3c852d0236da26f3"></a>char</td>
<td class="fieldname">
comm[TASK_COMM_LEN]</td>
<td class="fielddoc">
Process executable name. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ae430e56f23d1af15dad8f0d377d8d730"></a>int32_t</td>
<td class="fieldname">
file_count</td>
<td class="fielddoc">
total count of open files. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a149a59a233b29b32dc06c3d3e772d8e8"></a>int8_t</td>
<td class="fieldname">
is_32bit_application</td>
<td class="fielddoc">
Flag, indicating whether the checkpointed application was 32 bit application (otherwise 64 bit is assumed) </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a026fcce59aa4179c160a6b3fc26e1349"></a>int8_t</td>
<td class="fieldname">
is_npm</td>
<td class="fielddoc">
1, if this is checkpoint created as a result of non-preemptive migration request (0 otherwise) </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aa05045506d53947d471e16bb500619af"></a>int32_t</td>
<td class="fieldname">
magic</td>
<td class="fielddoc">
magic number identifying the checkpoint file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a8cd0958a70158b587474bcf6645dad02"></a>int32_t</td>
<td class="fieldname">
map_count</td>
<td class="fielddoc">
total count of virtual memory areas. </td></tr>
</table>

</div>
</div>
<a name="dd/d41/structtcmi__ckpt" id="dd/d41/structtcmi__ckpt"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ckpt</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Compound structure that gathers necessary process information. </p>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00087">87</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>
</div><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ckpt:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../de/daa/structtcmi__ckpt__coll__graph.png" border="0" usemap="#tcmi__ckpt_coll__map" alt="Collaboration graph"/></div>
<map name="tcmi__ckpt_coll__map" id="tcmi__ckpt_coll__map">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr" title="Describes the checkpoint header." alt="" coords="5,163,152,328"/><area shape="rect" id="node3" href="../../dd/d41/group__tcmi__fdcache__class.html#dd/d9c/structtcmi__fdcache" title="Compound structure contains all fd cache entries." alt="" coords="177,192,276,299"/><area shape="rect" id="node4" href="../../dd/d41/group__tcmi__fdcache__class.html#dd/d68/structtcmi__fdcache__entry" title="Describes an fd cache entry." alt="" coords="159,6,293,98"/></map>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a0ae13e23fb9ab5e3a59d85e09c476b22"></a>struct <a class="el" href="../../dd/d41/group__tcmi__fdcache__class.html#dd/d9c/structtcmi__fdcache">tcmi_fdcache</a> *</td>
<td class="fieldname">
fdcache</td>
<td class="fielddoc">
File descriptor cache - used when indentifying descriptors referencing the same file. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac4b918d9117fbd979317c83c9a8e18b2"></a>struct file *</td>
<td class="fieldname">
file</td>
<td class="fielddoc">
Actual file used create/restore the process checkpoint. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="afc332f7860d6621b8200c44859b67dbc"></a>struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr">tcmi_ckpt_hdr</a></td>
<td class="fieldname">
hdr</td>
<td class="fielddoc">
Checkpoint header. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a50e277cc6833515332d87ee45ac12f1c"></a>atomic_t</td>
<td class="fieldname">
ref_count</td>
<td class="fielddoc">
Instance reference counter. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga43e5b79349d2e05a9110832b53d94178"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_CKPT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ckpt</td><td>)</td>
          <td>&#160;&#160;&#160;((struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>*)ckpt)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Casts to the checkpoint instance. </p>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00103">103</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00063">tcmi_ckpt_new()</a>.</p>

</div>
</div>
<a class="anchor" id="gab07e0068ff7b0d4b9b577cb3d5fcf715"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define tcmi_ckpt_foreach_openfile</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">file, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e">fd</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a> = 0, file = current-&gt;files-&gt;fdt-&gt;fd[<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>];                    \</div>
<div class="line">         fd &lt; current-&gt;files-&gt;fdt-&gt;max_fds; <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>++, file = current-&gt;files-&gt;fdt-&gt;fd[<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>])       \</div>
<div class="line">        if (test_bit(<a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, current-&gt;files-&gt;fdt-&gt;open_fds))</div>
</div><!-- fragment -->
<p>&lt;&lt;public&gt;&gt; Iterates through all open files </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>- current file </td></tr>
    <tr><td class="paramname">fd</td><td>- descriptor of the file Replaced macro FD_ISSET to function test_bit | by Jiri Rakosnik </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00336">336</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00345">tcmi_ckpt_file_count()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00194">tcmi_ckpt_write_files()</a>, and <a class="el" href="../../d7/d05/tcmi__taskhelper_8h_source.html#l00728">tcmi_taskhelper_flushfiles()</a>.</p>

</div>
</div>
<a class="anchor" id="gae5a75a75cafe1195ce2aebb5a53e3970"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_CKPT_MAGIC&#160;&#160;&#160;0xdeadbeef</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>a magic number for the header </p>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00106">106</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00143">tcmi_ckpt_check_magic()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00143">tcmi_ckpt_read_hdr()</a>, and <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00105">tcmi_ckpt_write_hdr()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gacd057c681c2da8004f43de8075b9af1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef ssize_t vfs_method_t(struct file *, char __user *, size_t, loff_t *)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Describes the signature of the VFS method (typically vfs_read or vfs_write. </p>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00181">181</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga9205a2afa702f67fabb78960205f32eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr">tcmi_ckpt_hdr</a> __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__packed__)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gaf27fca9610524e47356db9a893cac692"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_check_magic </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes signals related stuff into the checkpoint. </p>
<p>&lt;&lt;public&gt;&gt; Reads signals related stuff from the checkpoint. &lt;&lt;public&gt;&gt; Performs a quick check if the specified buffer contains a valid magic number of the checkpoint file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*buf</td><td>- buffer containing the magic number </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true when valid. </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00143">143</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00106">TCMI_CKPT_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> ((<span class="keyword">struct</span> <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d57/structtcmi__ckpt__hdr" title="Describes the checkpoint header.">tcmi_ckpt_hdr</a>*)buf)-&gt;magic == <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gae5a75a75cafe1195ce2aebb5a53e3970" title="a magic number for the header">TCMI_CKPT_MAGIC</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac8491faf16814e68e4da2dbf77c1f9cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long tcmi_ckpt_do_mmap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>prot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset. </p>
<p>After that the position is advanced by len bytes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">addr</td><td>- starting address where the </td></tr>
    <tr><td class="paramname">len</td><td>- length of the region </td></tr>
    <tr><td class="paramname">prot</td><td>- access rights of the pages included in the memory region </td></tr>
    <tr><td class="paramname">flags</td><td>- memory region flags (see mm.h) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new file position or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00271">271</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00252">tcmi_ckpt_seek()</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00337">tcmi_ckpt_vm_area_read_h()</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Mapping VMA start:%08lx, len %08lx, prot: %08lx, flags: %08lx, pgoff: %08Lx&quot;</span>, </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;         addr, len, prot, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97" title="flags specified by the user when opening the file">flags</a>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>-&gt;f_pos &gt;&gt; PAGE_SHIFT);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    down_write(&amp;current-&gt;mm-&gt;mmap_sem);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    addr = do_mmap_pgoff(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>, addr, len, prot, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97" title="flags specified by the user when opening the file">flags</a>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>-&gt;f_pos);  <span class="comment">//Replaced function do_mmap to do_mmap_pgoff for kernel 3.7.x by Jiri Rakosnik</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    up_write(&amp;current-&gt;mm-&gt;mmap_sem);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset.">tcmi_ckpt_seek</a>(<span class="keyword">self</span>, len, 1);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Memory mapping at %08lx, new off %08Lx&quot;</span>, addr, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>-&gt;f_pos);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">return</span> addr;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gac8491faf16814e68e4da2dbf77c1f9cf_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gac8491faf16814e68e4da2dbf77c1f9cf_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gac8491faf16814e68e4da2dbf77c1f9cf_cgraph" id="df/d54/group__tcmi__ckpt__class_gac8491faf16814e68e4da2dbf77c1f9cf_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="197,5,312,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga59be6dd10ef81e4812417bfe0dd5f4c5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_fdcache_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Adds a file descriptor - file object pair into the fd cache. </p>
<p>This information will be used for later lookup of duplicate file descriptors.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">fd</td><td>- file descriptor of the file </td></tr>
    <tr><td class="paramname">*file</td><td>- file object - used for duplicate file descriptor lookup </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00312">312</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../de/d64/tcmi__fdcache_8h_source.html#l00150">tcmi_fdcache_add()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00170">tcmi_ckpt_openfile_write_newfd()</a>.</p>
<div class="fragment"><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;{</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d41/group__tcmi__fdcache__class.html#ga613fb750743c8a42aab62f9bcc230bd6" title="&lt;&lt;public&gt;&gt; Adds a file descriptor - file object pair into the fd cache.">tcmi_fdcache_add</a>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a0ae13e23fb9ab5e3a59d85e09c476b22" title="File descriptor cache - used when indentifying descriptors referencing the same file.">fdcache</a>, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>, file);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga59be6dd10ef81e4812417bfe0dd5f4c5_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga59be6dd10ef81e4812417bfe0dd5f4c5_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga59be6dd10ef81e4812417bfe0dd5f4c5_cgraph" id="df/d54/group__tcmi__ckpt__class_ga59be6dd10ef81e4812417bfe0dd5f4c5_cgraph">
<area shape="rect" id="node2" href="../../dd/d41/group__tcmi__fdcache__class.html#ga613fb750743c8a42aab62f9bcc230bd6" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="214,5,341,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga5847c258ee160509359de5f5c27a2c33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_fdcache_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">*file</td><td>- file object to be looked up </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file descriptor of the file or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00324">324</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../de/d64/tcmi__fdcache_8h_source.html#l00174">tcmi_fdcache_lookup()</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00060">tcmi_ckpt_openfile_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;{</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d41/group__tcmi__fdcache__class.html#ga09e6e85f776f3e0a1dc672b1f5c7979c" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file.">tcmi_fdcache_lookup</a>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a0ae13e23fb9ab5e3a59d85e09c476b22" title="File descriptor cache - used when indentifying descriptors referencing the same file.">fdcache</a>, file);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga5847c258ee160509359de5f5c27a2c33_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga5847c258ee160509359de5f5c27a2c33_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga5847c258ee160509359de5f5c27a2c33_cgraph" id="df/d54/group__tcmi__ckpt__class_ga5847c258ee160509359de5f5c27a2c33_cgraph">
<area shape="rect" id="node2" href="../../dd/d41/group__tcmi__fdcache__class.html#ga09e6e85f776f3e0a1dc672b1f5c7979c" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file." alt="" coords="229,5,373,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac1c519443be61f5923b9f6cc8fe92d1e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_file_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process. </p>
<p>For each file check if the file is supported if so, adjust the counter.</p>
<p>An error is indicated if any of the files is:</p>
<ul>
<li>socket</li>
<li>pipe</li>
<li>symlink</li>
<li>special file</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of open files, or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00345">345</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d4/d2b/tcmi__npm__params_8c_source.html#l00017">count()</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00123">fd</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00336">tcmi_ckpt_foreach_openfile</a>, and <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00147">tcmi_ckpt_openfile_supported()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00223">tcmi_ckpt_read_files()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00143">tcmi_ckpt_read_hdr()</a>, and <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00105">tcmi_ckpt_write_hdr()</a>.</p>
<div class="fragment"><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">/* file descriptor count */</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a> = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keyword">struct </span>file *file;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keyword">struct </span>inode *inode;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">/* Check each open file */</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab07e0068ff7b0d4b9b577cb3d5fcf715" title="&lt;&lt;public&gt;&gt; Iterates through all open files">tcmi_ckpt_foreach_openfile</a>(file, fd) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        inode = file-&gt;f_dentry-&gt;d_inode;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d" title="&lt;&lt;public&gt;&gt; Class method - checks if the specified file(represented by its inode) is supported by chec...">tcmi_ckpt_openfile_supported</a>(inode)) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Unsupported file mode detected %o [FD: %d]&quot;</span>, inode-&gt;i_mode, fd);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            err = -EINVAL;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        count++;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="comment">/*mdbg(INFO4, &quot;Scanned file fd=%d, type=%0o &#39;%s&#39;&quot;, fd, file-&gt;f_flags, </span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">          file-&gt;f_dentry-&gt;d_name.name); */</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Found %d files, err=%d&quot;</span>, count, err);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; exit0:</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gac1c519443be61f5923b9f6cc8fe92d1e_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gac1c519443be61f5923b9f6cc8fe92d1e_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gac1c519443be61f5923b9f6cc8fe92d1e_cgraph" id="df/d54/group__tcmi__ckpt__class_gac1c519443be61f5923b9f6cc8fe92d1e_cgraph">
<area shape="rect" id="node2" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="233,5,287,32"/><area shape="rect" id="node3" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d" title="&lt;&lt;public&gt;&gt; Class method &#45; checks if the specified file(represented by its inode) is supported by chec..." alt="" coords="195,57,325,98"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gab3a6ea550b2eb33a2814543bf82bc430"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>* tcmi_ckpt_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Instance accessor, increments the reference counter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt" title="Compound structure that gathers necessary process information.">tcmi_ckpt</a> instance </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00154">154</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>
<div class="fragment"><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span>) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        atomic_inc(&amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a50e277cc6833515332d87ee45ac12f1c" title="Instance reference counter.">ref_count</a>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">self</span>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gacea45b22c76a0bff6422d8d4e3731925"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_map_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process. </p>
<p>We can't simply return current-&gt;map_count. We need to check for special regions that would prevent creating a valid checkpoint</p>
<p>For now, we have to verify that the memory region is not:</p>
<ul>
<li>VM_IO - I/O mapped devices</li>
<li>VM_SHARED - shared memory - this will be included later on, when we support checkpointing and migration of LWP's</li>
<li>VM_RESERVED - special mappings</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of memory regions, or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00310">310</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d4/d2b/tcmi__npm__params_8c_source.html#l00017">count()</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../da/df4/i386_2vma_8h_source.html#l00005">vma_ignore</a>.</p>

<p>Referenced by <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00276">tcmi_ckpt_read_vmas()</a>, and <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00105">tcmi_ckpt_write_hdr()</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a> = 0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    tcmi_ckpt_foreach_vma(vma) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../da/df4/i386_2vma_8h.html#aa0673ccd379a191d54d5bd4e07593956" title="Returns 1, if the vma should be ignored by checkpointing componenet.">vma_ignore</a>(<span class="keyword">self</span>, vma) )</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        count++;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="comment">/* Do not dump I/O mapped devices, shared memory, or special mappings */</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">if</span> (vma-&gt;vm_flags &amp; (VM_IO | VM_SHARED | VM_RESERVED))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            err = -EINVAL;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Scanning area start:%08lx, end: %08lx, flags: %08lx, pageprot %08lx&quot;</span>, </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;             vma-&gt;vm_start, vma-&gt;vm_end, vma-&gt;vm_flags, vma-&gt;vm_page_prot.pgprot);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Found %d areas, mm indicates: %d&quot;</span>, count, current-&gt;mm-&gt;map_count);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">return</span> (err ? err : count);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gacea45b22c76a0bff6422d8d4e3731925_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gacea45b22c76a0bff6422d8d4e3731925_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gacea45b22c76a0bff6422d8d4e3731925_cgraph" id="df/d54/group__tcmi__ckpt__class_gacea45b22c76a0bff6422d8d4e3731925_cgraph">
<area shape="rect" id="node2" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="206,5,261,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaa428792c45bff6d4c204a1888bc45bb2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>* tcmi_ckpt_new </td>
          <td>(</td>
          <td class="paramtype">struct file *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Checkpoint constructor. </p>
<ul>
<li>allocates a new instance</li>
<li>resets the byte counter</li>
<li>reserves an extra reference for the file</li>
<li>reset position in the file to the beginning</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*file</td><td>- points to the file where the checkpoint is to be written/read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt" title="Compound structure that gathers necessary process information.">tcmi_ckpt</a> instance or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00063">63</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00093">tcmi_ckpt::fdcache</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00089">tcmi_ckpt::file</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00099">tcmi_ckpt::ref_count</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00103">TCMI_CKPT</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00252">tcmi_ckpt_seek()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>, and <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt" title="Compound structure that gathers necessary process information.">tcmi_ckpt</a> *ckpt;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    loff_t seek_res;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (!(ckpt = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga43e5b79349d2e05a9110832b53d94178" title="Casts to the checkpoint instance.">TCMI_CKPT</a>(kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt" title="Compound structure that gathers necessary process information.">tcmi_ckpt</a>), </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                       GFP_KERNEL)))) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t allocate memory for TCMI ckpt&quot;</span>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    get_file(<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    ckpt-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a> = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    ckpt-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a0ae13e23fb9ab5e3a59d85e09c476b22" title="File descriptor cache - used when indentifying descriptors referencing the same file.">fdcache</a> = NULL;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    atomic_set(&amp;ckpt-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a50e277cc6833515332d87ee45ac12f1c" title="Instance reference counter.">ref_count</a>, 1);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO2, <span class="stringliteral">&quot;Created new checkpoint %p&quot;</span>, ckpt);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">/* reset the file position */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    seek_res = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset.">tcmi_ckpt_seek</a>(ckpt, 0, 0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> ( seek_res &lt; 0 ) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        kfree(ckpt);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> ERR_PTR(seek_res);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> ckpt;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; exit0:</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gaa428792c45bff6d4c204a1888bc45bb2_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gaa428792c45bff6d4c204a1888bc45bb2_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gaa428792c45bff6d4c204a1888bc45bb2_cgraph" id="df/d54/group__tcmi__ckpt__class_gaa428792c45bff6d4c204a1888bc45bb2_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="163,5,277,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac5d7b45cd57fdd09ac83ce079260ec7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static loff_t tcmi_ckpt_page_align </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary. </p>
<p>This is needed when reading or writing pages.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new file position or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00296">296</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00337">tcmi_ckpt_vm_area_read_h()</a>, and <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00197">tcmi_ckpt_vm_area_write_h()</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span> vfs_llseek(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>, (self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>-&gt;f_pos + PAGE_SIZE - 1) &amp; PAGE_MASK, 0);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga28018eb420ebe27ee907314d4c232241"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tcmi_ckpt_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Releases the instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- pointer to this instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00168">168</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, and <a class="el" href="../../de/d64/tcmi__fdcache_8h_source.html#l00132">tcmi_fdcache_put()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>, and <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;{</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">self</span> &amp;&amp; atomic_dec_and_test(&amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a50e277cc6833515332d87ee45ac12f1c" title="Instance reference counter.">ref_count</a>)) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Destroying TCMI ckpt, %p&quot;</span>, <span class="keyword">self</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        fput(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="../../dd/d41/group__tcmi__fdcache__class.html#gad776fac5f8cecca0aabdad2bf31fc126" title="&lt;&lt;public&gt;&gt; Releases the instance.">tcmi_fdcache_put</a>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a0ae13e23fb9ab5e3a59d85e09c476b22" title="File descriptor cache - used when indentifying descriptors referencing the same file.">fdcache</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        kfree(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga28018eb420ebe27ee907314d4c232241_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga28018eb420ebe27ee907314d4c232241_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga28018eb420ebe27ee907314d4c232241_cgraph" id="df/d54/group__tcmi__ckpt__class_ga28018eb420ebe27ee907314d4c232241_cgraph">
<area shape="rect" id="node2" href="../../dd/d41/group__tcmi__fdcache__class.html#gad776fac5f8cecca0aabdad2bf31fc126" title="&lt;&lt;public&gt;&gt; Releases the instance." alt="" coords="158,5,282,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga5cd1d8b3a1dbbc588cf3fe538b39e385"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">*data</td><td>- buffer for the data </td></tr>
    <tr><td class="paramname">count</td><td>- number of bytes to be read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon successful write of count bytes </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00234">234</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00194">tcmi_ckpt_read_write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html#l00069">tcmi_ckpt_fsstruct_read()</a>, <a class="el" href="../../dc/dc6/tcmi__ckpt__mm_8h_source.html#l00122">tcmi_ckpt_mm_read()</a>, <a class="el" href="../../dd/d4a/tcmi__ckpt__npm__params_8h_source.html#l00071">tcmi_ckpt_npm_params_read()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00087">tcmi_ckpt_openfile_read()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00256">tcmi_ckpt_openfile_read_dupfd()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00293">tcmi_ckpt_openfile_read_newfd()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00143">tcmi_ckpt_read_hdr()</a>, <a class="el" href="../../da/dab/tcmi__ckpt__resources_8h_source.html#l00060">tcmi_ckpt_read_rlimit()</a>, <a class="el" href="../../de/d5f/tcmi__ckpt__regs_8h_source.html#l00089">tcmi_ckpt_regs_read()</a>, <a class="el" href="../../d6/d15/tcmi__ckpt__sig_8h_source.html#l00131">tcmi_ckpt_sig_read()</a>, <a class="el" href="../../df/d07/tcmi__ckpt__thread_8h_source.html#l00038">tcmi_ckpt_tls_read()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00080">tcmi_ckpt_vm_area_read()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00262">tcmi_ckpt_vm_area_read_l()</a>, and <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00422">tcmi_ckpt_vm_area_stack_fixup()</a>.</p>
<div class="fragment"><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;CKPT read to %p, count %d bytes&quot;</span>, <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084" title="Helper field that stores content of args/envp for the serialization.">data</a>, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file.">tcmi_ckpt_read_write</a>(<span class="keyword">self</span>, <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084" title="Helper field that stores content of args/envp for the serialization.">data</a>, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gacd057c681c2da8004f43de8075b9af1b" title="Describes the signature of the VFS method (typically vfs_read or vfs_write.">vfs_method_t</a>*)vfs_read);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga5cd1d8b3a1dbbc588cf3fe538b39e385_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga5cd1d8b3a1dbbc588cf3fe538b39e385_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga5cd1d8b3a1dbbc588cf3fe538b39e385_cgraph" id="df/d54/group__tcmi__ckpt__class_ga5cd1d8b3a1dbbc588cf3fe538b39e385_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="166,5,311,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga154d03e60367f3aed764af1964e4c2e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_read_files </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads open files from the checkpoint. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00223">223</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00345">tcmi_ckpt_file_count()</a>, and <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00087">tcmi_ckpt_openfile_read()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">while</span> ((i &lt; self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ae430e56f23d1af15dad8f0d377d8d730" title="total count of open files.">file_count</a>) &amp;&amp; !err) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga4fb86af944ddd746553b26ce509b60c8" title="&lt;&lt;public&gt;&gt; Reads and restores an open file from the checkpoint file.">tcmi_ckpt_openfile_read</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        i++;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process.">tcmi_ckpt_file_count</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga154d03e60367f3aed764af1964e4c2e5_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga154d03e60367f3aed764af1964e4c2e5_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga154d03e60367f3aed764af1964e4c2e5_cgraph" id="df/d54/group__tcmi__ckpt__class_ga154d03e60367f3aed764af1964e4c2e5_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process." alt="" coords="205,64,347,91"/><area shape="rect" id="node5" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga4fb86af944ddd746553b26ce509b60c8" title="&lt;&lt;public&gt;&gt; Reads and restores an open file from the checkpoint file." alt="" coords="195,152,357,179"/><area shape="rect" id="node3" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="443,5,498,32"/><area shape="rect" id="node4" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d" title="&lt;&lt;public&gt;&gt; Class method &#45; checks if the specified file(represented by its inode) is supported by chec..." alt="" coords="405,57,536,98"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="585,181,695,208"/><area shape="rect" id="node8" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga59af0d4928f72054b6034dc4fe11fcab" title="&lt;&lt;private&gt;&gt; Reads a new file chunk from the checkpoint file." alt="" coords="405,174,536,215"/><area shape="rect" id="node9" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gac7b4f72b5f4bf1f21f74a5bc178284c8" title="&lt;&lt;private&gt;&gt; Reads a duplicate file descriptor chunk from the checkpoint file." alt="" coords="405,239,536,281"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="745,181,890,208"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaa4a98f5ffdffde67b04f87c68a2069c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_read_hdr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads a checkpoint header. </p>
<p>&lt;&lt;public&gt;&gt; Reads a checkpoint header.</p>
<p>The magic number has to match TCMI_CKPT_MAGIC.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00143">143</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d2/def/arch__ids_8h_source.html#l00007">ARCH_I386</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00345">tcmi_ckpt_file_count()</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00106">TCMI_CKPT_MAGIC</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00234">tcmi_ckpt_read()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file.">tcmi_ckpt_read</a>(<span class="keyword">self</span>, &amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>, <span class="keyword">sizeof</span>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>))) &lt; 0) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t read checkpoint header %d&quot;</span>, err);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#aa05045506d53947d471e16bb500619af" title="magic number identifying the checkpoint file.">magic</a> != <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gae5a75a75cafe1195ce2aebb5a53e3970" title="a magic number for the header">TCMI_CKPT_MAGIC</a>) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Invalid checkpoint magic: %08x, expected: %08x&quot;</span>,</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;             self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#aa05045506d53947d471e16bb500619af" title="magic number identifying the checkpoint file.">magic</a>, <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gae5a75a75cafe1195ce2aebb5a53e3970" title="a magic number for the header">TCMI_CKPT_MAGIC</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Read ckpt header - magic: %08x, map_count: %d, files: %d (Header size: %lu)&quot;</span>, </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;         self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#aa05045506d53947d471e16bb500619af" title="magic number identifying the checkpoint file.">magic</a>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a8cd0958a70158b587474bcf6645dad02" title="total count of virtual memory areas.">map_count</a>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ae430e56f23d1af15dad8f0d377d8d730" title="total count of open files.">file_count</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<span class="keyword">sizeof</span>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>));</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (tcmi_ckpt_fdcache_init(<span class="keyword">self</span>) &lt; 0) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error initializing file descriptor cache!!&quot;</span>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process.">tcmi_ckpt_file_count</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    strncpy(current-&gt;comm, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ae5b29a78354f731c3c852d0236da26f3" title="Process executable name.">comm</a>, <span class="keyword">sizeof</span>(current-&gt;comm));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">/* TODO: To some arch file ? */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">    #if defined(__x86_64__) </span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a149a59a233b29b32dc06c3d3e772d8e8" title="Flag, indicating whether the checkpointed application was 32 bit application (otherwise 64 bit is ass...">is_32bit_application</a> )</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        set_thread_flag(TIF_IA32); <span class="comment">/* This flag must be set for 32bit applications running on 64 bit kernel */</span>      </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> ( self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a73051ab25767e5c39f0ba4f6b3f61fd8" title="Architecture (hw) of the checkpointed data.">checkpoint_arch</a> == <a class="code" href="../../d2/def/arch__ids_8h.html#adbc45da5aabb1eb49345f13d3eed13a9a155f09a06903d106b93908c603d92533">ARCH_I386</a> )</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        set_personality(PER_LINUX32_3GB); <span class="comment">/* Address space must be limited by 3GB, so that we are possibly able to migrate back */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Read header. Architecture of checkpoint %d Is 32 bit app: %d&quot;</span>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a73051ab25767e5c39f0ba4f6b3f61fd8" title="Architecture (hw) of the checkpointed data.">checkpoint_arch</a>, self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a149a59a233b29b32dc06c3d3e772d8e8" title="Flag, indicating whether the checkpointed application was 32 bit application (otherwise 64 bit is ass...">is_32bit_application</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; exit0:</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gaa4a98f5ffdffde67b04f87c68a2069c9_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gaa4a98f5ffdffde67b04f87c68a2069c9_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gaa4a98f5ffdffde67b04f87c68a2069c9_cgraph" id="df/d54/group__tcmi__ckpt__class_gaa4a98f5ffdffde67b04f87c68a2069c9_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process." alt="" coords="189,64,331,91"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="205,119,315,145"/><area shape="rect" id="node3" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="425,5,479,32"/><area shape="rect" id="node4" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d" title="&lt;&lt;public&gt;&gt; Class method &#45; checks if the specified file(represented by its inode) is supported by chec..." alt="" coords="387,57,517,98"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="379,123,525,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga112f108010a7082198d92ca2d343e0a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_read_regs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pt_regs *&#160;</td>
          <td class="paramname"><em>regs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads process CPU registers from the checkpoint. </p>

</div>
</div>
<a class="anchor" id="gab1744bf2ddd6823f2a24202dbcd47f2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_read_vmas </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Reads process memory regions from the checkpoint. </p>
<p>&lt;&lt;public&gt;&gt; Reads process memory regions from the checkpoint.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00276">276</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00310">tcmi_ckpt_map_count()</a>, and <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00080">tcmi_ckpt_vm_area_read()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00191">tcmi_ckptcom_restart()</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">while</span> ((i &lt; self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a8cd0958a70158b587474bcf6645dad02" title="total count of virtual memory areas.">map_count</a>) &amp;&amp; !err) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga6c230f15a2b7f3995bcabc64e2ce6160" title="&lt;&lt;public&gt;&gt; Reads a memory area from the checkpoint file.">tcmi_ckpt_vm_area_read</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        i++;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gacea45b22c76a0bff6422d8d4e3731925" title="&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process.">tcmi_ckpt_map_count</a>(<span class="keyword">self</span>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gab1744bf2ddd6823f2a24202dbcd47f2b_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gab1744bf2ddd6823f2a24202dbcd47f2b_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gab1744bf2ddd6823f2a24202dbcd47f2b_cgraph" id="df/d54/group__tcmi__ckpt__class_gab1744bf2ddd6823f2a24202dbcd47f2b_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gacea45b22c76a0bff6422d8d4e3731925" title="&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process." alt="" coords="211,19,362,45"/><area shape="rect" id="node4" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga6c230f15a2b7f3995bcabc64e2ce6160" title="&lt;&lt;public&gt;&gt; Reads a memory area from the checkpoint file." alt="" coords="203,95,370,121"/><area shape="rect" id="node3" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="482,5,537,32"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#ga5cd1d8b3a1dbbc588cf3fe538b39e385" title="&lt;&lt;public&gt;&gt; Reads a specified number of bytes from a checkpoint file." alt="" coords="871,107,982,133"/><area shape="rect" id="node7" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga59354104129b38287823b51095c8e144" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file &#45; light version." alt="" coords="421,107,597,133"/><area shape="rect" id="node8" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga48fa3a38bfe17aa6d17636903e08a026" title="&lt;&lt;private&gt;&gt; Reads a memory area from the checkpoint file &#45; heavy version." alt="" coords="419,187,599,213"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="1033,107,1178,133"/><area shape="rect" id="node9" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="661,157,809,184"/><area shape="rect" id="node10" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaf3bb948cfeb680ab12571de3f8b23dc5" title="&lt;&lt;private&gt;&gt; This method is responsible for fixing a the stack in the area just read from the checkpoi..." alt="" coords="648,209,821,250"/><area shape="rect" id="node11" href="../../df/d54/group__tcmi__ckpt__class.html#gac8491faf16814e68e4da2dbf77c1f9cf" title="&lt;&lt;public&gt;&gt; Helper method that performs a memory mapping on the checkpoint file at its current offset..." alt="" coords="663,275,806,301"/><area shape="rect" id="node12" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="869,275,984,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga6b8d00619b038e49b552f87cea4a8129"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_read_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#gacd057c681c2da8004f43de8075b9af1b">vfs_method_t</a> *&#160;</td>
          <td class="paramname"><em>vfs_method</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">*data</td><td>- buffer for the data </td></tr>
    <tr><td class="paramname">count</td><td>- number of bytes to be processed </td></tr>
    <tr><td class="paramname">*vfs_method</td><td>- VFS method to be executed on the checkpoint and data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon successful vfs method execution or an error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00194">194</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00234">tcmi_ckpt_read()</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00220">tcmi_ckpt_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    mm_segment_t old_fs;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">int</span> result = 0;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    old_fs = get_fs();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    set_fs(get_ds());</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">/* The cast to a user pointer is valid due to the set_fs() */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    result = vfs_method(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>, (<span class="keywordtype">void</span> __user *)<a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084" title="Helper field that stores content of args/envp for the serialization.">data</a>, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, &amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>-&gt;f_pos);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;DEBUG read vfs method return = %d&quot;</span>, result);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    set_fs(old_fs);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> (result == <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a> ? 0 : -EINVAL);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga6128870e21ea3aef1bf88d8e34e4cd48"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static loff_t tcmi_ckpt_seek </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>origin</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">*offset</td><td>- relative offset </td></tr>
    <tr><td class="paramname">origin</td><td>- 0 - offset is absolute from file start 1 - offset is relative from current file position 2 - offset is relative from end of file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new file position or error (&lt; 0) </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00252">252</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>.</p>

<p>Referenced by <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00271">tcmi_ckpt_do_mmap()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00063">tcmi_ckpt_new()</a>, and <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00197">tcmi_ckpt_vm_area_write_h()</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> vfs_llseek(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ac4b918d9117fbd979317c83c9a8e18b2" title="Actual file used create/restore the process checkpoint.">file</a>, offset, origin);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gab3d478dd860126047413a05828c02360"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ckpt_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">*data</td><td>- data to be written </td></tr>
    <tr><td class="paramname">count</td><td>- number of bytes to be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon successful write of count bytes </dd></dl>

<p>Definition at line <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00220">220</a> of file <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html">tcmi_ckpt.h</a>.</p>

<p>References <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00194">tcmi_ckpt_read_write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d06/tcmi__ckpt__fsstruct_8h_source.html#l00016">tcmi_ckpt_fsstruct_write()</a>, <a class="el" href="../../dc/dc6/tcmi__ckpt__mm_8h_source.html#l00074">tcmi_ckpt_mm_write()</a>, <a class="el" href="../../dd/d4a/tcmi__ckpt__npm__params_8h_source.html#l00018">tcmi_ckpt_npm_params_write()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00133">tcmi_ckpt_openfile_write_dupfd()</a>, <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00170">tcmi_ckpt_openfile_write_newfd()</a>, <a class="el" href="../../de/d5f/tcmi__ckpt__regs_8h_source.html#l00047">tcmi_ckpt_regs_write()</a>, <a class="el" href="../../df/d07/tcmi__ckpt__thread_8h_source.html#l00009">tcmi_ckpt_tls_write()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00197">tcmi_ckpt_vm_area_write_h()</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00124">tcmi_ckpt_vm_area_write_l()</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00105">tcmi_ckpt_write_hdr()</a>, and <a class="el" href="../../da/dab/tcmi__ckpt__resources_8h_source.html#l00028">tcmi_ckpt_write_rlimit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file.">tcmi_ckpt_read_write</a>(<span class="keyword">self</span>, <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084" title="Helper field that stores content of args/envp for the serialization.">data</a>, <a class="code" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c">count</a>, (<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gacd057c681c2da8004f43de8075b9af1b" title="Describes the signature of the VFS method (typically vfs_read or vfs_write.">vfs_method_t</a>*)vfs_write);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gab3d478dd860126047413a05828c02360_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gab3d478dd860126047413a05828c02360_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gab3d478dd860126047413a05828c02360_cgraph" id="df/d54/group__tcmi__ckpt__class_gab3d478dd860126047413a05828c02360_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="169,5,314,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga8eb79d798591739f7234bae67265e097"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_write_files </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes open files into the checkpoint. </p>
<p>Iterates through all open files of the current process and writes each file details into the checkpoint. Since some files might be just a duplicate file descriptor, we always check with the file descriptor cache. For duplicate file descriptors only simplified record is needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00194">194</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00123">fd</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00336">tcmi_ckpt_foreach_openfile</a>, and <a class="el" href="../../d4/d62/tcmi__ckpt__openfile_8c_source.html#l00060">tcmi_ckpt_openfile_write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a4a05f54831975728fbdcadcb6fc4d40e" title="file descriptor">fd</a> = 0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">struct </span>file *file;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">/* Check each open file */</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab07e0068ff7b0d4b9b577cb3d5fcf715" title="&lt;&lt;public&gt;&gt; Iterates through all open files">tcmi_ckpt_foreach_openfile</a>(file, fd) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;Processing &#39;%s&#39; fd=%d, type=%0o flags %08o, mode %08o, %p&quot;</span>, </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;             file-&gt;f_dentry-&gt;d_name.name, fd, file-&gt;f_dentry-&gt;d_inode-&gt;i_mode &amp; S_IFMT, </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;             file-&gt;f_flags, file-&gt;f_mode, file);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> ( (err = <a class="code" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga1ea75bd539338fdc841bcf97c1a32bef" title="&lt;&lt;public&gt;&gt; Writes an open file information into the checkpoint file.">tcmi_ckpt_openfile_write</a>(<span class="keyword">self</span>, fd, file)) &lt; 0) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Error writing file into checkpoint. Error %d&quot;</span>, err);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; exit0:</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga8eb79d798591739f7234bae67265e097_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga8eb79d798591739f7234bae67265e097_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga8eb79d798591739f7234bae67265e097_cgraph" id="df/d54/group__tcmi__ckpt__class_ga8eb79d798591739f7234bae67265e097_cgraph">
<area shape="rect" id="node2" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga1ea75bd539338fdc841bcf97c1a32bef" title="&lt;&lt;public&gt;&gt; Writes an open file information into the checkpoint file." alt="" coords="197,57,328,98"/><area shape="rect" id="node3" href="../../df/d54/group__tcmi__ckpt__class.html#ga5847c258ee160509359de5f5c27a2c33" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file." alt="" coords="376,5,552,32"/><area shape="rect" id="node5" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gafe70b47b94f4f0cccf013f758d89f046" title="&lt;&lt;private&gt;&gt; Writes a duplicate file descriptor chunk into the checkpoint file." alt="" coords="399,57,529,98"/><area shape="rect" id="node8" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#gabe85fffb1a72d2cf11ccde5f557ec3b6" title="&lt;&lt;private&gt;&gt; Writes a new file chunk into the checkpoint file." alt="" coords="399,154,529,195"/><area shape="rect" id="node4" href="../../dd/d41/group__tcmi__fdcache__class.html#ga09e6e85f776f3e0a1dc672b1f5c7979c" title="&lt;&lt;public&gt;&gt; Searches the file descriptor cache for a file." alt="" coords="620,5,764,32"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="635,60,749,87"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="847,52,993,79"/><area shape="rect" id="node9" href="../../d5/d77/proxyfs__helper_8h.html#a074be037b0aae4d248a61c90c2c68737" title="Checks, whether the file is proxyfs file." alt="" coords="640,111,744,137"/><area shape="rect" id="node10" href="../../d5/d77/proxyfs__helper_8h.html#a25be89ac94beb85ee51564c78d4031d7" title="Returns true, if the path points to a dev null file." alt="" coords="649,161,735,188"/><area shape="rect" id="node11" href="../../db/d78/group__proxyfs__server__class.html#ga0cf24b2ce6d39d211a219c3e0f53ff41" title="&lt;&lt;public&gt;&gt; &lt;&lt;exported&gt;&gt; Make file available trought proxyfs" alt="" coords="601,212,783,239"/><area shape="rect" id="node33" href="../../d5/d77/proxyfs__helper_8h.html#ae73c5991f03548d8f100d7200d80113e" title="Creates a name of a proxy file." alt="" coords="619,263,765,289"/><area shape="rect" id="node34" href="../../df/d54/group__tcmi__ckpt__class.html#ga59be6dd10ef81e4812417bfe0dd5f4c5" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="613,351,771,377"/><area shape="rect" id="node12" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#gaa072b8ffc0485563a02cd199ea44202d" title="&lt;&lt;public&gt;&gt; tty_real_file constructor" alt="" coords="837,103,1003,129"/><area shape="rect" id="node18" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gab01c9a2a21e46a82db7716411b088cae" title="&lt;&lt;public&gt;&gt; pipe_real_file construktor" alt="" coords="832,153,1008,180"/><area shape="rect" id="node30" href="../../d5/d89/proxyfs__real__file_8c.html#aa8bee110603ba3a6715496c0d4387874" title="&lt;&lt;public&gt;&gt; Adds shadow task into a shadow list of the file" alt="" coords="849,205,991,246"/><area shape="rect" id="node31" href="../../d0/dc1/proxyfs__server_8c.html#ad4aa6f1a2c9ee37939e3cfc52f6c6cd8" title="proxyfs_server_register\l_poll_callback" alt="" coords="843,322,997,363"/><area shape="rect" id="node20" href="../../da/d41/group__proxyfs__real__file__class.html#gad4ca43cdfe83775498c3c52ac5f7df18" title="&lt;&lt;public&gt;&gt; Deinitialize real_file" alt="" coords="1059,263,1224,289"/><area shape="rect" id="node13" href="../../de/d0d/group__proxyfs__tty__real__file__class.html#ga115051874a5892b99e1028cc4b6d2738" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="1061,103,1222,129"/><area shape="rect" id="node14" href="../../da/d41/group__proxyfs__real__file__class.html#ga3cafcaf17f89ac4e7fe848ecbbdb7dbc" title="&lt;&lt;public&gt;&gt; Initialize real_file" alt="" coords="1275,153,1413,180"/><area shape="rect" id="node15" href="../../d1/d14/group__proxyfs__file__class.html#ga104071e772f98e9a9151a6f9eaff5cfa" title="&lt;&lt;public&gt;&gt; Initialize proxyfs_file struct" alt="" coords="1467,155,1578,181"/><area shape="rect" id="node16" href="../../d4/d27/group__circ__buf__clas.html#ga340b6d6ae954ce66d15dace7f7c54e61" title="circ_buf_init" alt="" coords="1645,155,1736,181"/><area shape="rect" id="node17" href="../../d4/d27/group__circ__buf__clas.html#ga36c9967179adece95b711ac84023b2a4" title="&lt;&lt;public&gt;&gt; Opossite function to circ_buf_init" alt="" coords="1632,205,1749,232"/><area shape="rect" id="node19" href="../../d2/dc8/group__proxyfs__pipe__real__file__class.html#gaf77b5c0d93e89ac2e8fd5ebe74c0b8a2" title="&lt;&lt;public&gt;&gt; Initialize tty_real_file" alt="" coords="1056,204,1227,231"/><area shape="rect" id="node21" href="../../d1/d14/group__proxyfs__file__class.html#ga98106c38478a4df7b861052d341a0578" title="&lt;&lt;public&gt;&gt; Get file identifier" alt="" coords="1277,317,1411,358"/><area shape="rect" id="node22" href="../../d1/d14/group__proxyfs__file__class.html#ga5bbed7e844f5afab2fbd943457de4bf6" title="&lt;&lt;public&gt;&gt; Deinitialize proxyfs_file struct" alt="" coords="1275,261,1413,288"/><area shape="rect" id="node23" href="../../d3/d52/group__proxyfs__peer__class.html#ga0dc1598ce5116c8fe21c66b8b977ab4b" title="&lt;&lt;public&gt;&gt; Puts proxyfs_peer instance reference and on reaching zero destroys the instance..." alt="" coords="1462,261,1583,288"/><area shape="rect" id="node24" href="../../d6/d8e/group__kkc__sock__class.html#ga00d8b033d3e1118303e7b4c54c6aafe6" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1799,257,1966,284"/><area shape="rect" id="node26" href="../../d6/d8e/group__kkc__sock__class.html#ga9f980056fbf3436596c4cfdf3913e85c" title="&lt;&lt;public&gt;&gt; Decrements reference counter, if it reaches 0 the custom free method is called if defined..." alt="" coords="1639,308,1742,335"/><area shape="rect" id="node25" href="../../d6/d8e/group__kkc__sock__class.html#gadf1b231c727891d5ac2d32646d574931" title="&lt;&lt;public&gt;&gt; Peer socket name accessor." alt="" coords="2017,257,2177,284"/><area shape="rect" id="node27" href="../../d5/ddf/group__kkc__arch__class.html#ga06049c969ae0324d0607f10db99af65c" title="&lt;&lt;public&gt;&gt; Decrements the reference counter on the module owning the architecture." alt="" coords="1833,308,1933,335"/><area shape="rect" id="node28" href="../../d6/d8e/group__kkc__sock__class.html#gac8e64f52015e75cb76a34c4b7e9ef176" title="&lt;&lt;public&gt;&gt; Socket name accessor." alt="" coords="1797,359,1968,385"/><area shape="rect" id="node29" href="../../d6/d8e/group__kkc__sock__class.html#ga3cae649f56c8f5fa18f755f6c7d53597" title="&lt;&lt;public&gt;&gt; Local socket name accessor." alt="" coords="2016,359,2179,385"/><area shape="rect" id="node32" href="../../d0/dc1/proxyfs__server_8c.html#ab50c180af3b49b9044929be991b6e74d" title="&lt;&lt;private&gt;&gt; Method used for waiting on files, callback for poll structure" alt="" coords="1075,319,1207,361"/><area shape="rect" id="node35" href="../../dd/d41/group__tcmi__fdcache__class.html#ga613fb750743c8a42aab62f9bcc230bd6" title="&lt;&lt;public&gt;&gt; Adds a file descriptor &#45; file object pair into the fd cache." alt="" coords="857,388,983,415"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaecf1343fc1988bd210f6fc1ef349e256"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_write_hdr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_npm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes a checkpoint header. </p>
<p>The checkpoint header consists of:</p>
<ul>
<li>a magic number</li>
<li>total VM area count</li>
<li>total file count</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">is_npm</td><td>- Is this a non-preemptive checkpoint (otherwise preemptive is assumed) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00105">105</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00096">is_npm</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d0/dc1/proxyfs__server_8c_source.html#l00059">self</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00345">tcmi_ckpt_file_count()</a>, <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00106">TCMI_CKPT_MAGIC</a>, <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00310">tcmi_ckpt_map_count()</a>, and <a class="el" href="../../d6/db7/tcmi__ckpt_8h_source.html#l00220">tcmi_ckpt_write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">self</span>-&gt;hdr.checkpoint_arch = ARCH_CURRENT;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">self</span>-&gt;hdr.is_32bit_application = check_is_application_32bit();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keyword">self</span>-&gt;hdr.magic = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gae5a75a75cafe1195ce2aebb5a53e3970" title="a magic number for the header">TCMI_CKPT_MAGIC</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keyword">self</span>-&gt;hdr.is_npm = <a class="code" href="../../d6/db7/tcmi__ckpt_8h.html#a3b020b8f86ab9a3376dd028e485ae04b" title="1, if this is checkpoint created as a result of non-preemptive migration request (0 otherwise)...">is_npm</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> ((self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#a8cd0958a70158b587474bcf6645dad02" title="total count of virtual memory areas.">map_count</a> = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gacea45b22c76a0bff6422d8d4e3731925" title="&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process.">tcmi_ckpt_map_count</a>(<span class="keyword">self</span>)) &lt; 0) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed counting mmap&#39;s&quot;</span>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> ((self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ae430e56f23d1af15dad8f0d377d8d730" title="total count of open files.">file_count</a> = <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process.">tcmi_ckpt_file_count</a>(<span class="keyword">self</span>)) &lt; 0) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Failed counting open files&quot;</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (tcmi_ckpt_fdcache_init(<span class="keyword">self</span>) &lt; 0) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Error initializing file descriptor cache!!&quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// No need to lock, exclusive access</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    strncpy(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>.<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#ae5b29a78354f731c3c852d0236da26f3" title="Process executable name.">comm</a>, current-&gt;comm, <span class="keyword">sizeof</span>(current-&gt;comm));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Writing header of size: %lu Address: %p First 4 bytes: %8x&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<span class="keyword">sizeof</span>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>), &amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>, ((uint32_t*)(&amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>))[0]);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file.">tcmi_ckpt_write</a>(<span class="keyword">self</span>, &amp;self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>, <span class="keyword">sizeof</span>(self-&gt;<a class="code" href="../../df/d54/group__tcmi__ckpt__class.html#afc332f7860d6621b8200c44859b67dbc" title="Checkpoint header.">hdr</a>));</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; exit0:</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_gaecf1343fc1988bd210f6fc1ef349e256_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_gaecf1343fc1988bd210f6fc1ef349e256_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_gaecf1343fc1988bd210f6fc1ef349e256_cgraph" id="df/d54/group__tcmi__ckpt__class_gaecf1343fc1988bd210f6fc1ef349e256_cgraph">
<area shape="rect" id="node2" href="../../df/d54/group__tcmi__ckpt__class.html#gac1c519443be61f5923b9f6cc8fe92d1e" title="&lt;&lt;private&gt;&gt; Calculates the number of open files of the current process." alt="" coords="197,63,339,89"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#gacea45b22c76a0bff6422d8d4e3731925" title="&lt;&lt;private&gt;&gt; Calculates the number of memory regions of the current process." alt="" coords="193,8,343,35"/><area shape="rect" id="node6" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="211,117,325,144"/><area shape="rect" id="node3" href="../../d4/d2b/tcmi__npm__params_8c.html#af64f4ee0104b701e4f843c457b77e14c" title="count" alt="" coords="438,5,493,32"/><area shape="rect" id="node4" href="../../d6/d9c/group__tcmi__ckpt__openfile__class.html#ga733163f46fde5d5e4502bf35fe4f8a4d" title="&lt;&lt;public&gt;&gt; Class method &#45; checks if the specified file(represented by its inode) is supported by chec..." alt="" coords="400,57,531,98"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="393,123,538,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga5efebada8a7a33c270340b392412db81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_write_regs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pt_regs *&#160;</td>
          <td class="paramname"><em>regs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes process CPU registers into the checkpoint. </p>

</div>
</div>
<a class="anchor" id="ga9d1cb4bfd021a3a845689a7262fe8190"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcmi_ckpt_write_vmas </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>heavy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Writes process memory regions into the checkpoint. </p>
<p>&lt;&lt;public&gt;&gt; Writes process memory regions into the checkpoint.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*self</td><td>- this checkpoint instance </td></tr>
    <tr><td class="paramname">heavy</td><td>- if set a full checkpoint of all memory areas is made(see tcmi_ckptcom.c::tcmi_ckptcom_checkpoint()). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html#l00244">244</a> of file <a class="el" href="../../d1/dc6/tcmi__ckpt_8c_source.html">tcmi_ckpt.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00063">TCMI_CKPT_VM_AREA_HEAVY</a>, <a class="el" href="../../da/d20/tcmi__ckpt__vm__area_8h_source.html#l00062">TCMI_CKPT_VM_AREA_LIGHT</a>, <a class="el" href="../../dc/d9a/tcmi__ckpt__vm__area_8c_source.html#l00052">tcmi_ckpt_vm_area_write()</a>, <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h_source.html#l00131">type</a>, and <a class="el" href="../../da/df4/i386_2vma_8h_source.html#l00005">vma_ignore</a>.</p>

<p>Referenced by <a class="el" href="../../db/d70/tcmi__ckptcom_8c_source.html#l00074">tcmi_ckptcom_checkpoint()</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gaa592b3a7c04c11a2f77967faf0c4930c" title="Describes the type of the vm area we store, see above.">tcmi_ckpt_vm_area_t</a> <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a01e201dc18b51fdb0b7b2238343d9df7" title="file type">type</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">/* select the checkpoint type*/</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    type = (heavy ? <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930cacd7d761a8e03085e22b88e7903561ffb">TCMI_CKPT_VM_AREA_HEAVY</a> : <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ggaa592b3a7c04c11a2f77967faf0c4930ca92a525dd7bd2dde8c9098dd79b8fdd1f">TCMI_CKPT_VM_AREA_LIGHT</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    tcmi_ckpt_foreach_vma(vma) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../da/df4/i386_2vma_8h.html#aa0673ccd379a191d54d5bd4e07593956" title="Returns 1, if the vma should be ignored by checkpointing componenet.">vma_ignore</a>(<span class="keyword">self</span>, vma) )</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">if</span> ((err = <a class="code" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga2da52b7d6a4fc42437ad12d18b7806e5" title="&lt;&lt;public&gt;&gt; Writes a specified memory area into the checkpoint file.">tcmi_ckpt_vm_area_write</a>(<span class="keyword">self</span>, vma, type)) &lt; 0) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(ERR3, <span class="stringliteral">&quot;Can&#39;t write vm area start:%08lx, end: %08lx, flags: %08lx, pageprot %08lx&quot;</span>, </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;             vma-&gt;vm_start, vma-&gt;vm_end, vma-&gt;vm_flags, vma-&gt;vm_page_prot.pgprot);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">goto</span> exit0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; exit0:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../df/d54/group__tcmi__ckpt__class_ga9d1cb4bfd021a3a845689a7262fe8190_cgraph.png" border="0" usemap="#df/d54/group__tcmi__ckpt__class_ga9d1cb4bfd021a3a845689a7262fe8190_cgraph" alt=""/></div>
<map name="df/d54/group__tcmi__ckpt__class_ga9d1cb4bfd021a3a845689a7262fe8190_cgraph" id="df/d54/group__tcmi__ckpt__class_ga9d1cb4bfd021a3a845689a7262fe8190_cgraph">
<area shape="rect" id="node2" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga2da52b7d6a4fc42437ad12d18b7806e5" title="&lt;&lt;public&gt;&gt; Writes a specified memory area into the checkpoint file." alt="" coords="205,31,373,57"/><area shape="rect" id="node3" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#ga1bf3e24cdf83c3d7506e8eb8c2cea4d5" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file &#45; light version." alt="" coords="424,5,603,32"/><area shape="rect" id="node6" href="../../d3/dad/group__tcmi__ckpt__vm__area__class.html#gadb0972a6f0e422425746f27d4411c3f6" title="&lt;&lt;private&gt;&gt; Writes a specified memory area into the checkpoint file &#45; heavy version." alt="" coords="422,56,605,83"/><area shape="rect" id="node4" href="../../df/d54/group__tcmi__ckpt__class.html#gab3d478dd860126047413a05828c02360" title="&lt;&lt;public&gt;&gt; Writes a specified number of bytes into a checkpoint file." alt="" coords="671,5,785,32"/><area shape="rect" id="node5" href="../../df/d54/group__tcmi__ckpt__class.html#ga6b8d00619b038e49b552f87cea4a8129" title="&lt;&lt;private&gt;&gt; Executes a specified VFS method on the checkpoint file." alt="" coords="851,5,997,32"/><area shape="rect" id="node7" href="../../df/d54/group__tcmi__ckpt__class.html#gac5d7b45cd57fdd09ac83ce079260ec7e" title="&lt;&lt;public&gt;&gt; Aligns the position in the checkpoint file to page boundary." alt="" coords="654,56,802,83"/><area shape="rect" id="node8" href="../../df/d54/group__tcmi__ckpt__class.html#ga6128870e21ea3aef1bf88d8e34e4cd48" title="&lt;&lt;public&gt;&gt; Seeks in the checkpoint file based on specified offset." alt="" coords="671,107,785,133"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gadc15809038086006d81c961e1ead21b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d54/group__tcmi__ckpt__class.html#dd/d41/structtcmi__ckpt">tcmi_ckpt</a>  __attribute__</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2013 19:06:04 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
