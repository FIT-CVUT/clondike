<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Clondike: control filesystem</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Clondike
   </div>
   <div id="projectbrief">Supported to Linux kernel 3.6.11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d9/d0a/group__tcmi__ctlfs__class.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">control filesystem<div class="ingroups"><a class="el" href="../../d0/d20/group__tcmi__module__class.html">TCMI</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This &lt;&lt;singleton&gt;&gt; class represents TCMI control filesystem.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for control filesystem:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="../../d9/d0a/group__tcmi__ctlfs__class.png" border="0" alt="" usemap="#d9_2d0a_2group____tcmi____ctlfs____class"/>
<map name="d9_2d0a_2group____tcmi____ctlfs____class" id="d9_2d0a_2group____tcmi____ctlfs____class">
<area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html" title="This class represents a generic entry in the tcmi control file system." alt="" coords="280,5,429,32"/><area shape="rect" id="node2" href="../../d0/d20/group__tcmi__module__class.html" title="This &lt;&lt;singleton&gt;&gt; class is the base of the infrastructure and is responsible for initialization/shut..." alt="" coords="6,5,58,32"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:d8/d36/group__tcmi__ctlfs__entry__class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html">tcmi_ctlfs_entry class</a></td></tr>
<tr class="memdesc:d8/d36/group__tcmi__ctlfs__entry__class"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class represents a generic entry in the tcmi control file system. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:de/d48/structtcmi__ctlfs"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#de/d48/structtcmi__ctlfs">tcmi_ctlfs</a></td></tr>
<tr class="memdesc:de/d48/structtcmi__ctlfs"><td class="mdescLeft">&#160;</td><td class="mdescRight">A compound structure that contains all internal data of TCMI ctlfs.  <a href="../../d9/d0a/group__tcmi__ctlfs__class.html#de/d48/structtcmi__ctlfs">More...</a><br/></td></tr>
<tr class="separator:de/d48/structtcmi__ctlfs"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaf838aee6d2933dc427bf9d47ac09c610"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaf838aee6d2933dc427bf9d47ac09c610">TCMI_PERMS_DIR</a>&#160;&#160;&#160;(S_IRWXU | S_IRGRP | S_IXGRP)</td></tr>
<tr class="memdesc:gaf838aee6d2933dc427bf9d47ac09c610"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred directory rights.  <a href="#gaf838aee6d2933dc427bf9d47ac09c610">More...</a><br/></td></tr>
<tr class="separator:gaf838aee6d2933dc427bf9d47ac09c610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa901982b6e65df648201a7a7f80f232b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaa901982b6e65df648201a7a7f80f232b">TCMI_PERMS_FILE_W</a>&#160;&#160;&#160;(S_IWUSR)</td></tr>
<tr class="memdesc:gaa901982b6e65df648201a7a7f80f232b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred write file rights.  <a href="#gaa901982b6e65df648201a7a7f80f232b">More...</a><br/></td></tr>
<tr class="separator:gaa901982b6e65df648201a7a7f80f232b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga84907a0ffd1393cf8b462e14c9b4140a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga84907a0ffd1393cf8b462e14c9b4140a">TCMI_PERMS_FILE_R</a>&#160;&#160;&#160;(S_IRUSR | S_IRGRP)</td></tr>
<tr class="memdesc:ga84907a0ffd1393cf8b462e14c9b4140a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred read file rights.  <a href="#ga84907a0ffd1393cf8b462e14c9b4140a">More...</a><br/></td></tr>
<tr class="separator:ga84907a0ffd1393cf8b462e14c9b4140a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga680783e87260249d7b0132bff2bc4537"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga680783e87260249d7b0132bff2bc4537">TCMI_PERMS_FILE_RW</a>&#160;&#160;&#160;(<a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga84907a0ffd1393cf8b462e14c9b4140a">TCMI_PERMS_FILE_R</a> | <a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaa901982b6e65df648201a7a7f80f232b">TCMI_PERMS_FILE_W</a>)</td></tr>
<tr class="memdesc:ga680783e87260249d7b0132bff2bc4537"><td class="mdescLeft">&#160;</td><td class="mdescRight">Preferred read/write file rights.  <a href="#ga680783e87260249d7b0132bff2bc4537">More...</a><br/></td></tr>
<tr class="separator:ga680783e87260249d7b0132bff2bc4537"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac94582025e10222db6e3afa7b80f3d6d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac94582025e10222db6e3afa7b80f3d6d">init_once</a> (void *foo)</td></tr>
<tr class="separator:gac94582025e10222db6e3afa7b80f3d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga36798ee72c34451b47002a014fb27841"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga36798ee72c34451b47002a014fb27841">init_inodecache</a> (void)</td></tr>
<tr class="separator:ga36798ee72c34451b47002a014fb27841"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac4d25609cd85ba4cc80e0aa74c6d0ffd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac4d25609cd85ba4cc80e0aa74c6d0ffd">destroy_inodecache</a> (void)</td></tr>
<tr class="separator:gac4d25609cd85ba4cc80e0aa74c6d0ffd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga317a044cf2282a14839a817b4ac9fdee"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga317a044cf2282a14839a817b4ac9fdee">tcmi_ctlfs_fill_super</a> (struct super_block *sb, void *<a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084">data</a>, int silent)</td></tr>
<tr class="memdesc:ga317a044cf2282a14839a817b4ac9fdee"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Sets up super block and instantiates the root directory.  <a href="#ga317a044cf2282a14839a817b4ac9fdee">More...</a><br/></td></tr>
<tr class="separator:ga317a044cf2282a14839a817b4ac9fdee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga17d566b46127491aefd74c4f745d28bb"><td class="memItemLeft" align="right" valign="top">static struct dentry *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga17d566b46127491aefd74c4f745d28bb">tcmi_ctlfs_get_super</a> (struct file_system_type *fst, int <a class="el" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97">flags</a>, const char *devname, void *<a class="el" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084">data</a>)</td></tr>
<tr class="memdesc:ga17d566b46127491aefd74c4f745d28bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;private&gt;&gt; Super block as assigned a nonexistent device and the super block is obtained via mount_single().  <a href="#ga17d566b46127491aefd74c4f745d28bb">More...</a><br/></td></tr>
<tr class="separator:ga17d566b46127491aefd74c4f745d28bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf285a6af66f6a266c2a131b389cb6286"><td class="memItemLeft" align="right" valign="top">static int __init&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaf285a6af66f6a266c2a131b389cb6286">tcmi_ctlfs_init</a> (void)</td></tr>
<tr class="memdesc:gaf285a6af66f6a266c2a131b389cb6286"><td class="mdescLeft">&#160;</td><td class="mdescRight">Module initialization.  <a href="#gaf285a6af66f6a266c2a131b389cb6286">More...</a><br/></td></tr>
<tr class="separator:gaf285a6af66f6a266c2a131b389cb6286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeba985615bf24bdd93ce94d8bb908bee"><td class="memItemLeft" align="right" valign="top">static void __exit&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaeba985615bf24bdd93ce94d8bb908bee">tcmi_ctlfs_exit</a> (void)</td></tr>
<tr class="memdesc:gaeba985615bf24bdd93ce94d8bb908bee"><td class="mdescLeft">&#160;</td><td class="mdescRight">module cleanup  <a href="#gaeba985615bf24bdd93ce94d8bb908bee">More...</a><br/></td></tr>
<tr class="separator:gaeba985615bf24bdd93ce94d8bb908bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9b470bbc2b997efd258e5328d3f8b322"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga9b470bbc2b997efd258e5328d3f8b322">tcmi_ctlfs_get_root</a> (void)</td></tr>
<tr class="memdesc:ga9b470bbc2b997efd258e5328d3f8b322"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Root entry accessor.  <a href="#ga9b470bbc2b997efd258e5328d3f8b322">More...</a><br/></td></tr>
<tr class="separator:ga9b470bbc2b997efd258e5328d3f8b322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacdb60ef3fbd577a92bc310d947c8d70a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gacdb60ef3fbd577a92bc310d947c8d70a">tcmi_ctlfs_put_root</a> (void)</td></tr>
<tr class="memdesc:gacdb60ef3fbd577a92bc310d947c8d70a"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;public&gt;&gt; Releases the root directory.  <a href="#gacdb60ef3fbd577a92bc310d947c8d70a">More...</a><br/></td></tr>
<tr class="separator:gacdb60ef3fbd577a92bc310d947c8d70a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga421970550ae6c16fc9ca73ed85cee16e"><td class="memItemLeft" align="right" valign="top">static struct kmem_cache *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga421970550ae6c16fc9ca73ed85cee16e">ctlfs_inode_cachep</a></td></tr>
<tr class="separator:ga421970550ae6c16fc9ca73ed85cee16e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdbc077942666baae572bafc4e0c321e"><td class="memItemLeft" align="right" valign="top">static struct super_operations&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gafdbc077942666baae572bafc4e0c321e">s_ops</a></td></tr>
<tr class="separator:gafdbc077942666baae572bafc4e0c321e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4dd5bd294e8feab6e66f70bfbc11ce74"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#de/d48/structtcmi__ctlfs">tcmi_ctlfs</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga4dd5bd294e8feab6e66f70bfbc11ce74">self</a></td></tr>
<tr class="memdesc:ga4dd5bd294e8feab6e66f70bfbc11ce74"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt;&lt;singleton&gt;&gt; instance initialization  <a href="#ga4dd5bd294e8feab6e66f70bfbc11ce74">More...</a><br/></td></tr>
<tr class="separator:ga4dd5bd294e8feab6e66f70bfbc11ce74"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This &lt;&lt;singleton&gt;&gt; class represents TCMI control filesystem. </p>
<p>The idea behind the filesystem is very similar to what we have in sysfs. The reason why a separate filesystem has been created is that TCMI doesn't fit among regular device drivers which is the primary use of sysfs.</p>
<p>Similarly to sysfs, we provide a mechanism that allows any object in TCMI to create an interface presented to user space. The user is able to notify the object via reading/writing a file.</p>
<p>An entity in TCMI ctlfs is called an 'entry'. Currently there are entries that represent <a class="el" href="../../d1/de7/group__tcmi__ctlfs__file__class.html#d0/d6c/structtcmi__ctlfs__file">a file </a>, <a class="el" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#d2/d56/structtcmi__ctlfs__dir">a directory </a> and <a class="el" href="../../dd/d30/group__tcmi__ctlfs__symlink__class.html#d0/d73/structtcmi__ctlfs__symlink">a symbolic link </a>. </p>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="de/d48/structtcmi__ctlfs" id="de/d48/structtcmi__ctlfs"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct tcmi_ctlfs</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>A compound structure that contains all internal data of TCMI ctlfs. </p>
<p>This is for internal use only. </p>

<p>Definition at line <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html#l00065">65</a> of file <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html">tcmi_ctlfs.h</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Collaboration diagram for tcmi_ctlfs:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d95/structtcmi__ctlfs__coll__graph.png" border="0" usemap="#tcmi__ctlfs_coll__map" alt="Collaboration graph"/></div>
<map name="tcmi__ctlfs_coll__map" id="tcmi__ctlfs_coll__map">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure." alt="" coords="5,147,120,239"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#df/d10/structtcmi__ctlfs__ops" title="entry operations that support polymorphism" alt="" coords="7,5,119,83"/></map>
</div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a8a9745db27150b6355bb100439edb2c8"></a>struct file_system_type</td>
<td class="fieldname">
fs_type</td>
<td class="fielddoc">
A forward declaration describing this filesystem type. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a1de80ccc61a93a11275b982e58b8b70e"></a>struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a> *</td>
<td class="fieldname">
root_dir</td>
<td class="fielddoc">
forward declaration of the root directory of the TCMI control filesystem </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af8cc4ccc12b5c6fb2de91670301bbe59"></a>struct super_block *</td>
<td class="fieldname">
sb</td>
<td class="fielddoc">
Filesystem super block object. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab282837da8912090e62d7a561c65671f"></a>struct vfsmount *</td>
<td class="fieldname">
vfs_mnt</td>
<td class="fielddoc">
forward declaration of the mount object of TCMI control filesystem </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a16389830bd68eeb0df768190ca4f71df"></a>struct semaphore</td>
<td class="fieldname">
vfs_mnt_sem</td>
<td class="fielddoc">
a semaphore that protects the vfs_mount variable against concurrent accesses. <p>This is important when issuing tcmi_ctlfs_get_root/tcmi_ctlfs_put_root </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gaf838aee6d2933dc427bf9d47ac09c610"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_PERMS_DIR&#160;&#160;&#160;(S_IRWXU | S_IRGRP | S_IXGRP)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Preferred directory rights. </p>

<p>Definition at line <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html#l00087">87</a> of file <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html">tcmi_ctlfs.h</a>.</p>

<p>Referenced by <a class="el" href="../../d2/de0/tcmi__ccnman_8c_source.html#l00133">tcmi_ccnman_init_ctlfs_dirs()</a>, <a class="el" href="../../dd/dbd/tcmi__man_8c_source.html#l00227">tcmi_man_init_ctlfs_dirs()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00358">tcmi_migman_init_ctlfs_dirs()</a>, <a class="el" href="../../da/d37/tcmi__sock_8c_source.html#l00058">tcmi_sock_new()</a>, and <a class="el" href="../../de/d84/tcmi__task_8c_source.html#l00114">tcmi_task_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga84907a0ffd1393cf8b462e14c9b4140a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_PERMS_FILE_R&#160;&#160;&#160;(S_IRUSR | S_IRGRP)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Preferred read file rights. </p>

<p>Definition at line <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html#l00091">91</a> of file <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html">tcmi_ctlfs.h</a>.</p>

<p>Referenced by <a class="el" href="../../dd/d56/tcmi__ccnmigman_8c_source.html#l00137">tcmi_ccnmigman_init_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00404">tcmi_migman_init_ctlfs_files()</a>, <a class="el" href="../../da/d37/tcmi__sock_8c_source.html#l00058">tcmi_sock_new()</a>, <a class="el" href="../../de/d84/tcmi__task_8c_source.html#l00114">tcmi_task_init()</a>, and <a class="el" href="../../d4/d4e/tcmi__task_8h_source.html#l00453">tcmi_task_set_remote_pid()</a>.</p>

</div>
</div>
<a class="anchor" id="ga680783e87260249d7b0132bff2bc4537"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_PERMS_FILE_RW&#160;&#160;&#160;(<a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga84907a0ffd1393cf8b462e14c9b4140a">TCMI_PERMS_FILE_R</a> | <a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gaa901982b6e65df648201a7a7f80f232b">TCMI_PERMS_FILE_W</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Preferred read/write file rights. </p>

<p>Definition at line <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html#l00093">93</a> of file <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html">tcmi_ctlfs.h</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d0f/tcmi__module_8c_source.html#l00122">tcmi_module_init()</a>.</p>

</div>
</div>
<a class="anchor" id="gaa901982b6e65df648201a7a7f80f232b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCMI_PERMS_FILE_W&#160;&#160;&#160;(S_IWUSR)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Preferred write file rights. </p>

<p>Definition at line <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html#l00089">89</a> of file <a class="el" href="../../d0/d49/tcmi__ctlfs_8h_source.html">tcmi_ctlfs.h</a>.</p>

<p>Referenced by <a class="el" href="../../d2/de0/tcmi__ccnman_8c_source.html#l00159">tcmi_ccnman_init_ctlfs_files()</a>, <a class="el" href="../../dd/dbd/tcmi__man_8c_source.html#l00276">tcmi_man_init_ctlfs_files()</a>, <a class="el" href="../../d6/d82/tcmi__migman_8c_source.html#l00404">tcmi_migman_init_ctlfs_files()</a>, <a class="el" href="../../d9/d86/tcmi__penman_8c_source.html#l00103">tcmi_penman_init_ctlfs_files()</a>, and <a class="el" href="../../d9/ded/tcmi__penmigman_8c_source.html#l00154">tcmi_penmigman_init_ctlfs_files()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gac4d25609cd85ba4cc80e0aa74c6d0ffd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_inodecache </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00192">192</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00149">ctlfs_inode_cachep</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00270">tcmi_ctlfs_exit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    kmem_cache_destroy(<a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga421970550ae6c16fc9ca73ed85cee16e">ctlfs_inode_cachep</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga36798ee72c34451b47002a014fb27841"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int init_inodecache </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00183">183</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00149">ctlfs_inode_cachep</a>, and <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00151">init_once()</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00254">tcmi_ctlfs_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga421970550ae6c16fc9ca73ed85cee16e">ctlfs_inode_cachep</a> = kmem_cache_create(<span class="stringliteral">&quot;ctlfs_inode_cache&quot;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> inode), 0, (SLAB_RECLAIM_ACCOUNT| SLAB_MEM_SPREAD), <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac94582025e10222db6e3afa7b80f3d6d">init_once</a>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga421970550ae6c16fc9ca73ed85cee16e">ctlfs_inode_cachep</a> == NULL)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_ga36798ee72c34451b47002a014fb27841_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_ga36798ee72c34451b47002a014fb27841_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_ga36798ee72c34451b47002a014fb27841_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_ga36798ee72c34451b47002a014fb27841_cgraph">
<area shape="rect" id="node2" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac94582025e10222db6e3afa7b80f3d6d" title="init_once" alt="" coords="165,5,240,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac94582025e10222db6e3afa7b80f3d6d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void init_once </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>foo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00151">151</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00183">init_inodecache()</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                 {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;         <span class="keyword">struct </span>inode *inode = (<span class="keyword">struct </span>inode *) foo;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         inode_init_once(inode);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaeba985615bf24bdd93ce94d8bb908bee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __exit tcmi_ctlfs_exit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>module cleanup </p>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00270">270</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00192">destroy_inodecache()</a>, and <a class="el" href="../../d6/d01/dbg_8h_source.html#l00211">minfo</a>.</p>
<div class="fragment"><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(INFO3, <span class="stringliteral">&quot;Unregistering TCMI control filesystem&quot;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac4d25609cd85ba4cc80e0aa74c6d0ffd">destroy_inodecache</a>();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    unregister_filesystem(&amp;<span class="keyword">self</span>.fs_type);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_gaeba985615bf24bdd93ce94d8bb908bee_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_gaeba985615bf24bdd93ce94d8bb908bee_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_gaeba985615bf24bdd93ce94d8bb908bee_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_gaeba985615bf24bdd93ce94d8bb908bee_cgraph">
<area shape="rect" id="node2" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac4d25609cd85ba4cc80e0aa74c6d0ffd" title="destroy_inodecache" alt="" coords="160,5,299,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga317a044cf2282a14839a817b4ac9fdee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tcmi_ctlfs_fill_super </td>
          <td>(</td>
          <td class="paramtype">struct super_block *&#160;</td>
          <td class="paramname"><em>sb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>silent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Sets up super block and instantiates the root directory. </p>
<p>This method is called only once through out the super block life.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sb</td><td>- pointer to the super block </td></tr>
    <tr><td class="paramname">*data</td><td>- custom data supplied when reading the superblock(not used) </td></tr>
    <tr><td class="paramname">silent</td><td>- required by VFS, no idea what it means.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 upon success </dd></dl>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00215">215</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00198">s_ops</a>, <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00048">TCMI_CTLFS_MAGIC</a>, and <a class="el" href="../../d1/ddf/tcmi__ctlfs__dir_8c_source.html#l00114">tcmi_ctlfs_rootdir_new()</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00243">tcmi_ctlfs_get_super()</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;{</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    sb-&gt;s_blocksize = PAGE_CACHE_SIZE;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    sb-&gt;s_blocksize_bits = PAGE_CACHE_SHIFT;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    sb-&gt;s_magic = <a class="code" href="../../d0/d02/tcmi__ctlfs_8c.html#a26cec7630692af73c2cb403d3ee3f224" title="Magic number identifies the fs super block.">TCMI_CTLFS_MAGIC</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    sb-&gt;s_op = &amp;<a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gafdbc077942666baae572bafc4e0c321e">s_ops</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">self</span>.sb = sb;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;TMPDBG: GOING TO REQUEST ROOT&quot;</span>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">self</span>.root_dir = <a class="code" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#gad89f76bbf0883e5e40723543d815048e" title="&lt;&lt;public&gt;&gt; Root directory is instantiated by delegating all work to the parent class.">tcmi_ctlfs_rootdir_new</a>(sb);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO4, <span class="stringliteral">&quot;TMPDBG: ROOT SUCCEEDED&quot;</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_ga317a044cf2282a14839a817b4ac9fdee_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_ga317a044cf2282a14839a817b4ac9fdee_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_ga317a044cf2282a14839a817b4ac9fdee_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_ga317a044cf2282a14839a817b4ac9fdee_cgraph">
<area shape="rect" id="node2" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#gad89f76bbf0883e5e40723543d815048e" title="&lt;&lt;public&gt;&gt; Root directory is instantiated by delegating all work to the parent class." alt="" coords="190,35,341,61"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gacda4dfc581441853eea35819b0beca60" title="&lt;&lt;public&gt;&gt; Initializes a root entry instance." alt="" coords="389,5,549,32"/><area shape="rect" id="node5" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga71558bf14c4a13eed4e4b9ca240fd016" title="&lt;&lt;public&gt;&gt; Increments the number of links referencing this entry&#39;s inode." alt="" coords="400,57,539,98"/><area shape="rect" id="node4" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="597,5,739,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga9b470bbc2b997efd258e5328d3f8b322"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry">tcmi_ctlfs_entry</a>* tcmi_ctlfs_get_root </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Root entry accessor. </p>
<p>If the filesystem has not been activated yet, a kernel mount is performed. The kernel mount in turn ensures instantiation of the root directory. A user might have already mounted the filesystem from userspace. This is not a problem as we allow only one instance of the filesystem in memory(enforced by mount_single()), so only a reference counter of the root directory and the associated superblock is incremented. The last thread that releases the last reference to the super block and eventually to the root directory causes the whole filesystem to be released. See tcmi_ctlfs_kill_super() for details on this.</p>
<p>If the filesystem is already active (the vfs_mnt is valid), the mount reference count is adjusted.</p>
<p>It is necessary to protect the vfs_mnt variable as it can be manipulated by other threads that might issue <a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gacdb60ef3fbd577a92bc310d947c8d70a" title="&lt;&lt;public&gt;&gt; Releases the root directory and then the mount object.">tcmi_ctlfs_put_root()</a> and release the vfs mount from under us.</p>
<dl class="section return"><dt>Returns</dt><dd>pointer to the root entry (reference counter adjusted by <a class="el" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaab2e404bb2da373a66578541e2dc4ba9" title="&lt;&lt;public&gt;&gt; Instance accessor, Calls instance custom get method and increments the reference counter...">tcmi_ctlfs_entry_get()</a>) or NULL </dd></dl>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00076">76</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, <a class="el" href="../../d6/d01/dbg_8h_source.html#l00211">minfo</a>, and <a class="el" href="../../df/d2f/tcmi__ctlfs__entry_8h_source.html#l00178">tcmi_ctlfs_entry_get()</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d0f/tcmi__module_8c_source.html#l00122">tcmi_module_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    down(&amp;<span class="keyword">self</span>.vfs_mnt_sem);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* when the VFS mount is currently inactive we have to create</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">     * a new one */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (!<span class="keyword">self</span>.vfs_mnt) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;Mounting&quot;</span>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keyword">self</span>.vfs_mnt = kern_mount(&amp;<span class="keyword">self</span>.fs_type);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span> (IS_ERR(<span class="keyword">self</span>.vfs_mnt)) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(ERR1, <span class="stringliteral">&quot;Could not mount!&quot;</span>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keyword">self</span>.vfs_mnt = NULL;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="comment">/* if the mount failed, the root directory</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">             * instance doesn&#39;t exist too, so we don&#39;t</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">             * need to explicitely delete it*/</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keyword">self</span>.root_dir = NULL;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    } </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">/* VFS mount still active, just increment its ref. counter */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        mntget(<span class="keyword">self</span>.vfs_mnt);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    up(&amp;<span class="keyword">self</span>.vfs_mnt_sem);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;sb c_count=%d, s_active=%d&quot;</span>, <span class="keyword">self</span>.sb-&gt;s_count, </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;         atomic_read(&amp;<span class="keyword">self</span>.sb-&gt;s_active));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">//mdbg(INFO3, &quot;mount mnt_count=%d&quot;, atomic_read(&amp;self.vfs_mnt-&gt;mnt_count));</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaab2e404bb2da373a66578541e2dc4ba9" title="&lt;&lt;public&gt;&gt; Instance accessor, Calls instance custom get method and increments the reference counter...">tcmi_ctlfs_entry_get</a>(<span class="keyword">self</span>.root_dir);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_ga9b470bbc2b997efd258e5328d3f8b322_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_ga9b470bbc2b997efd258e5328d3f8b322_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_ga9b470bbc2b997efd258e5328d3f8b322_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_ga9b470bbc2b997efd258e5328d3f8b322_cgraph">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gaab2e404bb2da373a66578541e2dc4ba9" title="&lt;&lt;public&gt;&gt; Instance accessor, Calls instance custom get method and increments the reference counter..." alt="" coords="187,5,325,32"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="374,5,527,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga17d566b46127491aefd74c4f745d28bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct dentry* tcmi_ctlfs_get_super </td>
          <td>(</td>
          <td class="paramtype">struct file_system_type *&#160;</td>
          <td class="paramname"><em>fst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>devname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>&lt;&lt;private&gt;&gt; Super block as assigned a nonexistent device and the super block is obtained via mount_single(). </p>
<p>The kernel function mount_single() ensures that only 1 instance of the filesystem can be mounted at a time. Custom method to fill the super block is passed as parameter.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*fst</td><td>- points to the file system type, that is being mounted </td></tr>
    <tr><td class="paramname">flags</td><td>- </td></tr>
    <tr><td class="paramname">*devname</td><td>- device name, on which the file system resides (it has no meaning here) </td></tr>
    <tr><td class="paramname">*data</td><td>- pointer to private filesystem data - not used</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- pointer to the dentry object that has been created </dd></dl>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00243">243</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00215">tcmi_ctlfs_fill_super()</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">return</span> mount_single(fst, <a class="code" href="../../d4/d83/tcmi__ckpt__openfile_8h.html#a38a8a1678784eecc1ffcc0685dbcce97" title="flags specified by the user when opening the file">flags</a>, <a class="code" href="../../d9/d10/tcmi__npm__params_8h.html#ab9090ca30e7609aecaf540276e3c5084" title="Helper field that stores content of args/envp for the serialization.">data</a>, <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga317a044cf2282a14839a817b4ac9fdee" title="&lt;&lt;private&gt;&gt; Sets up super block and instantiates the root directory.">tcmi_ctlfs_fill_super</a>);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_ga17d566b46127491aefd74c4f745d28bb_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_ga17d566b46127491aefd74c4f745d28bb_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_ga17d566b46127491aefd74c4f745d28bb_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_ga17d566b46127491aefd74c4f745d28bb_cgraph">
<area shape="rect" id="node2" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga317a044cf2282a14839a817b4ac9fdee" title="&lt;&lt;private&gt;&gt; Sets up super block and instantiates the root directory." alt="" coords="197,35,333,61"/><area shape="rect" id="node3" href="../../dc/def/group__tcmi__ctlfs__dir__class.html#gad89f76bbf0883e5e40723543d815048e" title="&lt;&lt;public&gt;&gt; Root directory is instantiated by delegating all work to the parent class." alt="" coords="382,35,533,61"/><area shape="rect" id="node4" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#gacda4dfc581441853eea35819b0beca60" title="&lt;&lt;public&gt;&gt; Initializes a root entry instance." alt="" coords="581,5,741,32"/><area shape="rect" id="node6" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga71558bf14c4a13eed4e4b9ca240fd016" title="&lt;&lt;public&gt;&gt; Increments the number of links referencing this entry&#39;s inode." alt="" coords="592,57,731,98"/><area shape="rect" id="node5" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga256f5088d3434bfadcdb0cb59bf25cb7" title="&lt;&lt;private&gt;&gt; A method for inode allocation." alt="" coords="789,5,931,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaf285a6af66f6a266c2a131b389cb6286"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int __init tcmi_ctlfs_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Module initialization. </p>
<dl class="section return"><dt>Returns</dt><dd>- status of the register_filesystem() call </dd></dl>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00254">254</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00183">init_inodecache()</a>, and <a class="el" href="../../d6/d01/dbg_8h_source.html#l00211">minfo</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">int</span> error;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#abc23c8dde04f89ca72fc5035015a65e7">minfo</a>(INFO3, <span class="stringliteral">&quot;Registering TCMI control filesystem&quot;</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    error = <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga36798ee72c34451b47002a014fb27841">init_inodecache</a>();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span> (error)</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    error = register_filesystem(&amp;<span class="keyword">self</span>.fs_type);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">return</span> error;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_gaf285a6af66f6a266c2a131b389cb6286_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_gaf285a6af66f6a266c2a131b389cb6286_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_gaf285a6af66f6a266c2a131b389cb6286_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_gaf285a6af66f6a266c2a131b389cb6286_cgraph">
<area shape="rect" id="node2" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga36798ee72c34451b47002a014fb27841" title="init_inodecache" alt="" coords="157,5,269,32"/><area shape="rect" id="node3" href="../../d9/d0a/group__tcmi__ctlfs__class.html#gac94582025e10222db6e3afa7b80f3d6d" title="init_once" alt="" coords="317,5,392,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gacdb60ef3fbd577a92bc310d947c8d70a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tcmi_ctlfs_put_root </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt;&lt;public&gt;&gt; Releases the root directory. </p>
<p>&lt;&lt;public&gt;&gt; Releases the root directory.</p>
<p>VFS takes care of releasing the object in case their reference count reaches 0. We need to take care of setting the mnt to NULL.</p>
<p>The last 2 steps don't need to be semaphore protected as we are working on copies of both pointers and we wanted to protect the access to mnt only. If anybody tries to get a root from now on a new VFS mount will be created. If the root directory has been also destroyed, the read_super method takes care of instantiating a new super block along with the root directory. </p>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00117">117</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>References <a class="el" href="../../d6/d01/dbg_8h_source.html#l00210">mdbg</a>, and <a class="el" href="../../df/d2f/tcmi__ctlfs__entry_8h_source.html#l00212">tcmi_ctlfs_entry_put()</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d0f/tcmi__module_8c_source.html#l00168">tcmi_module_exit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">struct </span>vfsmount *cur_vfs_mnt;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#db/d2a/structtcmi__ctlfs__entry" title="An entry compound structure.">tcmi_ctlfs_entry</a> *cur_root_dir;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="../../d6/d01/dbg_8h.html#a881516d8ffc635f7f0e87468340c80dc">mdbg</a>(INFO3, <span class="stringliteral">&quot;sb c_count=%d, s_active=%d&quot;</span>, <span class="keyword">self</span>.sb-&gt;s_count, </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;         atomic_read(&amp;<span class="keyword">self</span>.sb-&gt;s_active));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">//mdbg(INFO3, &quot;mount mnt_count=%d&quot;, atomic_read(&amp;self.vfs_mnt-&gt;mnt_count));</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">/* mdbg(INFO3, &quot;root d_count=%d&quot;, atomic_read(&amp;self.root_dir-&gt;super.dentry-&gt;d_count));*/</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    down(&amp;<span class="keyword">self</span>.vfs_mnt_sem);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    cur_vfs_mnt = <span class="keyword">self</span>.vfs_mnt;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    cur_root_dir = <span class="keyword">self</span>.root_dir;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">/* If we are the last thread accesing the kernel mount */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">//Replaced construction reading mnt_count which it isn&#39;t included in vfsmount structure to function may_umount which return 1 when fs may be umounted | by Jiri Rakosnik</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">if</span>(may_umount(<span class="keyword">self</span>.vfs_mnt))     </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">self</span>.vfs_mnt = NULL;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    up(&amp;<span class="keyword">self</span>.vfs_mnt_sem);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">/* no locking needed since working on copies of both</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">     * pointers */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga6d6cbcd957efaaa590b335ac3150bb30" title="&lt;&lt;public&gt;&gt; Calls the instance custom put method(if any) and Decrements the reference counter of the d...">tcmi_ctlfs_entry_put</a>(cur_root_dir);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    mntput(cur_vfs_mnt);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="../../d9/d0a/group__tcmi__ctlfs__class_gacdb60ef3fbd577a92bc310d947c8d70a_cgraph.png" border="0" usemap="#d9/d0a/group__tcmi__ctlfs__class_gacdb60ef3fbd577a92bc310d947c8d70a_cgraph" alt=""/></div>
<map name="d9/d0a/group__tcmi__ctlfs__class_gacdb60ef3fbd577a92bc310d947c8d70a_cgraph" id="d9/d0a/group__tcmi__ctlfs__class_gacdb60ef3fbd577a92bc310d947c8d70a_cgraph">
<area shape="rect" id="node2" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga6d6cbcd957efaaa590b335ac3150bb30" title="&lt;&lt;public&gt;&gt; Calls the instance custom put method(if any) and Decrements the reference counter of the d..." alt="" coords="187,5,325,32"/><area shape="rect" id="node3" href="../../d8/d36/group__tcmi__ctlfs__entry__class.html#ga986b629882729daaf2c9607bfca57c3c" title="&lt;&lt;public&gt;&gt; Entry name accessor." alt="" coords="374,5,527,32"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga421970550ae6c16fc9ca73ed85cee16e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct kmem_cache* ctlfs_inode_cachep</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00149">149</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00192">destroy_inodecache()</a>, and <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00183">init_inodecache()</a>.</p>

</div>
</div>
<a class="anchor" id="gafdbc077942666baae572bafc4e0c321e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct super_operations s_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .statfs = simple_statfs,</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00198">198</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

<p>Referenced by <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00215">tcmi_ctlfs_fill_super()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4dd5bd294e8feab6e66f70bfbc11ce74"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d0a/group__tcmi__ctlfs__class.html#de/d48/structtcmi__ctlfs">tcmi_ctlfs</a> self</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    </div>
<div class="line">    .root_dir = NULL,</div>
<div class="line">    </div>
<div class="line">    .vfs_mnt_sem = __SEMAPHORE_INITIALIZER( <span class="keyword">self</span>.vfs_mnt_sem, 1 ),</div>
<div class="line">    </div>
<div class="line">    .vfs_mnt = NULL,</div>
<div class="line">    </div>
<div class="line">    .sb = NULL,</div>
<div class="line">    </div>
<div class="line">    .fs_type = {</div>
<div class="line">        .owner          = THIS_MODULE,</div>
<div class="line">        .name           = <span class="stringliteral">&quot;tcmi_ctlfs&quot;</span>,</div>
<div class="line">        .mount          = <a class="code" href="../../d9/d0a/group__tcmi__ctlfs__class.html#ga17d566b46127491aefd74c4f745d28bb" title="&lt;&lt;private&gt;&gt; Super block as assigned a nonexistent device and the super block is obtained via mount_si...">tcmi_ctlfs_get_super</a>,</div>
<div class="line">        .kill_sb        = kill_litter_super, </div>
<div class="line">    },</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>&lt;&lt;singleton&gt;&gt; instance initialization </p>

<p>Definition at line <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html#l00280">280</a> of file <a class="el" href="../../d0/d02/tcmi__ctlfs_8c_source.html">tcmi_ctlfs.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2013 19:06:07 for Clondike by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
